import{_ as ue,A as ce,c as G,r as m,o as pe,n as B,y as W,f as r,b as i,d as S,e as t,u as j,h as me,m as _,k,v as C,l as P,F as V,g as H,t as p,C as ve,T as fe,i as F,p as D,q as n}from"./app-BoyYQDe8.js";import{E as he,a as ge,X as be,u as E,w as ye}from"./xlsx-hePAvcYj.js";import{I as _e}from"./importFile-CtaHyV9s.js";import{P as we}from"./plus-D0XJ_9ss.js";import{P as xe}from"./pencil-CsVFTzWr.js";import"./createLucideIcon-ChBG8ZBO.js";const Se={class:"card border-0 shadow-lg rounded-4"},ke={class:"card-body"},Ce={class:"d-flex flex-wrap gap-2 justify-content-between align-items-center mb-3"},Pe={class:"d-flex flex-wrap gap-2 align-items-center"},De={class:"search-wrap"},Ee={key:1,class:"form-control search-input",placeholder:"Search",disabled:"",type:"text"},Ie={class:"dropdown"},Ae={class:"dropdown-menu dropdown-menu-end shadow rounded-4 py-2"},$e={class:"table-responsive"},Te={class:"table table-hover align-middle"},Ve={key:0},Fe={class:"fw-semibold"},Me={class:"text-break",style:{"max-width":"240px"}},Le={class:"text-truncate",style:{"max-width":"260px"}},Ne={class:"text-center"},Ue={class:"d-inline-flex align-items-center gap-3"},Be=["onClick"],je={key:0},Re={colspan:"7",class:"text-center text-muted py-4"},Oe={key:0,class:"mt-4 d-flex justify-content-between align-items-center"},qe={class:"text-muted small"},Ke={class:"modal fade",id:"modalAddSupplier",tabindex:"-1","aria-labelledby":"modalAddSupplier","aria-hidden":"true"},ze={class:"modal-dialog modal-lg modal-dialog-centered",role:"document"},Xe={class:"modal-content rounded-4"},Ge={class:"modal-header"},We={class:"modal-title fw-semibold"},He={class:"modal-body"},Ye={class:"row g-3"},Je={class:"col-lg-6"},Qe={key:0,class:"text-danger"},Ze={class:"col-lg-6"},et={key:0,class:"text-danger"},tt={class:"col-lg-6"},lt={class:"input-group"},ot={key:0,class:"text-danger d-block mt-1"},st={key:1,class:"text-danger d-block mt-1"},at={key:2,class:"text-success d-block mt-1"},nt={class:"col-lg-6"},rt={class:"col-lg-12"},it={key:0,class:"text-danger"},dt={class:"col-md-2"},ut=["disabled"],ct={key:0,class:"spinner-border spinner-border-sm me-2"},pt=["disabled"],mt={key:0,class:"spinner-border spinner-border-sm me-2"},I="+44",vt={__name:"SuppliersTab",setup(ft){const Y=ce();G(()=>Y.props.onboarding.language_and_location?.country_id??"PK");const w=m([]),g=m({current_page:1,last_page:1,per_page:10,total:0,from:0,to:0,links:[]});m(1),m(15);const x=async(l=null)=>{v.value=!0;try{const{data:e}=await D.get("/suppliers",{params:{q:b.value,page:l||g.value.current_page,per_page:g.value.per_page}});w.value=e.data||[],g.value={current_page:e.current_page,last_page:e.last_page,per_page:e.per_page,total:e.total,from:e.from,to:e.to,links:e.links},await B(),window.feather?.replace()}catch(e){console.error("Failed to fetch suppliers",e),n.error("Failed to load suppliers")}finally{v.value=!1}},J=l=>{if(!l)return;const o=new URLSearchParams(l.split("?")[1]).get("page");o&&x(parseInt(o))},b=m(""),R=m(Date.now()),M=`search-${Math.random().toString(36).substr(2,9)}`,O=m(!1);pe(async()=>{b.value="",R.value=Date.now(),await B(),setTimeout(()=>{O.value=!0;const l=document.getElementById(M);l&&(l.value="",b.value="")},100),await x()});const Q=l=>{l.target.value="",b.value=""},L=G(()=>{const l=b.value.trim().toLowerCase();if(!l)return w.value;const e=l.replace(/\D/g,"");return w.value.filter(o=>{const a=[o.name,o.email,o.address,o.preferred_items].some(c=>(c||"").toLowerCase().includes(l)),f=(o.phone||"").replace(/\D/g,""),h=(o.contact||"").replace(/\D/g,""),u=e&&(f.includes(e)||h.includes(e));return a||u})}),N=l=>{if(!w.value||w.value.length===0){n.error("No suppliers data to download");return}const e=b.value.trim()?L.value:w.value;if(e.length===0){n.error("No suppliers found to download");return}try{l==="pdf"?ee(e):l==="excel"?te(e):l==="csv"?Z(e):n.error("Invalid download type")}catch(o){console.error("Download failed:",o),n.error(`Download failed: ${o.message}`)}},Z=l=>{try{const e=["Name","Email","Phone","Address","Preferred Items"],o=l.map(c=>[`"${c.name||""}"`,`"${c.email||""}"`,`"${c.contact||""}"`,`"${c.address||""}"`,`"${c.preferred_items||""}"`]),a=[e.join(","),...o.map(c=>c.join(","))].join(`
`),f=new Blob([a],{type:"text/csv;charset=utf-8;"}),h=URL.createObjectURL(f),u=document.createElement("a");u.setAttribute("href",h),u.setAttribute("download",`suppliers_${new Date().toISOString().split("T")[0]}.csv`),document.body.appendChild(u),u.click(),document.body.removeChild(u),n.success("CSV downloaded successfully .",{autoClose:2500})}catch(e){console.error("CSV generation error:",e),n.error(`CSV generation failed: ${e.message}`,{autoClose:5e3})}},ee=l=>{try{const e=new he("p","mm","a4");e.setFont("helvetica","bold"),e.setFontSize(18),e.text("Suppliers Report",70,20),e.setFont("helvetica","normal"),e.setFontSize(10);const o=new Date().toLocaleString();e.text(`Generated on: ${o}`,14,30),e.text(`Total Suppliers: ${l.length}`,14,36);const a=["Name","Email","Phone","Address","Preferred Items"],f=l.map(u=>[u.name||"",u.email||"",u.contact||"",u.address||"",u.preferred_items||""]);ge(e,{head:[a],body:f,startY:45,styles:{fontSize:9,cellPadding:3,halign:"left",valign:"middle",lineColor:[200,200,200],lineWidth:.1},headStyles:{fillColor:[41,128,185],textColor:255,fontStyle:"bold"},alternateRowStyles:{fillColor:[245,245,245]},margin:{left:14,right:14},didDrawPage:u=>{const c=e.internal.getNumberOfPages(),de=e.internal.pageSize.height;e.setFontSize(8),e.text(`Page ${u.pageNumber} of ${c}`,14,de-10)}});const h=`suppliers_${new Date().toISOString().split("T")[0]}.pdf`;e.save(h),n.success("PDF downloaded successfully.",{autoClose:2500})}catch(e){console.error("PDF generation error:",e),n.error(`PDF generation failed: ${e.message}`,{autoClose:5e3})}},te=l=>{try{if(typeof be>"u")throw new Error("XLSX library is not loaded");const e=l.map(c=>({Name:c.name||"",Email:c.email||"",Phone:c.contact||"",Address:c.address||"","Preferred Items":c.preferred_items||""})),o=E.book_new(),a=E.json_to_sheet(e);a["!cols"]=[{wch:20},{wch:25},{wch:18},{wch:30},{wch:25}],E.book_append_sheet(o,a,"Suppliers");const f=[{Info:"Generated On",Value:new Date().toLocaleString()},{Info:"Total Records",Value:l.length},{Info:"Exported By",Value:"Supplier Management System"}],h=E.json_to_sheet(f);E.book_append_sheet(o,h,"Report Info");const u=`suppliers_${new Date().toISOString().split("T")[0]}.xlsx`;ye(o,u),n.success("Excel file downloaded successfully.",{autoClose:2500})}catch(e){console.error("Excel generation error:",e),n.error(`Excel generation failed: ${e.message}`,{autoClose:5e3})}},s=m({name:"",email:"",phone_country:"GB",phone_code:I,phone_local:"",phone:"",address:"",preferred_items:""}),y=m(""),A=m(!1),q=m([]),K=()=>{y.value="",q.value=[],A.value=!1;const l=String(s.value.phone_local||"").trim();if(!l)return y.value="Phone number is required",!1;let e=l.replace(/\D+/g,"");if(e.length!==10)return y.value="UK mobile number must be exactly 10 digits",!1;if(!e.startsWith("7"))return y.value="UK mobile numbers must start with 7",!1;if(!/^7[0-9]{9}$/.test(e))return y.value="Invalid UK mobile number format",!1;const a=e.substring(1,3);return["11","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99"].includes(a)?(A.value=!0,!0):(y.value="Invalid UK mobile operator code",!1)};function le(){const l=String(s.value.phone_local||"").replace(/\D+/g,"");s.value.phone=I+l}W(()=>s.value.phone_local,l=>{le(),K()});let z=null;W(b,()=>{clearTimeout(z),z=setTimeout(()=>{g.value.current_page=1,x(1)},500)});const v=m(!1),d=m({}),X=l=>{const e=document.getElementById(l);if(!e)return;(window.bootstrap?.Modal.getInstance(e)||new window.bootstrap.Modal(e)).hide()},U=()=>{s.value={name:"",email:"",phone:"",address:"",preferred_items:""},d.value={},T.value=null},oe=()=>{v.value=!0,d.value={};const l={name:s.value.name,email:s.value.email,contact:s.value.phone||null,address:s.value.address||null,preferred_items:s.value.preferred_items||null};D.post("/suppliers",l).then(e=>{x(),n.success("Supplier added successfully.",{autoClose:1500}),U(),X("modalAddSupplier")}).catch(e=>{e?.response?.status===422&&e.response.data?.errors?(d.value=e.response.data.errors,n.error("Please fill in all required fields correctly.")):(n.error("Something went wrong. Please try again.",{autoClose:3e3}),console.error(e))}).finally(()=>{v.value=!1})},se=l=>{const e=document.getElementById(l);if(!e)return;new window.bootstrap.Modal(e).show()},$=m(),T=m(null),ae=l=>{$.value="Edit",T.value=l,s.value={name:l.name||"",email:l.email||"",phone_country:"GB",phone_code:I,phone_local:l.phone?l.phone.replace(I,"").trim():l.contact?l.contact.replace(I,"").trim():"",phone:l.phone||l.contact||"",address:l.address||"",preferred_items:l.preferred_items??l.preferred_items??""},se("modalAddSupplier")},ne=()=>{if(!T.value)return;v.value=!0,d.value={};const l={id:T.value.id,name:s.value.name,email:s.value.email,contact:s.value.phone||null,address:s.value.address||null,preferred_items:s.value.preferred_items||null};D.post("/suppliers/update",l).then(e=>(x(),n.success("Supplier updated successfully .",{autoClose:500}),U(),X("modalAddSupplier"),B())).catch(e=>{e?.response?.status===422&&e.response.data?.errors?(d.value=e.response.data.errors,n.error("Validation failed. Please check the fields.",{autoClose:3e3})):(n.error("Update failed. Please try again.",{autoClose:3e3}),console.error(e))}).finally(()=>{v.value=!1})},re=l=>{v.value=!0,D.delete(`/suppliers/${l}`).then(()=>{w.value=w.value.filter(e=>e.id!==l),n.success("Supplier deleted successfully.")}).catch(e=>{n.error("Delete failed. Please try again.",{autoClose:3e3}),console.error(e)}).finally(()=>{v.value=!1})},ie=l=>{if(!l||l.length<=1){n.error("The file is empty",{autoClose:3e3});return}l[0];const o=l.slice(1).map(a=>({name:a[0]||"",email:a[1]||"",contact:a[2]||"",address:a[3]||"",preferred_items:a[4]||""}));D.post("/api/suppliers/import",{suppliers:o}).then(()=>{n.success("Suppliers imported successfully");const a=document.querySelector(".modal.show");if(a){const f=bootstrap.Modal.getInstance(a);f&&f.hide()}setTimeout(()=>{document.querySelectorAll(".modal-backdrop").forEach(h=>h.remove()),document.body.classList.remove("modal-open"),document.body.style.overflow="",document.body.style.paddingRight=""},100),x()}).catch(a=>{a?.response?.status===422&&a.response.data?.errors&&(d.value=a.response.data.errors,n.error("There may be some duplication in data",{autoClose:3e3})),setTimeout(()=>{document.querySelectorAll(".modal-backdrop").forEach(h=>h.remove()),document.body.classList.remove("modal-open"),document.body.style.overflow="",document.body.style.paddingRight=""},100)})};return(l,e)=>(i(),r(V,null,[S(j(me),{title:"Supplier"}),t("div",Se,[t("div",ke,[t("div",Ce,[e[16]||(e[16]=t("h4",{class:"mb-0"},"Suppliers",-1)),t("div",Pe,[t("div",De,[e[12]||(e[12]=t("i",{class:"bi bi-search"},null,-1)),e[13]||(e[13]=t("input",{type:"email",name:"email",autocomplete:"email",style:{position:"absolute",left:"-9999px",width:"1px",height:"1px"},tabindex:"-1","aria-hidden":"true"},null,-1)),O.value?k((i(),r("input",{id:M,"onUpdate:modelValue":e[0]||(e[0]=o=>b.value=o),key:R.value,class:"form-control search-input",placeholder:"Search",type:"search",autocomplete:"new-password",name:M,role:"presentation",onFocus:Q},null,32)),[[C,b.value]]):(i(),r("input",Ee))]),t("button",{"data-bs-toggle":"modal","data-bs-target":"#modalAddSupplier",onClick:e[1]||(e[1]=()=>{U(),d.value={},$.value="Add"}),class:"d-flex align-items-center gap-1 px-4 btn-sm py-2 rounded-pill btn-sm btn btn-primary text-white"},[S(j(we),{class:"w-4 h-4"}),e[14]||(e[14]=P(" Add Supplier ",-1))]),S(_e,{label:"Import",sampleHeaders:["Name","Email","Phone","Address","Preferred Items"],sampleData:[["Ali Khan","ali@example.com","+44 3721232321","Lahore","Steel"],["Ahmed Raza","ahmed@example.com","+44 5676576576","Karachi","Cement"]],onOnImport:ie}),t("div",Ie,[e[15]||(e[15]=t("button",{class:"btn btn-outline-secondary btn-sm rounded-pill py-2 px-4 dropdown-toggle","data-bs-toggle":"dropdown"}," Export ",-1)),t("ul",Ae,[t("li",null,[t("a",{class:"dropdown-item py-2",href:"javascript:;",onClick:e[2]||(e[2]=o=>N("pdf"))}," Export as PDF ")]),t("li",null,[t("a",{class:"dropdown-item py-2",href:"javascript:;",onClick:e[3]||(e[3]=o=>N("excel"))}," Export as Excel ")]),t("li",null,[t("a",{class:"dropdown-item py-2",href:"javascript:;",onClick:e[4]||(e[4]=o=>N("csv"))}," Export as CSV ")])])])])]),t("div",$e,[t("table",Te,[e[18]||(e[18]=t("thead",{class:"border-top small text-muted"},[t("tr",null,[t("th",null,"S. #"),t("th",null,"Supplier name"),t("th",null,"Contact"),t("th",null,"Email"),t("th",null,"Address"),t("th",null,"Items Linked"),t("th",{class:"text-center"},"Action")])],-1)),t("tbody",null,[v.value?(i(),r("tr",Ve,[...e[17]||(e[17]=[t("td",{colspan:"7",class:"text-center py-5"},[t("div",{class:"spinner-border text-primary",role:"status"},[t("span",{class:"visually-hidden"},"Loading...")]),t("p",{class:"text-muted mt-2 mb-0"},"Loading suppliers...")],-1)])])):(i(),r(V,{key:1},[(i(!0),r(V,null,H(L.value,(o,a)=>(i(),r("tr",{key:o.id},[t("td",null,p(g.value.from+a),1),t("td",Fe,p(o.name),1),t("td",null,p(o.contact),1),t("td",Me,p(o.email),1),t("td",Le,p(o.address),1),t("td",null,p(o.preferred_items),1),t("td",Ne,[t("div",Ue,[t("button",{onClick:()=>{ae(o),d.value={}},title:"Edit",class:"p-2 rounded-full text-blue-600 hover:bg-blue-100"},[S(j(xe),{class:"w-4 h-4"})],8,Be),S(ve,{title:"Confirm Delete",message:`Are you sure you want to delete ${o.name}?`,showDeleteButton:!0,onConfirm:()=>re(o.id),onCancel:()=>{}},null,8,["message","onConfirm"])])])]))),128)),L.value.length===0?(i(),r("tr",je,[t("td",Re,p(b.value.trim()?"No suppliers found matching your search.":"No suppliers found."),1)])):_("",!0)],64))])])]),!v.value&&g.value.last_page>1?(i(),r("div",Oe,[t("div",qe," Showing "+p(g.value.from)+" to "+p(g.value.to)+" of "+p(g.value.total)+" entries ",1),S(fe,{pagination:g.value.links,isApiDriven:!0,onPageChanged:J},null,8,["pagination"])])):_("",!0)])]),t("div",Ke,[t("div",ze,[t("div",Xe,[t("div",Ge,[t("h5",We,p($.value==="Add"?"Add Supplier":"Edit Supplier"),1),e[19]||(e[19]=t("button",{class:"absolute top-2 right-2 p-2 rounded-full hover:bg-gray-100 transition transform hover:scale-110","data-bs-dismiss":"modal","aria-label":"Close",title:"Close"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})])],-1))]),t("div",He,[t("div",Ye,[t("div",Je,[e[20]||(e[20]=t("label",{class:"form-label"},"Name",-1)),k(t("input",{class:F(["form-control",{"is-invalid":d.value.name}]),"onUpdate:modelValue":e[5]||(e[5]=o=>s.value.name=o)},null,2),[[C,s.value.name]]),d.value.name?(i(),r("small",Qe,p(d.value.name[0]),1)):_("",!0)]),t("div",Ze,[e[21]||(e[21]=t("label",{class:"form-label"},"Email",-1)),k(t("input",{class:F(["form-control",{"is-invalid":d.value.email}]),"onUpdate:modelValue":e[6]||(e[6]=o=>s.value.email=o)},null,2),[[C,s.value.email]]),d.value.email?(i(),r("small",et,p(d.value.email[0]),1)):_("",!0)]),t("div",tt,[e[26]||(e[26]=t("label",{class:"form-label"},"Phone*",-1)),t("div",lt,[e[22]||(e[22]=t("span",{class:"input-group-text p-0"},[t("input",{type:"text",class:"form-control text-center border-0 country-code bg-light fw-semibold",value:"+44",readonly:"",style:{width:"70px"}})],-1)),k(t("input",{class:F(["form-control phone-input",{"is-invalid":y.value,"is-valid":A.value&&s.value.phone_local}]),inputmode:"numeric",placeholder:"7311865859","onUpdate:modelValue":e[7]||(e[7]=o=>s.value.phone_local=o),onBlur:K,maxlength:"10"},null,34),[[C,s.value.phone_local]])]),y.value?(i(),r("small",ot,[e[23]||(e[23]=t("i",{class:"bi bi-exclamation-circle me-1"},null,-1)),P(p(y.value),1)])):d.value.contact?(i(),r("small",st,p(d.value.contact[0]),1)):_("",!0),A.value&&s.value.phone_local?(i(),r("small",at,[...e[24]||(e[24]=[t("i",{class:"bi bi-check-circle me-1"},null,-1),P("âœ“ Valid UK phone number ",-1)])])):_("",!0),(i(!0),r(V,null,H(q.value,(o,a)=>(i(),r("small",{key:a,class:"text-info d-block mt-1"},[e[25]||(e[25]=t("i",{class:"bi bi-info-circle me-1"},null,-1)),P(p(o),1)]))),128))]),t("div",nt,[e[27]||(e[27]=t("label",{class:"form-label"},"Preferred Items",-1)),k(t("input",{class:"form-control","onUpdate:modelValue":e[8]||(e[8]=o=>s.value.preferred_items=o)},null,512),[[C,s.value.preferred_items]])]),t("div",rt,[e[28]||(e[28]=t("label",{class:"form-label"},"Address",-1)),k(t("textarea",{class:F(["form-control",{"is-invalid":d.value.address}]),rows:"4","onUpdate:modelValue":e[9]||(e[9]=o=>s.value.address=o)},null,2),[[C,s.value.address]]),d.value.address?(i(),r("small",it,p(d.value.address[0]),1)):_("",!0)]),t("div",dt,[$.value==="Edit"?(i(),r("button",{key:0,class:"btn btn-primary btn-sm py-2 rounded-pill w-100 mt-4",disabled:v.value,onClick:e[10]||(e[10]=o=>ne())},[v.value?(i(),r("span",ct)):_("",!0),e[29]||(e[29]=P(" Save ",-1))],8,ut)):(i(),r("button",{key:1,class:"btn btn-primary rounded-pill btn-sm py-2 w-100 mt-4",disabled:v.value,onClick:e[11]||(e[11]=o=>oe())},[v.value?(i(),r("span",mt)):_("",!0),e[30]||(e[30]=P(" Save ",-1))],8,pt))])])])])])])],64))}},xt=ue(vt,[["__scopeId","data-v-6bfdd882"]]);export{xt as default};
