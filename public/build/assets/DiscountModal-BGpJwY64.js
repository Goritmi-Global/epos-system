import{_ as q,r as w,c as M,f as n,m as d,b as i,e as t,t as o,k,v as A,S as R,F as J,g as Q,i as W,x as Y,l as L,u as N}from"./app-DrUr72II.js";import{u as G}from"./useFormatters-DMzlbhVl.js";const H={key:0,class:"modal fade show",tabindex:"-1","aria-hidden":"true",style:{display:"block"}},K={class:"modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable"},O={class:"modal-content rounded-4 border-0 shadow"},X={class:"modal-header border-0"},Z={class:"d-flex align-items-center gap-3"},ee={key:0,class:"badge bg-primary"},te={class:"modal-body"},se={class:"filters-section mb-4"},le={class:"mb-3"},ae={class:"input-group"},oe={class:"row g-3"},ne={class:"col-md-4"},ie={class:"col-md-4"},re={class:"col-md-4"},de={key:0,class:"mt-3 d-flex align-items-center justify-content-between"},ce={class:"d-flex flex-wrap gap-2"},ue={class:"badge bg-secondary"},me={key:0,class:"badge bg-info"},pe={key:1,class:"badge bg-primary"},ve={key:2,class:"badge bg-warning"},he={key:3,class:"badge bg-success"},be={key:0,class:"text-center py-5"},fe={key:1},ge={key:0,class:"alert alert-light text-center dark:bg-gray-800 dark:text-white border-0"},ye={class:"mb-2"},_e={class:"text-muted"},xe={key:1,class:"discount-grid"},we=["onClick"],ke={class:"discount-checkbox"},De=["checked","disabled","onClick"],Ce={class:"discount-header d-flex align-items-center justify-content-between"},Me={class:"fw-bold fs-6"},Ae={class:"d-flex gap-2 align-items-center"},Fe={class:"badge bg-primary text-white small"},Pe={key:0,class:"badge bg-success text-white small"},Ie={key:1,class:"badge bg-danger text-white small"},Se={class:"discount-desc"},$e={class:"discount-applies-to small mb-2"},je={class:"badge bg-success-subtle text-success ms-1"},Le={class:"discount-info small"},Ne={class:"discount-info small"},Be={class:"discount-amount d-flex justify-content-between align-items-center mt-2"},Te={class:"fw-bold fs-5 text-danger"},Ve={key:0,class:"alert alert-warning p-2 mt-2 mb-0 small"},ze={class:"modal-footer border-0 justify-content-between"},Ee={key:0,class:"d-flex gap-2 align-items-center"},Ue={class:"text-end me-3"},qe={class:"d-block text-muted"},Re={class:"text-success fs-5"},Je=["disabled"],Qe={key:0,class:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"},We={__name:"DiscountModal",props:{show:Boolean,discounts:{type:Array,default:()=>[]},orderItems:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1},appliedDiscounts:{type:Array,default:()=>[]},rejectedDiscounts:{type:Array,default:()=>[]}},emits:["close","apply-discount","clear-discount"],setup(v,{emit:B}){const{formatCurrencySymbol:F}=G(),p=v,P=B,r=w([]),u=w(""),a=w({type:"",maxMinPurchase:null,minDiscount:null}),f=l=>p.appliedDiscounts.some(e=>e.id===l.id),g=l=>p.rejectedDiscounts.some(e=>e.id===l.id),I=l=>{if(f(l)||g(l))return;const e=r.value.findIndex(s=>s.id===l.id);e>=0?r.value.splice(e,1):r.value.push(l)},S=l=>r.value.some(e=>e.id===l.id),h=w(!1),T=async()=>{if(h.value)return;const l=r.value.filter(e=>j(e));if(l.length!==0)try{h.value=!0;const e=l.map(s=>{const c=parseFloat(_(s));return{...s,applied_discount:c,applied_to_items:p.orderItems.map(b=>b.id),applied_subtotal:y(),discount_id:s.id}});P("apply-discount",e)}finally{r.value=[],setTimeout(()=>{h.value=!1},500)}},V=()=>{r.value=[],P("clear-discount")},z=()=>{u.value="",a.value={type:"",maxMinPurchase:null,minDiscount:null}},D=M(()=>u.value||a.value.type||a.value.maxMinPurchase!==null||a.value.minDiscount!==null),E=M(()=>r.value.reduce((l,e)=>l+parseFloat(_(e)),0)),$=l=>l?new Date(l).toLocaleDateString():"-",m=l=>{const e=parseFloat(l);return isNaN(e)?"0.00":e.toFixed(2)},y=()=>p.orderItems.reduce((l,e)=>{const s=parseFloat(e.unit_price??e.price??0)||0,c=parseFloat(e.qty??0)||0;return l+s*c},0),_=l=>{const e=parseFloat(l.discount_amount??0)||0,s=y();if(l.min_purchase&&s<parseFloat(l.min_purchase))return m(0);if(l.type==="flat")return m(e);if(l.type==="percent"){const c=s*e/100,b=parseFloat(l.max_discount??0)||0;return b>0&&c>b?m(b):m(c)}return m(0)},j=l=>{if(p.orderItems.length===0)return!1;const e=y(),s=parseFloat(l.min_purchase||0);return e>=s},U=l=>{if(p.orderItems.length===0)return"Add items to cart to use this discount";const e=y(),s=parseFloat(l.min_purchase||0);if(e<s){const c=s-e;return`Need $${m(c)} more for min purchase`}return""},x=()=>{a.value={...a.value}},C=M(()=>{let l=[...p.discounts];if(u.value){const e=u.value.toLowerCase();l=l.filter(s=>s.name.toLowerCase().includes(e)||s.description&&s.description.toLowerCase().includes(e))}return a.value.type&&(l=l.filter(e=>e.type===a.value.type)),a.value.maxMinPurchase!==null&&a.value.maxMinPurchase>0&&(l=l.filter(e=>parseFloat(e.min_purchase||0)<=a.value.maxMinPurchase)),a.value.minDiscount!==null&&a.value.minDiscount>0&&(l=l.filter(e=>parseFloat(_(e))>=a.value.minDiscount)),l});return(l,e)=>v.show?(i(),n("div",H,[t("div",K,[t("div",O,[t("div",X,[t("div",Z,[e[6]||(e[6]=t("h5",{class:"modal-title fw-bold mb-0"},"Select Discounts",-1)),r.value.length>0?(i(),n("span",ee,o(r.value.length)+" Selected ",1)):d("",!0)]),t("button",{class:"absolute top-2 right-2 p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-100 transition transform hover:scale-110",onClick:e[0]||(e[0]=s=>l.$emit("close")),"aria-label":"Close",title:"Close"},[...e[7]||(e[7]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),t("div",te,[t("div",se,[t("div",le,[t("div",ae,[e[8]||(e[8]=t("span",{class:"input-group-text bg-light border-end-0"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"},[t("path",{d:"M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"})])],-1)),k(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>u.value=s),type:"text",class:"form-control border-start-0",placeholder:"Search discounts by name or description...",onInput:x},null,544),[[A,u.value]])])]),t("div",oe,[t("div",ne,[e[10]||(e[10]=t("label",{class:"form-label small fw-semibold"},"Discount Type",-1)),k(t("select",{"onUpdate:modelValue":e[2]||(e[2]=s=>a.value.type=s),onChange:x,class:"form-select form-select-sm"},[...e[9]||(e[9]=[t("option",{value:""},"All Types",-1),t("option",{value:"flat"},"Flat Discount",-1),t("option",{value:"percent"},"Percentage",-1)])],544),[[R,a.value.type]])]),t("div",ie,[e[11]||(e[11]=t("label",{class:"form-label small fw-semibold"},"Max Min Purchase",-1)),k(t("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>a.value.maxMinPurchase=s),type:"number",class:"form-control form-control-sm",placeholder:"e.g., 50",step:"0.01",onInput:x},null,544),[[A,a.value.maxMinPurchase,void 0,{number:!0}]])]),t("div",re,[e[12]||(e[12]=t("label",{class:"form-label small fw-semibold"},"Min Discount",-1)),k(t("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>a.value.minDiscount=s),type:"number",class:"form-control form-control-sm",placeholder:"e.g., 5",step:"0.01",onInput:x},null,544),[[A,a.value.minDiscount,void 0,{number:!0}]])])]),D.value?(i(),n("div",de,[t("div",ce,[t("span",ue,o(C.value.length)+" of "+o(v.discounts.length)+" discounts",1),u.value?(i(),n("span",me,'Search: "'+o(u.value)+'"',1)):d("",!0),a.value.type?(i(),n("span",pe,"Type: "+o(a.value.type),1)):d("",!0),a.value.maxMinPurchase?(i(),n("span",ve,"Max Min: $"+o(a.value.maxMinPurchase),1)):d("",!0),a.value.minDiscount?(i(),n("span",he,"Min Discount: $"+o(a.value.minDiscount),1)):d("",!0)]),t("button",{onClick:z,class:"btn btn-sm btn-outline-secondary"},"Clear Filters")])):d("",!0)]),v.loading?(i(),n("div",be,[...e[13]||(e[13]=[t("div",{class:"spinner-border text-primary",role:"status"},[t("span",{class:"visually-hidden"},"Loading...")],-1),t("p",{class:"mt-3 text-muted"},"Loading discounts...",-1)])])):(i(),n("div",fe,[C.value.length===0?(i(),n("div",ge,[t("p",ye,o(u.value||D.value?"No discounts match your filters":"No discounts available"),1),t("small",_e,o(D.value?"Try adjusting your filters":"Check back later for available discounts"),1)])):(i(),n("div",xe,[(i(!0),n(J,null,Q(C.value,s=>(i(),n("div",{key:s.id,class:W(["discount-card",{selected:S(s),"already-applied":f(s),rejected:g(s)}]),onClick:c=>I(s)},[t("div",ke,[t("input",{type:"checkbox",checked:S(s),disabled:f(s)||g(s),onClick:Y(c=>I(s),["stop"]),class:"form-check-input"},null,8,De)]),t("div",Ce,[t("span",Me,o(s.name),1),t("div",Ae,[t("span",Fe,o(s.type.toUpperCase()),1),f(s)?(i(),n("span",Pe," ✓ APPLIED ")):d("",!0),g(s)?(i(),n("span",Ie," ✗ REJECTED ")):d("",!0)])]),t("p",Se,o(s.description||"Special discount offer"),1),t("div",$e,[e[14]||(e[14]=t("span",{class:"badge bg-info-subtle text-info"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",fill:"currentColor",class:"me-1",viewBox:"0 0 16 16"},[t("path",{d:"M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"}),t("path",{d:"M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"})]),L(" Applies to all cart items ")],-1)),t("span",je,o(v.orderItems.length)+" item(s) in cart ",1)]),t("div",Le," Valid: "+o($(s.start_date))+" → "+o($(s.end_date)),1),t("div",Ne," Min: $"+o(m(s.min_purchase))+" | Max: $"+o(s.max_discount?m(s.max_discount):"—"),1),t("div",Be,[e[15]||(e[15]=t("span",{class:"fw-semibold"},"You Save:",-1)),t("span",Te,o(N(F)(_(s))),1)]),j(s)?d("",!0):(i(),n("div",Ve,o(U(s)),1))],10,we))),128))]))]))]),t("div",ze,[t("button",{class:"btn btn-secondary rounded-pill py-2 px-4",onClick:e[5]||(e[5]=s=>l.$emit("close"))},"Close"),r.value.length>0?(i(),n("div",Ee,[t("div",Ue,[t("small",qe,o(r.value.length)+" Discount(s) • "+o(v.orderItems.length)+" Item(s) ",1),t("strong",Re,o(N(F)(E.value)),1)]),t("button",{class:"btn btn-success rounded-pill px-4",onClick:T,disabled:h.value},[h.value?(i(),n("span",Qe)):d("",!0),L(" "+o(h.value?"Applying...":`Apply (${r.value.length})`),1)],8,Je),t("button",{class:"btn btn-outline-danger rounded-pill",onClick:V},"Clear")])):d("",!0)])])]),e[16]||(e[16]=t("div",{class:"modal-backdrop fade show"},null,-1))])):d("",!0)}},He=q(We,[["__scopeId","data-v-e04dd8b3"]]);export{He as default};
