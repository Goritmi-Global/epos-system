import{C as U,r as p,k as F,H as O,g as a,o as n,b as t,i as v,F as w,v as x,t as l,d as c,n as C,a as S,x as b,y as h,A as L,m as _}from"./app-CYEkE9GK.js";import{u as $}from"./useFormatters-BBfJnlDF.js";import{P as Q}from"./pencil-CHVYe7FI.js";import{E as z}from"./eye-B5CHwhPQ.js";import"./createLucideIcon-BvjKrCmJ.js";const H={class:"table-responsive"},R={class:"table table-hover align-middle"},G={class:"fw-semibold text-capitalize"},J={class:"text-break"},K={key:1,class:"text-muted"},W={class:"text-end"},X=["onClick"],Y=["onClick"],Z={key:0},tt={class:"modal fade",id:"viewLogModal_out",tabindex:"-1","aria-hidden":"true"},et={class:"modal-dialog modal-lg modal-dialog-centered"},st={class:"modal-content rounded-4 shadow-lg border-0"},ot={class:"modal-header align-items-center"},lt={class:"d-flex align-items-center gap-2"},at={class:"d-flex flex-column"},nt={class:"text-muted"},dt={class:"modal-body p-4 bg-light"},it={key:0,class:"row g-4"},rt={class:"col-lg-12"},ut={class:"card border-0 shadow-sm rounded-4 h-100"},ct={class:"card-body"},mt={class:"row g-3"},pt={class:"col-md-6"},vt={class:"fw-semibold"},gt={class:"col-md-6"},yt={class:"badge rounded-pill bg-danger"},bt={class:"row g-3 text-center"},ht={class:"col-md-12"},_t={class:"p-3 bg-light rounded-3"},ft={class:"fs-6 fw-semibold"},kt={class:"table-responsive"},wt={class:"table table-hover align-middle"},xt={key:0},Ct={class:"modal fade",id:"editLogModal_out",tabindex:"-1","aria-hidden":"true"},St={class:"modal-dialog modal-lg modal-dialog-centered"},Lt={class:"modal-content rounded-4"},Mt={class:"modal-body"},Tt={class:"row g-3"},qt={class:"col-md-6 col-md-12"},Nt={class:"col-md-6 col-md-12"},Et={key:0,class:"text-danger"},Vt={class:"col-md-6 col-md-12"},It={class:"mt-4"},Pt=["disabled","aria-busy"],At={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},Ot={__name:"StockOutLogs",props:{logs:{type:Array,default:()=>[]},q:{type:String,default:""}},emits:["updated"],setup(M,{emit:T}){const{formatCurrencySymbol:q,dateFmt:g}=$(),f=M,N=T,k=U(()=>{const o=(f.q||"").trim().toLowerCase(),e=f.logs.filter(s=>s.type==="stockout");return o?e.filter(s=>[s.itemName,s.category?.name||s.category||"",s.operationType,s.type,String(s.quantity),String(s.totalPrice),s.dateTime??""].join(" ").toLowerCase().includes(o)):e}),E=o=>(o??"").toString().replace(/[_-]+/g," ").trim().replace(/\w\S*/g,e=>e[0].toUpperCase()+e.slice(1).toLowerCase()),V=o=>({inventory_stockin:"Inventory Stockin",inventory_stockout:"Inventory Stockout",purchase:"Purchase",adjustment:"Adjustment",return:"Return"})[o]??E(o),I=o=>{switch(o){case"inventory_stockin":case"purchase":return"text-success";case"inventory_stockout":return"text-danger";case"adjustment":return"text-warning";default:return"text-secondary"}},i=p(null),m=p([]),u=p({}),d=p({id:null,itemName:"",quantity:"",totalPrice:"",operationType:"",type:"stockout"}),P=async o=>{try{const{data:e}=await L.get(`stock_entries/stock-logs/${o}/allocations`);console.log(e),m.value=e||[]}catch(e){m.value=[],console.error(e)}},A=async o=>{i.value=o,m.value=[],await P(o.id),new bootstrap.Modal(document.getElementById("viewLogModal_out")).show()};function B(o){d.value={...o},new bootstrap.Modal(document.getElementById("editLogModal_out")).show()}const r=p(!1),j=()=>u.value={};async function D(){if(!r.value){r.value=!0,u.value={};try{await L.put(`stock_entries/stock-logs/${d.value.id}`,d.value),_.success("Stock log updated successfully"),N("updated");const o=bootstrap.Modal.getInstance(document.getElementById("editLogModal_out"));o&&o.hide()}catch(o){o?.response?.status===422&&o.response.data?.errors?(u.value=o.response.data.errors,_.error("Please fill in all required fields correctly.")):(_.error("Something went wrong. Please try again."),console.error(o))}finally{r.value=!1}}}return F(()=>window.feather?.replace()),O(()=>window.feather?.replace()),(o,e)=>(n(),a("div",null,[t("div",H,[t("table",R,[e[4]||(e[4]=t("thead",{class:"small text-muted"},[t("tr",null,[t("th",null,"Item name"),t("th",null,"Quantity"),t("th",null,"Category"),t("th",null,"Date & Time"),t("th",null,"Operation Type"),t("th",{class:"text-end"},"Action")])],-1)),t("tbody",null,[(n(!0),a(w,null,x(k.value,s=>(n(),a("tr",{key:s.id},[t("td",G,l(s.itemName),1),t("td",null,l(s.quantity),1),t("td",null,l(s.category?.name||s.category),1),t("td",null,l(c(g)(s.dateTime)),1),t("td",J,[s.operationType?(n(),a("span",{key:0,class:C(["fw-semibold",I(s.operationType)])},l(V(s.operationType)),3)):(n(),a("span",K,"—"))]),t("td",W,[t("button",{class:"p-2 rounded-full text-blue-600 hover:bg-blue-100",onClick:y=>B(s),title:"Adjustment"},[S(c(Q),{class:"w-4 h-4"})],8,X),t("button",{class:"p-2 rounded-full text-primary hover:bg-blue-100",onClick:y=>A(s),title:"Show"},[S(c(z),{class:"w-4 h-4"})],8,Y)])]))),128)),k.value.length===0?(n(),a("tr",Z,[...e[3]||(e[3]=[t("td",{colspan:"10",class:"text-center text-muted py-4"}," No logs found. ",-1)])])):v("",!0)])])]),t("div",tt,[t("div",et,[t("div",st,[t("div",ot,[t("div",lt,[e[6]||(e[6]=t("span",{class:"badge bg-primary rounded-circle p-2"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3 7.5L12 12l9-4.5M3 7.5V17a2 2 0 002 2h14a2 2 0 002-2V7.5M21 7.5L12 3 3 7.5"})])],-1)),t("div",at,[e[5]||(e[5]=t("h5",{class:"modal-title mb-0"},"View Stock Log",-1)),t("small",nt,"Item: "+l(i.value?.itemName??"—"),1)])]),e[7]||(e[7]=t("button",{class:"absolute top-2 right-2 p-2 rounded-full hover:bg-gray-100 transition transform hover:scale-110","data-bs-dismiss":"modal","aria-label":"Close",title:"Close"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-danger",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})])],-1))]),t("div",dt,[i.value?(n(),a("div",it,[t("div",rt,[t("div",ut,[t("div",ct,[e[13]||(e[13]=t("h6",{class:"fw-semibold mb-3"}," Details ",-1)),t("div",mt,[t("div",pt,[e[8]||(e[8]=t("small",{class:"text-muted d-block"},"Category",-1)),t("div",vt,l(i.value.category?.name??i.value.category??"—"),1)]),t("div",gt,[e[9]||(e[9]=t("small",{class:"text-muted d-block"},"Operation",-1)),t("span",yt,l(i.value.operationType??"—"),1)])]),e[14]||(e[14]=t("hr",{class:"my-4"},null,-1)),t("div",bt,[t("div",ht,[t("div",_t,[e[10]||(e[10]=t("small",{class:"text-muted d-block"},"Date",-1)),t("div",ft,l(c(g)(i.value.dateTime)),1)])])]),e[15]||(e[15]=t("hr",{class:"my-4"},null,-1)),e[16]||(e[16]=t("h6",{class:"fw-semibold mb-3"}," Stock-out Allocation ",-1)),t("div",kt,[t("table",wt,[e[12]||(e[12]=t("thead",{class:"small text-muted"},[t("tr",null,[t("th",null,"#"),t("th",null,"Expiry Date"),t("th",null,"Unit Price"),t("th",null,"Allocated Qty")])],-1)),t("tbody",null,[(n(!0),a(w,null,x(m.value,(s,y)=>(n(),a("tr",{key:s.id},[t("td",null,l(y+1),1),t("td",null,l(c(g)(s.expiry_date?new Date(s.expiry_date).toISOString().slice(0,10):"—")),1),t("td",null,l(c(q)(s.unit_price??0)),1),t("td",null,l(s.quantity),1)]))),128)),m.value.length===0?(n(),a("tr",xt,[...e[11]||(e[11]=[t("td",{colspan:"5",class:"text-center text-muted py-3"}," No allocation history. ",-1)])])):v("",!0)])])])])])])])):v("",!0)])])])]),t("div",Ct,[t("div",St,[t("div",Lt,[t("div",{class:"modal-header"},[e[18]||(e[18]=t("h5",{class:"modal-title fw-semibold"},"Edit Stock Log",-1)),t("button",{class:"absolute top-2 right-2 p-2 rounded-full hover:bg-gray-100 transition transform hover:scale-110","data-bs-dismiss":"modal","aria-label":"Close",title:"Close",onClick:j},[...e[17]||(e[17]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),t("div",Mt,[t("div",Tt,[t("div",qt,[e[19]||(e[19]=t("label",{class:"form-label"},"Item Name",-1)),b(t("input",{type:"text",class:"form-control","onUpdate:modelValue":e[0]||(e[0]=s=>d.value.itemName=s),disabled:""},null,512),[[h,d.value.itemName]])]),t("div",Nt,[e[20]||(e[20]=t("label",{class:"form-label"},"Quantity",-1)),b(t("input",{type:"number",class:C(["form-control",{"is-invalid":u.value.quantity}]),"onUpdate:modelValue":e[1]||(e[1]=s=>d.value.quantity=s),required:""},null,2),[[h,d.value.quantity]]),u.value.quantity?(n(),a("small",Et,l(u.value.quantity[0]),1)):v("",!0)]),t("div",Vt,[e[21]||(e[21]=t("label",{class:"form-label"},"Value",-1)),b(t("input",{type:"number",readonly:"",class:"form-control","onUpdate:modelValue":e[2]||(e[2]=s=>d.value.totalPrice=s)},null,512),[[h,d.value.totalPrice]])]),t("div",It,[t("button",{class:"btn btn-primary rounded-pill px-4 d-inline-flex align-items-center gap-2",disabled:r.value,"aria-busy":r.value?"true":"false",onClick:D},[r.value?(n(),a("span",At)):v("",!0),t("span",null,l(r.value?"Saving…":"Save"),1)],8,Pt)])])])])])])]))}};export{Ot as default};
