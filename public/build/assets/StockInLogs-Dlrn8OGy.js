import{r as v,c as I,w as V,o as X,I as Z,E as tt,g as n,b as i,f as t,l as y,F as E,i as et,t as l,u,j as x,e as k,P as st,m as w,v as D,q as N,s as P}from"./app-O8d-RKSx.js";import{u as at}from"./useFormatters-aJ2eP44t.js";import{P as lt}from"./pencil-yTKtpRsR.js";import{E as ot}from"./eye-KGqjtb7Z.js";import"./createLucideIcon-CwRmIb17.js";const nt={class:"table-responsive"},it={class:"table table-hover align-middle"},dt={key:0},rt={class:"fw-semibold text-capitalize"},ut=["title"],ct={class:"text-muted ms-2"},mt={key:1,class:"text-muted"},pt={class:"text-break"},gt={key:1,class:"text-muted"},vt={class:"text-end"},yt=["onClick"],_t=["onClick"],bt={key:2},ft={key:0,class:"mt-4 d-flex justify-content-between align-items-center"},ht={class:"text-muted small"},xt={class:"modal fade",id:"viewLogModal_in",tabindex:"-1","aria-hidden":"true"},kt={class:"modal-dialog modal-lg modal-dialog-centered"},wt={class:"modal-content rounded-4 shadow-lg border-0"},Dt={class:"modal-header align-items-center"},Pt={class:"d-flex align-items-center gap-2"},Ct={class:"d-flex flex-column"},Mt={class:"text-muted"},St={class:"modal-body p-4 bg-light"},Lt={key:0,class:"row g-4"},Tt={class:"col-lg-12"},qt={class:"card border-0 shadow-sm rounded-4 h-100"},It={class:"card-body"},Vt={class:"row g-3"},Et={class:"col-md-6"},Nt={class:"fw-semibold"},Ut={class:"col-md-6"},Bt={class:"fw-semibold"},jt={class:"col-md-6"},Ft={class:"badge rounded-pill bg-success"},At={class:"row g-3 text-center"},Ot={class:"col-md-3"},Qt={class:"p-3 bg-light rounded-3 card"},Rt={class:"fs-6 fw-semibold"},Yt={class:"col-md-3"},$t={class:"p-3 bg-light rounded-3 card"},zt={class:"fs-6 fw-semibold"},Gt={class:"col-md-3"},Ht={class:"p-3 bg-light rounded-3 card"},Jt={class:"fs-6 fw-semibold"},Kt={class:"col-md-3"},Wt={class:"p-3 bg-light rounded-3 card"},Xt={class:"fs-6 fw-semibold"},Zt={class:"modal fade",id:"editLogModal_in",tabindex:"-1","aria-hidden":"true"},te={class:"modal-dialog modal-lg modal-dialog-centered"},ee={class:"modal-content rounded-4"},se={class:"modal-body"},ae={class:"row g-3"},le={class:"col-md-6 col-md-12"},oe={class:"col-md-6 col-md-12"},ne={key:0,class:"text-danger"},ie={class:"col-md-6 col-md-12"},de={key:0,class:"text-danger"},re={class:"col-md-6 col-md-12"},ue={class:"mt-4"},ce=["disabled","aria-busy"],me={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},pe=864e5,fe={__name:"StockInLogs",props:{logs:{type:Array,default:()=>[]},q:{type:String,default:""}},emits:["updated"],setup(U,{emit:B}){const{formatCurrencySymbol:f,dateFmt:_}=at(),C=U,j=B,b=v(!1),c=v({current_page:1,last_page:1,per_page:10,total:0,from:0,to:0,links:[]}),M=v([]),h=async(s=null)=>{b.value=!0;try{const e=await N.get("stock_entries/api-stock-in-logs",{params:{q:C.q,page:s||c.value.current_page,per_page:c.value.per_page}});M.value=e.data.data||[],c.value={current_page:e.data.current_page,last_page:e.data.last_page,per_page:e.data.per_page,total:e.data.total,from:e.data.from,to:e.data.to,links:e.data.links},b.value=!1}catch(e){console.error("❌ Fetch stock in logs error:",e),P.error("Failed to load stock in logs"),b.value=!1}},F=s=>{if(!s)return;const r=new URLSearchParams(s.split("?")[1]).get("page");r&&h(parseInt(r))},S=I(()=>M.value),A=s=>new Date(s).toISOString().slice(0,10),O=s=>{if(!s)return null;if(typeof s=="string"){const r=s.match(/^\d{4}-\d{2}-\d{2}/);if(r)return new Date(r[0]+"T00:00:00")}const e=new Date(s);return isNaN(e)?null:new Date(e.getFullYear(),e.getMonth(),e.getDate())},p=s=>{const e=O(s);if(!e)return null;const r=new Date,a=new Date(r.getFullYear(),r.getMonth(),r.getDate());return Math.ceil((e-a)/pe)},Q=s=>{const e=p(s);return e===null?"bg-secondary":e<0||e<15?"bg-danger":e<30?"bg-warning text-dark":"bg-success"},R=s=>(s??"").toString().replace(/[_-]+/g," ").trim().replace(/\w\S*/g,e=>e[0].toUpperCase()+e.slice(1).toLowerCase()),Y=s=>({inventory_stockin:"Inventory Stockin",inventory_stockout:"Inventory Stockout",purchase:"Purchase",adjustment:"Adjustment",return:"Return"})[s]??R(s),$=s=>{switch(s){case"inventory_stockin":case"purchase":return"text-success";case"inventory_stockout":return"text-danger";case"adjustment":return"text-warning";default:return"text-secondary"}},d=v(null),m=v({}),o=v({id:null,itemName:"",quantity:"",unitPrice:"",totalPrice:"",expiryDate:"",operationType:"",type:"stockin"}),z=s=>{d.value=s,new bootstrap.Modal(document.getElementById("viewLogModal_in")).show()};function G(s){o.value={...s},new bootstrap.Modal(document.getElementById("editLogModal_in")).show()}const g=v(!1),H=()=>m.value={},L=I({get:()=>o.value.expiryDate?A(o.value.expiryDate):"",set:s=>o.value.expiryDate=s||null}),T=s=>s===""||s===null||s===void 0?0:Number(s),J=s=>Math.round((s+Number.EPSILON)*100)/100;V(()=>[o.value.quantity,o.value.unitPrice],([s,e])=>o.value.totalPrice=J(T(s)*T(e)),{immediate:!0});let q=null;V(()=>C.q,()=>{clearTimeout(q),q=setTimeout(()=>{c.value.current_page=1,h(1)},500)});async function K(){if(!g.value){g.value=!0,m.value={};try{await N.put(`stock_entries/stock-logs/${o.value.id}`,o.value),P.success("Stock log updated successfully"),await h(),j("updated");const s=bootstrap.Modal.getInstance(document.getElementById("editLogModal_in"));s&&s.hide()}catch(s){s?.response?.status===422&&s.response.data?.errors?(m.value=s.response.data.errors,P.error("Please fill in all required fields correctly.")):(P.error("Something went wrong. Please try again."),console.error(s))}finally{g.value=!1}}}return X(()=>{window.feather?.replace(),h()}),Z(()=>window.feather?.replace()),(s,e)=>{const r=tt("VueDatePicker");return i(),n("div",null,[t("div",nt,[t("table",it,[e[7]||(e[7]=t("thead",{class:"small text-muted"},[t("tr",null,[t("th",null,"Item name"),t("th",null,"Quantity"),t("th",null,"Unit Price"),t("th",null,"Total Price"),t("th",null,"Category"),t("th",null,"Date & Time"),t("th",null,"Expiry Date"),t("th",null,"Operation Type"),t("th",{class:"text-end"},"Action")])],-1)),t("tbody",null,[b.value?(i(),n("tr",dt,[...e[5]||(e[5]=[t("td",{colspan:"10",class:"text-center py-5"},[t("div",{class:"spinner-border text-primary",role:"status"},[t("span",{class:"visually-hidden"},"Loading...")]),t("p",{class:"text-muted mt-2 mb-0"},"Loading logs...")],-1)])])):(i(!0),n(E,{key:1},et(S.value,a=>(i(),n("tr",{key:a.id},[t("td",rt,l(a.itemName),1),t("td",null,l(a.quantity),1),t("td",null,l(u(f)(a.unitPrice)),1),t("td",null,l(u(f)(a.totalPrice)),1),t("td",null,l(a.category?.name||a.category),1),t("td",null,l(u(_)(a.dateTime)),1),t("td",null,[a.expiryDate?(i(),n(E,{key:0},[t("span",{class:x(["badge","rounded-pill",Q(a.expiryDate)]),title:p(a.expiryDate)!==null?p(a.expiryDate)<0?Math.abs(p(a.expiryDate))+" day(s) ago":p(a.expiryDate)+" day(s) left":""},l(u(_)(a.expiryDate)),11,ut),t("small",ct,l(p(a.expiryDate)<0?Math.abs(p(a.expiryDate))+" day(s) ago":p(a.expiryDate)+" day(s) left"),1)],64)):(i(),n("span",mt,"—"))]),t("td",pt,[a.operationType?(i(),n("span",{key:0,class:x(["fw-semibold",$(a.operationType)])},l(Y(a.operationType)),3)):(i(),n("span",gt,"—"))]),t("td",vt,[t("button",{class:"p-2 rounded-full text-blue-600 hover:bg-blue-100",onClick:W=>G(a),title:"Adjustment"},[k(u(lt),{class:"w-4 h-4"})],8,yt),t("button",{class:"p-2 rounded-full text-primary hover:bg-blue-100",onClick:W=>z(a),title:"Show"},[k(u(ot),{class:"w-4 h-4"})],8,_t)])]))),128)),S.value.length===0?(i(),n("tr",bt,[...e[6]||(e[6]=[t("td",{colspan:"10",class:"text-center text-muted py-4"}," No logs found. ",-1)])])):y("",!0)])])]),!b.value&&c.value.last_page>1?(i(),n("div",ft,[t("div",ht," Showing "+l(c.value.from)+" to "+l(c.value.to)+" of "+l(c.value.total)+" entries ",1),k(st,{pagination:c.value.links,isApiDriven:!0,onPageChanged:F},null,8,["pagination"])])):y("",!0),t("div",xt,[t("div",kt,[t("div",wt,[t("div",Dt,[t("div",Pt,[e[9]||(e[9]=t("span",{class:"badge bg-primary rounded-circle p-2"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3 7.5L12 12l9-4.5M3 7.5V17a2 2 0 002 2h14a2 2 0 002-2V7.5M21 7.5L12 3 3 7.5"})])],-1)),t("div",Ct,[e[8]||(e[8]=t("h5",{class:"modal-title mb-0"},"View Stock Log",-1)),t("small",Mt,"Item: "+l(d.value?.itemName??"—"),1)])]),e[10]||(e[10]=t("button",{class:"absolute top-2 right-2 p-2 rounded-full hover:bg-gray-100 transition transform hover:scale-110","data-bs-dismiss":"modal","aria-label":"Close",title:"Close"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-danger",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})])],-1))]),t("div",St,[d.value?(i(),n("div",Lt,[t("div",Tt,[t("div",qt,[t("div",It,[e[18]||(e[18]=t("h6",{class:"fw-semibold mb-3"}," Details ",-1)),t("div",Vt,[t("div",Et,[e[11]||(e[11]=t("small",{class:"text-muted d-block"},"Category",-1)),t("div",Nt,l(d.value.category?.name??d.value.category??"—"),1)]),t("div",Ut,[e[12]||(e[12]=t("small",{class:"text-muted d-block"},"Stock In Quantity",-1)),t("div",Bt,l(d.value.quantity??"—"),1)]),t("div",jt,[e[13]||(e[13]=t("small",{class:"text-muted d-block"},"Operation",-1)),t("div",Ft,l(d.value.operationType??"—"),1)])]),e[19]||(e[19]=t("hr",{class:"my-4"},null,-1)),t("div",At,[t("div",Ot,[t("div",Qt,[e[14]||(e[14]=t("small",{class:"text-muted d-block"},"Unit Price",-1)),t("div",Rt,l(u(f)(d.value.unitPrice??0)),1)])]),t("div",Yt,[t("div",$t,[e[15]||(e[15]=t("small",{class:"text-muted d-block"},"Total Price",-1)),t("div",zt,l(u(f)(d.value.totalPrice??0)),1)])]),t("div",Gt,[t("div",Ht,[e[16]||(e[16]=t("small",{class:"text-muted d-block"},"Expiry Date",-1)),t("div",Jt,l(d.value.expiryDate?u(_)(d.value.expiryDate):"—"),1)])]),t("div",Kt,[t("div",Wt,[e[17]||(e[17]=t("small",{class:"text-muted d-block"},"Date",-1)),t("div",Xt,l(u(_)(d.value.dateTime)),1)])])])])])])])):y("",!0)])])])]),t("div",Zt,[t("div",te,[t("div",ee,[t("div",{class:"modal-header"},[e[21]||(e[21]=t("h5",{class:"modal-title fw-semibold"},"Edit Stock Log",-1)),t("button",{class:"absolute top-2 right-2 p-2 rounded-full hover:bg-gray-100 transition transform hover:scale-110","data-bs-dismiss":"modal","aria-label":"Close",title:"Close",onClick:H},[...e[20]||(e[20]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),t("div",se,[t("div",ae,[t("div",le,[e[22]||(e[22]=t("label",{class:"form-label"},"Item Name",-1)),w(t("input",{type:"text",class:"form-control","onUpdate:modelValue":e[0]||(e[0]=a=>o.value.itemName=a),disabled:""},null,512),[[D,o.value.itemName]])]),t("div",oe,[e[23]||(e[23]=t("label",{class:"form-label"},"Quantity",-1)),w(t("input",{type:"number",class:x(["form-control",{"is-invalid":m.value.quantity}]),"onUpdate:modelValue":e[1]||(e[1]=a=>o.value.quantity=a),required:""},null,2),[[D,o.value.quantity]]),m.value.quantity?(i(),n("small",ne,l(m.value.quantity[0]),1)):y("",!0)]),t("div",ie,[e[24]||(e[24]=t("label",{class:"form-label"},"Unit Price",-1)),w(t("input",{type:"number",class:x(["form-control",{"is-invalid":m.value.unitPrice}]),"onUpdate:modelValue":e[2]||(e[2]=a=>o.value.unitPrice=a),required:""},null,2),[[D,o.value.unitPrice]]),m.value.unitPrice?(i(),n("small",de,l(m.value.unitPrice[0]),1)):y("",!0)]),t("div",re,[e[25]||(e[25]=t("label",{class:"form-label"},"Value",-1)),w(t("input",{type:"number",readonly:"",class:"form-control","onUpdate:modelValue":e[3]||(e[3]=a=>o.value.totalPrice=a)},null,512),[[D,o.value.totalPrice]])]),e[26]||(e[26]=t("label",null,"Expiry Date",-1)),k(r,{modelValue:L.value,"onUpdate:modelValue":e[4]||(e[4]=a=>L.value=a),format:u(_),enableTimePicker:!1,"min-date":new Date,placeholder:"Select date"},null,8,["modelValue","format","min-date"]),t("div",ue,[t("button",{class:"btn btn-primary rounded-pill btn-sm px-4 d-inline-flex align-items-center gap-2",disabled:g.value,"aria-busy":g.value?"true":"false",onClick:K},[g.value?(i(),n("span",me)):y("",!0),t("span",null,l(g.value?"Saving…":"Save"),1)],8,ce)])])])])])])])}}};export{fe as default};
