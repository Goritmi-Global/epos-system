import{_ as pe,r as p,w as ve,a as Ve,b as d,d as ee,g as r,l as y,f as e,t as a,m as A,v as Y,p as $,V as ze,o as ce,n as qe,c as Ue,e as F,u as f,h as Ge,F as I,i as K,T as me,j as Xe,P as We,s as w}from"./app-BnsnJ5Tj.js";import{_ as He}from"./Master-BNU6dmEI.js";import{u as Ke}from"./useFormatters-CwVh0Mdn.js";import{F as Ye}from"./FilterModal-BpnJZSdH.js";import{s as Qe}from"./index-CR0Blkc6.js";import{E as Ze,a as Je,X as et,u as z,w as tt}from"./xlsx-LllAmExe.js";import{E as st}from"./eye-RrEOnLQ2.js";import{C as lt}from"./circle-x-lHbPgc8i.js";import"./index-RLFzO3uW.js";import"./createLucideIcon-BCt5CEW6.js";import"./index-DoPdJjGw.js";import"./index-q6Axaa4L.js";import"./sun-BXp2FZMG.js";import"./index-DDhkNZri.js";import"./index-B9CcrpiB.js";import"./index-Bb_fSmW2.js";const at={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50"},ot={class:"bg-white rounded-xl shadow-xl w-full max-w-md p-6 animate-drop-in relative"},nt={class:"text-center text-lg font-medium text-gray-800 mb-2"},dt={class:"bg-gray-50 rounded-lg p-4 mb-4 space-y-2"},rt={class:"flex justify-between text-sm"},it={class:"font-medium text-gray-800"},ut={class:"flex justify-between text-sm"},ct={class:"font-medium text-gray-800"},mt={class:"flex justify-between text-sm"},pt={class:"font-medium text-gray-800"},vt={class:"mb-4"},bt={class:"flex justify-center gap-3"},yt=["disabled"],ft={key:0,class:"spinner-border spinner-border-sm",role:"status"},gt=["disabled"],ht={__name:"OrderCancellationModal",props:{show:{type:Boolean,default:!1},order:{type:Object,default:null},loading:{type:Boolean,default:!1}},emits:["confirm","cancel"],setup(k,{emit:g}){const q=k,P=g,T=p("");ve(()=>q.show,_=>{_||(T.value="")});const S=()=>{P("confirm",T.value||"Cancelled by admin from orders page")},O=()=>{P("cancel")},m=_=>new Intl.NumberFormat("en-GB",{style:"currency",currency:"GBP"}).format(_||0);return(_,v)=>(d(),Ve(ze,{name:"fade-slide"},{default:ee(()=>[k.show?(d(),r("div",at,[e("div",ot,[e("button",{class:"absolute top-2 right-2 p-2 rounded-full hover:bg-gray-100 transition transform hover:scale-110",onClick:O,"data-bs-dismiss":"modal","aria-label":"Close",title:"Close"},[...v[1]||(v[1]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)])]),v[6]||(v[6]=e("div",{class:"flex justify-center mb-4"},[e("div",{class:"bg-red-100 p-3 rounded-full"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-8 h-8 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})])])],-1)),e("h3",nt," Cancel Order #"+a(k.order?.id)+"? ",1),v[7]||(v[7]=e("p",{class:"text-center text-sm text-gray-500 mb-4"}," This action will cancel the order and cannot be undone. ",-1)),e("div",dt,[e("div",rt,[v[2]||(v[2]=e("span",{class:"text-gray-600"},"Customer:",-1)),e("span",it,a(k.order?.customer_name||"Walk In"),1)]),e("div",ut,[v[3]||(v[3]=e("span",{class:"text-gray-600"},"Total Amount:",-1)),e("span",ct,a(m(k.order?.total_amount)),1)]),e("div",mt,[v[4]||(v[4]=e("span",{class:"text-gray-600"},"Payment Type:",-1)),e("span",pt,a(k.order?.payment?.payment_type||"N/A"),1)])]),e("div",vt,[v[5]||(v[5]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Reason for Cancellation (Optional) ",-1)),A(e("textarea",{"onUpdate:modelValue":v[0]||(v[0]=R=>T.value=R),class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-1 focus:ring-white focus:border-transparent resize-none",rows:"3",placeholder:"Enter reason for cancelling this order..."},null,512),[[Y,T.value]])]),e("div",bt,[e("button",{onClick:S,disabled:k.loading,class:"btn btn-danger d-flex align-items-center gap-2 px-4 py-2 rounded-pill text-white"},[k.loading?(d(),r("span",ft)):y("",!0),$(" "+a(k.loading?"Cancelling...":"Cancel Order"),1)],8,yt),e("button",{onClick:O,disabled:k.loading,class:"btn btn-secondary d-flex align-items-center gap-2 px-4 py-2 rounded-pill text-white"}," Keep Order ",8,gt)])])])):y("",!0)]),_:1}))}},wt=pe(ht,[["__scopeId","data-v-828b9886"]]),_t={class:"page-wrapper"},xt={class:"row g-3"},Ct={class:"col-md-6 col-xl-4"},kt={class:"card border-0 shadow-sm rounded-4"},Tt={class:"card-body d-flex align-items-center justify-content-between"},$t={class:"mb-0 fw-bold"},St={class:"col-md-6 col-xl-4"},Ot={class:"card border-0 shadow-sm rounded-4"},Dt={class:"card-body d-flex align-items-center justify-content-between"},Mt={class:"mb-0 fw-bold"},Ft={class:"col-md-6 col-xl-4"},Pt={class:"card border-0 shadow-sm rounded-4"},jt={class:"card-body d-flex align-items-center justify-content-between"},Nt={class:"mb-0 fw-bold"},It={class:"col-md-6 col-xl-3"},At={class:"card border-0 shadow-sm rounded-4"},Rt={class:"card-body d-flex align-items-center justify-content-between"},Et={class:"mb-0 fw-bold"},Bt={class:"card border-0 shadow-lg rounded-4 mt-0"},Lt={class:"card-body"},Vt={class:"d-flex flex-wrap gap-2 justify-content-between align-items-center mb-3"},zt={class:"d-flex flex-wrap gap-2 align-items-center"},qt={class:"search-wrap"},Ut={key:1,class:"form-control search-input",placeholder:"Search",disabled:"",type:"text"},Gt={class:"col-md-6"},Xt=["onUpdate:modelValue"],Wt=["value"],Ht={class:"col-md-6 mt-3"},Kt=["onUpdate:modelValue"],Yt=["value"],Qt={class:"table-responsive"},Zt={class:"table table-hover align-middle mb-0"},Jt={key:0},es=["onClick"],ts={style:{"font-size":"14px"}},ss={class:"text-muted small"},ls={class:"text-left"},as={class:"d-flex gap-2 justify-content-center align-items-center"},os=["onClick"],ns=["onClick","disabled"],ds=["onClick","disabled"],rs={key:0},is={key:0,class:"mt-4 d-flex justify-content-between align-items-center"},us={class:"text-muted small"},cs={class:"modal fade",id:"paymentDetailsModal",tabindex:"-1","aria-hidden":"true"},ms={class:"modal-dialog modal-md modal-dialog-centered"},ps={class:"modal-content border-0 shadow-lg rounded-4 overflow-hidden"},vs={class:"modal-body p-4"},bs={class:"payment-info"},ys={class:"row g-3"},fs={class:"col-6"},gs={class:"info-card"},hs={class:"value"},ws={class:"col-6"},_s={class:"info-card"},xs={class:"value"},Cs={key:0,class:"col-6"},ks={class:"info-card"},Ts={class:"value"},$s={key:1,class:"col-6"},Ss={class:"info-card"},Os={class:"value"},Ds={class:"col-6"},Ms={class:"info-card"},Fs={class:"value"},Ps={key:2,class:"col-6"},js={class:"info-card"},Ns={class:"value text-capitalize"},Is={key:3,class:"col-6"},As={class:"info-card"},Rs={class:"value"},Es={key:4,class:"col-6"},Bs={class:"info-card"},Ls={class:"value"},Vs={key:5,class:"col-6"},zs={class:"info-card"},qs={class:"value"},Us={class:"modal fade",id:"orderDetailsModal",tabindex:"-1","aria-hidden":"true"},Gs={class:"modal-dialog modal-lg modal-dialog-centered"},Xs={class:"modal-content rounded-4 shadow border-0"},Ws={class:"modal-header bg-white border-0 position-relative px-4 pt-4"},Hs={class:"d-flex align-items-center gap-3"},Ks={class:"d-flex flex-column"},Ys={class:"modal-title fw-bold mb-0"},Qs={class:"text-muted"},Zs={class:"modal-body bg-light px-4 pb-4"},Js={key:0,class:"rounded-3 bg-white shadow-sm p-4"},el={class:"mb-4"},tl={class:"row text-muted small"},sl={class:"col-md-4 mb-2"},ll={class:"col-md-4 mb-2"},al={class:"table-responsive"},ol={class:"table align-middle table-striped table-hover border rounded-3 overflow-hidden shadow-sm"},nl={class:"px-3"},dl={class:"fw-semibold"},rl={class:"fw-bold text-success"},il={key:0,class:"no-border"},ul={class:"text-success fw-semibold",colspan:"3"},cl={key:1,class:"no-border"},ml={class:"text-success fw-semibold",colspan:"3"},pl={key:2,class:"no-border"},vl={class:"text-success fw-semibold",colspan:"3"},bl={key:3,class:"no-border"},yl={class:"text-success fw-semibold",colspan:"3"},fl={key:4,class:"no-border"},gl={class:"text-success fw-semibold",colspan:"3"},hl={key:5,class:"no-border"},wl={class:"text-success fw-semibold",colspan:"3"},_l={class:"border-top-thick"},xl={class:"fw-bold text-success"},Cl={key:6},kl={class:"modal-footer bg-white border-0 shadow-sm px-4 py-3"},Tl={class:"modal fade",id:"refundModal",tabindex:"-1","aria-hidden":"true"},$l={class:"modal-dialog modal-dialog-centered"},Sl={class:"modal-content rounded-4 shadow border-0"},Ol={class:"modal-body"},Dl={class:"mb-3"},Ml={class:"bg-light p-3 rounded-3"},Fl={class:"d-flex justify-content-between mb-2"},Pl={class:"fw-semibold"},jl={class:"d-flex justify-content-between mb-2"},Nl={class:"fw-semibold"},Il={class:"d-flex justify-content-between mb-2"},Al={class:"fw-semibold"},Rl={class:"d-flex justify-content-between mb-2"},El={class:"fw-semibold text-capitalize"},Bl={key:0,class:"d-flex justify-content-between mb-2"},Ll={class:"fw-semibold text-success"},Vl={key:1,class:"d-flex justify-content-between"},zl={class:"fw-semibold"},ql={class:"mb-3"},Ul={class:"input-group"},Gl=["max"],Xl={class:"text-muted"},Wl={class:"mb-3"},Hl={class:"text-muted"},Kl={class:"modal-footer border-0"},Yl=["disabled"],Ql=["disabled"],Zl={key:0},Jl={key:1},ea={__name:"Order",setup(k){const{formatCurrencySymbol:g,dateFmt:q}=Ke(),P=p(null),T=p(null),S=p(0),O=p(""),m=p(null),_=p([]),v=p(!1),R=p(null),be=[{label:"PDF",value:"pdf"},{label:"Excel",value:"excel"},{label:"CSV",value:"csv"}],ye=s=>{s.value&&(Me(s.value),R.value=null)},E=p({total_orders:0,completed_orders:0,cancelled_orders:0,total_revenue:0}),B=async(s=null)=>{v.value=!0;try{const t={q:j.value,page:s||x.value.current_page,per_page:x.value.per_page,sort_by:c.value.sortBy||"",order_type:c.value.orderType||"",payment_type:c.value.paymentType||"",status:c.value.status||"",price_min:c.value.priceMin||"",price_max:c.value.priceMax||"",date_from:c.value.dateFrom||"",date_to:c.value.dateTo||""};Object.keys(t).forEach(o=>{(t[o]===void 0||t[o]==="")&&delete t[o]});const l=await axios.get("/api/orders/all",{params:t});_.value=l.data.data||[],l.data.stats&&(E.value=l.data.stats),x.value={current_page:l.data.current_page,last_page:l.data.last_page,per_page:l.data.per_page,total:l.data.total,from:l.data.from,to:l.data.to,links:l.data.links}}catch(t){console.error("Error fetching orders:",t),w.error("Failed to load orders")}finally{v.value=!1}},fe=s=>{if(!s)return;const l=new URLSearchParams(s.split("?")[1]).get("page");l&&B(parseInt(l))};ce(async()=>{j.value="",te.value=Date.now(),await qe(),setTimeout(()=>{se.value=!0;const t=document.getElementById(Q);t&&(t.value="",j.value="")},100),B();const s=document.getElementById("orderFilterModal");s&&s.addEventListener("hidden.bs.modal",()=>{L.value={sortBy:c.value.sortBy||"",orderType:c.value.orderType||"",paymentType:c.value.paymentType||"",status:c.value.status||"",priceMin:c.value.priceMin||null,priceMax:c.value.priceMax||null,dateFrom:c.value.dateFrom||"",dateTo:c.value.dateTo||""}})});const j=p(""),te=p(Date.now()),Q=`search-${Math.random().toString(36).substr(2,9)}`,se=p(!1),x=p({current_page:1,last_page:1,per_page:10,total:0,from:0,to:0,links:[]}),L=p({sortBy:"",orderType:"",paymentType:"",status:"",priceMin:null,priceMax:null,dateFrom:"",dateTo:""}),c=p({sortBy:"",orderType:"",paymentType:"",status:"",priceMin:null,priceMax:null,dateFrom:"",dateTo:""});p(["All","Dine In","Delivery","Takeaway"]),p(["All","Cash","Card","Split"]);const U=Ue(()=>({sortOptions:[{value:"date_desc",label:"Date: Newest First"},{value:"date_asc",label:"Date: Oldest First"},{value:"price_desc",label:"Price: High to Low"},{value:"price_asc",label:"Price: Low to High"},{value:"customer_asc",label:"Customer: A to Z"},{value:"customer_desc",label:"Customer: Z to A"}],orderTypeOptions:[{value:"Dine In",label:"Dine In"},{value:"Delivery",label:"Delivery"},{value:"Takeaway",label:"Takeaway"},{value:"Collection",label:"Collection"}],paymentTypeOptions:[{value:"Cash",label:"Cash"},{value:"Card",label:"Card"},{value:"Split",label:"Split"}],statusOptions:[{value:"paid",label:"Paid"},{value:"pending",label:"Pending"},{value:"cancelled",label:"Cancelled"}]})),ge=s=>{c.value={...L.value},x.value.current_page=1,B(1),bootstrap.Modal.getInstance(document.getElementById("orderFilterModal"))?.hide()},he=()=>{L.value={sortBy:"",orderType:"",paymentType:"",status:"",priceMin:null,priceMax:null,dateFrom:"",dateTo:""},c.value={sortBy:"",orderType:"",paymentType:"",status:"",priceMin:null,priceMax:null,dateFrom:"",dateTo:""},x.value.current_page=1,x.value.per_page=10,B(1)};function G(s){const t=new Date(s),l=t.getFullYear(),o=String(t.getMonth()+1).padStart(2,"0"),u=String(t.getDate()).padStart(2,"0");return`${l}-${o}-${u}`}function we(s){const t=Date.now()-new Date(s).getTime(),l=Math.floor(t/6e4);if(l<60)return`${l} minute${l===1?"":"s"} ago`;const o=Math.floor(l/60);if(o<24)return`${o} hour${o===1?"":"s"} ago`;const u=Math.floor(o/24);return`${u} day${u===1?"":"s"} ago`}function Z(s){const t=Number(s??0);return`£${Number.isInteger(t)?t.toFixed(0):t.toFixed(1)}`}const _e=p(!1),h=p(null),b=p(null);function xe(s){h.value=s,_e.value=!0,new bootstrap.Modal(document.getElementById("paymentDetailsModal")).show()}const Ce=s=>{b.value=s,new bootstrap.Modal(document.getElementById("orderDetailsModal")).show()};function ke(s){const t=C=>`£${Number(C??0).toFixed(2)}`,l=C=>(C??"").toString(),o=s?.payment??{},u=(o.payment_type??s?.payment_method??"Cash").toLowerCase(),D=o.cash_amount??s?.cash_amount??s?.cash_received??0,i=o.card_amount??s?.card_amount??0,n=o.brand??s?.card_brand??"",N=o.last_digits??s?.last4??s?.last_digits??"";let X="";if(u==="split")X=`Payment: Split (Cash: ${t(D)}, Card: ${t(i)})`;else if(u==="card"||u==="stripe"){const C=n?` (${n})`:"",H=N?` •••• ${N}`:"";X=`Payment: Card${C}${H}`}else X=`Payment: ${l(s?.payment_method)||"Cash"}`;const Ne=s?.id??"N/A",Ie=s?.type?.order_type??s?.order_type??"N/A",re=s?.type?.table_number??s?.table_number??null,Ae=s?.customer_name||"Walk In",V=s?.created_at?new Date(s.created_at):new Date,Re=`${V.getFullYear()}-${String(V.getMonth()+1).padStart(2,"0")}-${String(V.getDate()).padStart(2,"0")} ${String(V.getHours()).padStart(2,"0")}:${String(V.getMinutes()).padStart(2,"0")}`,ie=Array.isArray(s?.items)?s.items:[],ue=s?.sub_total??ie.reduce((C,H)=>C+Number(H.price??0)*Number(H.quantity??0),0),Ee=s?.total_amount??ue,Be=ie.map(C=>`
    <div class="row">
      <span class="w-50 ellips">${l(C.title)}</span>
      <span class="w-20 right">x${Number(C.quantity??0)}</span>
      <span class="w-30 right">${t(C.price)}</span>
    </div>
  `).join(""),Le=`
<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Receipt</title>
<style>
  :root { --w: 58mm; }
  html, body { margin:0; padding:0; }
  body { width: var(--w); font-family: monospace; font-size: 12px; line-height: 1.3; color:#000; }
  .center { text-align:center; }
  .right { text-align:right; }
  .row { display:flex; justify-content:space-between; gap:4px; }
  .w-50 { width:50%; } .w-20 { width:20%; } .w-30 { width:30%; }
  .ellips { white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
  hr { border:0; border-top:1px dashed #000; margin:4px 0; }
  h3 { margin:0 0 2px 0; font-size: 14px; }
  small { font-size:11px; }
  .mt-4 { margin-top:4px; }
  .mb-4 { margin-bottom:4px; }
  .bold { font-weight:bold; }
  @page { size: var(--w) auto; margin: 3mm; }
  @media print { body { -webkit-print-color-adjust: exact; print-color-adjust: exact; } }
</style>
</head>
<body>
  <div class="center">
    <h3>Goritmi</h3>
    <small>Order #${Ne}</small><br/>
    <small>${Re}</small>
  </div>

  <hr/>
  <div><small>Customer: ${l(Ae)}</small></div>
  <div><small>Order Type: ${l(Ie)}${re?` | Table: ${l(re)}`:""}</small></div>
  <div><small>${X}</small></div>

  <hr/>
  <div class="row bold"><span class="w-50">Item</span><span class="w-20 right">Qty</span><span class="w-30 right">Price</span></div>
  ${Be}
  <hr/>

  <div class="row"><span>Subtotal:</span><span class="right">${t(ue)}</span></div>
  ${Number(s?.tax??0)?`<div class="row"><span>Tax:</span><span class="right">${t(s.tax)}</span></div>`:""}
  ${Number(s?.service_charges??0)?`<div class="row"><span>Service:</span><span class="right">${t(s.service_charges)}</span></div>`:""}
  ${Number(s?.delivery_charges??0)?`<div class="row"><span>Delivery:</span><span class="right">${t(s.delivery_charges)}</span></div>`:""}

  <div class="row bold mt-4"><span>Total:</span><span class="right">${t(Ee)}</span></div>

  ${u==="cash"||!u?`<div class="row"><span>Cash Received:</span><span class="right">${t(s?.cash_received??o?.amount_received??0)}</span></div>
       <div class="row"><span>Change:</span><span class="right">${t(s?.change??0)}</span></div>`:""}

  <hr/>
  <div class="center">
    <small>Abdara Road, Peshawar</small><br/>
    <small>info@goritmi.com</small><br/>
    <small>Thank you for your visit!</small>
  </div>

<script>
  async function ready() {
    try { if (document.fonts && document.fonts.ready) { await document.fonts.ready; } } catch(e){}
    window.focus();
    const mq = window.matchMedia && window.matchMedia('print');
    if (mq && mq.addEventListener) {
      mq.addEventListener('change', function(e){ if(!e.matches) setTimeout(function(){ window.close(); }, 300); });
    } else if (mq && mq.addListener) { // older browsers
      mq.addListener(function(mql){ if(!mql.matches) setTimeout(function(){ window.close(); }, 300); });
    }
    window.onafterprint = function(){ setTimeout(function(){ window.close(); }, 300); };
    setTimeout(function(){ window.print(); }, 200);
  }
  if (document.readyState === 'complete') ready();
  else window.addEventListener('load', ready);
<\/script>
</body>
</html>
`,W=window.open("","","width=420,height=640");if(!W){console.error("Popup blocked or failed to open"),alert("Please allow popups for this site to print receipts");return}W.document.open(),W.document.write(Le),W.document.close()}const le=p([]),ae=p(!1);ce(async()=>{ae.value=!0;try{const s=await axios.get("/api/printers");le.value=s.data.data.filter(t=>t.is_connected===!0||t.status==="OK").map(t=>({label:`${t.name}`,value:t.name,driver:t.driver,port:t.port}))}catch(s){console.error("Failed to fetch printers:",s)}finally{ae.value=!1}});const Te=s=>{if(!s||!s.payment)return!1;const t=s.payment.payment_type?.toLowerCase(),l=s.status?.toLowerCase(),o=s.payment.refund_status?.toLowerCase();return(l==="paid"||l==="cancelled")&&(t==="card"||t==="split")&&(!o||o==="none")},$e=async s=>{if(!s)return;s.payment?.payment_type?.toLowerCase();const t=s.total_amount,l=s.payment?.card_amount||t;m.value=s,S.value=Number(l).toFixed(2),O.value="";const o=document.getElementById("refundModal");o&&new bootstrap.Modal(o).show()},Se=async()=>{if(!m.value)return;const s=Number(S.value);if(s<=0){w.error("Refund amount must be greater than 0");return}const t=m.value.payment?.payment_type?.toLowerCase(),l=m.value.payment?.card_amount||m.value.total_amount;if(s>l){w.error(`Refund amount cannot exceed ${g(l)}`);return}T.value=m.value.id;try{const o=await axios.post(`/api/pos/orders/${m.value.id}/refund`,{amount:s,reason:O.value||"Refund requested by admin",payment_type:t});if(o.data.success){w.success(`Refund of ${g(s)} processed successfully`);const u=_.value.findIndex(i=>i.id===m.value.id);u!==-1&&(_.value[u]=o.data.order);const D=document.getElementById("refundModal");if(D){const i=bootstrap.Modal.getInstance(D);i&&i.hide()}m.value=null,S.value=0,O.value=""}}catch(o){console.error("Error processing refund:",o),w.error(o.response?.data?.message||"Failed to process refund")}finally{T.value=null}},oe=()=>{const s=document.getElementById("refundModal");if(s){const t=bootstrap.Modal.getInstance(s);t&&t.hide()}m.value=null,S.value=0,O.value=""},J=p(!1),M=p(null),Oe=s=>{s&&(M.value=s,J.value=!0)},ne=()=>{J.value=!1,M.value=null},De=async s=>{if(M.value){P.value=M.value.id;try{const t=await axios.post(`/api/pos/orders/${M.value.id}/cancel`,{reason:s});if(t.data.success){w.success("Order cancelled and stock restored successfully");const l=_.value.findIndex(o=>o.id===M.value.id);l!==-1&&(_.value[l]=t.data.order),ne()}}catch(t){console.error("Error cancelling order:",t),w.error(t.response?.data?.message||"Failed to cancel order")}finally{P.value=null}}};let de=null;ve(j,()=>{clearTimeout(de),de=setTimeout(()=>{x.value.current_page=1,B(1)},500)});const Me=async s=>{if(!_.value||_.value.length===0){w.error("No orders data to download");return}try{v.value=!0;const t={q:j.value,sort_by:c.value.sortBy||"",order_type:c.value.orderType||"",payment_type:c.value.paymentType||"",status:c.value.status||"",price_min:c.value.priceMin||"",price_max:c.value.priceMax||"",date_from:c.value.dateFrom||"",date_to:c.value.dateTo||"",export:"all"};Object.keys(t).forEach(u=>{(t[u]===void 0||t[u]==="")&&delete t[u]});const o=(await axios.get("/api/orders/all",{params:t})).data.data||[];if(o.length===0){w.error("No orders found to download");return}s==="pdf"?Pe(o):s==="excel"?je(o):s==="csv"?Fe(o):w.error("Invalid download type")}catch(t){console.error("Download failed:",t),w.error(`Download failed: ${t.message}`)}finally{v.value=!1}},Fe=s=>{try{const t=["Order ID","Table No.","Order Type","Date","Customer","Payment Type","Sub Total","Promo Discount","Sales Discount","Approved Discount","Tax","Service Charges","Delivery Charges","Total Amount","Status","Promo Name"],l=s.map(n=>[`"${n.id||""}"`,`"${n.type?.table_number||"-"}"`,`"${n.type?.order_type||"-"}"`,`"${G(n.created_at)}"`,`"${n.customer_name||"-"}"`,`"${n.payment?.payment_type||"-"}"`,`"${n.sub_total||0}"`,`"${n.promo?.[0]?.discount_amount||0}"`,`"${n.sales_discount||0}"`,`"${n.approved_discounts||0}"`,`"${n.tax||0}"`,`"${n.service_charges||0}"`,`"${n.delivery_charges||0}"`,`"${n.total_amount||0}"`,`"${n.status||""}"`,`"${n.promo?.[0]?.promo_name||"-"}"`]),o=[t.join(","),...l.map(n=>n.join(","))].join(`
`),u=new Blob([o],{type:"text/csv;charset=utf-8;"}),D=URL.createObjectURL(u),i=document.createElement("a");i.setAttribute("href",D),i.setAttribute("download",`Orders_${new Date().toISOString().split("T")[0]}.csv`),document.body.appendChild(i),i.click(),document.body.removeChild(i),w.success("CSV downloaded successfully")}catch(t){console.error("CSV generation error:",t),w.error(`CSV generation failed: ${t.message}`,{autoClose:5e3})}},Pe=s=>{try{const t=new Ze("l","mm","a4");t.setFontSize(18),t.setFont("helvetica","bold"),t.text("Orders Report",14,20),t.setFontSize(10),t.setFont("helvetica","normal");const l=new Date().toLocaleString();t.text(`Generated on: ${l}`,14,28),t.text(`Total Orders: ${s.length}`,14,34);const o=["Order ID","Table","Type","Date","Customer","Payment","Sub Total","Promo Disc.","Sales Disc.","Total","Status"],u=s.map(i=>[i.id||"",i.type?.table_number||"-",i.type?.order_type||"-",G(i.created_at),i.customer_name||"-",i.payment?.payment_type||"-",`£${Number(i.sub_total||0).toFixed(2)}`,`£${Number(i.promo?.[0]?.discount_amount||0).toFixed(2)}`,`£${Number(i.sales_discount||0).toFixed(2)}`,`£${Number(i.total_amount||0).toFixed(2)}`,i.status||""]);Je(t,{head:[o],body:u,startY:40,styles:{fontSize:8,cellPadding:2,halign:"left",lineColor:[0,0,0],lineWidth:.1},headStyles:{fillColor:[41,128,185],textColor:255,fontStyle:"bold"},alternateRowStyles:{fillColor:[245,245,245]},margin:{left:14,right:14},didDrawPage:i=>{const n=t.internal.getNumberOfPages(),N=t.internal.pageSize.height;t.setFontSize(8),t.text(`Page ${i.pageNumber} of ${n}`,i.settings.margin.left,N-10)}});const D=`Orders_${new Date().toISOString().split("T")[0]}.pdf`;t.save(D),w.success("PDF downloaded successfully")}catch(t){console.error("PDF generation error:",t),w.error(`PDF generation failed: ${t.message}`,{autoClose:5e3})}},je=s=>{try{if(typeof et>"u")throw new Error("XLSX library is not loaded");const t=s.map(n=>({"Order ID":n.id||"","Table No.":n.type?.table_number||"-","Order Type":n.type?.order_type||"-",Date:G(n.created_at),Customer:n.customer_name||"-","Payment Type":n.payment?.payment_type||"-","Sub Total":Number(n.sub_total||0).toFixed(2),"Promo Discount":Number(n.promo?.[0]?.discount_amount||0).toFixed(2),"Sales Discount":Number(n.sales_discount||0).toFixed(2),"Approved Discount":Number(n.approved_discounts||0).toFixed(2),Tax:Number(n.tax||0).toFixed(2),"Service Charges":Number(n.service_charges||0).toFixed(2),"Delivery Charges":Number(n.delivery_charges||0).toFixed(2),"Total Amount":Number(n.total_amount||0).toFixed(2),Status:n.status||"","Promo Name":n.promo?.[0]?.promo_name||"-"})),l=z.book_new(),o=z.json_to_sheet(t);o["!cols"]=[{wch:10},{wch:10},{wch:12},{wch:12},{wch:20},{wch:12},{wch:12},{wch:15},{wch:15},{wch:17},{wch:10},{wch:15},{wch:16},{wch:13},{wch:10},{wch:20}],z.book_append_sheet(l,o,"Orders");const u=[{Info:"Generated On",Value:new Date().toLocaleString()},{Info:"Total Records",Value:s.length},{Info:"Total Revenue",Value:`£${s.reduce((n,N)=>n+Number(N.total_amount||0),0).toFixed(2)}`},{Info:"Exported By",Value:"Restaurant Management System"}],D=z.json_to_sheet(u);z.book_append_sheet(l,D,"Report Info");const i=`Orders_${new Date().toISOString().split("T")[0]}.xlsx`;tt(l,i),w.success("Excel file downloaded successfully",{autoClose:2500})}catch(t){console.error("Excel generation error:",t),w.error(`Excel generation failed: ${t.message}`,{autoClose:5e3})}};return(s,t)=>(d(),r(I,null,[F(f(Ge),{title:"Orders"}),F(He,null,{default:ee(()=>[e("div",_t,[t[75]||(t[75]=e("h4",{class:"fw-semibold mb-3"},"Overall Orders",-1)),e("div",xt,[e("div",Ct,[e("div",kt,[e("div",Tt,[e("div",null,[e("h3",$t,a(E.value.total_orders),1),t[7]||(t[7]=e("p",{class:"text-muted mb-0 small"},"Total Orders",-1))]),t[8]||(t[8]=e("div",{class:"rounded-circle p-2 d-flex align-items-center justify-content-center text-primary",style:{width:"40px",height:"40px"}},[e("i",{class:"bi bi-list-task fs-4"})],-1))])])]),e("div",St,[e("div",Ot,[e("div",Dt,[e("div",null,[e("h3",Mt,a(E.value.completed_orders),1),t[9]||(t[9]=e("p",{class:"text-muted mb-0 small"},"Completed Orders",-1))]),t[10]||(t[10]=e("div",{class:"rounded-circle p-3 d-flex align-items-center justify-content-center text-success",style:{width:"40px",height:"40px"}},[e("i",{class:"bi bi-check2-circle fs-4"})],-1))])])]),e("div",Ft,[e("div",Pt,[e("div",jt,[e("div",null,[e("h3",Nt,a(E.value.cancelled_orders),1),t[11]||(t[11]=e("p",{class:"text-muted mb-0 small"},"Cancelled Orders",-1))]),t[12]||(t[12]=e("div",{class:"rounded-circle p-3 d-flex align-items-center justify-content-center text-warning",style:{width:"40px",height:"40px"}},[e("i",{class:"bi bi-hourglass-split fs-4"})],-1))])])]),e("div",It,[e("div",At,[e("div",Rt,[e("div",null,[e("h3",Et,a(f(g)(E.value.total_revenue)),1),t[13]||(t[13]=e("p",{class:"text-muted mb-0 small"},"Total Revenue",-1))]),t[14]||(t[14]=e("div",{class:"rounded-circle p-3 d-flex align-items-center justify-content-center text-info",style:{width:"40px",height:"40px"}},[e("i",{class:"bi bi-currency-pound fs-4"})],-1))])])])]),e("div",Bt,[e("div",Lt,[e("div",Vt,[t[21]||(t[21]=e("h5",{class:"mb-0 fw-semibold"},"Orders",-1)),e("div",zt,[e("div",qt,[t[15]||(t[15]=e("i",{class:"bi bi-search"},null,-1)),t[16]||(t[16]=e("input",{type:"email",name:"email",autocomplete:"email",style:{position:"absolute",left:"-9999px",width:"1px",height:"1px"},tabindex:"-1","aria-hidden":"true"},null,-1)),se.value?A((d(),r("input",{id:Q,"onUpdate:modelValue":t[0]||(t[0]=l=>j.value=l),key:te.value,class:"form-control search-input",placeholder:"Search",type:"search",autocomplete:"new-password",name:Q,role:"presentation",onFocus:t[1]||(t[1]=(...l)=>s.handleFocus&&s.handleFocus(...l))},null,32)),[[Y,j.value]]):(d(),r("input",Ut))]),F(Ye,{modelValue:L.value,"onUpdate:modelValue":t[2]||(t[2]=l=>L.value=l),title:"Orders","modal-id":"orderFilterModal","modal-size":"modal-lg","sort-options":U.value.sortOptions,"status-options":U.value.statusOptions,"show-stock-status":!1,"show-price-range":!0,"show-date-range":!0,"price-label":"Total Amount Range",onApply:ge,onClear:he},{customFilters:ee(({filters:l})=>[e("div",Gt,[t[18]||(t[18]=e("label",{class:"form-label fw-semibold text-dark"},[e("i",{class:"fas fa-concierge-bell me-2 text-muted"}),$("Order Type ")],-1)),A(e("select",{"onUpdate:modelValue":o=>l.orderType=o,class:"form-select"},[t[17]||(t[17]=e("option",{value:""},"All",-1)),(d(!0),r(I,null,K(U.value.orderTypeOptions,o=>(d(),r("option",{key:o.value,value:o.value},a(o.label),9,Wt))),128))],8,Xt),[[me,l.orderType]])]),e("div",Ht,[t[20]||(t[20]=e("label",{class:"form-label fw-semibold text-dark"},[e("i",{class:"fas fa-credit-card me-2 text-muted"}),$("Payment Type ")],-1)),A(e("select",{"onUpdate:modelValue":o=>l.paymentType=o,class:"form-select"},[t[19]||(t[19]=e("option",{value:""},"All",-1)),(d(!0),r(I,null,K(U.value.paymentTypeOptions,o=>(d(),r("option",{key:o.value,value:o.value},a(o.label),9,Yt))),128))],8,Kt),[[me,l.paymentType]])])]),_:1},8,["modelValue","sort-options","status-options"]),F(f(Qe),{modelValue:R.value,"onUpdate:modelValue":t[3]||(t[3]=l=>R.value=l),options:be,optionLabel:"label",optionValue:"value",placeholder:"Export",class:"export-dropdown",onChange:ye},null,8,["modelValue"])])]),e("div",Qt,[e("table",Zt,[t[25]||(t[25]=e("thead",{class:"border-top small text-muted"},[e("tr",null,[e("th",{style:{width:"70px"}},"S. #"),e("th",null,"Table No."),e("th",null,"Order Type"),e("th",null,"Date"),e("th",null,"Time"),e("th",null,"Customer"),e("th",null,"Payment Type"),e("th",null,"Total"),e("th",null,"Status"),e("th",null,"Source"),e("th",{class:"text-center"},"Actions")])],-1)),e("tbody",null,[v.value?(d(),r("tr",Jt,[...t[22]||(t[22]=[e("td",{colspan:"11",class:"text-center py-5"},[e("div",{class:"d-flex flex-column align-items-center justify-content-center"},[e("div",{class:"spinner-border mb-3",role:"status",style:{color:"#1B1670",width:"3rem",height:"3rem","border-width":"0.3em"}},[e("span",{class:"visually-hidden"},"Loading...")]),e("div",{class:"fw-semibold text-muted"},"Loading orders...")])],-1)])])):(d(),r(I,{key:1},[(d(!0),r(I,null,K(_.value,(l,o)=>(d(),r("tr",{key:l.id},[e("td",null,a(o+1),1),e("td",null,a(l.type?.table_number??"-"),1),e("td",null,a(l.type?.order_type??"-"),1),e("td",null,a(f(q)(l.created_at)),1),e("td",null,a(we(l.created_at)),1),e("td",null,a(l.customer_name??"-"),1),e("td",null,[e("span",{class:"cursor-pointer",onClick:u=>xe(l.payment)},a(l.payment?.payment_type??"-"),9,es)]),e("td",null,a(f(g)(l.total_amount)),1),e("td",ts,[e("span",{class:Xe(["badge px-4 py-2 rounded-pill",{"bg-danger":l?.status==="cancelled","bg-warning text-dark":l?.status==="refunded","bg-success":l?.status==="paid"}])},a(l?.status.charAt(0).toUpperCase()+l?.status.slice(1)),3)]),e("td",null,[e("span",ss,a(l.source==="Pos System"?"POS System":l.source==="website"?"Website":"-"),1)]),e("td",ls,[e("div",as,[e("button",{onClick:u=>Ce(l),title:"View Details",class:"p-2 rounded-full text-primary hover:bg-gray-100"},[F(f(st),{class:"w-4 h-4"})],8,os),l.status!=="cancelled"&&l.status!=="refunded"?(d(),r("button",{key:0,onClick:u=>Oe(l),title:"Cancel Order",disabled:P.value===l.id,class:"p-2 rounded-full text-danger hover:bg-gray-100"},[F(f(lt),{class:"w-4 h-4"})],8,ns)):y("",!0),Te(l)?(d(),r("button",{key:1,onClick:u=>$e(l),title:"Refund Payment",disabled:T.value===l.id,class:"p-2 rounded-full text-warning hover:bg-gray-100"},[...t[23]||(t[23]=[e("i",{class:"bi bi-arrow-counterclockwise",style:{"font-size":"1rem"}},null,-1)])],8,ds)):y("",!0)])])]))),128)),!v.value&&_.value.length===0?(d(),r("tr",rs,[...t[24]||(t[24]=[e("td",{colspan:"11",class:"text-center text-muted py-4"},[e("div",{class:"d-flex flex-column align-items-center justify-content-center py-3"},[e("i",{class:"bi bi-inbox",style:{"font-size":"2rem",opacity:"0.5","margin-bottom":"0.5rem"}}),e("div",{class:"fw-semibold"},"No orders found"),e("div",{class:"small text-secondary mt-1"},"Try adjusting your filters or date range")])],-1)])])):y("",!0)],64))])])]),!v.value&&x.value.last_page>1?(d(),r("div",is,[e("div",us," Showing "+a(x.value.from)+" to "+a(x.value.to)+" of "+a(x.value.total)+" entries ",1),F(We,{pagination:x.value.links,isApiDriven:!0,onPageChanged:fe},null,8,["pagination"])])):y("",!0)])]),e("div",cs,[e("div",ms,[e("div",ps,[t[35]||(t[35]=e("div",{class:"modal-header border-0 text-black"},[e("h6",{class:"modal-title fw-semibold"},[e("i",{class:"bi bi-credit-card me-2"}),$(" Payment Details ")]),e("button",{class:"absolute top-2 right-2 p-2 rounded-full hover:bg-gray-100 transition transform hover:scale-110","data-bs-dismiss":"modal","aria-label":"Close",title:"Close"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-danger",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})])])],-1)),e("div",vs,[e("div",bs,[e("div",ys,[e("div",fs,[e("div",gs,[t[26]||(t[26]=e("span",{class:"label"},"Payment Type",-1)),e("span",hs,a(h.value?.payment_type??"-"),1)])]),e("div",ws,[e("div",_s,[t[27]||(t[27]=e("span",{class:"label"},"Amount Received",-1)),e("span",xs,a(Z(h.value?.amount_received)),1)])]),h.value?.payment_type==="Split"?(d(),r("div",Cs,[e("div",ks,[t[28]||(t[28]=e("span",{class:"label"},"Cash Amount",-1)),e("span",Ts,a(Z(h.value?.cash_amount)),1)])])):y("",!0),h.value?.payment_type==="Split"?(d(),r("div",$s,[e("div",Ss,[t[29]||(t[29]=e("span",{class:"label"},"Card Amount",-1)),e("span",Os,a(Z(h.value?.card_amount)),1)])])):y("",!0),e("div",Ds,[e("div",Ms,[t[30]||(t[30]=e("span",{class:"label"},"Payment Date",-1)),e("span",Fs,a(G(h.value?.payment_date)),1)])]),h.value?.brand?(d(),r("div",Ps,[e("div",js,[t[31]||(t[31]=e("span",{class:"label"},"Card Brand",-1)),e("span",Ns,a(h.value.brand),1)])])):y("",!0),h.value?.last_digits?(d(),r("div",Is,[e("div",As,[t[32]||(t[32]=e("span",{class:"label"},"Last 4 Digits",-1)),e("span",Rs,"**** **** **** "+a(h.value.last_digits),1)])])):y("",!0),h.value?.exp_month?(d(),r("div",Es,[e("div",Bs,[t[33]||(t[33]=e("span",{class:"label"},"Expiry",-1)),e("span",Ls,a(h.value.exp_month)+"/"+a(h.value.exp_year),1)])])):y("",!0),h.value?.currency_code?(d(),r("div",Vs,[e("div",zs,[t[34]||(t[34]=e("span",{class:"label"},"Currency",-1)),e("span",qs,a(h.value.currency_code),1)])])):y("",!0)])])])])])]),e("div",Us,[e("div",Gs,[e("div",Xs,[e("div",Ws,[e("div",Hs,[t[36]||(t[36]=e("span",{class:"badge bg-gradient rounded-circle p-3 shadow-sm",style:{background:`linear-gradient(
                                            135deg,
                                            #4e73df,
                                            #224abe
                                        )`}},[e("i",{class:"bi bi-receipt fs-5 text-black"})],-1)),e("div",Ks,[e("h5",Ys," Order #"+a(b.value?.id),1),e("small",Qs," Customer: "+a(b.value?.customer_name??"—"),1)])]),t[37]||(t[37]=e("button",{class:"absolute top-2 right-2 p-2 rounded-full hover:bg-gray-100 transition transform hover:scale-110","data-bs-dismiss":"modal","aria-label":"Close",title:"Close"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})])],-1))]),e("div",Zs,[b.value?(d(),r("div",Js,[e("div",el,[t[40]||(t[40]=e("h6",{class:"fw-bold mb-3 text-primary"}," Order Details ",-1)),e("div",tl,[e("div",sl,[t[38]||(t[38]=e("span",{class:"fw-semibold text-dark"},"Order Type:",-1)),$(" "+a(b.value?.type?.order_type??"—"),1)]),e("div",ll,[t[39]||(t[39]=e("span",{class:"fw-semibold text-dark"},"Date:",-1)),$(" "+a(f(q)(b.value?.created_at)),1)])])]),t[72]||(t[72]=e("h6",{class:"fw-bold mb-3 text-primary"}," Order Items ",-1)),e("div",al,[e("table",ol,[t[71]||(t[71]=e("thead",{class:"bg-light text-muted small"},[e("tr",null,[e("th",{class:"px-3"},"#"),e("th",null,"Item"),e("th",null,"Qty"),e("th",null,"Actual Price"),e("th",null,"="),e("th",null,"Promo Name"),e("th",null,"Total Price")])],-1)),e("tbody",null,[(d(!0),r(I,null,K(b.value.items??[],(l,o)=>(d(),r("tr",{key:l.id},[e("td",nl,a(o+1),1),e("td",null,a(l.title),1),e("td",null,a(l.quantity),1),e("td",dl,a(f(g)(l.price)),1),t[41]||(t[41]=e("td",null,null,-1)),e("td",null,a(b.value.promo[0]?.promo_name||"-"),1),e("td",rl,a(f(g)(l.price)),1)]))),128)),b.value.promo?(d(),r("tr",il,[t[42]||(t[42]=e("td",null,null,-1)),t[43]||(t[43]=e("td",null,null,-1)),t[44]||(t[44]=e("td",null,null,-1)),t[45]||(t[45]=e("td",{colspan:"3",class:"text-end text-muted text-adjusting"},"Promo Discount",-1)),e("td",ul," -"+a(f(g)(b.value.promo[0]?.discount_amount??0)),1)])):y("",!0),b.value.tax?(d(),r("tr",cl,[t[46]||(t[46]=e("td",null,null,-1)),t[47]||(t[47]=e("td",null,null,-1)),t[48]||(t[48]=e("td",null,null,-1)),t[49]||(t[49]=e("td",{colspan:"3",class:"text-end text-muted text-adjusting"},"Tax",-1)),e("td",ml," +"+a(f(g)(b.value.tax??0)),1)])):y("",!0),b.value.service_charges?(d(),r("tr",pl,[t[50]||(t[50]=e("td",null,null,-1)),t[51]||(t[51]=e("td",null,null,-1)),t[52]||(t[52]=e("td",null,null,-1)),t[53]||(t[53]=e("td",{colspan:"3",class:"text-end text-muted text-adjusting"},"Service Charges",-1)),e("td",vl," +"+a(f(g)(b.value.service_charges??0)),1)])):y("",!0),b.value.delivery_charges?(d(),r("tr",bl,[t[54]||(t[54]=e("td",null,null,-1)),t[55]||(t[55]=e("td",null,null,-1)),t[56]||(t[56]=e("td",null,null,-1)),t[57]||(t[57]=e("td",{colspan:"3",class:"text-end text-muted text-adjusting"},"Delivery Charges",-1)),e("td",yl," +"+a(f(g)(b.value.delivery_charges??0)),1)])):y("",!0),b.value.sales_discount?(d(),r("tr",fl,[t[58]||(t[58]=e("td",null,null,-1)),t[59]||(t[59]=e("td",null,null,-1)),t[60]||(t[60]=e("td",null,null,-1)),t[61]||(t[61]=e("td",{colspan:"3",class:"text-end text-muted text-adjusting"},"Sales Discount",-1)),e("td",gl," +"+a(f(g)(b.value.sales_discount??0)),1)])):y("",!0),b.value.approved_discounts?(d(),r("tr",hl,[t[62]||(t[62]=e("td",null,null,-1)),t[63]||(t[63]=e("td",null,null,-1)),t[64]||(t[64]=e("td",null,null,-1)),t[65]||(t[65]=e("td",{colspan:"3",class:"text-end text-muted text-adjusting"},"Approved Discounts",-1)),e("td",wl," +"+a(f(g)(b.value.approved_discounts??0)),1)])):y("",!0),e("tr",_l,[t[66]||(t[66]=e("td",null,null,-1)),t[67]||(t[67]=e("td",null,null,-1)),t[68]||(t[68]=e("td",null,null,-1)),t[69]||(t[69]=e("td",{colspan:"3",class:"text-end text-muted text-adjusting"},"Grand Total ",-1)),e("td",xl,a(f(g)(b.value.total_amount)),1)]),(b.value.items??[]).length===0?(d(),r("tr",Cl,[...t[70]||(t[70]=[e("td",{colspan:"7",class:"text-center text-muted py-4"}," No items found ",-1)])])):y("",!0)])])])])):y("",!0)]),e("div",kl,[t[74]||(t[74]=e("button",{class:"btn btn-secondary px-2 py-2","data-bs-dismiss":"modal"}," Close ",-1)),le.value.length>0?(d(),r("button",{key:0,class:"btn btn-primary shadow-sm rounded-pill px-4 py-2",onClick:t[4]||(t[4]=l=>ke(b.value))},[...t[73]||(t[73]=[e("i",{class:"bi bi-printer me-1"},null,-1),$(" Print Receipt ",-1)])])):y("",!0)])])])])]),e("div",Tl,[e("div",$l,[e("div",Sl,[e("div",{class:"modal-header border-0"},[t[77]||(t[77]=e("h5",{class:"modal-title fw-bold"},[e("i",{class:"bi bi-arrow-counterclockwise text-warning me-2"}),$(" Process Refund ")],-1)),e("button",{onClick:oe,class:"absolute top-2 right-2 p-2 rounded-full hover:bg-gray-100 transition transform hover:scale-110","data-bs-dismiss":"modal","aria-label":"Close",title:"Close"},[...t[76]||(t[76]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("div",Ol,[t[88]||(t[88]=e("div",{class:"alert alert-warning d-flex align-items-start gap-2"},[e("i",{class:"bi bi-exclamation-triangle-fill mt-1"}),e("div",null,[e("strong",null,"Important:"),$(" This will process a refund to the customer's card. This action cannot be undone. ")])],-1)),e("div",Dl,[t[84]||(t[84]=e("label",{class:"form-label fw-semibold"},"Order Details",-1)),e("div",Ml,[e("div",Fl,[t[78]||(t[78]=e("span",{class:"text-muted"},"Order #:",-1)),e("span",Pl,a(m.value?.id),1)]),e("div",jl,[t[79]||(t[79]=e("span",{class:"text-muted"},"Customer:",-1)),e("span",Nl,a(m.value?.customer_name||"Walk In"),1)]),e("div",Il,[t[80]||(t[80]=e("span",{class:"text-muted"},"Total Amount:",-1)),e("span",Al,a(f(g)(m.value?.total_amount)),1)]),e("div",Rl,[t[81]||(t[81]=e("span",{class:"text-muted"},"Payment Type:",-1)),e("span",El,a(m.value?.payment?.payment_type),1)]),m.value?.payment?.payment_type?.toLowerCase()==="split"?(d(),r("div",Bl,[t[82]||(t[82]=e("span",{class:"text-muted"},"Card Amount:",-1)),e("span",Ll,a(f(g)(m.value?.payment?.card_amount)),1)])):y("",!0),m.value?.payment?.brand?(d(),r("div",Vl,[t[83]||(t[83]=e("span",{class:"text-muted"},"Card:",-1)),e("span",zl,a(m.value.payment.brand)+" •••• "+a(m.value.payment.last_digits),1)])):y("",!0)])]),e("div",ql,[t[86]||(t[86]=e("label",{class:"form-label fw-semibold"},"Refund Amount",-1)),e("div",Ul,[t[85]||(t[85]=e("span",{class:"input-group-text"},"£",-1)),A(e("input",{"onUpdate:modelValue":t[5]||(t[5]=l=>S.value=l),type:"number",class:"form-control",max:m.value?.payment?.card_amount||m.value?.total_amount,step:"0.01",min:"0.01",required:""},null,8,Gl),[[Y,S.value,void 0,{number:!0}]])]),e("small",Xl," Maximum: "+a(f(g)(m.value?.payment?.card_amount||m.value?.total_amount)),1)]),e("div",Wl,[t[87]||(t[87]=e("label",{class:"form-label fw-semibold"},"Refund Reason (Optional)",-1)),A(e("textarea",{"onUpdate:modelValue":t[6]||(t[6]=l=>O.value=l),class:"form-control",rows:"3",placeholder:"Enter reason for refund...",maxlength:"500"},null,512),[[Y,O.value]]),e("small",Hl,a(O.value.length)+"/500 characters",1)])]),e("div",Kl,[e("button",{type:"button",class:"btn btn-secondary px-2 py-2",onClick:oe,disabled:T.value!==null}," Cancel ",8,Yl),e("button",{type:"button",class:"btn btn-primary px-2 py-2",onClick:Se,disabled:T.value!==null||!S.value||S.value<=0},[T.value?(d(),r("span",Zl,[...t[89]||(t[89]=[e("span",{class:"spinner-border spinner-border-sm me-2"},null,-1),$(" Processing... ",-1)])])):(d(),r("span",Jl,[...t[90]||(t[90]=[e("i",{class:"bi bi-arrow-counterclockwise me-1"},null,-1),$(" Process Refund ",-1)])]))],8,Ql)])])])]),F(wt,{show:J.value,order:M.value,loading:P.value===M.value?.id,onConfirm:De,onCancel:ne},null,8,["show","order","loading"])]),_:1})],64))}},ga=pe(ea,[["__scopeId","data-v-e7f4ba6b"]]);export{ga as default};
