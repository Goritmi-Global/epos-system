import{_ as de,r as i,c as X,w as q,o as ue,a as A,b as o,d as R,e as v,f as a,u as w,h as ce,g as r,F as U,i as G,t as d,j as c,k as me,l as g,m as E,v as L,p as T,W as K,C as pe,P as ve,X as ge,s as m}from"./app-CYYlfszq.js";import{_ as fe}from"./Master-B6Go9fCb.js";import{s as be}from"./index-CUDmc8zC.js";import{u as he}from"./useFormatters-RJKnQoSm.js";import{F as _e}from"./FilterModal-C-YUVCAT.js";import{P as ye}from"./package-BytiI-eu.js";import{C as we}from"./circle-check-big-DXkkqcPI.js";import{C as xe}from"./circle-x-7DjUoTGQ.js";import{P as ke}from"./plus-zjlV5r_a.js";import{P as Ce}from"./pencil-C49dQH-z.js";import"./index-C-KxnP12.js";import"./createLucideIcon-D217t_iT.js";import"./index-DJNrC0mS.js";import"./index-Dz-aUUP8.js";import"./sun-B21gpqoz.js";import"./index-B3Pqd2wp.js";import"./index-BxpxhNZZ.js";import"./index-BuSNz9fi.js";import"./index-CKKC2Lpu.js";const De={class:"page-wrapper"},Me={class:"row g-3"},Ie={class:"card border-0 shadow-sm rounded-4"},Ue={class:"card-body d-flex align-items-center justify-content-between"},Fe={class:"fw-bold fs-4"},Pe={class:"text-muted fs-6"},Se={class:"card border-0 shadow-lg rounded-4 mt-4"},Be={class:"card-body"},Ae={class:"d-flex flex-wrap gap-2 justify-content-between align-items-center mb-3"},Ee={class:"d-flex flex-wrap gap-2 align-items-center"},Le={class:"search-wrap"},Ve={key:1,class:"form-control search-input",placeholder:"Search",disabled:"",type:"text"},je={class:"table-responsive"},$e={class:"table table-hover"},Oe={key:0},Ne={class:"fw-semibold"},Re={key:0,class:"badge bg-red-600 rounded-pill d-inline-block text-center px-3 py-1"},Te={key:1,class:"badge bg-success rounded-pill d-inline-block text-center px-3 py-1"},Ze={class:"text-center"},ze={class:"d-inline-flex align-items-center gap-3"},We=["onClick"],He=["onClick","title"],Xe={key:0},qe={key:0,class:"mt-4"},Ge={class:"text-center mt-3 text-sm text-gray-600"},Ke={class:"modal fade",id:"addDealModal",tabindex:"-1","aria-hidden":"true"},Je={class:"modal-dialog modal-lg modal-dialog-centered"},Qe={class:"modal-content rounded-4"},Ye={class:"modal-header"},ea={class:"modal-title fw-semibold"},aa={class:"modal-body"},ta={class:"row g-3"},sa={class:"col-md-6"},la={key:0,class:"text-danger"},oa={class:"col-md-6"},na={key:0,class:"text-danger"},ia={class:"col-md-12"},ra={class:"d-flex justify-content-between align-items-center w-100"},da={class:"badge bg-primary"},ua={key:0,class:"text-danger"},ca={class:"col-12"},ma={key:0,class:"text-danger"},pa={class:"col-md-6"},va=["src"],ga={key:1,class:"placeholder"},fa={class:"mt-4"},ba=["disabled"],ha={__name:"Deals",props:{menuItems:{type:Array,default:()=>[]}},setup(J){const{formatCurrencySymbol:Z}=he(),x=i([]),k=i(1),F=i(10),V=i(0),j=i([]),C=i(!1),p=i({total:0,active:0,inactive:0}),l=i({name:"",price:"",menu_item_ids:[],description:"",imageFile:null,imageUrl:null,status:1}),n=i({}),b=i(!1),$=i(!1),P=i(!1),D=i(!1),S=i(null),h=i(""),z=i(Date.now()),O=`search-${Math.random().toString(36).substr(2,9)}`,W=i(!1),B={sortBy:"",status:"",priceMin:null,priceMax:null},u=i({...B}),N=i({...B}),_=async(t=1)=>{C.value=!0;try{const e=await axios.get("/api/deals",{params:{page:t,per_page:F.value,search:h.value.trim()||null,status:u.value.status!==""?u.value.status:null,sort_by:u.value.sortBy||null,price_min:u.value.priceMin||null,price_max:u.value.priceMax||null}});x.value=e.data.data||[],e.data.pagination&&(k.value=e.data.pagination.current_page,V.value=e.data.pagination.total,j.value=e.data.pagination.links),e.data.counts&&(p.value=e.data.counts)}catch(e){console.error("❌ Error fetching deals:",e),m.error("Failed to fetch deals")}finally{C.value=!1}},Q=t=>{if(!t||C.value)return;const s=new URLSearchParams(t.split("?")[1]).get("page");s&&_(parseInt(s))},Y=X(()=>[{label:"Total Deals",value:p.value.total??0,icon:ye,iconBg:"bg-soft-success",iconColor:"text-success"},{label:"Active Deals",value:p.value.active??0,icon:we,iconBg:"bg-soft-danger",iconColor:"text-success"},{label:"Inactive Deals",value:p.value.inactive??0,icon:xe,iconBg:"bg-soft-warning",iconColor:"text-danger"}]),H=X(()=>({sortOptions:[{value:"price_desc",label:"Price: High to Low"},{value:"price_asc",label:"Price: Low to High"},{value:"name_asc",label:"Name: A to Z"},{value:"name_desc",label:"Name: Z to A"}],statusOptions:[{value:1,label:"Active"},{value:0,label:"Inactive"}]})),ee=()=>{u.value={...B},N.value={...B}},ae=()=>{N.value={...u.value}};function te(t){S.value=l.value.imageUrl,S.value&&(D.value=!0)}function se({file:t}){l.value.imageFile=t,l.value.imageUrl=URL.createObjectURL(t)}const le=async()=>{b.value=!0,n.value={};try{const t=new FormData;t.append("name",l.value.name.trim()),t.append("price",l.value.price),t.append("description",l.value.description||""),t.append("status",l.value.status),l.value.menu_item_ids.forEach((e,s)=>{t.append(`menu_item_ids[${s}]`,e)}),l.value.imageFile&&t.append("image",l.value.imageFile),await axios.post("/deals",t,{headers:{"Content-Type":"multipart/form-data"}}),m.success("Deal created successfully"),I(),await _(),bootstrap.Modal.getInstance(document.getElementById("addDealModal"))?.hide()}catch(t){if(console.error("❌ Error saving:",t.response?.data),t?.response?.status===422&&t.response.data?.errors){n.value=t.response.data.errors;const e=Object.values(t.response.data.errors).flat().join(`
`);m.error(e||"Validation failed")}else m.error("Failed to save deal: "+(t.response?.data?.message||t.message))}finally{b.value=!1}},oe=async()=>{b.value=!0,n.value={};try{const t=new FormData;t.append("name",l.value.name.trim()),t.append("price",l.value.price),t.append("description",l.value.description||""),t.append("status",l.value.status),l.value.menu_item_ids.forEach((s,y)=>{t.append(`menu_item_ids[${y}]`,s)}),l.value.imageFile&&t.append("image",l.value.imageFile),t.append("_method","PUT"),await axios.post(`/deals/${l.value.id}`,t,{headers:{"Content-Type":"multipart/form-data"}}),m.success("Deal updated successfully"),I(),await _(),bootstrap.Modal.getInstance(document.getElementById("addDealModal"))?.hide()}catch(t){if(console.error("❌ Update failed:",t.response?.data),t?.response?.status===422&&t.response.data?.errors){n.value=t.response.data.errors;const e=Object.values(t.response.data.errors).flat().join(`
`);m.error(e||"Validation failed")}else m.error("Failed to update deal: "+(t.response?.data?.message||t.message))}finally{b.value=!1}},ne=t=>{l.value.imageUrl&&l.value.imageUrl.startsWith("blob:")&&URL.revokeObjectURL(l.value.imageUrl),$.value=!0,l.value={id:t.id,name:t.name,price:t.price,description:t.description||"",menu_item_ids:t.menu_items?.map(s=>s.id)||[],imageFile:null,imageUrl:t.image_url||null,status:t.status??1},new bootstrap.Modal(document.getElementById("addDealModal")).show()},M=i({}),ie=async t=>{try{const e=t.status===1?0:1,s=await axios.patch(`/deals/${t.id}/status`,{status:e}),y=x.value.findIndex(f=>f.id===t.id);y!==-1&&(x.value[y].status=e),e===1?(p.value.active++,p.value.inactive--):(p.value.active--,p.value.inactive++),m.success(`Deal is now ${e===1?"Active":"Inactive"}`),M.value[t.id]=!1}catch(e){console.error("Failed to toggle status",e),m.error("Failed to update status"),await _(k.value),M.value[t.id]=!1}};function I(){l.value.imageUrl&&l.value.imageUrl.startsWith("blob:")&&URL.revokeObjectURL(l.value.imageUrl),l.value={name:"",price:"",menu_item_ids:[],description:"",imageFile:null,imageUrl:null,status:1},P.value=!1,D.value=!1,S.value=null,n.value={},$.value=!1}const re=()=>{I()};return q([u,h],()=>{_(1)},{deep:!0}),q(l,t=>{Object.keys(n.value).forEach(e=>{const s=t[e];s!=null&&s!==""&&(!Array.isArray(s)||s.length>0)&&delete n.value[e]})},{deep:!0}),ue(async()=>{h.value="",z.value=Date.now(),setTimeout(()=>{W.value=!0;const e=document.getElementById(O);e&&(e.value="",h.value="")},100),await _();const t=document.getElementById("dealFilterModal");t&&t.addEventListener("hidden.bs.modal",()=>{u.value={...N.value}})}),(t,e)=>(o(),A(fe,null,{default:R(()=>[v(w(ce),{title:"Deals"}),a("div",De,[e[26]||(e[26]=a("h4",{class:"mb-3"},"Deals Management",-1)),a("div",Me,[(o(!0),r(U,null,G(Y.value,s=>(o(),r("div",{key:s.label,class:"col-md-6 col-xl-4"},[a("div",Ie,[a("div",Ue,[a("div",null,[a("div",Fe,d(s.value),1),a("div",Pe,d(s.label),1)]),a("div",{class:c(["icon-chip",s.iconBg])},[(o(),A(me(s.icon),{class:c(s.iconColor),size:"26"},null,8,["class"]))],2)])])]))),128))]),a("div",Se,[a("div",Be,[a("div",Ae,[e[12]||(e[12]=a("h4",{class:"mb-0"},"Deals",-1)),a("div",Ee,[a("div",Le,[e[10]||(e[10]=a("i",{class:"bi bi-search"},null,-1)),W.value?E((o(),r("input",{id:O,"onUpdate:modelValue":e[0]||(e[0]=s=>h.value=s),key:z.value,class:"form-control search-input",placeholder:"Search",type:"search",autocomplete:"new-password",name:O})),[[L,h.value]]):(o(),r("input",Ve))]),v(_e,{modelValue:u.value,"onUpdate:modelValue":e[1]||(e[1]=s=>u.value=s),title:"Deals","modal-id":"dealFilterModal","modal-size":"modal-lg","sort-options":H.value.sortOptions,"status-options":H.value.statusOptions,"show-price-range":!0,"show-date-range":!1,"show-category":!1,"show-stock-status":!1,onApply:ae,onClear:ee},null,8,["modelValue","sort-options","status-options"]),a("button",{"data-bs-toggle":"modal",onClick:re,"data-bs-target":"#addDealModal",class:"d-flex align-items-center gap-1 px-4 btn-sm py-2 rounded-pill btn btn-primary text-white"},[v(w(ke),{class:"w-4 h-4"}),e[11]||(e[11]=T(" Add Deal ",-1))])])]),a("div",je,[a("table",$e,[e[15]||(e[15]=a("thead",{class:"border-top small text-muted"},[a("tr",null,[a("th",null,"S.#"),a("th",null,"Image"),a("th",null,"Deal Name"),a("th",null,"Price"),a("th",null,"Menus"),a("th",null,"Status"),a("th",{class:"text-center"},"Action")])],-1)),a("tbody",null,[C.value?(o(),r("tr",Oe,[...e[13]||(e[13]=[a("td",{colspan:"7",class:"text-center py-5"},[a("div",{class:"d-flex flex-column align-items-center justify-content-center"},[a("div",{class:"spinner-border text-primary mb-3",role:"status"},[a("span",{class:"visually-hidden"},"Loading...")]),a("p",{class:"text-muted mb-0"},"Loading deals...")])],-1)])])):(o(),r(U,{key:1},[(o(!0),r(U,null,G(x.value,(s,y)=>(o(),r("tr",{key:s.id},[a("td",null,d((k.value-1)*F.value+y+1),1),a("td",null,[s.image_url?(o(),A(K,{key:0,file:s.image_url,alt:s.name,width:50,height:50,custom_class:"cursor-pointer"},null,8,["file","alt"])):g("",!0)]),a("td",Ne,d(s.name),1),a("td",null,d(w(Z)(s.price||0,"GBP")),1),a("td",null,d((s.menu_items||[]).map(f=>f.name).join(", ")),1),a("td",null,[s.status===0?(o(),r("span",Re,"Inactive")):(o(),r("span",Te,"Active"))]),a("td",Ze,[a("div",ze,[a("button",{onClick:f=>ne(s),"data-bs-toggle":"modal",title:"Edit",class:"p-2 rounded-full text-blue-600 hover:bg-blue-100"},[v(w(Ce),{class:"w-4 h-4"})],8,We),v(pe,{show:M.value[s.id],"onUpdate:show":f=>M.value[s.id]=f,title:"Confirm Status Change",message:`Are you sure you want to ${s.status===1?"deactivate":"activate"} this deal?`,showStatusButton:!0,status:s.status===1?"active":"inactive",onConfirm:()=>ie(s)},{trigger:R(()=>[a("button",{onClick:f=>M.value[s.id]=!0,class:c(["relative inline-flex items-center w-8 h-4 rounded-full transition-colors duration-300 focus:outline-none",s.status===1?"bg-green-500 hover:bg-green-600":"bg-red-400 hover:bg-red-500"]),title:s.status===1?"Set Inactive":"Set Active"},[a("span",{class:c(["absolute left-0.5 top-0.5 w-3 h-3 bg-white rounded-full shadow transform transition-transform duration-300",s.status===1?"translate-x-4":"translate-x-0"])},null,2)],10,He)]),_:2},1032,["show","onUpdate:show","message","status","onConfirm"])])])]))),128)),x.value.length===0?(o(),r("tr",Xe,[...e[14]||(e[14]=[a("td",{colspan:"7",class:"text-center text-muted py-4"}," No deals found. ",-1)])])):g("",!0)],64))])])]),j.value.length>0&&!C.value?(o(),r("div",qe,[v(ve,{pagination:j.value,isApiDriven:!0,onPageChanged:Q},null,8,["pagination"]),a("div",Ge," Showing "+d((k.value-1)*F.value+1)+" to "+d(Math.min(k.value*F.value,V.value))+" of "+d(V.value)+" results ",1)])):g("",!0)])]),a("div",Ke,[a("div",Je,[a("div",Qe,[a("div",Ye,[a("h5",ea,d($.value?"Edit Deal":"Add Deal"),1),a("button",{onClick:I,class:"absolute top-2 right-2 p-2 rounded-full hover:bg-gray-100 transition transform hover:scale-110","data-bs-dismiss":"modal","aria-label":"Close",title:"Close"},[...e[16]||(e[16]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),a("div",aa,[a("div",ta,[a("div",sa,[e[17]||(e[17]=a("label",{class:"form-label"},"Deal Name",-1)),E(a("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>l.value.name=s),type:"text",class:c(["form-control",{"is-invalid":n.value.name}]),placeholder:"e.g., Family Deal"},null,2),[[L,l.value.name]]),n.value.name?(o(),r("small",la,d(n.value.name[0]),1)):g("",!0)]),a("div",oa,[e[18]||(e[18]=a("label",{class:"form-label"},"Price",-1)),E(a("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>l.value.price=s),type:"number",min:"0",step:"0.01",class:c(["form-control",{"is-invalid":n.value.price}]),placeholder:"e.g., 29.99"},null,2),[[L,l.value.price]]),n.value.price?(o(),r("small",na,d(n.value.price[0]),1)):g("",!0)]),a("div",ia,[e[19]||(e[19]=a("label",{class:"form-label"},"Select Menu Items",-1)),v(w(be),{modelValue:l.value.menu_item_ids,"onUpdate:modelValue":e[4]||(e[4]=s=>l.value.menu_item_ids=s),options:J.menuItems,optionLabel:"name",optionValue:"id",filter:"",placeholder:"Select Menu Items",class:c(["w-full",{"is-invalid":n.value.menu_item_ids}]),appendTo:"self",autoZIndex:!0,baseZIndex:2e3},{option:R(s=>[a("div",ra,[a("span",null,d(s.option.name),1),a("span",da,d(w(Z)(s.option.price)),1)])]),_:1},8,["modelValue","options","class"]),n.value.menu_item_ids?(o(),r("small",ua,d(n.value.menu_item_ids[0]),1)):g("",!0)]),a("div",ca,[e[20]||(e[20]=a("label",{class:"form-label"},"Description",-1)),E(a("textarea",{"onUpdate:modelValue":e[5]||(e[5]=s=>l.value.description=s),rows:"4",class:c(["form-control",{"is-invalid":n.value.description}]),placeholder:"Deal description"},null,2),[[L,l.value.description]]),n.value.description?(o(),r("small",ma,d(n.value.description[0]),1)):g("",!0)]),a("div",pa,[e[23]||(e[23]=a("label",{class:"form-label"},"Deal Image",-1)),a("div",{class:c(["logo-card",{"is-invalid":n.value.image}])},[a("div",{class:"logo-frame",onClick:e[6]||(e[6]=s=>l.value.imageUrl?te():P.value=!0)},[l.value.imageUrl?(o(),r("img",{key:0,src:l.value.imageUrl,alt:"Deal Image"},null,8,va)):(o(),r("div",ga,[...e[21]||(e[21]=[a("i",{class:"bi bi-image"},null,-1)])]))]),e[22]||(e[22]=a("small",{class:"text-muted mt-2 d-block"},"Upload Image",-1)),v(ge,{show:P.value,onClose:e[7]||(e[7]=s=>P.value=!1),onCropped:se},null,8,["show"]),D.value?(o(),A(K,{key:0,show:D.value,image:S.value,onClose:e[8]||(e[8]=s=>D.value=!1)},null,8,["show","image"])):g("",!0)],2)])]),a("div",fa,[a("button",{class:"btn btn-primary rounded-pill btn-sm px-5 py-2",disabled:b.value,onClick:e[9]||(e[9]=s=>l.value.id?oe():le())},[b.value?(o(),r(U,{key:0},[e[24]||(e[24]=a("span",{class:"spinner-border spinner-border-sm me-2"},null,-1)),e[25]||(e[25]=T(" Saving... ",-1))],64)):(o(),r(U,{key:1},[T(" Save ")],64))],8,ba),a("button",{class:"btn btn-secondary btn-sm rounded-pill py-2 px-4 ms-2","data-bs-dismiss":"modal",onClick:I}," Cancel ")])])])])])])]),_:1}))}},$a=de(ha,[["__scopeId","data-v-86b7b7f2"]]);export{$a as default};
