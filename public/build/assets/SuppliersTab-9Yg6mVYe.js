import{_ as ve,A as fe,c as G,r as v,o as he,n as B,w as W,g as n,b as i,e as w,f as l,u as F,h as ge,l as _,m as S,v as k,p as C,F as T,i as H,t as m,C as be,P as ye,j as L,q as P,s as r}from"./app-CCSEjIT4.js";import{E as _e,a as we,X as xe,u as E,w as Se}from"./xlsx-D9vfwJJ2.js";import{I as ke}from"./importFile-DI05SuZE.js";import{s as Ce}from"./index-D7k8c467.js";import{P as Pe}from"./plus-1VzIKtYb.js";import{P as De}from"./pencil-CyazALLb.js";import"./index-FDc3FNfE.js";import"./index-Bm9uMUox.js";import"./index-BQdLG6Qw.js";import"./index-Kclx_GWY.js";import"./index-CUHCErLp.js";import"./index-DIvh2939.js";import"./createLucideIcon-bhPlb3RE.js";const Ee={class:"card border-0 shadow-lg rounded-4"},Ie={class:"card-body"},Ae={class:"d-flex flex-wrap gap-2 justify-content-between align-items-center mb-3"},Ve={class:"d-flex flex-wrap gap-2 align-items-center"},$e={class:"search-wrap"},Fe={key:1,class:"form-control search-input",placeholder:"Search",disabled:"",type:"text"},Te={class:"table-responsive"},Le={class:"table table-hover align-middle"},Me={key:0},Ue={class:"fw-semibold"},Ne={class:"text-break",style:{"max-width":"240px"}},Be={class:"text-truncate",style:{"max-width":"260px"}},Oe={class:"text-center"},Re={class:"d-inline-flex align-items-center gap-3"},qe=["onClick"],je={key:0},Ke={colspan:"7",class:"text-center text-muted py-4"},ze={key:0,class:"mt-4 d-flex justify-content-between align-items-center"},Xe={class:"text-muted small"},Ge={class:"modal fade",id:"modalAddSupplier",tabindex:"-1","aria-labelledby":"modalAddSupplier","aria-hidden":"true"},We={class:"modal-dialog modal-lg modal-dialog-centered",role:"document"},He={class:"modal-content rounded-4"},Ye={class:"modal-header"},Je={class:"modal-title fw-semibold"},Qe={class:"modal-body"},Ze={class:"row g-3"},et={class:"col-lg-6"},tt={key:0,class:"text-danger"},lt={class:"col-lg-6"},at={key:0,class:"text-danger"},ot={class:"col-lg-6"},st={class:"input-group"},rt={key:0,class:"text-danger d-block mt-1"},nt={key:1,class:"text-danger d-block mt-1"},it={key:2,class:"text-success d-block mt-1"},dt={class:"col-lg-6"},ut={class:"col-lg-12"},ct={key:0,class:"text-danger"},pt={class:"col-md-2"},mt=["disabled"],vt={key:0,class:"spinner-border spinner-border-sm me-2"},ft=["disabled"],ht={key:0,class:"spinner-border spinner-border-sm me-2"},I="+44",gt={__name:"SuppliersTab",setup(bt){const Y=fe();G(()=>Y.props.onboarding.language_and_location?.country_id??"PK");const D=v([]),g=v({current_page:1,last_page:1,per_page:10,total:0,from:0,to:0,links:[]});v(1),v(15);const M=v(null),J=[{label:"PDF",value:"pdf"},{label:"Excel",value:"excel"},{label:"CSV",value:"csv"}],Q=t=>{t.value&&(le(t.value),M.value=null)},x=async(t=null)=>{d.value=!0;try{const{data:e}=await P.get("/suppliers",{params:{q:b.value,page:t||g.value.current_page,per_page:g.value.per_page}});D.value=e.data||[],g.value={current_page:e.current_page,last_page:e.last_page,per_page:e.per_page,total:e.total,from:e.from,to:e.to,links:e.links},await B(),window.feather?.replace()}catch(e){console.error("Failed to fetch suppliers",e),r.error("Failed to load suppliers")}finally{d.value=!1}},Z=t=>{if(!t)return;const a=new URLSearchParams(t.split("?")[1]).get("page");a&&x(parseInt(a))},b=v(""),O=v(Date.now()),U=`search-${Math.random().toString(36).substr(2,9)}`,R=v(!1);he(async()=>{b.value="",O.value=Date.now(),await B(),setTimeout(()=>{R.value=!0;const t=document.getElementById(U);t&&(t.value="",b.value="")},100),await x()});const ee=t=>{t.target.value="",b.value=""},q=G(()=>{const t=b.value.trim().toLowerCase();if(!t)return D.value;const e=t.replace(/\D/g,"");return D.value.filter(a=>{const s=[a.name,a.email,a.address,a.preferred_items].some(p=>(p||"").toLowerCase().includes(t)),f=(a.phone||"").replace(/\D/g,""),h=(a.contact||"").replace(/\D/g,""),c=e&&(f.includes(e)||h.includes(e));return s||c})}),te=async()=>{try{d.value=!0;const t=await P.get("/suppliers",{params:{q:b.value.trim(),per_page:1e4,page:1}});return console.log("ðŸ“¦ Export data received:",{total:t.data.total,items:t.data.data.length}),t.data.data||[]}catch(t){return console.error("âŒ Error fetching export data:",t),r.error("Failed to load data for export"),[]}finally{d.value=!1}},le=async t=>{try{d.value=!0,r.info("Preparing export data...",{autoClose:1500});const e=await te();if(!e||e.length===0){r.error("No suppliers found to download"),d.value=!1;return}console.log(`ðŸ“¥ Exporting ${e.length} suppliers as ${t.toUpperCase()}`),t==="pdf"?oe(e):t==="excel"?se(e):t==="csv"?ae(e):r.error("Invalid download type")}catch(e){console.error("Download failed:",e),r.error(`Download failed: ${e.message}`)}finally{d.value=!1}},ae=t=>{try{const e=["Name","Email","Phone","Address","Preferred Items"],a=t.map(p=>[`"${p.name||""}"`,`"${p.email||""}"`,`"${p.contact||""}"`,`"${p.address||""}"`,`"${p.preferred_items||""}"`]),s=[e.join(","),...a.map(p=>p.join(","))].join(`
`),f=new Blob([s],{type:"text/csv;charset=utf-8;"}),h=URL.createObjectURL(f),c=document.createElement("a");c.setAttribute("href",h),c.setAttribute("download",`suppliers_${new Date().toISOString().split("T")[0]}.csv`),document.body.appendChild(c),c.click(),document.body.removeChild(c),r.success("CSV downloaded successfully .",{autoClose:2500})}catch(e){console.error("CSV generation error:",e),r.error(`CSV generation failed: ${e.message}`,{autoClose:5e3})}},oe=t=>{try{const e=new _e("p","mm","a4");e.setFont("helvetica","bold"),e.setFontSize(18),e.text("Suppliers Report",70,20),e.setFont("helvetica","normal"),e.setFontSize(10);const a=new Date().toLocaleString();e.text(`Generated on: ${a}`,14,30),e.text(`Total Suppliers: ${t.length}`,14,36);const s=["Name","Email","Phone","Address","Preferred Items"],f=t.map(c=>[c.name||"",c.email||"",c.contact||"",c.address||"",c.preferred_items||""]);we(e,{head:[s],body:f,startY:45,styles:{fontSize:9,cellPadding:3,halign:"left",valign:"middle",lineColor:[200,200,200],lineWidth:.1},headStyles:{fillColor:[41,128,185],textColor:255,fontStyle:"bold"},alternateRowStyles:{fillColor:[245,245,245]},margin:{left:14,right:14},didDrawPage:c=>{const p=e.internal.getNumberOfPages(),me=e.internal.pageSize.height;e.setFontSize(8),e.text(`Page ${c.pageNumber} of ${p}`,14,me-10)}});const h=`suppliers_${new Date().toISOString().split("T")[0]}.pdf`;e.save(h),r.success("PDF downloaded successfully.",{autoClose:2500})}catch(e){console.error("PDF generation error:",e),r.error(`PDF generation failed: ${e.message}`,{autoClose:5e3})}},se=t=>{try{if(typeof xe>"u")throw new Error("XLSX library is not loaded");const e=t.map(p=>({Name:p.name||"",Email:p.email||"",Phone:p.contact||"",Address:p.address||"","Preferred Items":p.preferred_items||""})),a=E.book_new(),s=E.json_to_sheet(e);s["!cols"]=[{wch:20},{wch:25},{wch:18},{wch:30},{wch:25}],E.book_append_sheet(a,s,"Suppliers");const f=[{Info:"Generated On",Value:new Date().toLocaleString()},{Info:"Total Records",Value:t.length},{Info:"Exported By",Value:"Supplier Management System"}],h=E.json_to_sheet(f);E.book_append_sheet(a,h,"Report Info");const c=`suppliers_${new Date().toISOString().split("T")[0]}.xlsx`;Se(a,c),r.success("Excel file downloaded successfully.",{autoClose:2500})}catch(e){console.error("Excel generation error:",e),r.error(`Excel generation failed: ${e.message}`,{autoClose:5e3})}},o=v({name:"",email:"",phone_country:"GB",phone_code:I,phone_local:"",phone:"",address:"",preferred_items:""}),y=v(""),A=v(!1),j=v([]),K=()=>{y.value="",j.value=[],A.value=!1;const t=String(o.value.phone_local||"").trim();if(!t)return y.value="Phone number is required",!1;let e=t.replace(/\D+/g,"");if(e.length!==10)return y.value="UK mobile number must be exactly 10 digits",!1;if(!e.startsWith("7"))return y.value="UK mobile numbers must start with 7",!1;if(!/^7[0-9]{9}$/.test(e))return y.value="Invalid UK mobile number format",!1;const s=e.substring(1,3);return["11","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99"].includes(s)?(A.value=!0,!0):(y.value="Invalid UK mobile operator code",!1)};function re(){const t=String(o.value.phone_local||"").replace(/\D+/g,"");o.value.phone=I+t}W(()=>o.value.phone_local,t=>{re(),K()});let z=null;W(b,()=>{clearTimeout(z),z=setTimeout(()=>{g.value.current_page=1,x(1)},500)});const d=v(!1),u=v({}),X=t=>{const e=document.getElementById(t);if(!e)return;(window.bootstrap?.Modal.getInstance(e)||new window.bootstrap.Modal(e)).hide()},N=()=>{o.value={name:"",email:"",phone:"",address:"",preferred_items:""},u.value={},$.value=null},ne=()=>{d.value=!0,u.value={};const t={name:o.value.name,email:o.value.email,contact:o.value.phone||null,address:o.value.address||null,preferred_items:o.value.preferred_items||null};P.post("/suppliers",t).then(e=>{x(),r.success("Supplier added successfully.",{autoClose:1500}),N(),X("modalAddSupplier")}).catch(e=>{e?.response?.status===422&&e.response.data?.errors?(u.value=e.response.data.errors,r.error("Please fill in all required fields correctly.")):(r.error("Something went wrong. Please try again.",{autoClose:3e3}),console.error(e))}).finally(()=>{d.value=!1})},ie=t=>{const e=document.getElementById(t);if(!e)return;new window.bootstrap.Modal(e).show()},V=v(),$=v(null),de=t=>{V.value="Edit",$.value=t,o.value={name:t.name||"",email:t.email||"",phone_country:"GB",phone_code:I,phone_local:t.phone?t.phone.replace(I,"").trim():t.contact?t.contact.replace(I,"").trim():"",phone:t.phone||t.contact||"",address:t.address||"",preferred_items:t.preferred_items??t.preferred_items??""},ie("modalAddSupplier")},ue=()=>{if(!$.value)return;d.value=!0,u.value={};const t={id:$.value.id,name:o.value.name,email:o.value.email,contact:o.value.phone||null,address:o.value.address||null,preferred_items:o.value.preferred_items||null};P.post("/suppliers/update",t).then(e=>(x(),r.success("Supplier updated successfully .",{autoClose:500}),N(),X("modalAddSupplier"),B())).catch(e=>{e?.response?.status===422&&e.response.data?.errors?(u.value=e.response.data.errors,r.error("Validation failed. Please check the fields.",{autoClose:3e3})):(r.error("Update failed. Please try again.",{autoClose:3e3}),console.error(e))}).finally(()=>{d.value=!1})},ce=t=>{d.value=!0,P.delete(`/suppliers/${t}`).then(()=>{D.value=D.value.filter(e=>e.id!==t),r.success("Supplier deleted successfully.")}).catch(e=>{r.error("Delete failed. Please try again.",{autoClose:3e3}),console.error(e)}).finally(()=>{d.value=!1})},pe=t=>{if(!t||t.length<=1){r.error("The file is empty",{autoClose:3e3});return}t[0];const a=t.slice(1).map(s=>({name:s[0]||"",email:s[1]||"",contact:s[2]||"",address:s[3]||"",preferred_items:s[4]||""}));P.post("/api/suppliers/import",{suppliers:a}).then(()=>{r.success("Suppliers imported successfully");const s=document.querySelector(".modal.show");if(s){const f=bootstrap.Modal.getInstance(s);f&&f.hide()}setTimeout(()=>{document.querySelectorAll(".modal-backdrop").forEach(h=>h.remove()),document.body.classList.remove("modal-open"),document.body.style.overflow="",document.body.style.paddingRight=""},100),x()}).catch(s=>{s?.response?.status===422&&s.response.data?.errors&&(u.value=s.response.data.errors,r.error("There may be some duplication in data",{autoClose:3e3})),setTimeout(()=>{document.querySelectorAll(".modal-backdrop").forEach(h=>h.remove()),document.body.classList.remove("modal-open"),document.body.style.overflow="",document.body.style.paddingRight=""},100)})};return(t,e)=>(i(),n(T,null,[w(F(ge),{title:"Supplier"}),l("div",Ee,[l("div",Ie,[l("div",Ae,[e[13]||(e[13]=l("h4",{class:"mb-0"},"Suppliers",-1)),l("div",Ve,[l("div",$e,[e[10]||(e[10]=l("i",{class:"bi bi-search"},null,-1)),e[11]||(e[11]=l("input",{type:"email",name:"email",autocomplete:"email",style:{position:"absolute",left:"-9999px",width:"1px",height:"1px"},tabindex:"-1","aria-hidden":"true"},null,-1)),R.value?S((i(),n("input",{id:U,"onUpdate:modelValue":e[0]||(e[0]=a=>b.value=a),key:O.value,class:"form-control search-input",placeholder:"Search",type:"search",autocomplete:"new-password",name:U,role:"presentation",onFocus:ee},null,32)),[[k,b.value]]):(i(),n("input",Fe))]),l("button",{"data-bs-toggle":"modal","data-bs-target":"#modalAddSupplier",onClick:e[1]||(e[1]=()=>{N(),u.value={},V.value="Add"}),class:"d-flex align-items-center gap-1 px-4 btn-sm py-2 rounded-pill btn-sm btn btn-primary text-white"},[w(F(Pe),{class:"w-4 h-4"}),e[12]||(e[12]=C(" Add Supplier ",-1))]),w(ke,{label:"Import",sampleHeaders:["Name","Email","Phone","Address","Preferred Items"],sampleData:[["Ali Khan","ali@example.com","+44 3721232321","Lahore","Steel"],["Ahmed Raza","ahmed@example.com","+44 5676576576","Karachi","Cement"]],onOnImport:pe}),w(F(Ce),{modelValue:M.value,"onUpdate:modelValue":e[2]||(e[2]=a=>M.value=a),options:J,optionLabel:"label",optionValue:"value",placeholder:"Export",class:"export-dropdown",onChange:Q},null,8,["modelValue"])])]),l("div",Te,[l("table",Le,[e[15]||(e[15]=l("thead",{class:"border-top small text-muted"},[l("tr",null,[l("th",null,"S. #"),l("th",null,"Supplier name"),l("th",null,"Contact"),l("th",null,"Email"),l("th",null,"Address"),l("th",null,"Items Linked"),l("th",{class:"text-center"},"Action")])],-1)),l("tbody",null,[d.value?(i(),n("tr",Me,[...e[14]||(e[14]=[l("td",{colspan:"7",class:"text-center py-5"},[l("div",{class:"spinner-border text-primary",role:"status"},[l("span",{class:"visually-hidden"},"Loading...")]),l("p",{class:"text-muted mt-2 mb-0"},"Loading suppliers...")],-1)])])):(i(),n(T,{key:1},[(i(!0),n(T,null,H(q.value,(a,s)=>(i(),n("tr",{key:a.id},[l("td",null,m(g.value.from+s),1),l("td",Ue,m(a.name),1),l("td",null,m(a.contact),1),l("td",Ne,m(a.email),1),l("td",Be,m(a.address),1),l("td",null,m(a.preferred_items),1),l("td",Oe,[l("div",Re,[l("button",{onClick:()=>{de(a),u.value={}},title:"Edit",class:"p-2 rounded-full text-blue-600 hover:bg-blue-100"},[w(F(De),{class:"w-4 h-4"})],8,qe),w(be,{title:"Confirm Delete",message:`Are you sure you want to delete ${a.name}?`,showDeleteButton:!0,onConfirm:()=>ce(a.id),onCancel:()=>{}},null,8,["message","onConfirm"])])])]))),128)),q.value.length===0?(i(),n("tr",je,[l("td",Ke,m(b.value.trim()?"No suppliers found matching your search.":"No suppliers found."),1)])):_("",!0)],64))])])]),!d.value&&g.value.last_page>1?(i(),n("div",ze,[l("div",Xe," Showing "+m(g.value.from)+" to "+m(g.value.to)+" of "+m(g.value.total)+" entries ",1),w(ye,{pagination:g.value.links,isApiDriven:!0,onPageChanged:Z},null,8,["pagination"])])):_("",!0)])]),l("div",Ge,[l("div",We,[l("div",He,[l("div",Ye,[l("h5",Je,m(V.value==="Add"?"Add Supplier":"Edit Supplier"),1),e[16]||(e[16]=l("button",{class:"absolute top-2 right-2 p-2 rounded-full hover:bg-gray-100 transition transform hover:scale-110","data-bs-dismiss":"modal","aria-label":"Close",title:"Close"},[l("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})])],-1))]),l("div",Qe,[l("div",Ze,[l("div",et,[e[17]||(e[17]=l("label",{class:"form-label"},"Name",-1)),S(l("input",{class:L(["form-control",{"is-invalid":u.value.name}]),"onUpdate:modelValue":e[3]||(e[3]=a=>o.value.name=a)},null,2),[[k,o.value.name]]),u.value.name?(i(),n("small",tt,m(u.value.name[0]),1)):_("",!0)]),l("div",lt,[e[18]||(e[18]=l("label",{class:"form-label"},"Email",-1)),S(l("input",{class:L(["form-control",{"is-invalid":u.value.email}]),"onUpdate:modelValue":e[4]||(e[4]=a=>o.value.email=a)},null,2),[[k,o.value.email]]),u.value.email?(i(),n("small",at,m(u.value.email[0]),1)):_("",!0)]),l("div",ot,[e[23]||(e[23]=l("label",{class:"form-label"},"Phone*",-1)),l("div",st,[e[19]||(e[19]=l("span",{class:"input-group-text p-0"},[l("input",{type:"text",class:"form-control text-center border-0 country-code bg-light fw-semibold",value:"+44",readonly:"",style:{width:"70px"}})],-1)),S(l("input",{class:L(["form-control phone-input",{"is-invalid":y.value,"is-valid":A.value&&o.value.phone_local}]),inputmode:"numeric",placeholder:"7311865859","onUpdate:modelValue":e[5]||(e[5]=a=>o.value.phone_local=a),onBlur:K,maxlength:"10"},null,34),[[k,o.value.phone_local]])]),y.value?(i(),n("small",rt,[e[20]||(e[20]=l("i",{class:"bi bi-exclamation-circle me-1"},null,-1)),C(m(y.value),1)])):u.value.contact?(i(),n("small",nt,m(u.value.contact[0]),1)):_("",!0),A.value&&o.value.phone_local?(i(),n("small",it,[...e[21]||(e[21]=[l("i",{class:"bi bi-check-circle me-1"},null,-1),C("âœ“ Valid UK phone number ",-1)])])):_("",!0),(i(!0),n(T,null,H(j.value,(a,s)=>(i(),n("small",{key:s,class:"text-info d-block mt-1"},[e[22]||(e[22]=l("i",{class:"bi bi-info-circle me-1"},null,-1)),C(m(a),1)]))),128))]),l("div",dt,[e[24]||(e[24]=l("label",{class:"form-label"},"Preferred Items",-1)),S(l("input",{class:"form-control","onUpdate:modelValue":e[6]||(e[6]=a=>o.value.preferred_items=a)},null,512),[[k,o.value.preferred_items]])]),l("div",ut,[e[25]||(e[25]=l("label",{class:"form-label"},"Address",-1)),S(l("textarea",{class:L(["form-control",{"is-invalid":u.value.address}]),rows:"4","onUpdate:modelValue":e[7]||(e[7]=a=>o.value.address=a)},null,2),[[k,o.value.address]]),u.value.address?(i(),n("small",ct,m(u.value.address[0]),1)):_("",!0)]),l("div",pt,[V.value==="Edit"?(i(),n("button",{key:0,class:"btn btn-primary btn-sm py-2 rounded-pill w-100 mt-4",disabled:d.value,onClick:e[8]||(e[8]=a=>ue())},[d.value?(i(),n("span",vt)):_("",!0),e[26]||(e[26]=C(" Save ",-1))],8,mt)):(i(),n("button",{key:1,class:"btn btn-primary rounded-pill btn-sm py-2 w-100 mt-4",disabled:d.value,onClick:e[9]||(e[9]=a=>ne())},[d.value?(i(),n("span",ht)):_("",!0),e[27]||(e[27]=C(" Save ",-1))],8,ft))])])])])])])],64))}},$t=ve(gt,[["__scopeId","data-v-fab84843"]]);export{$t as default};
