import{_ as V,r as i,k as D,p as E,C as u,H as R,c as H,o as d,w as A,a as F,b as e,d as m,h as U,t as n,x as T,g as c,y as $,f as G,F as C,v as I,I as Q,i as z}from"./app-CKq2yLFP.js";import{_ as Y}from"./Master-CiX_JCFa.js";import{u as q}from"./useFormatters-CBalBVwV.js";import{F as K}from"./FilterModal-Bg3sSFkT.js";import"./index-B9vr8CaN.js";import"./createLucideIcon-D4RXw3zI.js";import"./sun-qiut8AwL.js";const W={class:"page-wrapper"},J={class:"row g-3"},X={class:"col-6 col-md-4"},Z={class:"card border-0 shadow-sm rounded-4"},ee={class:"card-body d-flex align-items-center justify-content-between"},te={class:"mb-0 fw-bold"},ae={class:"col-6 col-md-4"},se={class:"card border-0 shadow-sm rounded-4"},oe={class:"card-body d-flex align-items-center justify-content-between"},le={class:"mb-0 fw-bold"},ne={class:"col-12 col-md-4"},re={class:"card border-0 shadow-sm rounded-4"},de={class:"card-body d-flex align-items-center justify-content-between"},ie={class:"mb-0 fw-bold"},ue={class:"card border-0 shadow-lg rounded-4 mt-3"},ce={class:"card-body"},me={class:"d-flex flex-wrap gap-2 justify-content-between align-items-center mb-3"},pe={class:"d-flex flex-wrap gap-2 align-items-center"},ye={class:"search-wrap"},ve={key:1,class:"form-control search-input",placeholder:"Search",disabled:"",type:"text"},be={class:"col-md-6"},fe=["onUpdate:modelValue"],we=["value"],he={class:"dropdown"},ge={class:"dropdown-menu dropdown-menu-end shadow rounded-4 py-2"},_e={class:"table-responsive"},xe={class:"table table-hover align-middle",style:{"min-height":"320px"}},De={class:"text-success"},Ae={class:"text-capitalize"},Fe={key:0},Te={__name:"Index",setup(Ce){const{formatCurrencySymbol:y,dateFmt:k}=q(),b=i([]),N=async()=>{try{const s=await axios.get("/api/orders/all");b.value=s.data.data,console.log("orders.value",b.value)}catch(s){console.error("Error fetching orders:",s)}};D(async()=>{p.value="",h.value=Date.now(),await E(),setTimeout(()=>{g.value=!0;const s=document.getElementById(f);s&&(s.value="",p.value="")},100),N()});const p=i(""),h=i(Date.now()),f=`search-${Math.random().toString(36).substr(2,9)}`,g=i(!1),l=i({sortBy:"",paymentType:"",dateFrom:"",dateTo:"",priceMin:null,priceMax:null});i("All"),i(["All","Cash","Card","QR","Bank"]);const v=u(()=>b.value.map(s=>({orderId:s.id,customer:s.customer_name,user:s.user?.name||"—",type:s.payment?.payment_type||"—",amountReceived:Number(s.sub_total||0),promoDiscount:Number(s.sub_total||0)-Number(s.total_amount||0),grandTotal:Number(s.total_amount||0),promoName:s.promo?.promo_name||"—",paidAt:s.payment?.payment_date||null,status:s.status}))),w=u(()=>{const s=p.value.trim().toLowerCase();let t=[...v.value];return s&&(t=t.filter(a=>[String(a.orderId),a.customer||"",a.user||"",a.type||"",String(a.amount),j(a.paidAt)].join(" ").toLowerCase().includes(s))),l.value.paymentType&&(t=t.filter(a=>(a.type??"").toLowerCase()===l.value.paymentType.toLowerCase())),(l.value.priceMin!==null||l.value.priceMax!==null)&&(t=t.filter(a=>{const o=Number(a.amount)||0,r=Number(l.value.priceMin)||0,L=l.value.priceMax?Number(l.value.priceMax):1/0;return o>=r&&o<=L})),l.value.dateFrom&&(t=t.filter(a=>{const o=new Date(a.paidAt),r=new Date(l.value.dateFrom);return o>=r})),l.value.dateTo&&(t=t.filter(a=>{const o=new Date(a.paidAt),r=new Date(l.value.dateTo);return r.setHours(23,59,59,999),o<=r})),t});u(()=>{const s=[...w.value];switch(l.value.sortBy){case"date_desc":return s.sort((a,o)=>new Date(o.paidAt)-new Date(a.paidAt));case"date_asc":return s.sort((a,o)=>new Date(a.paidAt)-new Date(o.paidAt));case"amount_desc":return s.sort((a,o)=>(o.amount||0)-(a.amount||0));case"amount_asc":return s.sort((a,o)=>(a.amount||0)-(o.amount||0));case"order_asc":return s.sort((a,o)=>(a.orderId||0)-(o.orderId||0));case"order_desc":return s.sort((a,o)=>(o.orderId||0)-(a.orderId||0));default:return s.sort((a,o)=>new Date(o.paidAt)-new Date(a.paidAt))}});const _=u(()=>({sortOptions:[{value:"date_desc",label:"Date: Newest First"},{value:"date_asc",label:"Date: Oldest First"},{value:"amount_desc",label:"Amount: High to Low"},{value:"amount_asc",label:"Amount: Low to High"},{value:"order_asc",label:"Order ID: Low to High"},{value:"order_desc",label:"Order ID: High to Low"}],paymentTypeOptions:[{value:"Cash",label:"Cash"},{value:"Card",label:"Card"},{value:"Split",label:"Split"},{value:"QR",label:"QR"},{value:"Bank",label:"Bank"}]})),P=s=>{console.log("Filters applied:",s)},M=()=>{console.log("Filters cleared")},B=u(()=>v.value.length),S=u(()=>{const s=new Date,t=new Date(s.getFullYear(),s.getMonth(),s.getDate()),a=new Date(s.getFullYear(),s.getMonth(),s.getDate()+1);return v.value.filter(o=>{if(!o.paidAt)return!1;const r=new Date(o.paidAt);return r>=t&&r<a}).length}),O=u(()=>v.value.reduce((s,t)=>s+Number(t.amount||0),0));function j(s){return s?new Date(s).toLocaleString("en-GB",{day:"2-digit",month:"short",year:"numeric",hour:"numeric",minute:"2-digit",hour12:!0}):"—"}const x=s=>console.log("Download:",s);return D(()=>window.feather?.replace()),R(()=>window.feather?.replace()),(s,t)=>(d(),H(Y,null,{default:A(()=>[F(m(U),{title:"Payment"}),e("div",W,[t[19]||(t[19]=e("h4",{class:"fw-semibold mb-3"},"Overall Payments",-1)),e("div",J,[e("div",X,[e("div",Z,[e("div",ee,[e("div",null,[e("h3",te,n(B.value),1),t[5]||(t[5]=e("p",{class:"text-muted mb-0 small"},"Total Payments",-1))]),t[6]||(t[6]=e("div",{class:"rounded-circle p-3 bg-primary-subtle text-primary d-flex align-items-center justify-content-center",style:{width:"56px",height:"56px"}},[e("i",{class:"bi bi-list-check fs-4"})],-1))])])]),e("div",ae,[e("div",se,[e("div",oe,[e("div",null,[e("h3",le,n(S.value),1),t[7]||(t[7]=e("p",{class:"text-muted mb-0 small"},"Today's Payments",-1))]),t[8]||(t[8]=e("div",{class:"rounded-circle p-3 bg-success-subtle text-success d-flex align-items-center justify-content-center",style:{width:"56px",height:"56px"}},[e("i",{class:"bi bi-calendar-day fs-4"})],-1))])])]),e("div",ne,[e("div",re,[e("div",de,[e("div",null,[e("h3",ie,n(m(y)(O.value,"GBP")),1),t[9]||(t[9]=e("p",{class:"text-muted mb-0 small"},"Total Amount",-1))]),t[10]||(t[10]=e("div",{class:"rounded-circle p-3 bg-warning-subtle text-warning d-flex align-items-center justify-content-center",style:{width:"56px",height:"56px"}},[e("i",{class:"bi bi-currency-pound fs-4"})],-1))])])])]),e("div",ue,[e("div",ce,[e("div",me,[t[16]||(t[16]=e("h5",{class:"mb-0 fw-semibold"},"Payments",-1)),e("div",pe,[e("div",ye,[t[11]||(t[11]=e("i",{class:"bi bi-search"},null,-1)),t[12]||(t[12]=e("input",{type:"email",name:"email",autocomplete:"email",style:{position:"absolute",left:"-9999px",width:"1px",height:"1px"},tabindex:"-1","aria-hidden":"true"},null,-1)),g.value?T((d(),c("input",{id:f,"onUpdate:modelValue":t[0]||(t[0]=a=>p.value=a),key:h.value,class:"form-control search-input",placeholder:"Search",type:"search",autocomplete:"new-password",name:f,role:"presentation",onFocus:t[1]||(t[1]=(...a)=>s.handleFocus&&s.handleFocus(...a))},null,32)),[[$,p.value]]):(d(),c("input",ve))]),F(K,{modelValue:l.value,"onUpdate:modelValue":t[2]||(t[2]=a=>l.value=a),title:"Payments","modal-id":"paymentFilterModal","modal-size":"modal-lg","sort-options":_.value.sortOptions,"show-price-range":!0,"show-date-range":!0,"price-label":"Amount Range",onApply:P,onClear:M},{customFilters:A(({filters:a})=>[e("div",be,[t[14]||(t[14]=e("label",{class:"form-label fw-semibold text-dark"},[e("i",{class:"fas fa-credit-card me-2 text-muted"}),G("Payment Type ")],-1)),T(e("select",{"onUpdate:modelValue":o=>a.paymentType=o,class:"form-select"},[t[13]||(t[13]=e("option",{value:""},"All",-1)),(d(!0),c(C,null,I(_.value.paymentTypeOptions,o=>(d(),c("option",{key:o.value,value:o.value},n(o.label),9,we))),128))],8,fe),[[Q,a.paymentType]])])]),_:1},8,["modelValue","sort-options"]),e("div",he,[t[15]||(t[15]=e("button",{class:"btn btn-outline-secondary rounded-pill px-4 dropdown-toggle","data-bs-toggle":"dropdown"}," Export ",-1)),e("ul",ge,[e("li",null,[e("a",{class:"dropdown-item py-2",href:"javascript:void(0)",onClick:t[3]||(t[3]=a=>x("pdf"))},"Export as PDF")]),e("li",null,[e("a",{class:"dropdown-item py-2",href:"javascript:void(0)",onClick:t[4]||(t[4]=a=>x("excel"))},"Export as Excel")])])])])]),e("div",_e,[e("table",xe,[t[18]||(t[18]=e("thead",{class:"border-top small text-muted"},[e("tr",null,[e("th",null,"S. #"),e("th",null,"Order ID"),e("th",null,"Actual Payment"),e("th",null,"Promo Discount"),e("th",null,"Grand Total"),e("th",null,"Promo Name"),e("th",null,"Payment Date"),e("th",null,"Payment Type")])],-1)),e("tbody",null,[(d(!0),c(C,null,I(w.value,(a,o)=>(d(),c("tr",{key:a.orderId},[e("td",null,n(o+1),1),e("td",null,n(a.orderId),1),e("td",null,n(m(y)(a.amountReceived)),1),e("td",De,n(m(y)(a.promoDiscount)),1),e("td",null,n(m(y)(a.grandTotal)),1),e("td",null,n(a.promoName),1),e("td",null,n(m(k)(a.paidAt)),1),e("td",Ae,n(a.type),1)]))),128)),w.value.length===0?(d(),c("tr",Fe,[...t[17]||(t[17]=[e("td",{colspan:"8",class:"text-center text-muted py-4"}," No payments found. ",-1)])])):z("",!0)])])])])])])]),_:1}))}},Oe=V(Te,[["__scopeId","data-v-cbb792c4"]]);export{Oe as default};
