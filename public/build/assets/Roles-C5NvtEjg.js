import{_ as G,r as i,C as T,k as H,p as W,j as J,g as a,o as n,b as t,i as h,f as V,F as k,v as A,t as c,a as Q,d as Y,x as w,y as $,n as Z,ak as E,A as m,m as _}from"./app-C8Xsdeiq.js";import{P as ee}from"./pencil-3goqc9oR.js";import"./createLucideIcon-Is2tcEJ3.js";const se={class:"card shadow-sm border-0 rounded-4"},te={class:"list-group list-group-flush"},oe={class:"d-flex flex-column"},le={class:"fw-semibold"},ae={class:"text-muted"},ne=["onClick"],ie={key:0,class:"list-group-item text-center text-muted"},re={key:0,class:"modal show d-block fade"},de={class:"modal-dialog modal-dialog-end modal-xl"},ue={class:"modal-content rounded-4"},ce={class:"modal-header"},me={class:"modal-title"},ve={class:"modal-body"},pe={class:"mb-3"},fe={key:0,class:"invalid-feedback d-block"},be={class:"mb-2 d-flex justify-content-between align-items-center"},he={class:"input-group",style:{"max-width":"260px"}},ge={key:1,class:"form-control search-input",placeholder:"Search",disabled:"",type:"text"},ye={class:"form-check mb-3"},ke={style:{color:"#1B2850"},class:"fw-bold border-bottom pb-1 mb-2"},we={class:"row"},_e={class:"form-check"},xe=["id","value"],Ce=["for"],Pe={key:0,class:"text-danger"},Re={class:"modal-footer"},Se=["disabled"],Ae={key:0,class:"spinner-border spinner-border-sm me-1"},x="/roles",Le="/permissions-list",Me={__name:"Roles",setup(Ie){const v=i(!1),p=i(null),C=i([]),P=i([]),f=i({name:""}),u=i([]),g=i(!1),d=i({}),y=i(!1),L=i(Date.now()),R=`search-${Math.random().toString(36).substr(2,9)}`,M=i(!1),N=["allergies","analytics","categories","menu-categories","menu","inventory-categories","inventory","kots","notifications","orders","pos","profile","promos","purchase","suppliers","tags","settings","users","roles","permissions","stock","reference"],U=T(()=>{const s={};return S.value.forEach(e=>{const o=e.name?.toLowerCase()||"",r=e.description?.toLowerCase()||"";let l="General";if(o.includes("menu-categories")||o.includes("menu.categories"))l="menu-categories";else if(o.includes("inventory-categories")||o.includes("inventory.categories"))l="inventory-categories";else if(o.includes("categories"))l="categories";else if(o.includes("menu"))l="menu";else if(o.includes("inventory"))l="inventory";else for(const b of N)if(o.includes(b)||r.includes(b)){l=b;break}s[l]||(s[l]=[]),s[l].push(e)}),s}),j=s=>{const e={"menu-categories":"Menu Categories","inventory-categories":"Inventory Categories",pos:"POS (Point of Sale)",kots:"KOT (Kitchen Order Tickets)",api:"API"};return e[s.toLowerCase()]?e[s.toLowerCase()]:s.replace(/-/g," ").replace(/\b\w/g,o=>o.toUpperCase())};function B(){m.defaults.headers.common["X-Requested-With"]="XMLHttpRequest";const s=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content");s&&(m.defaults.headers.common["X-CSRF-TOKEN"]=s)}async function I(){const{data:s}=await m.get(x);C.value=s||[]}async function F(){const{data:s}=await m.get(Le);P.value=s||[]}const O=i(""),S=T(()=>{const s=O.value.trim().toLowerCase();return s?P.value.filter(e=>(e.name||"").toLowerCase().includes(s)||(e.description||"").toLowerCase().includes(s)):P.value});function D(){p.value=null,f.value={name:""},u.value=[],d.value={},v.value=!0}async function K(s){p.value=s.id,f.value={name:s.name},d.value={};const{data:e}=await m.get(`${x}/${s.id}`);u.value=Array.from(e.permission_ids||[]),v.value=!0}async function X(){try{y.value=!0,d.value={};const s={name:f.value.name,permissions:u.value};p.value?(await m.put(`${x}/${p.value}`,s),_.success("Role updated successfully")):(await m.post(x,s),_.success("Role created successfully")),await I(),v.value=!1}catch(s){if(s?.response?.status===422){const e=s.response.data?.errors||{};d.value=e;const o=Object.values(e)?.[0]?.[0]??"Please fix the highlighted fields and try again.";_.error(o)}else console.error(s),_.error("Something went wrong. Please try again.")}finally{y.value=!1}}H(async()=>{L.value=Date.now(),await W(),setTimeout(()=>{M.value=!0;const s=document.getElementById(R);s&&(s.value="",q.value="")},100),B(),await Promise.all([I(),F()])});function z(){g.value?u.value=[...S.value]:u.value=[]}return J(u,s=>{const e=S.value.map(r=>r.name),o=s.map(r=>r.name);g.value=o.length===e.length&&e.every(r=>o.includes(r))}),(s,e)=>(n(),a(k,null,[t("div",se,[t("div",{class:"card-header d-flex justify-content-between align-items-center"},[e[8]||(e[8]=t("div",null,[t("h5",{class:"mb-0"},"List of Roles"),t("small",{class:"text-muted"},"These are all the roles that this system uses.")],-1)),t("button",{class:"btn btn-primary btn-sm rounded-pill px-3 py-2",onClick:D},[...e[7]||(e[7]=[t("i",{class:"bi bi-plus-lg me-1"},null,-1),V("Add Role ",-1)])])]),t("ul",te,[(n(!0),a(k,null,A(C.value,o=>(n(),a("li",{key:o.id,class:"list-group-item d-flex justify-content-between align-items-center"},[t("div",oe,[t("div",le,c(o.name),1),t("small",ae,c(o.permissions?.length||0)+" permission(s) ",1)]),t("button",{class:"p-2 rounded-full text-blue-600 hover:bg-blue-100",onClick:r=>K(o)},[Q(Y(ee),{class:"w-4 h-4"})],8,ne)]))),128)),C.value.length===0?(n(),a("li",ie," No roles ")):h("",!0)])]),v.value?(n(),a("div",re,[t("div",de,[t("div",ue,[t("div",ce,[t("h6",me,c(p.value?"Edit Role":"Create Role"),1),t("button",{class:"absolute top-2 right-2 p-2 rounded-full hover:bg-gray-100 transition transform hover:scale-110",onClick:e[0]||(e[0]=o=>v.value=!1),"data-bs-dismiss":"modal","aria-label":"Close",title:"Close"},[...e[9]||(e[9]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),t("div",ve,[t("div",pe,[e[10]||(e[10]=t("label",{class:"form-label"},"Role Name",-1)),w(t("input",{"onUpdate:modelValue":e[1]||(e[1]=o=>f.value.name=o),class:Z(["form-control",{"is-invalid":d.value.name,"bg-danger bg-opacity-10":d.value.name}]),placeholder:"Admin"},null,2),[[$,f.value.name]]),d.value.name?(n(),a("div",fe,c(d.value.name[0]),1)):h("",!0)]),t("div",be,[e[12]||(e[12]=t("label",{class:"form-label mb-0"},"Permissions",-1)),t("div",he,[e[11]||(e[11]=t("input",{type:"email",name:"email",autocomplete:"email",style:{position:"absolute",left:"-9999px",width:"1px",height:"1px"},tabindex:"-1","aria-hidden":"true"},null,-1)),M.value?w((n(),a("input",{id:R,"onUpdate:modelValue":e[2]||(e[2]=o=>s.q=o),key:L.value,class:"form-control search-input",placeholder:"Search",type:"search",autocomplete:"new-password",name:R,role:"presentation",onFocus:e[3]||(e[3]=(...o)=>s.handleFocus&&s.handleFocus(...o))},null,32)),[[$,s.q]]):(n(),a("input",ge))])]),t("div",ye,[w(t("input",{class:"form-check-input",type:"checkbox",id:"select-all","onUpdate:modelValue":e[4]||(e[4]=o=>g.value=o),onChange:z},null,544),[[E,g.value]]),e[13]||(e[13]=t("label",{class:"form-check-label fw-bold",for:"select-all"}," Select All Permissions ",-1))]),(n(!0),a(k,null,A(U.value,(o,r)=>(n(),a("div",{key:r,class:"mb-3"},[t("h6",ke,c(j(r)),1),t("div",we,[(n(!0),a(k,null,A(o,l=>(n(),a("div",{key:l.id,class:"col-md-3 col-sm-6 mb-2"},[t("div",_e,[w(t("input",{class:"form-check-input",type:"checkbox",id:"perm-"+l.id,"onUpdate:modelValue":e[5]||(e[5]=b=>u.value=b),value:l},null,8,xe),[[E,u.value]]),t("label",{class:"form-check-label",for:"perm-"+l.id},c(l.description||l.name),9,Ce)])]))),128))])]))),128)),d.value.permissions?(n(),a("small",Pe,c(d.value.permissions[0]),1)):h("",!0)]),t("div",Re,[t("button",{class:"btn btn-primary rounded-pill px-2 py-2",disabled:y.value,onClick:X},[y.value?(n(),a("span",Ae)):h("",!0),e[14]||(e[14]=V(" Save ",-1))],8,Se),t("button",{class:"btn btn-secondary rounded-pill px-2 py-2",onClick:e[6]||(e[6]=o=>v.value=!1)}," Cancel ")])])])])):h("",!0)],64))}},qe=G(Me,[["__scopeId","data-v-07bbeb00"]]);export{qe as default};
