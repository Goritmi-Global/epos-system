import{_ as ae,q as ne,D as U,r as m,k as re,p as O,E as de,g as c,o as d,b as t,a as I,x,y as S,f as M,d as R,F as z,v as ie,t as v,V as ue,i as w,n as V,c as ce,A as C,m as n}from"./app-COVoaSpv.js";import{E as pe,a as me,X as ve,u as k,w as fe}from"./xlsx-DJLHTQQj.js";import{I as he}from"./importFile-CDTRveMr.js";import{P as ge}from"./plus-Cb5BFGxI.js";import{P as be}from"./pencil-DHZ4m_sc.js";import{i as ye,p as we}from"./isValidPhoneNumber-Clsaak6x.js";const _e={class:"card border-0 shadow-lg rounded-4"},xe={class:"card-body"},Se={class:"d-flex flex-wrap gap-2 justify-content-between align-items-center mb-3"},Ce={class:"d-flex flex-wrap gap-2 align-items-center"},ke={class:"search-wrap"},Pe={key:1,class:"form-control search-input",placeholder:"Search",disabled:"",type:"text"},De={class:"dropdown"},Ee={class:"dropdown-menu dropdown-menu-end shadow rounded-4 py-2"},Ie={class:"table-responsive"},Ve={class:"table table-hover align-middle"},$e={key:0},Ae={key:1},Fe={class:"fw-semibold"},Ne={class:"text-break",style:{"max-width":"240px"}},Te={class:"text-truncate",style:{"max-width":"260px"}},Me={class:"text-center"},Le={class:"d-inline-flex align-items-center gap-3"},je=["onClick"],Be={class:"modal fade",id:"modalAddSupplier",tabindex:"-1","aria-labelledby":"modalAddSupplier","aria-hidden":"true"},Ue={class:"modal-dialog modal-lg modal-dialog-centered",role:"document"},Oe={class:"modal-content rounded-4"},Re={class:"modal-header"},ze={class:"modal-title fw-semibold"},qe={class:"modal-body"},Ke={class:"row g-3"},Xe={class:"col-lg-6"},Ge={key:0,class:"text-danger"},He={class:"col-lg-6"},We={key:0,class:"text-danger"},Ye={class:"col-lg-6"},Je={key:0,class:"text-danger"},Qe={key:1,class:"text-danger"},Ze={key:2,class:"text-success"},et={class:"col-lg-6"},tt={class:"col-lg-12"},st={key:0,class:"text-danger"},lt={class:"col-md-2"},ot=["disabled"],at={key:0,class:"spinner-border spinner-border-sm me-2"},nt=["disabled"],rt={key:0,class:"spinner-border spinner-border-sm me-2"},dt={__name:"SuppliersTab",setup(it){const q=ne(),$=U(()=>q.props.onboarding.language_and_location?.country_id??"PK");console.log("ðŸŒ Onboarding Country:",$.value);const h=m([]),K=m(1),X=m(15),P=()=>(p.value=!0,C.get("/suppliers",{params:{q:g.value,page:K.value,per_page:X.value}}).then(({data:s})=>{h.value=s?.data??s?.suppliers?.data??s??[]}).catch(s=>{console.error(s)}).finally(()=>{p.value=!1})),g=m(""),L=m(Date.now()),A=`search-${Math.random().toString(36).substr(2,9)}`,j=m(!1);re(async()=>{g.value="",L.value=Date.now(),await O(),setTimeout(()=>{j.value=!0;const s=document.getElementById(A);s&&(s.value="",g.value="")},100),await P()});const G=s=>{s.target.value="",g.value=""},F=U(()=>{const s=g.value.trim().toLowerCase();if(!s)return h.value;const e=s.replace(/\D/g,"");return h.value.filter(o=>{const l=[o.name,o.email,o.address,o.preferred_items].some(u=>(u||"").toLowerCase().includes(s)),f=(o.phone||"").replace(/\D/g,""),y=(o.contact||"").replace(/\D/g,""),i=e&&(f.includes(e)||y.includes(e));return l||i})}),N=s=>{if(!h.value||h.value.length===0){n.error("No suppliers data to download");return}const e=g.value.trim()?F.value:h.value;if(e.length===0){n.error("No suppliers found to download");return}try{s==="pdf"?W(e):s==="excel"?Y(e):s==="csv"?H(e):n.error("Invalid download type")}catch(o){console.error("Download failed:",o),n.error(`Download failed: ${o.message}`)}},H=s=>{try{const e=["Name","Email","Phone","Address","Preferred Items"],o=s.map(u=>[`"${u.name||""}"`,`"${u.email||""}"`,`"${u.contact||""}"`,`"${u.address||""}"`,`"${u.preferred_items||""}"`]),l=[e.join(","),...o.map(u=>u.join(","))].join(`
`),f=new Blob([l],{type:"text/csv;charset=utf-8;"}),y=URL.createObjectURL(f),i=document.createElement("a");i.setAttribute("href",y),i.setAttribute("download",`suppliers_${new Date().toISOString().split("T")[0]}.csv`),document.body.appendChild(i),i.click(),document.body.removeChild(i),n.success("CSV downloaded successfully .",{autoClose:2500})}catch(e){console.error("CSV generation error:",e),n.error(`CSV generation failed: ${e.message}`,{autoClose:5e3})}},W=s=>{try{const e=new pe("p","mm","a4");e.setFont("helvetica","bold"),e.setFontSize(18),e.text("Suppliers Report",70,20),e.setFont("helvetica","normal"),e.setFontSize(10);const o=new Date().toLocaleString();e.text(`Generated on: ${o}`,14,30),e.text(`Total Suppliers: ${s.length}`,14,36);const l=["Name","Email","Phone","Address","Preferred Items"],f=s.map(i=>[i.name||"",i.email||"",i.contact||"",i.address||"",i.preferred_items||""]);me(e,{head:[l],body:f,startY:45,styles:{fontSize:9,cellPadding:3,halign:"left",valign:"middle",lineColor:[200,200,200],lineWidth:.1},headStyles:{fillColor:[41,128,185],textColor:255,fontStyle:"bold"},alternateRowStyles:{fillColor:[245,245,245]},margin:{left:14,right:14},didDrawPage:i=>{const u=e.internal.getNumberOfPages(),oe=e.internal.pageSize.height;e.setFontSize(8),e.text(`Page ${i.pageNumber} of ${u}`,14,oe-10)}});const y=`suppliers_${new Date().toISOString().split("T")[0]}.pdf`;e.save(y),n.success("PDF downloaded successfully.",{autoClose:2500})}catch(e){console.error("PDF generation error:",e),n.error(`PDF generation failed: ${e.message}`,{autoClose:5e3})}},Y=s=>{try{if(typeof ve>"u")throw new Error("XLSX library is not loaded");const e=s.map(u=>({Name:u.name||"",Email:u.email||"",Phone:u.contact||"",Address:u.address||"","Preferred Items":u.preferred_items||""})),o=k.book_new(),l=k.json_to_sheet(e);l["!cols"]=[{wch:20},{wch:25},{wch:18},{wch:30},{wch:25}],k.book_append_sheet(o,l,"Suppliers");const f=[{Info:"Generated On",Value:new Date().toLocaleString()},{Info:"Total Records",Value:s.length},{Info:"Exported By",Value:"Supplier Management System"}],y=k.json_to_sheet(f);k.book_append_sheet(o,y,"Report Info");const i=`suppliers_${new Date().toISOString().split("T")[0]}.xlsx`;fe(o,i),n.success("Excel file downloaded successfully.",{autoClose:2500})}catch(e){console.error("Excel generation error:",e),n.error(`Excel generation failed: ${e.message}`,{autoClose:5e3})}},a=m({name:"",email:"",phone:"",address:"",preferred_items:""}),b=m(""),_=m(!1),J=({number:s,country:e})=>{if(!s||s.trim()===""){b.value="",_.value=!1;return}b.value="",_.value=!1;try{if(!ye(s,e?.iso2||"PK")){b.value=`Invalid phone number for ${e?.name||"selected country"}`;return}const l=we(s,e?.iso2||"PK");console.log("ðŸ“ž Parsed Phone:",{formatted:l.formatInternational(),national:l.nationalNumber,country:l.country,type:l.getType()}),_.value=!0}catch(o){console.error("Phone validation error:",o),b.value="Invalid phone number format"}},p=m(!1),r=m({}),B=s=>{const e=document.getElementById(s);if(!e)return;(window.bootstrap?.Modal.getInstance(e)||new window.bootstrap.Modal(e)).hide()},T=()=>{a.value={name:"",email:"",phone:"",address:"",preferred_items:""},r.value={},E.value=null},Q=()=>{p.value=!0,r.value={};const s={name:a.value.name,email:a.value.email,contact:a.value.phone||null,address:a.value.address||null,preferred_items:a.value.preferred_items||null};C.post("/suppliers",s).then(e=>{P(),n.success("Supplier added successfully.",{autoClose:1500}),T(),B("modalAddSupplier")}).catch(e=>{e?.response?.status===422&&e.response.data?.errors?(r.value=e.response.data.errors,n.error("Please fill in all required fields correctly.")):(n.error("Something went wrong. Please try again.",{autoClose:3e3}),console.error(e))}).finally(()=>{p.value=!1})},Z=s=>{const e=document.getElementById(s);if(!e)return;new window.bootstrap.Modal(e).show()},D=m(),E=m(null),ee=s=>{D.value="Edit",E.value=s,a.value={name:s.name||"",email:s.email||"",phone:s.phone??s.contact??"",address:s.address||"",preferred_items:s.preferred_items??s.preferred_items??""},Z("modalAddSupplier")},te=()=>{if(!E.value)return;p.value=!0,r.value={};const s={id:E.value.id,name:a.value.name,email:a.value.email,contact:a.value.phone||null,address:a.value.address||null,preferred_items:a.value.preferred_items||null};C.post("/suppliers/update",s).then(e=>(P(),n.success("Supplier updated successfully .",{autoClose:500}),T(),B("modalAddSupplier"),O())).catch(e=>{e?.response?.status===422&&e.response.data?.errors?(r.value=e.response.data.errors,n.error("Validation failed. Please check the fields.",{autoClose:3e3})):(n.error("Update failed. Please try again.",{autoClose:3e3}),console.error(e))}).finally(()=>{p.value=!1})},se=s=>{p.value=!0,C.delete(`/suppliers/${s}`).then(()=>{h.value=h.value.filter(e=>e.id!==s),n.success("Supplier deleted successfully.")}).catch(e=>{n.error("Delete failed. Please try again.",{autoClose:3e3}),console.error(e)}).finally(()=>{p.value=!1})},le=s=>{if(console.log("Imported Data:",s),!s||s.length<=1){n.error("The file is empty",{autoClose:3e3});return}s[0];const o=s.slice(1).map(l=>({name:l[0]||"",email:l[1]||"",contact:l[2]||"",address:l[3]||"",preferred_items:l[4]||""}));C.post("/api/suppliers/import",{suppliers:o}).then(()=>{n.success("Suppliers imported successfully"),P()}).catch(l=>{l?.response?.status===422&&l.response.data?.errors&&(r.value=l.response.data.errors,n.error("There may be some duplication in data",{autoClose:3e3}))})};return(s,e)=>{const o=de("vue-tel-input");return d(),c(z,null,[t("div",_e,[t("div",xe,[t("div",Se,[e[16]||(e[16]=t("h4",{class:"mb-0"},"Suppliers",-1)),t("div",Ce,[t("div",ke,[e[12]||(e[12]=t("i",{class:"bi bi-search"},null,-1)),e[13]||(e[13]=t("input",{type:"email",name:"email",autocomplete:"email",style:{position:"absolute",left:"-9999px",width:"1px",height:"1px"},tabindex:"-1","aria-hidden":"true"},null,-1)),j.value?x((d(),c("input",{id:A,"onUpdate:modelValue":e[0]||(e[0]=l=>g.value=l),key:L.value,class:"form-control search-input",placeholder:"Search",type:"search",autocomplete:"new-password",name:A,role:"presentation",onFocus:G},null,32)),[[S,g.value]]):(d(),c("input",Pe))]),t("button",{"data-bs-toggle":"modal","data-bs-target":"#modalAddSupplier",onClick:e[1]||(e[1]=()=>{T(),r.value={},D.value="Add"}),class:"d-flex align-items-center gap-1 px-4 btn-sm py-2 rounded-pill btn-sm btn btn-primary text-white"},[I(R(ge),{class:"w-4 h-4"}),e[14]||(e[14]=M(" Add Supplier ",-1))]),I(he,{label:"Import",sampleHeaders:["Name","Email","Phone","Address","Preferred Items"],sampleData:[["Ali Khan","ali@example.com","03001234567","Lahore","Steel"],["Ahmed Raza","ahmed@example.com","03111234567","Karachi","Cement"]],onOnImport:le}),t("div",De,[e[15]||(e[15]=t("button",{class:"btn btn-outline-secondary btn-sm rounded-pill py-2 px-4 dropdown-toggle","data-bs-toggle":"dropdown"}," Export ",-1)),t("ul",Ee,[t("li",null,[t("a",{class:"dropdown-item py-2",href:"javascript:;",onClick:e[2]||(e[2]=l=>N("pdf"))}," Export as PDF ")]),t("li",null,[t("a",{class:"dropdown-item py-2",href:"javascript:;",onClick:e[3]||(e[3]=l=>N("excel"))}," Export as Excel ")]),t("li",null,[t("a",{class:"dropdown-item py-2",href:"javascript:;",onClick:e[4]||(e[4]=l=>N("csv"))}," Export as CSV ")])])])])]),t("div",Ie,[t("table",Ve,[e[19]||(e[19]=t("thead",{class:"border-top small text-muted"},[t("tr",null,[t("th",null,"S. #"),t("th",null,"Supplier name"),t("th",null,"Contact"),t("th",null,"Email"),t("th",null,"Address"),t("th",null,"Items Linked"),t("th",{class:"text-center"},"Action")])],-1)),t("tbody",null,[p.value?(d(),c("tr",$e,[...e[17]||(e[17]=[t("td",{colspan:"7",class:"text-center py-5 text-muted"},[t("div",{class:"d-flex justify-content-center align-items-center gap-2"},[t("div",{class:"spinner-border",role:"status",style:{width:"1.5rem",height:"1.5rem","border-color":"#1c0d82","border-right-color":"transparent"}},[t("span",{class:"visually-hidden"},"Loading...")]),t("span",null,"Fetching suppliers...")])],-1)])])):F.value.length===0?(d(),c("tr",Ae,[...e[18]||(e[18]=[t("td",{colspan:"7",class:"text-center text-muted py-4"}," No suppliers found. ",-1)])])):(d(!0),c(z,{key:2},ie(F.value,(l,f)=>(d(),c("tr",{key:l.id},[t("td",null,v(f+1),1),t("td",Fe,v(l.name),1),t("td",null,v(l.contact),1),t("td",Ne,v(l.email),1),t("td",Te,v(l.address),1),t("td",null,v(l.preferred_items),1),t("td",Me,[t("div",Le,[t("button",{onClick:()=>{ee(l),r.value={}},title:"Edit",class:"p-2 rounded-full text-blue-600 hover:bg-blue-100"},[I(R(be),{class:"w-4 h-4"})],8,je),I(ue,{title:"Confirm Delete",message:`Are you sure you want to delete ${l.name}?`,showDeleteButton:!0,onConfirm:()=>se(l.id),onCancel:()=>{}},null,8,["message","onConfirm"])])])]))),128))])])])])]),t("div",Be,[t("div",Ue,[t("div",Oe,[t("div",Re,[t("h5",ze,v(D.value==="Add"?"Add Supplier":"Edit Supplier"),1),e[20]||(e[20]=t("button",{class:"absolute top-2 right-2 p-2 rounded-full hover:bg-gray-100 transition transform hover:scale-110","data-bs-dismiss":"modal","aria-label":"Close",title:"Close"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})])],-1))]),t("div",qe,[t("div",Ke,[t("div",Xe,[e[21]||(e[21]=t("label",{class:"form-label"},"Name",-1)),x(t("input",{class:V(["form-control",{"is-invalid":r.value.name}]),"onUpdate:modelValue":e[5]||(e[5]=l=>a.value.name=l)},null,2),[[S,a.value.name]]),r.value.name?(d(),c("small",Ge,v(r.value.name[0]),1)):w("",!0)]),t("div",He,[e[22]||(e[22]=t("label",{class:"form-label"},"Email",-1)),x(t("input",{class:V(["form-control",{"is-invalid":r.value.email}]),"onUpdate:modelValue":e[6]||(e[6]=l=>a.value.email=l)},null,2),[[S,a.value.email]]),r.value.email?(d(),c("small",We,v(r.value.email[0]),1)):w("",!0)]),t("div",Ye,[e[23]||(e[23]=t("label",{class:"form-label"},"Phone",-1)),(d(),ce(o,{modelValue:a.value.phone,"onUpdate:modelValue":e[7]||(e[7]=l=>a.value.phone=l),"default-country":$.value,key:$.value,mode:"international",class:V(["phone",{"is-invalid":r.value.contact||b.value,"is-valid":_.value&&a.value.phone}]),onValidate:J,"auto-format":!0,"enable-formatting":!0,"disabled-fetching-country":!0,"dropdown-options":{showFlags:!1,showDialCodeInSelection:!0,disabled:!0},"input-options":{showDialCode:!0}},null,8,["modelValue","default-country","class"])),r.value.contact?(d(),c("small",Je,v(r.value.contact[0]),1)):b.value?(d(),c("small",Qe,v(b.value),1)):_.value&&a.value.phone?(d(),c("small",Ze," âœ“ Valid phone number ")):w("",!0)]),t("div",et,[e[24]||(e[24]=t("label",{class:"form-label"},"Preferred Items",-1)),x(t("input",{class:"form-control","onUpdate:modelValue":e[8]||(e[8]=l=>a.value.preferred_items=l)},null,512),[[S,a.value.preferred_items]])]),t("div",tt,[e[25]||(e[25]=t("label",{class:"form-label"},"Address",-1)),x(t("textarea",{class:V(["form-control",{"is-invalid":r.value.address}]),rows:"4","onUpdate:modelValue":e[9]||(e[9]=l=>a.value.address=l)},null,2),[[S,a.value.address]]),r.value.address?(d(),c("small",st,v(r.value.address[0]),1)):w("",!0)]),t("div",lt,[D.value==="Edit"?(d(),c("button",{key:0,class:"btn btn-primary btn-sm py-2 rounded-pill w-100 mt-4",disabled:p.value,onClick:e[10]||(e[10]=l=>te())},[p.value?(d(),c("span",at)):w("",!0),e[26]||(e[26]=M(" Save ",-1))],8,ot)):(d(),c("button",{key:1,class:"btn btn-primary rounded-pill btn-sm py-2 w-100 mt-4",disabled:p.value,onClick:e[11]||(e[11]=l=>Q())},[p.value?(d(),c("span",rt)):w("",!0),e[27]||(e[27]=M(" Save ",-1))],8,nt))])])])])])])],64)}}},ht=ae(dt,[["__scopeId","data-v-c492d2cc"]]);export{ht as default};
