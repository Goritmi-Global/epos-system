import{B as ce,_ as pe,r as u,D as C,k as X,p as me,I as ve,E as ye,c as Z,o,w as ge,b as t,g as l,i as h,f as D,a as P,x as V,y as I,F as ee,v as te,t as d,d as g,n as K,A as N,m as y}from"./app-COVoaSpv.js";import{_ as he}from"./Master-CU8Kbb5A.js";import{u as $,w as be,E as _e,a as fe}from"./xlsx-DJLHTQQj.js";import ke from"./PurchaseComponent-B1SbPWff.js";import xe from"./OrderComponent-CsL30mgK.js";import{u as we}from"./useFormatters-BC277QyT.js";import Se from"./BulkOrderComponent-807tDHZ3.js";import{E as Ce}from"./eye-Dwf2JI1u.js";import"./index-BQbxzkdq.js";import"./sun-DqfGktyu.js";import"./index-CcYqNmWE.js";import"./index-DHNrrZoT.js";/**
 * @license lucide-vue-next v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const De=ce("trash-2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),Pe={class:"page-wrapper"},Ve={class:"card border-0 shadow-lg rounded-4"},Ie={class:"card-body p-4"},Ne={class:"d-flex align-items-center justify-content-between mb-3"},$e={class:"d-flex align-items-center gap-2"},Ae={class:"position-relative"},Oe={key:0,class:"help-popover shadow rounded-4 p-3"},Fe={class:"d-flex gap-2 align-items-center"},Ee={class:"search-wrap me-1"},Ue={key:1,class:"form-control search-input",placeholder:"Search",disabled:"",type:"text"},Me={class:"dropdown"},Te={class:"dropdown-menu dropdown-menu-end shadow rounded-4 py-2"},je={class:"table-responsive"},Be={class:"table table-striped"},Le={key:0},Re={class:"text-nowrap"},qe={class:"small text-muted"},ze={class:"text-start"},He={class:"text-end"},Ge=["onClick"],Ke={key:2},Qe={class:"modal fade",id:"orderDetailsModal",tabindex:"-1","aria-hidden":"true"},We={class:"modal-dialog modal-xl modal-dialog-centered"},Ye={class:"modal-content rounded-4 shadow-lg border-0"},Je={class:"modal-header align-items-center"},Xe={class:"d-flex align-items-center gap-2"},Ze={class:"d-flex flex-column"},et={class:"modal-title mb-0"},tt={class:"text-muted"},st={key:0,class:"modal-body p-4 bg-light"},at={class:"row g-3"},ot={class:"col-md-6"},lt={class:"fw-semibold"},rt={class:"col-md-6"},nt={class:"col-md-6"},dt={class:"fw-semibold"},it={class:"fw-semibold mb-3"},ut={class:"table-responsive"},ct={class:"table table-bordered align-middle"},pt={class:"table-light"},mt={key:0},vt={key:0},yt=["onUpdate:modelValue"],gt={key:0},ht=["onUpdate:modelValue","onInput"],bt={key:0},_t=["onUpdate:modelValue","onInput"],ft={key:0},kt=["onUpdate:modelValue"],xt={key:0},wt={key:2,class:"text-danger"},St={key:0},Ct=["onClick"],Dt={key:0},Pt=["colspan"],Vt={class:"footer"},It={class:"fw-bold"},Nt={key:0,class:"alert alert-info mt-3"},$t={key:1,class:"modal-footer"},At=["disabled"],Ot={key:0},Ft={key:1},Et={__name:"Index",setup(Ut){const{formatCurrencySymbol:x,dateFmt:A}=we(),O=u(""),Q=u(Date.now()),j=`search-${Math.random().toString(36).substr(2,9)}`,W=u(!1),F=s=>new Date(s).toLocaleString("en-GB",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0}),B=s=>Math.round((Number(s)||0)*100)/100,L=u(!1),E=u([]),se=async()=>{const s=await N.get("/api/suppliers/pluck");E.value=s.data},R=u([]),q=u(""),ae=async()=>{try{const s=await N.get("/inventory/api-inventories");R.value=s.data.data}catch(s){console.error("Error fetching inventory:",s)}},U=C(()=>{const s=q.value.trim().toLowerCase();return s?R.value.filter(e=>[e.name,e.category??"",e.subcategory??"",String(e.stock??"")].join(" ").toLowerCase().includes(s)):R.value});console.log("p_filteredInv",U);const Y=C(()=>{const s=q.value.trim().toLowerCase();return s?w.value.filter(e=>[e.supplier??"",e.status??"",String(e.total??""),F(e.purchasedAt)??""].join(" ").toLowerCase().includes(s)):w.value});X(async()=>{O.value="",Q.value=Date.now(),await me(),setTimeout(()=>{W.value=!0;const s=document.getElementById(j);s&&(s.value="",O.value="")},100),ae(),se()});const M=u(!1),b=u({data:[],current_page:1,last_page:1,per_page:20,total:0,links:[]}),w=C(()=>b.value.data||[]),z=C(()=>({current_page:b.value.current_page,last_page:b.value.last_page,per_page:b.value.per_page,total:b.value.total}));C(()=>b.value.links||[]);const H=u(20);function oe(s){const e=s?.data??s;if(e&&e.data&&Array.isArray(e.data)&&typeof e.current_page<"u")return{data:e.data,current_page:Number(e.current_page)||1,last_page:Number(e.last_page)||1,per_page:Number(e.per_page)||20,total:Number(e.total)||(e.data?.length??0),links:Array.isArray(e.links)?e.links:[]};if(s&&s.data&&Array.isArray(s.data)&&typeof s.current_page<"u")return{data:s.data,current_page:Number(s.current_page)||1,last_page:Number(s.last_page)||1,per_page:Number(s.per_page)||20,total:Number(s.total)||(s.data?.length??0),links:Array.isArray(s.links)?s.links:[]};if(s&&Array.isArray(s.data)&&s.meta){const r=s.meta;return{data:s.data,current_page:Number(r.current_page)||1,last_page:Number(r.last_page)||1,per_page:Number(r.per_page)||20,total:Number(r.total)||(s.data?.length??0),links:Array.isArray(r.links)?r.links:[]}}return{data:Array.isArray(e)?e:[],current_page:1,last_page:1,per_page:H.value,total:Array.isArray(e)?e.length:0,links:[]}}const k=async(s=1)=>{M.value=!0;try{const e=await N.get("/api/purchase-orders/fetch-orders",{params:{page:s,per_page:H.value}}),r=e?.data?.data??e?.data??e,a=oe(r);b.value=a}catch(e){console.error(e),y.error("Failed to fetch orders"),b.value={data:[],current_page:1,last_page:1,per_page:H.value,total:0,links:[]}}finally{M.value=!1}},c=u(null),_=u([]),i=u(!1),f=u({}),le=()=>{f.value={}},T=u(!1);u(!1);async function re(s){try{const e=await N.get(`/purchase-orders/${s.id}`);c.value=e.data,console.log("selectedOrder.value",c.value),s.status==="pending"?(i.value=!0,_.value=c.value.items.map(a=>({id:a.id,product_id:a.product_id,name:a.product?.name||"Unknown",quantity:a.quantity,unit_price:a.unit_price,expiry:a.expiry||"",sub_total:a.sub_total}))):i.value=!1,new bootstrap.Modal(document.getElementById("orderDetailsModal")).show()}catch(e){console.error(e),y.error("Failed to load order details")}}async function ne(){if(c.value){T.value=!0;try{const s={status:"completed",items:_.value.map(r=>({purchase_id:c.value.id,product_id:r.product_id,qty:r.quantity,unit_price:r.unit_price,expiry:r.expiry||null}))};await N.put(`/purchase-orders/${c.value.id}`,s),bootstrap.Modal.getInstance(document.getElementById("orderDetailsModal"))?.hide(),f.value={},await k(),await k(z.value.current_page),y.success("Order updated successfully and stock entries created!")}catch(s){if(s.response?.status===422&&s.response?.data?.errors){f.value=s.response.data.errors;const e=Object.values(f.value).flat().join(`
`);y.error(e)}else console.error("Error updating order:",s),y.error("Failed to update order")}finally{T.value=!1}}}function J(s){const e=parseFloat(s.quantity)||0,r=parseFloat(s.unit_price)||0;s.sub_total=(e*r).toFixed(2)}const G=s=>{switch(s){case"pdf":ie(w.value);break;case"excel":ue(w.value);break;case"csv":de(w.value);break;default:y.error("Invalid export type")}},de=s=>{try{const e=["S.No","Supplier Name","Purchase Date","Status","Total Value"],r=s.map((v,S)=>[S+1,`"${v.supplier||""}"`,`"${F(v.purchasedAt)||""}"`,`"${v.status||""}"`,`"${B(v.total)||0}"`]),a=[e.join(","),...r.map(v=>v.join(","))].join(`
`),p=new Blob([a],{type:"text/csv;charset=utf-8;"}),n=URL.createObjectURL(p),m=document.createElement("a");m.href=n,m.download=`purchase_orders_${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(m),m.click(),document.body.removeChild(m),y.success("CSV downloaded successfully",{autoClose:2500})}catch(e){console.error("CSV generation error:",e),y.error(`CSV generation failed: ${e.message}`)}},ie=s=>{try{const e=new _e("p","mm","a4");e.setFontSize(18),e.setFont("helvetica","bold"),e.text("Purchase Orders Report",60,20),e.setFontSize(10),e.setFont("helvetica","normal");const r=new Date().toLocaleString();e.text(`Generated on: ${r}`,14,28),e.text(`Total Records: ${s.length}`,14,33);const a=["S.No","Supplier Name","Purchase Date","Status","Total Value"],p=s.map((m,v)=>[v+1,m.supplier||"",F(m.purchasedAt)||"",m.status||"",B(m.total)||0]);fe(e,{head:[a],body:p,startY:40,styles:{fontSize:9,cellPadding:2,lineWidth:.1,halign:"left"},headStyles:{fillColor:[41,128,185],textColor:255,fontStyle:"bold"},alternateRowStyles:{fillColor:[240,240,240]},margin:{left:14,right:14},didDrawPage:m=>{const v=e.internal.getNumberOfPages(),S=e.internal.pageSize.height;e.setFontSize(8),e.text(`Page ${m.pageNumber} of ${v}`,m.settings.margin.left,S-10)}});const n=`purchase_orders_${new Date().toISOString().split("T")[0]}.pdf`;e.save(n),y.success("PDF downloaded successfully",{autoClose:2500})}catch(e){console.error("PDF generation error:",e),y.error(`PDF generation failed: ${e.message}`)}},ue=s=>{try{const e=s.map((v,S)=>({"S.No":S+1,"Supplier Name":v.supplier||"","Purchase Date":F(v.purchasedAt)||"",Status:v.status||"","Total Value":B(v.total)||0})),r=$.book_new(),a=$.json_to_sheet(e);a["!cols"]=[{wch:8},{wch:25},{wch:25},{wch:15},{wch:15}],$.book_append_sheet(r,a,"Purchase Orders");const p=[{Info:"Generated On",Value:new Date().toLocaleString()},{Info:"Total Records",Value:s.length},{Info:"Exported By",Value:"Purchase Order System"}],n=$.json_to_sheet(p);$.book_append_sheet(r,n,"Report Info");const m=`purchase_orders_${new Date().toISOString().split("T")[0]}.xlsx`;be(r,m),y.success("Excel file downloaded successfully",{autoClose:2500})}catch(e){console.error("Excel generation error:",e),y.error(`Excel generation failed: ${e.message}`)}};return X(()=>{k(1)}),ve(()=>window.feather?.replace?.()),(s,e)=>{const r=ye("VueDatePicker");return o(),Z(he,null,{default:ge(()=>[t("div",Pe,[t("div",Ve,[t("div",Ie,[t("div",Ne,[t("div",$e,[e[9]||(e[9]=t("h3",{class:"fw-semibold mb-0"},"Purchase Order",-1)),t("div",Ae,[t("button",{class:"btn btn-link p-0 ms-2",onClick:e[0]||(e[0]=a=>L.value=!L.value),title:"Help"},[...e[7]||(e[7]=[t("i",{class:"bi bi-question-circle fs-5"},null,-1)])]),L.value?(o(),l("div",Oe,[...e[8]||(e[8]=[t("p",{class:"mb-2"}," This screen allows you to view, manage, and update all purchase orders. ",-1),t("p",{class:"mb-2"},[t("strong",null,"Add Purchase"),D(": create a purchase and stock-in immediately. ")],-1),t("p",{class:"mb-0"},[t("strong",null,"Add Order"),D(": create a purchase order for later delivery. ")],-1)])])):h("",!0)])]),t("div",Fe,[t("div",Ee,[e[10]||(e[10]=t("i",{class:"bi bi-search"},null,-1)),e[11]||(e[11]=t("input",{type:"email",name:"email",autocomplete:"email",style:{position:"absolute",left:"-9999px",width:"1px",height:"1px"},tabindex:"-1","aria-hidden":"true"},null,-1)),W.value?V((o(),l("input",{id:j,"onUpdate:modelValue":e[1]||(e[1]=a=>O.value=a),key:Q.value,class:"form-control search-input",placeholder:"Search",type:"search",autocomplete:"new-password",name:j,role:"presentation",onFocus:e[2]||(e[2]=(...a)=>s.handleFocus&&s.handleFocus(...a))},null,32)),[[I,O.value]]):(o(),l("input",Ue))]),e[13]||(e[13]=t("button",{class:"btn btn-primary btn-sm py-2 rounded-pill px-4","data-bs-toggle":"modal","data-bs-target":"#bulkOrderModal"}," Bulk Purchase ",-1)),P(Se,{suppliers:E.value,items:U.value,onRefreshData:k},null,8,["suppliers","items"]),P(ke,{suppliers:E.value,items:U.value,onRefreshData:k,"onUpdate:search":e[3]||(e[3]=a=>q.value=a)},null,8,["suppliers","items"]),e[14]||(e[14]=t("button",{class:"btn btn-primary btn-sm py-2 rounded-pill px-4 py-2","data-bs-toggle":"modal","data-bs-target":"#addOrderModal"}," Order ",-1)),P(xe,{suppliers:E.value,items:U.value,onRefreshData:k},null,8,["suppliers","items"]),t("div",Me,[e[12]||(e[12]=t("button",{class:"btn btn-outline-secondary btn-sm rounded-pill py-2 px-4 dropdown-toggle","data-bs-toggle":"dropdown"}," Export ",-1)),t("ul",Te,[t("li",null,[t("a",{class:"dropdown-item py-2",href:"javascript:;",onClick:e[4]||(e[4]=a=>G("pdf"))},"Export as PDF")]),t("li",null,[t("a",{class:"dropdown-item py-2",href:"javascript:;",onClick:e[5]||(e[5]=a=>G("excel"))},"Export as Excel")]),t("li",null,[t("a",{class:"dropdown-item py-2",href:"javascript:;",onClick:e[6]||(e[6]=a=>G("csv"))}," Export as CSV ")])])])])]),t("div",je,[t("table",Be,[e[17]||(e[17]=t("thead",{class:"small text-muted"},[t("tr",null,[t("th",{style:{width:"80px"}},"S. #"),t("th",null,"Supplier Name"),t("th",null,"Purchase date"),t("th",{class:"text-start"},"Status"),t("th",null,"Total value"),t("th",{class:"text-end"},"Action")])],-1)),t("tbody",null,[M.value?(o(),l("tr",Le,[...e[15]||(e[15]=[t("td",{colspan:"6",class:"text-center text-muted py-4"}," Loading… ",-1)])])):(o(!0),l(ee,{key:1},te(Y.value,(a,p)=>(o(),l("tr",{key:a.id},[t("td",null,d((z.value.current_page-1)*z.value.per_page+(p+1)),1),t("td",null,d(a.supplier),1),t("td",Re,[D(d(g(A)(a.purchasedAt).split(",")[0])+", ",1),t("div",qe,d(g(A)(a.purchasedAt).split(",")[1]?.trim()),1)]),t("td",ze,[t("span",{class:K(["badge rounded-pill",a.status==="pending"?"bg-warning text-dark":a.status==="completed"?"bg-success":"bg-secondary"])},d(a.status),3)]),t("td",null,d(g(x)(a.total)),1),t("td",He,[t("button",{class:"p-2 rounded-pill text-primary hover:bg-gray-100 btn",onClick:n=>re(a),title:"View Item"},[P(g(Ce),{class:"w-4 h-4"})],8,Ge)])]))),128)),!M.value&&Y.value?.length===0?(o(),l("tr",Ke,[...e[16]||(e[16]=[t("td",{colspan:"6",class:"text-center text-muted py-4"}," No purchase orders found. ",-1)])])):h("",!0)])])])])]),t("div",Qe,[t("div",We,[t("div",Ye,[t("div",Je,[t("div",Xe,[e[18]||(e[18]=t("span",{class:"badge bg-success rounded-circle p-2"},[t("i",{class:"bi bi-basket"})],-1)),t("div",Ze,[t("h5",et,d(i.value?"Edit Purchase Order":"Purchase Details"),1),t("small",tt," Supplier: "+d(c.value?.supplier?.name??"—"),1)])]),t("button",{onClick:le,class:"absolute top-2 right-2 p-2 rounded-full hover:bg-gray-100 transition transform hover:scale-110","data-bs-dismiss":"modal","aria-label":"Close",title:"Close"},[...e[19]||(e[19]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),c.value?(o(),l("div",st,[e[32]||(e[32]=t("h6",{class:"fw-semibold mb-3"},"Order Summary",-1)),t("div",at,[t("div",ot,[e[20]||(e[20]=t("small",{class:"text-muted d-block"},"Purchase Date",-1)),t("div",lt,d(g(A)(c.value.purchase_date).split(",")[0]),1)]),t("div",rt,[e[21]||(e[21]=t("small",{class:"text-muted d-block"},"Status",-1)),t("span",{class:K(["badge rounded-pill",c.value.status==="completed"?"bg-success":"bg-warning"])},d(c.value.status),3)]),t("div",nt,[e[22]||(e[22]=t("small",{class:"text-muted d-block"},"Total Amount",-1)),t("div",dt,d(g(x)(c.value.total_amount)),1)])]),e[33]||(e[33]=t("hr",{class:"my-4"},null,-1)),t("h6",it,d(i.value?"Edit Items":"Purchased Items"),1),t("div",ut,[t("table",ct,[t("thead",pt,[t("tr",null,[e[23]||(e[23]=t("th",null,"Product",-1)),e[24]||(e[24]=t("th",null,"Qty",-1)),e[25]||(e[25]=t("th",null,"Unit Price",-1)),e[26]||(e[26]=t("th",null,"Subtotal",-1)),e[27]||(e[27]=t("th",null,"Expiry",-1)),i.value?(o(),l("th",mt,"Action")):h("",!0)])]),t("tbody",null,[(o(!0),l(ee,null,te(i.value?_.value:c.value.items,(a,p)=>(o(),l("tr",{class:"black-row",key:a.id||p},[t("td",null,[i.value?V((o(),l("input",{key:1,"onUpdate:modelValue":n=>a.name=n,class:"form-control",readonly:""},null,8,yt)),[[I,a.name]]):(o(),l("span",vt,d(a.product?.name||a.name||"Unknown Product"),1))]),t("td",null,[i.value?V((o(),l("input",{key:1,"onUpdate:modelValue":n=>a.quantity=n,type:"number",class:"form-control",onInput:n=>J(a)},null,40,ht)),[[I,a.quantity,void 0,{number:!0}]]):(o(),l("span",gt,d(a.quantity),1))]),t("td",null,[i.value?V((o(),l("input",{key:1,"onUpdate:modelValue":n=>a.unit_price=n,type:"number",class:"form-control",onInput:n=>J(a)},null,40,_t)),[[I,a.unit_price,void 0,{number:!0}]]):(o(),l("span",bt,d(g(x)(a.unit_price)),1))]),t("td",null,[i.value?V((o(),l("input",{key:1,"onUpdate:modelValue":n=>a.sub_total=n,class:"form-control",readonly:""},null,8,kt)),[[I,a.sub_total]]):(o(),l("span",ft,d(g(x)(a.sub_total)),1))]),t("td",null,[i.value?(o(),Z(r,{key:1,modelValue:a.expiry,"onUpdate:modelValue":n=>a.expiry=n,enableTimePicker:!1,"min-date":new Date,teleport:!0,format:"yyyy-MM-dd",placeholder:"Select expiry date",class:K({"is-invalid":f.value[`items.${p}.expiry`]})},null,8,["modelValue","onUpdate:modelValue","min-date","class"])):(o(),l("span",xt,d(g(A)(a.expiry_date)),1)),f.value[`items.${p}.expiry`]?(o(),l("small",wt,d(f.value[`items.${p}.expiry`][0]),1)):h("",!0)]),e[28]||(e[28]=t("br",null,null,-1)),i.value?(o(),l("td",St,[t("button",{class:"p-2 rounded-full transition transform hover:bg-gray-100 hover:scale-110",onClick:n=>_.value.splice(p,1),title:"Delete"},[P(g(De),{class:"w-4 h-4 text-red-500"})],8,Ct)])):h("",!0)]))),128)),(i.value?_.value.length:c.value.items.length)===0?(o(),l("tr",Dt,[t("td",{colspan:i.value?6:5,class:"text-center text-muted py-3"}," No items found ",8,Pt)])):h("",!0)]),t("tfoot",Vt,[t("tr",null,[e[29]||(e[29]=t("td",{colspan:"3",class:"text-end fw-bold"}," Total: ",-1)),t("td",It,d(g(x)((i.value?_.value:c.value.items).reduce((a,p)=>a+parseFloat(p.sub_total||0),0))),1),e[30]||(e[30]=t("td",{colspan:"2"},null,-1))])])])]),i.value?(o(),l("div",Nt,[...e[31]||(e[31]=[t("i",{class:"bi bi-info-circle me-2"},null,-1),D(" Updating will mark this order as completed and create stock entries. ",-1)])])):h("",!0)])):h("",!0),i.value?(o(),l("div",$t,[t("button",{type:"button",class:"btn btn-primary rounded-pill px-4 py-2",onClick:ne,disabled:T.value||_.value.length===0},[T.value?(o(),l("span",Ot,[...e[34]||(e[34]=[t("span",{class:"spinner-border spinner-border-sm me-2"},null,-1),D(" Updating... ",-1)])])):(o(),l("span",Ft,"Complete Order & Update Stock"))],8,At),e[35]||(e[35]=t("button",{type:"button",class:"btn btn-secondary rounded-pill px-4 py-2","data-bs-dismiss":"modal"}," Cancel ",-1))])):h("",!0)])])])])]),_:1})}}},Wt=pe(Et,[["__scopeId","data-v-9eb22d9f"]]);export{Wt as default};
