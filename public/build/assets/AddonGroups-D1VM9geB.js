import{_ as de,r as h,o as ie,n as ce,c as X,a as P,b as u,w as H,d as A,e as t,u as N,h as ue,f as v,F as V,g as Z,i as y,j as me,t as f,k as G,v as I,l as O,m as M,C as pe,p as D,q as l}from"./app-CbaALDFq.js";import{_ as ve}from"./Master-DgOeezfe.js";import{s as fe}from"./index-O1klk09n.js";import{E as ge,a as he,X as be,u as C,w as xe}from"./xlsx-CIB83LfT.js";import{F as _e}from"./FilterModal-BL4Z7k-q.js";import{I as we}from"./importFile-ruCgUtmi.js";import{L as ye,C as Ce}from"./layers-BmKOhby-.js";import{C as Se}from"./circle-check-big-RKo7-CmR.js";import{C as ke}from"./circle-x-BAhpQ_Zu.js";import{P as Ae}from"./plus-C0ILXHev.js";import{P as Me}from"./pencil-Hecq5vTE.js";import"./index-Cmd-R4V0.js";import"./createLucideIcon-DEQDBvBF.js";import"./index-CCKTLXrc.js";import"./index-B2pb8CAK.js";import"./sun-CXQc7xiF.js";import"./index-DgfMEiQA.js";import"./index-CrFzrr1y.js";const Ge={class:"page-wrapper"},Ie={class:"row g-3 mb-4"},De={class:"card border-0 shadow-sm rounded-4"},$e={class:"card-body d-flex align-items-center"},Fe={class:"mb-0 fw-bold"},Ee={class:"text-muted mb-0 small"},Ne={class:"card border-0 shadow-lg rounded-4"},Ve={class:"card-body"},Le={class:"d-flex flex-wrap gap-2 justify-content-between align-items-center mb-3"},Te={class:"d-flex flex-wrap gap-2 align-items-center"},je={class:"search-wrap"},Be={key:1,class:"form-control search-input rounded-pill",placeholder:"Search groups...",disabled:"",type:"text"},Pe={class:"dropdown"},Oe={class:"dropdown-menu dropdown-menu-end shadow rounded-4 py-2"},Re={class:"table-responsive"},Ue={class:"table table-striped"},ze={key:0},Xe={class:"fw-semibold"},He={class:"badge bg-primary px-3 py-2 rounded-pill"},Ze={class:"text-center"},qe={class:"text-center"},Ke={class:"d-inline-flex align-items-center gap-3"},We=["onClick"],Ye=["title"],Je={key:2},Qe={class:"modal fade",id:"addonGroupModal",tabindex:"-1","aria-hidden":"true"},et={class:"modal-dialog modal-lg modal-dialog-centered"},tt={class:"modal-content rounded-4"},st={class:"modal-header"},ot={class:"modal-title fw-semibold"},at={class:"modal-body"},lt={class:"row g-3"},nt={class:"col-12"},rt={key:0,class:"text-danger"},dt={class:"col-md-6"},it={key:0,class:"text-danger d-block"},ct={class:"col-md-6"},ut={key:0,class:"text-danger d-block"},mt={class:"col-12"},pt={key:0,class:"text-danger"},vt={class:"col-12"},ft={key:0,class:"text-danger"},gt={class:"mt-4"},ht=["disabled"],bt={__name:"AddonGroups",setup(xt){const b=h([]),m=h({name:"",min_select:0,max_select:1,description:"",status:"active"}),p=h({sortBy:"",stockStatus:"",priceMin:null,priceMax:null}),S=h(null),$=h(!1),F=h(!1),R=h(0),c=h({}),q=[{label:"Active",value:"active"},{label:"Inactive",value:"inactive"}],L=async()=>{F.value=!0;try{const o=await D.get("/api/addon-groups/all");b.value=o.data.data}catch(o){console.error("Failed to fetch addon groups:",o),l.error("Failed to load addon groups")}finally{F.value=!1}};ie(async()=>{k.value="",U.value=Date.now(),await ce(),setTimeout(()=>{z.value=!0;const o=document.getElementById(T);o&&(o.value="",k.value="")},100),L()});const K=X(()=>[{label:"Total Groups",value:b.value.length,icon:ye,iconBg:"bg-light-primary",iconColor:"text-primary"},{label:"Active Groups",value:b.value.filter(o=>o.status==="active").length,icon:Se,iconBg:"bg-light-success",iconColor:"text-success"},{label:"Inactive Groups",value:b.value.filter(o=>o.status==="inactive").length,icon:ke,iconBg:"bg-light-danger",iconColor:"text-danger"},{label:"Total Addons",value:b.value.reduce((o,e)=>o+(e.addons_count||0),0),icon:Ce,iconBg:"bg-light-warning",iconColor:"text-warning"}]),k=h(""),U=h(Date.now()),T=`search-${Math.random().toString(36).substr(2,9)}`,z=h(!1),j=X(()=>{let o=b.value;const e=k.value.trim().toLowerCase();if(e&&(o=o.filter(s=>s.name.toLowerCase().includes(e))),p.value.stockStatus&&(o=o.filter(s=>s.status===p.value.stockStatus)),p.value.priceMin!==null&&p.value.priceMin!==""&&(o=o.filter(s=>(s.addons_count||0)>=parseInt(p.value.priceMin))),p.value.priceMax!==null&&p.value.priceMax!==""&&(o=o.filter(s=>(s.addons_count||0)<=parseInt(p.value.priceMax))),p.value.sortBy)switch(p.value.sortBy){case"name_asc":o.sort((s,n)=>s.name.localeCompare(n.name));break;case"name_desc":o.sort((s,n)=>n.name.localeCompare(s.name));break;case"addons_asc":o.sort((s,n)=>(s.addons_count||0)-(n.addons_count||0));break;case"addons_desc":o.sort((s,n)=>(n.addons_count||0)-(s.addons_count||0));break;case"newest":o.sort((s,n)=>new Date(n.created_at)-new Date(s.created_at));break;case"oldest":o.sort((s,n)=>new Date(s.created_at)-new Date(n.created_at));break}return o}),W=o=>{p.value={...p.value,...o},console.log("Filters applied:",p.value)},Y=()=>{p.value={sortBy:"",stockStatus:"",priceMin:null,priceMax:null},console.log("Filters cleared")},J=o=>{o.target.setAttribute("autocomplete","off")},E=()=>{m.value={name:"",min_select:0,max_select:1,description:"",status:"active"},S.value=null,c.value={}},Q=o=>{S.value=o,m.value={name:o.name,min_select:o.min_select,max_select:o.max_select,description:o.description||"",status:o.status};const e=document.getElementById("addonGroupModal");new bootstrap.Modal(e).show()},ee=async()=>{if(m.value.min_select>m.value.max_select){l.error("Minimum select cannot be greater than maximum select");return}$.value=!0,c.value={};try{S.value?(await D.post(`/api/addon-groups/${S.value.id}`,m.value),l.success("Addon group updated successfully")):(await D.post("/api/addon-groups",m.value),l.success("Addon group created successfully")),bootstrap.Modal.getInstance(document.getElementById("addonGroupModal"))?.hide(),E(),await L()}catch(o){if(console.error("âŒ Error:",o.response?.data||o.message),o.response?.status===422&&o.response?.data?.errors){c.value=o.response.data.errors;const e=Object.values(o.response.data.errors).flat();l.error(e.join(`
`))}else{const e=o.response?.data?.message||"Failed to save addon group";l.error(e)}}finally{$.value=!1}},te=async o=>{const e=o.status==="active"?"inactive":"active";try{await D.patch(`/api/addon-groups/${o.id}/toggle-status`,{status:e}),o.status=e,l.success(`Status changed to ${e}`),R.value++}catch(s){console.error("Failed to update status:",s),l.error("Failed to update status")}},B=o=>{if(!b.value||b.value.length===0){l.error("No Addon Groups data to download");return}const e=k.value.trim()?j.value:b.value;if(e.length===0){l.error("No Addon Groups found to download");return}try{o==="pdf"?oe(e):o==="excel"?ae(e):o==="csv"?se(e):l.error("Invalid download type")}catch(s){console.error("Download failed:",s),l.error(`Download failed: ${s.message}`)}},se=o=>{console.log("Data to export:",o);try{const e=["Group Name","Min Select","Max Select","Status","Description","Total Addons","Addons List"],s=o.map(d=>{const _=d.addons&&d.addons.length>0?d.addons.map(i=>i.name).join(" | "):"No addons";return[`"${d.name||""}"`,`${d.min_select||0}`,`${d.max_select||0}`,`"${d.status||"active"}"`,`"${(d.description||"").replace(/"/g,'""')}"`,`${d.addons_count||0}`,`"${_}"`]}),n=[e.join(","),...s.map(d=>d.join(","))].join(`
`),g=new Blob([n],{type:"text/csv;charset=utf-8;"}),x=URL.createObjectURL(g),r=document.createElement("a");r.setAttribute("href",x),r.setAttribute("download",`Addon_Groups_${new Date().toISOString().split("T")[0]}.csv`),document.body.appendChild(r),r.click(),document.body.removeChild(r),l.success("CSV downloaded successfully")}catch(e){console.error("CSV generation error:",e),l.error(`CSV generation failed: ${e.message}`,{autoClose:5e3})}},oe=o=>{try{const e=new ge("p","mm","a4");e.setFontSize(18),e.setFont("helvetica","bold"),e.text("Addon Groups with Addons Report",14,20),e.setFontSize(10),e.setFont("helvetica","normal");const s=new Date().toLocaleString();e.text(`Generated on: ${s}`,14,28),e.text(`Total Groups: ${o.length}`,14,34);const n=["Group Name","Min","Max","Status","Total Addons","Addons"],g=o.map(r=>{const d=r.addons&&r.addons.length>0?r.addons.map(_=>_.name).join(", "):"No addons";return[r.name||"",r.min_select||0,r.max_select||0,(r.status||"active").toUpperCase(),r.addons_count||0,d]});he(e,{head:[n],body:g,startY:40,styles:{fontSize:8,cellPadding:3,halign:"left",valign:"top",lineColor:[0,0,0],lineWidth:.1,overflow:"linebreak"},headStyles:{fillColor:[41,128,185],textColor:255,fontStyle:"bold"},alternateRowStyles:{fillColor:[245,245,245]},columnStyles:{5:{cellWidth:50}},margin:{left:14,right:14},didDrawPage:r=>{const d=e.internal.getNumberOfPages(),_=e.internal.pageSize.height;e.setFontSize(8),e.text(`Page ${r.pageNumber} of ${d}`,r.settings.margin.left,_-10)}});const x=`Addon_Groups_${new Date().toISOString().split("T")[0]}.pdf`;e.save(x),l.success("PDF downloaded successfully")}catch(e){console.error("PDF generation error:",e),l.error(`PDF generation failed: ${e.message}`,{autoClose:5e3})}},ae=o=>{try{if(typeof be>"u")throw new Error("XLSX library is not loaded");const e=o.map(i=>{const a=i.addons&&i.addons.length>0?i.addons.map(w=>w.name).join(" | "):"No addons";return{"Group Name":i.name||"","Min Select":i.min_select||0,"Max Select":i.max_select||0,Status:(i.status||"active").toUpperCase(),"Total Addons":i.addons_count||0,Description:i.description||"","Addons List":a}}),s=C.book_new(),n=C.json_to_sheet(e);n["!cols"]=[{wch:20},{wch:12},{wch:12},{wch:12},{wch:14},{wch:30},{wch:50}],C.book_append_sheet(s,n,"Addon Groups");const g=[];o.forEach(i=>{i.addons&&i.addons.length>0&&i.addons.forEach(a=>{g.push({"Group Name":i.name,"Addon Name":a.name,Price:a.price||0,Status:(a.status||"active").toUpperCase(),Description:a.description||"","Sort Order":a.sort_order||0})})});const x=C.json_to_sheet(g);x["!cols"]=[{wch:20},{wch:20},{wch:12},{wch:12},{wch:30},{wch:12}],C.book_append_sheet(s,x,"Addons Details");const r=[{Info:"Report",Value:"Addon Groups with Addons Export"},{Info:"Generated On",Value:new Date().toLocaleString()},{Info:"Total Groups",Value:o.length},{Info:"Total Addons",Value:o.reduce((i,a)=>i+(a.addons_count||0),0)},{Info:"Exported By",Value:"Inventory Management System"}],d=C.json_to_sheet(r);C.book_append_sheet(s,d,"Report Info");const _=`Addon_Groups_${new Date().toISOString().split("T")[0]}.xlsx`;xe(s,_),l.success("Excel file downloaded successfully",{autoClose:2500})}catch(e){console.error("Excel generation error:",e),l.error(`Excel generation failed: ${e.message}`,{autoClose:5e3})}},le=["Group Name","Min Select","Max Select","Status","Description"],ne=[["Toppings","0","5","active","Pizza toppings selection"],["Extras","0","3","active","Extra items"],["Sauces","1","1","active","Choose one sauce"]],re=o=>{if(!o||o.length<=1){l.error("The imported file is empty.");return}o[0];const s=o.slice(1).map(a=>({name:(a[0]||"").trim(),min_select:parseInt(a[1])||0,max_select:parseInt(a[2])||1,status:(a[3]||"active").toLowerCase().trim(),description:(a[4]||"").trim()})).filter(a=>a.name.length>0);if(s.length===0){l.error("No valid addon groups found in the file.");return}const n=s.filter(a=>a.min_select>a.max_select);if(n.length>0){const a=n.map(w=>w.name).join(", ");l.error(`Invalid: Min select > Max select for: ${a}`);return}const g=s.map(a=>a.name.toLowerCase()),x=g.filter((a,w)=>g.indexOf(a)!==w);if(x.length>0){l.error(`Duplicate names in CSV: ${[...new Set(x)].join(", ")}`);return}const r=b.value.map(a=>a.name.toLowerCase()),d=s.filter(a=>r.includes(a.name.toLowerCase()));if(d.length>0){const a=d.map(w=>w.name).join(", ");l.error(`Already exist in table: ${a}`);return}const _=["active","inactive"];if(s.filter(a=>!_.includes(a.status)).length>0){l.error("Status must be 'active' or 'inactive'.");return}D.post("/api/addon-groups/import",{groups:s}).then(a=>{l.success(a.data.message||"Import successful!"),L()}).catch(a=>{const w=a.response?.data?.message||"Import failed";l.error(w),console.error("Import error:",a)})};return(o,e)=>(u(),P(ve,null,{default:H(()=>[A(N(ue),{title:"Addon Groups"}),t("div",Ge,[e[29]||(e[29]=t("h4",{class:"fw-semibold mb-3"},"Addon Groups Management",-1)),t("div",Ie,[(u(!0),v(V,null,Z(K.value,s=>(u(),v("div",{key:s.label,class:"col-md-6 col-xl-3"},[t("div",De,[t("div",$e,[t("div",{class:y([[s.iconBg,s.iconColor],"rounded-circle p-3 d-flex align-items-center justify-content-center me-3"]),style:{width:"56px",height:"56px"}},[(u(),P(me(s.icon),{class:"w-6 h-6"}))],2),t("div",null,[t("h3",Fe,f(s.value),1),t("p",Ee,f(s.label),1)])])])]))),128))]),t("div",Ne,[t("div",Ve,[t("div",Le,[e[14]||(e[14]=t("h5",{class:"mb-0 fw-semibold"},"Addon Groups",-1)),t("div",Te,[A(_e,{modelValue:p.value,"onUpdate:modelValue":e[0]||(e[0]=s=>p.value=s),title:"Addon Groups",modalId:"addonGroupsFilterModal",modalSize:"modal-lg",sortOptions:[{value:"name_asc",label:"Name: A to Z"},{value:"name_desc",label:"Name: Z to A"},{value:"addons_asc",label:"Addons Count: Low to High"},{value:"addons_desc",label:"Addons Count: High to Low"},{value:"newest",label:"Newest First"},{value:"oldest",label:"Oldest First"}],showPriceRange:!0,showDateRange:!1,showCategory:!1,statusLabel:"Group Status",priceLabel:"Addons Count Range",priceMinPlaceholder:"Min Count",priceMaxPlaceholder:"Max Count",onApply:W,onClear:Y},null,8,["modelValue"]),t("div",je,[e[10]||(e[10]=t("i",{class:"bi bi-search"},null,-1)),e[11]||(e[11]=t("input",{type:"email",name:"email",autocomplete:"email",style:{position:"absolute",left:"-9999px",width:"1px",height:"1px"},tabindex:"-1","aria-hidden":"true"},null,-1)),z.value?G((u(),v("input",{id:T,"onUpdate:modelValue":e[1]||(e[1]=s=>k.value=s),key:U.value,class:"form-control search-input rounded-pill",placeholder:"Search groups...",type:"search",autocomplete:"new-password",name:T,role:"presentation",onFocus:J},null,32)),[[I,k.value]]):(u(),v("input",Be))]),t("button",{"data-bs-toggle":"modal","data-bs-target":"#addonGroupModal",onClick:E,class:"d-flex align-items-center gap-1 px-4 py-2 rounded-pill btn btn-primary text-white"},[A(N(Ae),{class:"w-4 h-4"}),e[12]||(e[12]=O(" Add Group ",-1))]),A(we,{label:"Import Groups",sampleHeaders:le,sampleData:ne,onOnImport:re}),t("div",Pe,[e[13]||(e[13]=t("button",{class:"btn btn-outline-secondary rounded-pill py-2 btn-sm px-4 dropdown-toggle","data-bs-toggle":"dropdown"}," Export ",-1)),t("ul",Oe,[t("li",null,[t("a",{class:"dropdown-item py-2",href:"javascript:;",onClick:e[2]||(e[2]=s=>B("pdf"))},"Export as PDF")]),t("li",null,[t("a",{class:"dropdown-item py-2",href:"javascript:;",onClick:e[3]||(e[3]=s=>B("excel"))},"Export as Excel")]),t("li",null,[t("a",{class:"dropdown-item py-2",href:"javascript:;",onClick:e[4]||(e[4]=s=>B("csv"))}," Export as CSV ")])])])])]),t("div",Re,[t("table",Ue,[e[17]||(e[17]=t("thead",{class:"border-top small text-muted"},[t("tr",null,[t("th",null,"S.#"),t("th",null,"Name"),t("th",null,"Min Select"),t("th",null,"Max Select"),t("th",null,"Addons Count"),t("th",{class:"text-center"},"Status"),t("th",{class:"text-center"},"Action")])],-1)),t("tbody",null,[F.value?(u(),v("tr",ze,[...e[15]||(e[15]=[t("td",{colspan:"7",class:"text-center py-4"},[t("div",{class:"spinner-border text-primary",role:"status"},[t("span",{class:"visually-hidden"},"Loading...")])],-1)])])):(u(!0),v(V,{key:1},Z(j.value,(s,n)=>(u(),v("tr",{key:s.id},[t("td",null,f(n+1),1),t("td",Xe,f(s.name),1),t("td",null,f(s.min_select),1),t("td",null,f(s.max_select),1),t("td",null,[t("span",He,f(s.addons_count||0)+" addons ",1)]),t("td",Ze,[t("span",{class:y(s.status==="active"?"badge bg-success px-4 py-2 rounded-pill":"badge bg-danger px-4 py-2 rounded-pill")},f(s.status==="active"?"Active":"Inactive"),3)]),t("td",qe,[t("div",Ke,[t("button",{onClick:g=>Q(s),title:"Edit",class:"p-2 rounded-full text-blue-600 hover:bg-blue-100"},[A(N(Me),{class:"w-4 h-4"})],8,We),(u(),P(pe,{key:`confirm-${s.id}-${R.value}`,title:"Confirm Status Change",message:`Are you sure you want to set ${s.name} to ${s.status==="active"?"Inactive":"Active"}?`,showStatusButton:!0,confirmText:"Yes, Change",cancelText:"Cancel",status:s.status,onConfirm:g=>te(s)},{trigger:H(()=>[t("button",{class:y(["relative inline-flex items-center w-8 h-4 rounded-full transition-colors duration-300 focus:outline-none",s.status==="active"?"bg-green-500 hover:bg-green-600":"bg-red-400 hover:bg-red-500"]),title:s.status==="active"?"Set Inactive":"Set Active"},[t("span",{class:y(["absolute left-0.5 top-0.5 w-3 h-3 bg-white rounded-full shadow transform transition-transform duration-300",s.status==="active"?"translate-x-4":"translate-x-0"])},null,2)],10,Ye)]),_:2},1032,["message","status","onConfirm"]))])])]))),128)),!F.value&&j.value.length===0?(u(),v("tr",Je,[...e[16]||(e[16]=[t("td",{colspan:"7",class:"text-center text-muted py-4"}," No addon groups found. ",-1)])])):M("",!0)])])])])]),t("div",Qe,[t("div",et,[t("div",tt,[t("div",st,[t("h5",ot,f(S.value?"Edit Addon Group":"Add New Addon Group"),1),t("button",{class:"absolute top-2 right-2 p-2 rounded-full hover:bg-gray-100 transition transform hover:scale-110",onClick:E,"data-bs-dismiss":"modal","aria-label":"Close",title:"Close"},[...e[18]||(e[18]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),t("div",at,[t("div",lt,[t("div",nt,[e[19]||(e[19]=t("label",{class:"form-label"},"Group Name *",-1)),G(t("input",{"onUpdate:modelValue":e[5]||(e[5]=s=>m.value.name=s),type:"text",class:y(["form-control",{"is-invalid":c.value.name}]),placeholder:"e.g., Toppings, Extras, Sauces"},null,2),[[I,m.value.name]]),c.value.name?(u(),v("small",rt,f(c.value.name[0]),1)):M("",!0)]),t("div",dt,[e[20]||(e[20]=t("label",{class:"form-label"},"Minimum Select *",-1)),G(t("input",{"onUpdate:modelValue":e[6]||(e[6]=s=>m.value.min_select=s),type:"number",min:"0",class:y(["form-control",{"is-invalid":c.value.min_select}]),placeholder:"0"},null,2),[[I,m.value.min_select,void 0,{number:!0}]]),e[21]||(e[21]=t("small",{class:"text-muted"}," Minimum items customer must select ",-1)),c.value.min_select?(u(),v("small",it,f(c.value.min_select[0]),1)):M("",!0)]),t("div",ct,[e[22]||(e[22]=t("label",{class:"form-label"},"Maximum Select *",-1)),G(t("input",{"onUpdate:modelValue":e[7]||(e[7]=s=>m.value.max_select=s),type:"number",min:"1",class:y(["form-control",{"is-invalid":c.value.max_select}]),placeholder:"1"},null,2),[[I,m.value.max_select,void 0,{number:!0}]]),e[23]||(e[23]=t("small",{class:"text-muted"}," Maximum items customer can select ",-1)),c.value.max_select?(u(),v("small",ut,f(c.value.max_select[0]),1)):M("",!0)]),t("div",mt,[e[24]||(e[24]=t("label",{class:"form-label"},"Status *",-1)),A(N(fe),{modelValue:m.value.status,"onUpdate:modelValue":e[8]||(e[8]=s=>m.value.status=s),options:q,optionLabel:"label",optionValue:"value",class:y(["form-select",{"is-invalid":c.value.status}]),appendTo:"self",autoZIndex:!0,baseZIndex:2e3},null,8,["modelValue","class"]),c.value.status?(u(),v("small",pt,f(c.value.status[0]),1)):M("",!0)]),t("div",vt,[e[25]||(e[25]=t("label",{class:"form-label"},"Description (Optional)",-1)),G(t("textarea",{"onUpdate:modelValue":e[9]||(e[9]=s=>m.value.description=s),class:y(["form-control",{"is-invalid":c.value.description}]),rows:"3",placeholder:"Enter group description..."},null,2),[[I,m.value.description]]),c.value.description?(u(),v("small",ft,f(c.value.description[0]),1)):M("",!0)])]),e[28]||(e[28]=t("hr",{class:"my-4"},null,-1)),t("div",gt,[t("button",{class:"btn btn-primary rounded-pill px-4",disabled:$.value,onClick:ee},[$.value?(u(),v(V,{key:0},[e[26]||(e[26]=t("span",{class:"spinner-border spinner-border-sm me-2"},null,-1)),e[27]||(e[27]=O(" Saving... ",-1))],64)):(u(),v(V,{key:1},[O(f((S.value,"Save")),1)],64))],8,ht),t("button",{class:"btn btn-secondary rounded-pill px-4 ms-2","data-bs-dismiss":"modal",onClick:E}," Cancel ")])])])])])])]),_:1}))}},jt=de(bt,[["__scopeId","data-v-3a289da6"]]);export{jt as default};
