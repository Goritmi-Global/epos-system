import{_ as ct,r as b,y as jt,a as Pt,b as o,w as H,f as d,m as v,e as t,t as n,k as A,v as q,l as h,V as St,o as it,n as At,c as j,d as P,u as m,h as Lt,F,g as V,T as ut,i as Ft,q as S}from"./app-CbaALDFq.js";import{_ as It}from"./Master-DgOeezfe.js";import{u as Rt}from"./useFormatters-CIpT4SD6.js";import{F as Bt}from"./FilterModal-BL4Z7k-q.js";import{E as Nt}from"./eye-l1_vkT_h.js";import{C as Et}from"./circle-x-BAhpQ_Zu.js";import"./index-Cmd-R4V0.js";import"./createLucideIcon-DEQDBvBF.js";import"./index-CCKTLXrc.js";import"./index-B2pb8CAK.js";import"./sun-CXQc7xiF.js";const Vt={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50"},qt={class:"bg-white rounded-xl shadow-xl w-full max-w-md p-6 animate-drop-in relative"},zt={class:"text-center text-lg font-medium text-gray-800 mb-2"},Ut={class:"bg-gray-50 rounded-lg p-4 mb-4 space-y-2"},Gt={class:"flex justify-between text-sm"},Ht={class:"font-medium text-gray-800"},Wt={class:"flex justify-between text-sm"},Kt={class:"font-medium text-gray-800"},Qt={class:"flex justify-between text-sm"},Yt={class:"font-medium text-gray-800"},Zt={class:"mb-4"},Xt={class:"flex justify-center gap-3"},Jt=["disabled"],te={key:0,class:"spinner-border spinner-border-sm",role:"status"},ee={key:1,xmlns:"http://www.w3.org/2000/svg",class:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},se=["disabled"],le={__name:"OrderCancellationModal",props:{show:{type:Boolean,default:!1},order:{type:Object,default:null},loading:{type:Boolean,default:!1}},emits:["confirm","cancel"],setup(_,{emit:p}){const I=_,T=p,x=b("");jt(()=>I.show,w=>{w||(x.value="")});const C=()=>{T("confirm",x.value||"Cancelled by admin from orders page")},k=()=>{T("cancel")},r=w=>new Intl.NumberFormat("en-GB",{style:"currency",currency:"GBP"}).format(w||0);return(w,c)=>(o(),Pt(St,{name:"fade-slide"},{default:H(()=>[_.show?(o(),d("div",Vt,[t("div",qt,[t("button",{class:"absolute top-2 right-2 p-2 rounded-full hover:bg-gray-100 transition transform hover:scale-110",onClick:k,title:"Close"},[...c[1]||(c[1]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)])]),c[8]||(c[8]=t("div",{class:"flex justify-center mb-4"},[t("div",{class:"bg-red-100 p-3 rounded-full"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-8 h-8 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})])])],-1)),t("h3",zt," Cancel Order #"+n(_.order?.id)+"? ",1),c[9]||(c[9]=t("p",{class:"text-center text-sm text-gray-500 mb-4"}," This action will cancel the order and cannot be undone. ",-1)),t("div",Ut,[t("div",Gt,[c[2]||(c[2]=t("span",{class:"text-gray-600"},"Customer:",-1)),t("span",Ht,n(_.order?.customer_name||"Walk In"),1)]),t("div",Wt,[c[3]||(c[3]=t("span",{class:"text-gray-600"},"Total Amount:",-1)),t("span",Kt,n(r(_.order?.total_amount)),1)]),t("div",Qt,[c[4]||(c[4]=t("span",{class:"text-gray-600"},"Payment Type:",-1)),t("span",Yt,n(_.order?.payment?.payment_type||"N/A"),1)])]),t("div",Zt,[c[5]||(c[5]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Reason for Cancellation (Optional) ",-1)),A(t("textarea",{"onUpdate:modelValue":c[0]||(c[0]=D=>x.value=D),class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-1 focus:ring-white focus:border-transparent resize-none",rows:"3",placeholder:"Enter reason for cancelling this order..."},null,512),[[q,x.value]])]),t("div",Xt,[t("button",{onClick:C,disabled:_.loading,class:"btn btn-danger d-flex align-items-center gap-2 px-4 py-2 rounded-pill text-white"},[_.loading?(o(),d("span",te)):(o(),d("svg",ee,[...c[6]||(c[6]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"},null,-1)])])),h(" "+n(_.loading?"Cancelling...":"Cancel Order"),1)],8,Jt),t("button",{onClick:k,disabled:_.loading,class:"btn btn-secondary d-flex align-items-center gap-2 px-4 py-2 rounded-pill text-white"},[...c[7]||(c[7]=[h(" Keep Order ",-1),t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,se)])])])):v("",!0)]),_:1}))}},ae=ct(le,[["__scopeId","data-v-72385fab"]]),ne={class:"page-wrapper"},oe={class:"row g-3"},de={class:"col-md-6 col-xl-4"},re={class:"card border-0 shadow-sm rounded-4"},ie={class:"card-body d-flex align-items-center justify-content-between"},ue={class:"mb-0 fw-bold"},ce={class:"col-md-6 col-xl-4"},me={class:"card border-0 shadow-sm rounded-4"},pe={class:"card-body d-flex align-items-center justify-content-between"},ve={class:"mb-0 fw-bold"},be={class:"col-md-6 col-xl-4"},ye={class:"card border-0 shadow-sm rounded-4"},fe={class:"card-body d-flex align-items-center justify-content-between"},we={class:"mb-0 fw-bold"},ge={class:"card border-0 shadow-lg rounded-4 mt-0"},he={class:"card-body"},_e={class:"d-flex flex-wrap gap-2 justify-content-between align-items-center mb-3"},xe={class:"d-flex flex-wrap gap-2 align-items-center"},Ce={class:"search-wrap"},ke={key:1,class:"form-control search-input",placeholder:"Search",disabled:"",type:"text"},$e={class:"col-md-6"},Te=["onUpdate:modelValue"],De=["value"],Oe={class:"col-md-6 mt-3"},Me=["onUpdate:modelValue"],je=["value"],Pe={class:"table-responsive"},Se={class:"table table-hover align-middle mb-0",style:{"min-height":"320px"}},Ae=["onClick"],Le={class:"text-success"},Fe={class:"text-success"},Ie={class:"text-success"},Re={class:"text-left"},Be={class:"d-flex gap-2 justify-content-center align-items-center"},Ne=["onClick"],Ee=["onClick","disabled"],Ve=["onClick","disabled"],qe={key:0},ze={class:"modal fade",id:"paymentDetailsModal",tabindex:"-1","aria-hidden":"true"},Ue={class:"modal-dialog modal-md modal-dialog-centered"},Ge={class:"modal-content border-0 shadow-lg rounded-4 overflow-hidden"},He={class:"modal-body p-4"},We={class:"payment-info"},Ke={class:"row g-3"},Qe={class:"col-6"},Ye={class:"info-card"},Ze={class:"value"},Xe={class:"col-6"},Je={class:"info-card"},ts={class:"value"},es={key:0,class:"col-6"},ss={class:"info-card"},ls={class:"value"},as={key:1,class:"col-6"},ns={class:"info-card"},os={class:"value"},ds={class:"col-6"},rs={class:"info-card"},is={class:"value"},us={key:2,class:"col-6"},cs={class:"info-card"},ms={class:"value text-capitalize"},ps={key:3,class:"col-6"},vs={class:"info-card"},bs={class:"value"},ys={key:4,class:"col-6"},fs={class:"info-card"},ws={class:"value"},gs={key:5,class:"col-6"},hs={class:"info-card"},_s={class:"value"},xs={class:"modal fade",id:"orderDetailsModal",tabindex:"-1","aria-hidden":"true"},Cs={class:"modal-dialog modal-lg modal-dialog-centered"},ks={class:"modal-content rounded-4 shadow border-0"},$s={class:"modal-header bg-white border-0 position-relative px-4 pt-4"},Ts={class:"d-flex align-items-center gap-3"},Ds={class:"d-flex flex-column"},Os={class:"modal-title fw-bold mb-0"},Ms={class:"text-muted"},js={class:"modal-body bg-light px-4 pb-4"},Ps={key:0,class:"rounded-3 bg-white shadow-sm p-4"},Ss={class:"mb-4"},As={class:"row text-muted small"},Ls={class:"col-md-4 mb-2"},Fs={class:"col-md-4 mb-2"},Is={class:"table-responsive"},Rs={class:"table align-middle table-striped table-hover border rounded-3 overflow-hidden shadow-sm"},Bs={class:"px-3"},Ns={class:"fw-semibold"},Es={class:"fw-bold text-success"},Vs={key:0,class:"no-border"},qs={class:"text-success fw-semibold",colspan:"3"},zs={key:1,class:"no-border"},Us={class:"text-success fw-semibold",colspan:"3"},Gs={key:2,class:"no-border"},Hs={class:"text-success fw-semibold",colspan:"3"},Ws={key:3,class:"no-border"},Ks={class:"text-success fw-semibold",colspan:"3"},Qs={key:4,class:"no-border"},Ys={class:"text-success fw-semibold",colspan:"3"},Zs={key:5,class:"no-border"},Xs={class:"text-success fw-semibold",colspan:"3"},Js={class:"border-top-thick"},tl={class:"fw-bold text-success"},el={key:6},sl={class:"modal-footer bg-white border-0 shadow-sm px-4 py-3"},ll={class:"modal fade",id:"refundModal",tabindex:"-1","aria-hidden":"true"},al={class:"modal-dialog modal-dialog-centered"},nl={class:"modal-content rounded-4 shadow border-0"},ol={class:"modal-body"},dl={class:"mb-3"},rl={class:"bg-light p-3 rounded-3"},il={class:"d-flex justify-content-between mb-2"},ul={class:"fw-semibold"},cl={class:"d-flex justify-content-between mb-2"},ml={class:"fw-semibold"},pl={class:"d-flex justify-content-between mb-2"},vl={class:"fw-semibold"},bl={class:"d-flex justify-content-between mb-2"},yl={class:"fw-semibold text-capitalize"},fl={key:0,class:"d-flex justify-content-between mb-2"},wl={class:"fw-semibold text-success"},gl={key:1,class:"d-flex justify-content-between"},hl={class:"fw-semibold"},_l={class:"mb-3"},xl={class:"input-group"},Cl=["max"],kl={class:"text-muted"},$l={class:"mb-3"},Tl={class:"text-muted"},Dl={class:"modal-footer border-0"},Ol=["disabled"],Ml=["disabled"],jl={key:0},Pl={key:1},Sl={__name:"Order",setup(_){const{formatCurrencySymbol:p,dateFmt:I}=Rt(),T=b(null),x=b(null),C=b(0),k=b(""),r=b(null),w=b([]),c=async()=>{try{const l=await axios.get("/api/orders/all");w.value=l.data.data}catch(l){console.error("Error fetching inventory:",l)}};it(async()=>{D.value="",W.value=Date.now(),await At(),setTimeout(()=>{K.value=!0;const l=document.getElementById(z);l&&(l.value="",D.value="")},100),c()});const D=b(""),W=b(Date.now()),z=`search-${Math.random().toString(36).substr(2,9)}`,K=b(!1),y=b({sortBy:"",orderType:"",paymentType:"",status:"",priceMin:null,priceMax:null,dateFrom:"",dateTo:""});b(["All","Dine In","Delivery","Takeaway"]),b(["All","Cash","Card","Split"]);const Q=j(()=>{const l=D.value.trim().toLowerCase();let e=[...w.value];return l&&(e=e.filter(s=>[String(s.id),s.type?.table_number??"",s.type?.order_type??"",s.customer_name??"",s.payment?.payment_type??"",s.status??"",String(s.total_amount??""),Y(s.created_at),Z(s.created_at)].join(" ").toLowerCase().includes(l))),y.value.orderType&&(e=e.filter(s=>(s.type?.order_type??"").toLowerCase()===y.value.orderType.toLowerCase())),y.value.paymentType&&(e=e.filter(s=>(s.payment?.payment_type??"").toLowerCase()===y.value.paymentType.toLowerCase())),y.value.status&&(e=e.filter(s=>s.status?.toLowerCase()===y.value.status.toLowerCase())),(y.value.priceMin!==null||y.value.priceMax!==null)&&(e=e.filter(s=>{const a=s.total_amount||0,i=y.value.priceMin||0,O=y.value.priceMax||1/0;return a>=i&&a<=O})),y.value.dateFrom&&(e=e.filter(s=>{const a=new Date(s.created_at),i=new Date(y.value.dateFrom);return a>=i})),y.value.dateTo&&(e=e.filter(s=>{const a=new Date(s.created_at),i=new Date(y.value.dateTo);return i.setHours(23,59,59,999),a<=i})),e}),mt=j(()=>{const l=[...Q.value];switch(y.value.sortBy){case"date_desc":return l.sort((s,a)=>new Date(a.created_at)-new Date(s.created_at));case"date_asc":return l.sort((s,a)=>new Date(s.created_at)-new Date(a.created_at));case"price_desc":return l.sort((s,a)=>(a.total_amount||0)-(s.total_amount||0));case"price_asc":return l.sort((s,a)=>(s.total_amount||0)-(a.total_amount||0));case"customer_asc":return l.sort((s,a)=>(s.customer_name||"").localeCompare(a.customer_name||""));case"customer_desc":return l.sort((s,a)=>(a.customer_name||"").localeCompare(s.customer_name||""));default:return l.sort((s,a)=>new Date(a.created_at)-new Date(s.created_at))}}),R=j(()=>({sortOptions:[{value:"date_desc",label:"Date: Newest First"},{value:"date_asc",label:"Date: Oldest First"},{value:"price_desc",label:"Price: High to Low"},{value:"price_asc",label:"Price: Low to High"},{value:"customer_asc",label:"Customer: A to Z"},{value:"customer_desc",label:"Customer: Z to A"}],orderTypeOptions:[{value:"Dine In",label:"Dine In"},{value:"Delivery",label:"Delivery"},{value:"Takeaway",label:"Takeaway"},{value:"Collection",label:"Collection"}],paymentTypeOptions:[{value:"Cash",label:"Cash"},{value:"Card",label:"Card"},{value:"Split",label:"Split"}],statusOptions:[{value:"paid",label:"Paid"},{value:"pending",label:"Pending"},{value:"cancelled",label:"Cancelled"}]})),pt=j(()=>w.value.length),vt=j(()=>w.value.filter(l=>l.status==="paid").length),bt=j(()=>w.value.filter(l=>l.status!=="paid").length);function Y(l){const e=new Date(l),s=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),i=String(e.getDate()).padStart(2,"0");return`${s}-${a}-${i}`}function Z(l){const e=Date.now()-new Date(l).getTime(),s=Math.floor(e/6e4);if(s<60)return`${s} minute${s===1?"":"s"} ago`;const a=Math.floor(s/60);if(a<24)return`${a} hour${a===1?"":"s"} ago`;const i=Math.floor(a/24);return`${i} day${i===1?"":"s"} ago`}function U(l){const e=Number(l??0);return`£${Number.isInteger(e)?e.toFixed(0):e.toFixed(1)}`}const yt=b(!1),f=b(null),u=b(null);function ft(l){f.value=l,yt.value=!0,new bootstrap.Modal(document.getElementById("paymentDetailsModal")).show()}const wt=l=>{u.value=l,new bootstrap.Modal(document.getElementById("orderDetailsModal")).show()};function gt(l){const e=g=>`£${Number(g??0).toFixed(2)}`,s=g=>(g??"").toString(),a=l?.payment??{},i=(a.payment_type??l?.payment_method??"Cash").toLowerCase(),O=a.cash_amount??l?.cash_amount??l?.cash_received??0,M=a.card_amount??l?.card_amount??0,at=a.brand??l?.card_brand??"",nt=a.last_digits??l?.last4??l?.last_digits??"";let B="";if(i==="split")B=`Payment: Split (Cash: ${e(O)}, Card: ${e(M)})`;else if(i==="card"||i==="stripe"){const g=at?` (${at})`:"",E=nt?` •••• ${nt}`:"";B=`Payment: Card${g}${E}`}else B=`Payment: ${s(l?.payment_method)||"Cash"}`;const Ct=l?.id??"N/A",kt=l?.type?.order_type??l?.order_type??"N/A",ot=l?.type?.table_number??l?.table_number??null,$t=l?.customer_name||"Walk In",L=l?.created_at?new Date(l.created_at):new Date,Tt=`${L.getFullYear()}-${String(L.getMonth()+1).padStart(2,"0")}-${String(L.getDate()).padStart(2,"0")} ${String(L.getHours()).padStart(2,"0")}:${String(L.getMinutes()).padStart(2,"0")}`,dt=Array.isArray(l?.items)?l.items:[],rt=l?.sub_total??dt.reduce((g,E)=>g+Number(E.price??0)*Number(E.quantity??0),0),Dt=l?.total_amount??rt,Ot=dt.map(g=>`
    <div class="row">
      <span class="w-50 ellips">${s(g.title)}</span>
      <span class="w-20 right">x${Number(g.quantity??0)}</span>
      <span class="w-30 right">${e(g.price)}</span>
    </div>
  `).join(""),Mt=`
<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Receipt</title>
<style>
  :root { --w: 58mm; }
  html, body { margin:0; padding:0; }
  body { width: var(--w); font-family: monospace; font-size: 12px; line-height: 1.3; color:#000; }
  .center { text-align:center; }
  .right { text-align:right; }
  .row { display:flex; justify-content:space-between; gap:4px; }
  .w-50 { width:50%; } .w-20 { width:20%; } .w-30 { width:30%; }
  .ellips { white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
  hr { border:0; border-top:1px dashed #000; margin:4px 0; }
  h3 { margin:0 0 2px 0; font-size: 14px; }
  small { font-size:11px; }
  .mt-4 { margin-top:4px; }
  .mb-4 { margin-bottom:4px; }
  .bold { font-weight:bold; }
  @page { size: var(--w) auto; margin: 3mm; }
  @media print { body { -webkit-print-color-adjust: exact; print-color-adjust: exact; } }
</style>
</head>
<body>
  <div class="center">
    <h3>Goritmi</h3>
    <small>Order #${Ct}</small><br/>
    <small>${Tt}</small>
  </div>

  <hr/>
  <div><small>Customer: ${s($t)}</small></div>
  <div><small>Order Type: ${s(kt)}${ot?` | Table: ${s(ot)}`:""}</small></div>
  <div><small>${B}</small></div>

  <hr/>
  <div class="row bold"><span class="w-50">Item</span><span class="w-20 right">Qty</span><span class="w-30 right">Price</span></div>
  ${Ot}
  <hr/>

  <div class="row"><span>Subtotal:</span><span class="right">${e(rt)}</span></div>
  ${Number(l?.tax??0)?`<div class="row"><span>Tax:</span><span class="right">${e(l.tax)}</span></div>`:""}
  ${Number(l?.service_charges??0)?`<div class="row"><span>Service:</span><span class="right">${e(l.service_charges)}</span></div>`:""}
  ${Number(l?.delivery_charges??0)?`<div class="row"><span>Delivery:</span><span class="right">${e(l.delivery_charges)}</span></div>`:""}

  <div class="row bold mt-4"><span>Total:</span><span class="right">${e(Dt)}</span></div>

  ${i==="cash"||!i?`<div class="row"><span>Cash Received:</span><span class="right">${e(l?.cash_received??a?.amount_received??0)}</span></div>
       <div class="row"><span>Change:</span><span class="right">${e(l?.change??0)}</span></div>`:""}

  <hr/>
  <div class="center">
    <small>Abdara Road, Peshawar</small><br/>
    <small>info@goritmi.com</small><br/>
    <small>Thank you for your visit!</small>
  </div>

<script>
  async function ready() {
    try { if (document.fonts && document.fonts.ready) { await document.fonts.ready; } } catch(e){}
    window.focus();
    const mq = window.matchMedia && window.matchMedia('print');
    if (mq && mq.addEventListener) {
      mq.addEventListener('change', function(e){ if(!e.matches) setTimeout(function(){ window.close(); }, 300); });
    } else if (mq && mq.addListener) { // older browsers
      mq.addListener(function(mql){ if(!mql.matches) setTimeout(function(){ window.close(); }, 300); });
    }
    window.onafterprint = function(){ setTimeout(function(){ window.close(); }, 300); };
    setTimeout(function(){ window.print(); }, 200);
  }
  if (document.readyState === 'complete') ready();
  else window.addEventListener('load', ready);
<\/script>
</body>
</html>
`,N=window.open("","","width=420,height=640");if(!N){console.error("Popup blocked or failed to open"),alert("Please allow popups for this site to print receipts");return}N.document.open(),N.document.write(Mt),N.document.close()}const X=b([]),J=b(!1);it(async()=>{J.value=!0;try{const l=await axios.get("/api/printers");X.value=l.data.data.filter(e=>e.is_connected===!0||e.status==="OK").map(e=>({label:`${e.name}`,value:e.name,driver:e.driver,port:e.port}))}catch(l){console.error("Failed to fetch printers:",l)}finally{J.value=!1}});const tt=l=>{if(!l||!l.payment)return!1;const e=l.payment.payment_type?.toLowerCase(),s=l.status?.toLowerCase(),a=l.payment.refund_status?.toLowerCase();return(s==="paid"||s==="cancelled")&&(e==="card"||e==="split")&&(!a||a==="none")},et=async l=>{if(!l)return;l.payment?.payment_type?.toLowerCase();const e=l.total_amount,s=l.payment?.card_amount||e;r.value=l,C.value=Number(s).toFixed(2),k.value="";const a=document.getElementById("refundModal");a&&new bootstrap.Modal(a).show()},ht=async()=>{if(!r.value)return;const l=Number(C.value);if(l<=0){S.error("Refund amount must be greater than 0");return}const e=r.value.payment?.payment_type?.toLowerCase(),s=r.value.payment?.card_amount||r.value.total_amount;if(l>s){S.error(`Refund amount cannot exceed ${p(s)}`);return}x.value=r.value.id;try{const a=await axios.post(`/api/pos/orders/${r.value.id}/refund`,{amount:l,reason:k.value||"Refund requested by admin",payment_type:e});if(a.data.success){S.success(`Refund of ${p(l)} processed successfully`);const i=w.value.findIndex(M=>M.id===r.value.id);i!==-1&&(w.value[i]=a.data.order);const O=document.getElementById("refundModal");if(O){const M=bootstrap.Modal.getInstance(O);M&&M.hide()}r.value=null,C.value=0,k.value=""}}catch(a){console.error("Error processing refund:",a),S.error(a.response?.data?.message||"Failed to process refund")}finally{x.value=null}},st=()=>{const l=document.getElementById("refundModal");if(l){const e=bootstrap.Modal.getInstance(l);e&&e.hide()}r.value=null,C.value=0,k.value=""},G=b(!1),$=b(null),_t=l=>{l&&($.value=l,G.value=!0)},lt=()=>{G.value=!1,$.value=null},xt=async l=>{if($.value){T.value=$.value.id;try{const e=await axios.post(`/api/pos/orders/${$.value.id}/cancel`,{reason:l});if(e.data.success){S.success("Order cancelled and stock restored successfully");const s=w.value.findIndex(a=>a.id===$.value.id);s!==-1&&(w.value[s]=e.data.order),lt(),tt(e.data.order)&&setTimeout(()=>{confirm(`Order cancelled successfully!

Would you like to refund the payment as well?`)&&et(e.data.order)},500)}}catch(e){console.error("Error cancelling order:",e),S.error(e.response?.data?.message||"Failed to cancel order")}finally{T.value=null}}};return(l,e)=>(o(),d(F,null,[P(m(Lt),{title:"Orders"}),P(It,null,{default:H(()=>[t("div",ne,[e[72]||(e[72]=t("h4",{class:"fw-semibold mb-3"},"Overall Orders",-1)),t("div",oe,[t("div",de,[t("div",re,[t("div",ie,[t("div",null,[t("h3",ue,n(pt.value),1),e[6]||(e[6]=t("p",{class:"text-muted mb-0 small"},"Total Orders",-1))]),e[7]||(e[7]=t("div",{class:"rounded-circle p-2 d-flex align-items-center justify-content-center text-primary",style:{width:"40px",height:"40px"}},[t("i",{class:"bi bi-list-task fs-4"})],-1))])])]),t("div",ce,[t("div",me,[t("div",pe,[t("div",null,[t("h3",ve,n(vt.value),1),e[8]||(e[8]=t("p",{class:"text-muted mb-0 small"},"Completed Orders",-1))]),e[9]||(e[9]=t("div",{class:"rounded-circle p-3 d-flex align-items-center justify-content-center text-success",style:{width:"40px",height:"40px"}},[t("i",{class:"bi bi-check2-circle fs-4"})],-1))])])]),t("div",be,[t("div",ye,[t("div",fe,[t("div",null,[t("h3",we,n(bt.value),1),e[10]||(e[10]=t("p",{class:"text-muted mb-0 small"},"Pending Orders",-1))]),e[11]||(e[11]=t("div",{class:"rounded-circle p-3 d-flex align-items-center justify-content-center text-warning",style:{width:"40px",height:"40px"}},[t("i",{class:"bi bi-hourglass-split fs-4"})],-1))])])])]),t("div",ge,[t("div",he,[t("div",_e,[e[19]||(e[19]=t("h5",{class:"mb-0 fw-semibold"},"Orders",-1)),t("div",xe,[t("div",Ce,[e[12]||(e[12]=t("i",{class:"bi bi-search"},null,-1)),e[13]||(e[13]=t("input",{type:"email",name:"email",autocomplete:"email",style:{position:"absolute",left:"-9999px",width:"1px",height:"1px"},tabindex:"-1","aria-hidden":"true"},null,-1)),K.value?A((o(),d("input",{id:z,"onUpdate:modelValue":e[0]||(e[0]=s=>D.value=s),key:W.value,class:"form-control search-input",placeholder:"Search",type:"search",autocomplete:"new-password",name:z,role:"presentation",onFocus:e[1]||(e[1]=(...s)=>l.handleFocus&&l.handleFocus(...s))},null,32)),[[q,D.value]]):(o(),d("input",ke))]),P(Bt,{modelValue:y.value,"onUpdate:modelValue":e[2]||(e[2]=s=>y.value=s),title:"Orders","modal-id":"orderFilterModal","modal-size":"modal-lg","sort-options":R.value.sortOptions,"status-options":R.value.statusOptions,"show-price-range":!0,"show-date-range":!0,"price-label":"Total Amount Range",onApply:l.handleFilterApply,onClear:l.handleFilterClear},{customFilters:H(({filters:s})=>[t("div",$e,[e[15]||(e[15]=t("label",{class:"form-label fw-semibold text-dark"},[t("i",{class:"fas fa-concierge-bell me-2 text-muted"}),h("Order Type ")],-1)),A(t("select",{"onUpdate:modelValue":a=>s.orderType=a,class:"form-select"},[e[14]||(e[14]=t("option",{value:""},"All",-1)),(o(!0),d(F,null,V(R.value.orderTypeOptions,a=>(o(),d("option",{key:a.value,value:a.value},n(a.label),9,De))),128))],8,Te),[[ut,s.orderType]])]),t("div",Oe,[e[17]||(e[17]=t("label",{class:"form-label fw-semibold text-dark"},[t("i",{class:"fas fa-credit-card me-2 text-muted"}),h("Payment Type ")],-1)),A(t("select",{"onUpdate:modelValue":a=>s.paymentType=a,class:"form-select"},[e[16]||(e[16]=t("option",{value:""},"All",-1)),(o(!0),d(F,null,V(R.value.paymentTypeOptions,a=>(o(),d("option",{key:a.value,value:a.value},n(a.label),9,je))),128))],8,Me),[[ut,s.paymentType]])])]),_:1},8,["modelValue","sort-options","status-options","onApply","onClear"]),e[18]||(e[18]=t("div",{class:"dropdown"},[t("button",{class:"btn btn-outline-secondary rounded-pill px-4 dropdown-toggle","data-bs-toggle":"dropdown"}," Export "),t("ul",{class:"dropdown-menu dropdown-menu-end shadow rounded-4 py-2"},[t("li",null,[t("a",{class:"dropdown-item py-2",href:"javascript:void(0)"},"Export as PDF")]),t("li",null,[t("a",{class:"dropdown-item py-2",href:"javascript:void(0)"},"Export as Excel")])])],-1))])]),t("div",Pe,[t("table",Se,[e[22]||(e[22]=t("thead",{class:"border-top small text-muted"},[t("tr",null,[t("th",{style:{width:"70px"}},"S. #"),t("th",null,"Table No."),t("th",null,"Order Type"),t("th",null,"Date"),t("th",null,"Time"),t("th",null,"Customer"),t("th",null,"Payment Type"),t("th",null,"Actual Price"),t("th",null,"Promo Discount"),t("th",null,"Sales Discount"),t("th",null,"Approved Discount"),t("th",null,"Tax"),t("th",null,"Service Charges"),t("th",null,"Delivery Charges"),t("th",null,"Promo Name"),t("th",null,"Total"),t("th",null,"Status"),t("th",{class:"text-center"},"Actions")])],-1)),t("tbody",null,[(o(!0),d(F,null,V(mt.value,(s,a)=>(o(),d("tr",{key:s.id},[t("td",null,n(a+1),1),t("td",null,n(s.type?.table_number??"-"),1),t("td",null,n(s.type?.order_type??"-"),1),t("td",null,n(m(I)(s.created_at)),1),t("td",null,n(Z(s.created_at)),1),t("td",null,n(s.customer_name??"-"),1),t("td",null,[t("span",{class:"cursor-pointer",onClick:i=>ft(s.payment)},n(s.payment?.payment_type??"-"),9,Ae)]),t("td",null,n(m(p)(s.sub_total??0)),1),t("td",Le," -"+n(m(p)(s?.promo?.[0]?.discount_amount??0)),1),t("td",Fe," -"+n(m(p)(s.sales_discount??0)),1),t("td",Ie," -"+n(m(p)(s?.approved_discounts??0)),1),t("td",null,n(s.tax??"-"),1),t("td",null,n(s.service_charges??"-"),1),t("td",null,n(s.delivery_charges??"-"),1),t("td",null,n(s.promo?.[0]?.promo_name||"-"),1),t("td",null,n(m(p)(s.total_amount)),1),t("td",null,[t("span",{class:Ft(["badge px-2 py-2 rounded-pill",{"bg-danger":s?.status==="cancelled","bg-warning text-dark":s?.status==="refunded","bg-success":s?.status==="paid"}])},n(s?.status.charAt(0).toUpperCase()+s?.status.slice(1)),3)]),t("td",Re,[t("div",Be,[t("button",{onClick:i=>wt(s),title:"View Details",class:"p-2 rounded-full text-primary hover:bg-gray-100"},[P(m(Nt),{class:"w-4 h-4"})],8,Ne),s.status!=="cancelled"&&s.status!=="refunded"?(o(),d("button",{key:0,onClick:i=>_t(s),title:"Cancel Order",disabled:T.value===s.id,class:"p-2 rounded-full text-danger hover:bg-gray-100"},[P(m(Et),{class:"w-4 h-4"})],8,Ee)):v("",!0),tt(s)?(o(),d("button",{key:1,onClick:i=>et(s),title:"Refund Payment",disabled:x.value===s.id,class:"p-2 rounded-full text-warning hover:bg-gray-100"},[...e[20]||(e[20]=[t("i",{class:"bi bi-arrow-counterclockwise",style:{"font-size":"1rem"}},null,-1)])],8,Ve)):v("",!0)])])]))),128)),Q.value.length===0?(o(),d("tr",qe,[...e[21]||(e[21]=[t("td",{colspan:"18",class:"text-center text-muted py-4"}," No orders found. ",-1)])])):v("",!0)])])])])]),t("div",ze,[t("div",Ue,[t("div",Ge,[e[32]||(e[32]=t("div",{class:"modal-header border-0 text-black"},[t("h6",{class:"modal-title fw-semibold"},[t("i",{class:"bi bi-credit-card me-2"}),h(" Payment Details ")]),t("button",{class:"absolute top-2 right-2 p-2 rounded-full hover:bg-gray-100 transition transform hover:scale-110","data-bs-dismiss":"modal","aria-label":"Close",title:"Close"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-danger",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})])])],-1)),t("div",He,[t("div",We,[t("div",Ke,[t("div",Qe,[t("div",Ye,[e[23]||(e[23]=t("span",{class:"label"},"Payment Type",-1)),t("span",Ze,n(f.value?.payment_type??"-"),1)])]),t("div",Xe,[t("div",Je,[e[24]||(e[24]=t("span",{class:"label"},"Amount Received",-1)),t("span",ts,n(U(f.value?.amount_received)),1)])]),f.value?.payment_type==="Split"?(o(),d("div",es,[t("div",ss,[e[25]||(e[25]=t("span",{class:"label"},"Cash Amount",-1)),t("span",ls,n(U(f.value?.cash_amount)),1)])])):v("",!0),f.value?.payment_type==="Split"?(o(),d("div",as,[t("div",ns,[e[26]||(e[26]=t("span",{class:"label"},"Card Amount",-1)),t("span",os,n(U(f.value?.card_amount)),1)])])):v("",!0),t("div",ds,[t("div",rs,[e[27]||(e[27]=t("span",{class:"label"},"Payment Date",-1)),t("span",is,n(Y(f.value?.payment_date)),1)])]),f.value?.brand?(o(),d("div",us,[t("div",cs,[e[28]||(e[28]=t("span",{class:"label"},"Card Brand",-1)),t("span",ms,n(f.value.brand),1)])])):v("",!0),f.value?.last_digits?(o(),d("div",ps,[t("div",vs,[e[29]||(e[29]=t("span",{class:"label"},"Last 4 Digits",-1)),t("span",bs,"**** **** **** "+n(f.value.last_digits),1)])])):v("",!0),f.value?.exp_month?(o(),d("div",ys,[t("div",fs,[e[30]||(e[30]=t("span",{class:"label"},"Expiry",-1)),t("span",ws,n(f.value.exp_month)+"/"+n(f.value.exp_year),1)])])):v("",!0),f.value?.currency_code?(o(),d("div",gs,[t("div",hs,[e[31]||(e[31]=t("span",{class:"label"},"Currency",-1)),t("span",_s,n(f.value.currency_code),1)])])):v("",!0)])])])])])]),t("div",xs,[t("div",Cs,[t("div",ks,[t("div",$s,[t("div",Ts,[e[33]||(e[33]=t("span",{class:"badge bg-gradient rounded-circle p-3 shadow-sm",style:{background:`linear-gradient(
                                            135deg,
                                            #4e73df,
                                            #224abe
                                        )`}},[t("i",{class:"bi bi-receipt fs-5 text-black"})],-1)),t("div",Ds,[t("h5",Os," Order #"+n(u.value?.id),1),t("small",Ms," Customer: "+n(u.value?.customer_name??"—"),1)])]),e[34]||(e[34]=t("button",{class:"absolute top-2 right-2 p-2 rounded-full hover:bg-gray-100 transition transform hover:scale-110","data-bs-dismiss":"modal","aria-label":"Close",title:"Close"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})])],-1))]),t("div",js,[u.value?(o(),d("div",Ps,[t("div",Ss,[e[37]||(e[37]=t("h6",{class:"fw-bold mb-3 text-primary"}," Order Details ",-1)),t("div",As,[t("div",Ls,[e[35]||(e[35]=t("span",{class:"fw-semibold text-dark"},"Order Type:",-1)),h(" "+n(u.value?.type?.order_type??"—"),1)]),t("div",Fs,[e[36]||(e[36]=t("span",{class:"fw-semibold text-dark"},"Date:",-1)),h(" "+n(m(I)(u.value?.created_at)),1)])])]),e[69]||(e[69]=t("h6",{class:"fw-bold mb-3 text-primary"}," Order Items ",-1)),t("div",Is,[t("table",Rs,[e[68]||(e[68]=t("thead",{class:"bg-light text-muted small"},[t("tr",null,[t("th",{class:"px-3"},"#"),t("th",null,"Item"),t("th",null,"Qty"),t("th",null,"Actual Price"),t("th",null,"="),t("th",null,"Promo Name"),t("th",null,"Total Price")])],-1)),t("tbody",null,[(o(!0),d(F,null,V(u.value.items??[],(s,a)=>(o(),d("tr",{key:s.id},[t("td",Bs,n(a+1),1),t("td",null,n(s.title),1),t("td",null,n(s.quantity),1),t("td",Ns,n(m(p)(s.price)),1),e[38]||(e[38]=t("td",null,null,-1)),t("td",null,n(u.value.promo[0]?.promo_name||"-"),1),t("td",Es,n(m(p)(s.price)),1)]))),128)),u.value.promo?(o(),d("tr",Vs,[e[39]||(e[39]=t("td",null,null,-1)),e[40]||(e[40]=t("td",null,null,-1)),e[41]||(e[41]=t("td",null,null,-1)),e[42]||(e[42]=t("td",{colspan:"3",class:"text-end text-muted text-adjusting"},"Promo Discount",-1)),t("td",qs," -"+n(m(p)(u.value.promo[0]?.discount_amount??0)),1)])):v("",!0),u.value.tax?(o(),d("tr",zs,[e[43]||(e[43]=t("td",null,null,-1)),e[44]||(e[44]=t("td",null,null,-1)),e[45]||(e[45]=t("td",null,null,-1)),e[46]||(e[46]=t("td",{colspan:"3",class:"text-end text-muted text-adjusting"},"Tax",-1)),t("td",Us," +"+n(m(p)(u.value.tax??0)),1)])):v("",!0),u.value.service_charges?(o(),d("tr",Gs,[e[47]||(e[47]=t("td",null,null,-1)),e[48]||(e[48]=t("td",null,null,-1)),e[49]||(e[49]=t("td",null,null,-1)),e[50]||(e[50]=t("td",{colspan:"3",class:"text-end text-muted text-adjusting"},"Service Charges",-1)),t("td",Hs," +"+n(m(p)(u.value.service_charges??0)),1)])):v("",!0),u.value.delivery_charges?(o(),d("tr",Ws,[e[51]||(e[51]=t("td",null,null,-1)),e[52]||(e[52]=t("td",null,null,-1)),e[53]||(e[53]=t("td",null,null,-1)),e[54]||(e[54]=t("td",{colspan:"3",class:"text-end text-muted text-adjusting"},"Delivery Charges",-1)),t("td",Ks," +"+n(m(p)(u.value.delivery_charges??0)),1)])):v("",!0),u.value.sales_discount?(o(),d("tr",Qs,[e[55]||(e[55]=t("td",null,null,-1)),e[56]||(e[56]=t("td",null,null,-1)),e[57]||(e[57]=t("td",null,null,-1)),e[58]||(e[58]=t("td",{colspan:"3",class:"text-end text-muted text-adjusting"},"Sales Discount",-1)),t("td",Ys," +"+n(m(p)(u.value.sales_discount??0)),1)])):v("",!0),u.value.approved_discounts?(o(),d("tr",Zs,[e[59]||(e[59]=t("td",null,null,-1)),e[60]||(e[60]=t("td",null,null,-1)),e[61]||(e[61]=t("td",null,null,-1)),e[62]||(e[62]=t("td",{colspan:"3",class:"text-end text-muted text-adjusting"},"Approved Discounts",-1)),t("td",Xs," +"+n(m(p)(u.value.approved_discounts??0)),1)])):v("",!0),t("tr",Js,[e[63]||(e[63]=t("td",null,null,-1)),e[64]||(e[64]=t("td",null,null,-1)),e[65]||(e[65]=t("td",null,null,-1)),e[66]||(e[66]=t("td",{colspan:"3",class:"text-end text-muted text-adjusting"},"Grand Total ",-1)),t("td",tl,n(m(p)(u.value.total_amount)),1)]),(u.value.items??[]).length===0?(o(),d("tr",el,[...e[67]||(e[67]=[t("td",{colspan:"7",class:"text-center text-muted py-4"}," No items found ",-1)])])):v("",!0)])])])])):v("",!0)]),t("div",sl,[e[71]||(e[71]=t("button",{class:"btn btn-secondary px-2 py-2","data-bs-dismiss":"modal"}," Close ",-1)),X.value.length>0?(o(),d("button",{key:0,class:"btn btn-primary shadow-sm rounded-pill px-4 py-2",onClick:e[3]||(e[3]=s=>gt(u.value))},[...e[70]||(e[70]=[t("i",{class:"bi bi-printer me-1"},null,-1),h(" Print Receipt ",-1)])])):v("",!0)])])])])]),t("div",ll,[t("div",al,[t("div",nl,[t("div",{class:"modal-header border-0"},[e[74]||(e[74]=t("h5",{class:"modal-title fw-bold"},[t("i",{class:"bi bi-arrow-counterclockwise text-warning me-2"}),h(" Process Refund ")],-1)),t("button",{onClick:st,class:"absolute top-2 right-2 p-2 rounded-full hover:bg-gray-100 transition transform hover:scale-110","data-bs-dismiss":"modal","aria-label":"Close",title:"Close"},[...e[73]||(e[73]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),t("div",ol,[e[85]||(e[85]=t("div",{class:"alert alert-warning d-flex align-items-start gap-2"},[t("i",{class:"bi bi-exclamation-triangle-fill mt-1"}),t("div",null,[t("strong",null,"Important:"),h(" This will process a refund to the customer's card. This action cannot be undone. ")])],-1)),t("div",dl,[e[81]||(e[81]=t("label",{class:"form-label fw-semibold"},"Order Details",-1)),t("div",rl,[t("div",il,[e[75]||(e[75]=t("span",{class:"text-muted"},"Order #:",-1)),t("span",ul,n(r.value?.id),1)]),t("div",cl,[e[76]||(e[76]=t("span",{class:"text-muted"},"Customer:",-1)),t("span",ml,n(r.value?.customer_name||"Walk In"),1)]),t("div",pl,[e[77]||(e[77]=t("span",{class:"text-muted"},"Total Amount:",-1)),t("span",vl,n(m(p)(r.value?.total_amount)),1)]),t("div",bl,[e[78]||(e[78]=t("span",{class:"text-muted"},"Payment Type:",-1)),t("span",yl,n(r.value?.payment?.payment_type),1)]),r.value?.payment?.payment_type?.toLowerCase()==="split"?(o(),d("div",fl,[e[79]||(e[79]=t("span",{class:"text-muted"},"Card Amount:",-1)),t("span",wl,n(m(p)(r.value?.payment?.card_amount)),1)])):v("",!0),r.value?.payment?.brand?(o(),d("div",gl,[e[80]||(e[80]=t("span",{class:"text-muted"},"Card:",-1)),t("span",hl,n(r.value.payment.brand)+" •••• "+n(r.value.payment.last_digits),1)])):v("",!0)])]),t("div",_l,[e[83]||(e[83]=t("label",{class:"form-label fw-semibold"},"Refund Amount",-1)),t("div",xl,[e[82]||(e[82]=t("span",{class:"input-group-text"},"£",-1)),A(t("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>C.value=s),type:"number",class:"form-control",max:r.value?.payment?.card_amount||r.value?.total_amount,step:"0.01",min:"0.01",required:""},null,8,Cl),[[q,C.value,void 0,{number:!0}]])]),t("small",kl," Maximum: "+n(m(p)(r.value?.payment?.card_amount||r.value?.total_amount)),1)]),t("div",$l,[e[84]||(e[84]=t("label",{class:"form-label fw-semibold"},"Refund Reason (Optional)",-1)),A(t("textarea",{"onUpdate:modelValue":e[5]||(e[5]=s=>k.value=s),class:"form-control",rows:"3",placeholder:"Enter reason for refund...",maxlength:"500"},null,512),[[q,k.value]]),t("small",Tl,n(k.value.length)+"/500 characters",1)])]),t("div",Dl,[t("button",{type:"button",class:"btn btn-secondary px-2 py-2",onClick:st,disabled:x.value!==null}," Cancel ",8,Ol),t("button",{type:"button",class:"btn btn-primary px-2 py-2",onClick:ht,disabled:x.value!==null||!C.value||C.value<=0},[x.value?(o(),d("span",jl,[...e[86]||(e[86]=[t("span",{class:"spinner-border spinner-border-sm me-2"},null,-1),h(" Processing... ",-1)])])):(o(),d("span",Pl,[...e[87]||(e[87]=[t("i",{class:"bi bi-arrow-counterclockwise me-1"},null,-1),h(" Process Refund ",-1)])]))],8,Ml)])])])]),P(ae,{show:G.value,order:$.value,loading:T.value===$.value?.id,onConfirm:xt,onCancel:lt},null,8,["show","order","loading"])]),_:1})],64))}},Gl=ct(Sl,[["__scopeId","data-v-5a0f06ce"]]);export{Gl as default};
