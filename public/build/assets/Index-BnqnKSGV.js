import{_ as I,r as u,o as N,n as O,c as q,a as w,b as g,d as j,e as x,f as l,u as k,h as M,m as R,g as _,v as B,j as C,q as z,s as r}from"./app-DR8KNMKR.js";import{_ as U}from"./Master-CDAihGCm.js";import{E as X,a as A,X as Q,u as f,w as G}from"./xlsx-pGpJNtJ_.js";import H from"./StockInLogs-Bk8V4v0S.js";import K from"./StockOutLogs-pxFaGkMz.js";import{s as W}from"./index-CTSRqQAW.js";import"./index-CLKGagE0.js";import"./createLucideIcon-B2WAtkKL.js";import"./PasswordVerificationModal-CwsPs3Zr.js";import"./index-YIqX59W4.js";import"./index-D1-aYu0b.js";import"./sun-g0Zz1s9o.js";import"./useFormatters-DMXCh6bx.js";import"./pencil-CB6eqCn5.js";import"./eye-BCYcq801.js";import"./index-D-wNi1xB.js";import"./index-Dwzhpvva.js";import"./index-BOMKKwwB.js";import"./index-nqZoyhBR.js";const Y={class:"page-wrapper"},J={class:"card border-0 shadow-lg rounded-4"},Z={class:"card-body p-4"},ee={class:"d-flex align-items-center justify-content-between mb-3"},te={class:"d-flex gap-2 align-items-center"},oe={class:"search-wrap"},ae={key:1,class:"form-control search-input",placeholder:"Search",disabled:"",type:"text"},ne={class:"tabs-underline mb-2"},le={__name:"Index",setup(re){const s=u([]),i=u(""),b=u(Date.now()),y=`search-${Math.random().toString(36).substr(2,9)}`,S=u(!1),d=u("stockin"),v=u(null),$=[{label:"PDF",value:"pdf"},{label:"Excel",value:"excel"},{label:"CSV",value:"csv"}],P=t=>{t.value&&(D(t.value),v.value=null)},h=async()=>{try{const{data:t}=await z.get("stock_entries/stock-logs");s.value=t}catch(t){r.error("Failed to fetch logs",t)}};N(async()=>{i.value="",b.value=Date.now(),await O(),setTimeout(()=>{S.value=!0;const t=document.getElementById(y);t&&(t.value="",i.value="")},100),h()});const T=q(()=>{const t=i.value.trim().toLowerCase();return t?s.value.filter(e=>[e.itemName,e.category?.name||e.category||"",e.operationType,e.type,String(e.quantity),String(e.unitPrice),String(e.totalPrice),e.expiryDate??"",e.dateTime??""].join(" ").toLowerCase().includes(t)):s.value}),D=t=>{if(!s.value||s.value.length===0){r.error("No Allergies data to download");return}const e=i.value.trim()?T.value:s.value;if(e.length===0){r.error("No Logs Moment found to download");return}try{t==="pdf"?L(e):t==="excel"?F(e):t==="csv"?V(e):r.error("Invalid download type")}catch(n){console.error("Download failed:",n),r.error(`Download failed: ${n.message}`)}},V=t=>{try{const e=["Category","Supplier","Product","Quantity","Price","Value","Operation Type","Stock Type"],n=t.map(o=>[`"${(o.category?.name||o.category||"").toString().replace(/"/g,'""')}"`,`"${(o.supplier||"").toString().replace(/"/g,'""')}"`,`"${(o.itemName||"").toString().replace(/"/g,'""')}"`,`"${o.quantity??""}"`,`"${o.unitPrice??""}"`,`"${o.totalPrice??""}"`,`"${(o.operationType||"").toString().replace(/"/g,'""')}"`,`"${(o.type||"").toString().replace(/"/g,'""')}"`]),c=[e.join(","),...n.map(o=>o.join(","))].join(`
`),p=new Blob([c],{type:"text/csv;charset=utf-8;"}),m=URL.createObjectURL(p),a=document.createElement("a");a.setAttribute("href",m),a.setAttribute("download",`logs_moment_${new Date().toISOString().split("T")[0]}.csv`),document.body.appendChild(a),a.click(),document.body.removeChild(a),r.success("CSV downloaded successfully")}catch(e){console.error("CSV generation error:",e),r.error(`CSV generation failed: ${e.message}`,{autoClose:5e3})}},L=t=>{try{const e=new X("p","mm","a4");e.setFontSize(20),e.setFont("helvetica","bold"),e.text("Logs Moment Report",70,20),e.setFontSize(10),e.setFont("helvetica","normal");const n=new Date().toLocaleString();e.text(`Generated on: ${n}`,70,28),e.text(`Total Logs: ${t.length}`,70,34);const c=["Category","Supplier","Product","Quantity","Value","Price","Operation Type","Stock Type"],p=t.map(a=>[a.category?.name||a.category||"",a.supplier||"",a.itemName||"",a.quantity??"",a.unitPrice??"",a.totalPrice??"",a.operationType||"",a.type||""]);A(e,{head:[c],body:p,startY:40,styles:{fontSize:8,cellPadding:2,halign:"left",lineColor:[0,0,0],lineWidth:.1},headStyles:{fillColor:[41,128,185],textColor:255,fontStyle:"bold"},alternateRowStyles:{fillColor:[240,240,240]},margin:{left:14,right:14},didDrawPage:a=>{const o=e.internal.getNumberOfPages(),E=e.internal.pageSize.height;e.setFontSize(8),e.text(`Page ${a.pageNumber} of ${o}`,a.settings.margin.left,E-10)}});const m=`logs_moment_${new Date().toISOString().split("T")[0]}.pdf`;e.save(m),r.success("PDF downloaded successfully")}catch(e){console.error("PDF generation error:",e),r.error(`PDF generation failed: ${e.message}`,{autoClose:5e3})}},F=t=>{try{if(typeof Q>"u")throw new Error("XLSX library is not loaded");const e=t.map(o=>({Category:o.category?.name||o.category||"",Supplier:o.supplier||"",Product:o.itemName||"",Quantity:o.quantity??"",Price:o.unitPrice??"",Value:o.totalPrice??"","Operation Type":o.operationType||"","Stock Type":o.type||""})),n=f.book_new(),c=f.json_to_sheet(e);c["!cols"]=[{wch:20},{wch:20},{wch:25},{wch:10},{wch:15},{wch:15},{wch:20},{wch:20}],f.book_append_sheet(n,c,"Logs Moments");const p=[{Info:"Generated On",Value:new Date().toLocaleString()},{Info:"Total Records",Value:t.length},{Info:"Exported By",Value:"Logs Management System"}],m=f.json_to_sheet(p);f.book_append_sheet(n,m,"Report Info");const a=`logs_moment_${new Date().toISOString().split("T")[0]}.xlsx`;G(n,a),r.success("Excel file downloaded successfully ",{autoClose:2500})}catch(e){console.error("Excel generation error:",e),r.error(`Excel generation failed: ${e.message}`,{autoClose:5e3})}};return(t,e)=>(g(),w(U,null,{default:j(()=>[x(k(M),{title:"Stock Logs"}),l("div",Y,[l("div",J,[l("div",Z,[l("div",ee,[e[7]||(e[7]=l("h4",{class:"mb-0"},"Stock Moment Logs",-1)),l("div",te,[l("div",oe,[e[5]||(e[5]=l("i",{class:"bi bi-search"},null,-1)),e[6]||(e[6]=l("input",{type:"email",name:"email",autocomplete:"email",style:{position:"absolute",left:"-9999px",width:"1px",height:"1px"},tabindex:"-1","aria-hidden":"true"},null,-1)),S.value?R((g(),_("input",{id:y,"onUpdate:modelValue":e[0]||(e[0]=n=>i.value=n),key:b.value,class:"form-control search-input",placeholder:"Search",type:"search",autocomplete:"new-password",name:y,role:"presentation",onFocus:e[1]||(e[1]=(...n)=>t.handleFocus&&t.handleFocus(...n))},null,32)),[[B,i.value]]):(g(),_("input",ae))]),x(k(W),{modelValue:v.value,"onUpdate:modelValue":e[2]||(e[2]=n=>v.value=n),options:$,optionLabel:"label",optionValue:"value",placeholder:"Export",class:"export-dropdown",onChange:P},null,8,["modelValue"])])]),l("div",ne,[l("button",{class:C(["tab-link fw-semibold",{active:d.value==="stockin"}]),onClick:e[3]||(e[3]=n=>d.value="stockin")}," Stock In ",2),l("button",{class:C(["tab-link fw-semibold",{active:d.value==="stockout"}]),onClick:e[4]||(e[4]=n=>d.value="stockout")}," Stock Out ",2)]),e[8]||(e[8]=l("div",{class:"border-bottom mb-3"},null,-1)),d.value==="stockin"?(g(),w(H,{key:0,logs:s.value,q:i.value,onUpdated:h},null,8,["logs","q"])):(g(),w(K,{key:1,logs:s.value,q:i.value,onUpdated:h},null,8,["logs","q"]))])])])]),_:1}))}},$e=I(le,[["__scopeId","data-v-797e4950"]]);export{$e as default};
