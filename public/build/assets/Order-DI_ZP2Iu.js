import{_ as pe,r as m,w as ve,a as Ge,b as d,d as ee,g as r,l as v,f as e,t as a,m as A,v as Y,p as T,V as Xe,o as ce,n as We,c as V,e as F,u as y,h as He,F as I,i as K,T as me,j as Ke,P as Ye,s as x}from"./app-BQcLyXae.js";import{_ as Qe}from"./Master-CqVL6ONQ.js";import{u as Ze}from"./useFormatters-gZqjEMKN.js";import{F as Je}from"./FilterModal-DeIcJooP.js";import{s as et}from"./index-CTconj2N.js";import{E as tt,a as st,X as lt,u as z,w as at}from"./xlsx-BYTrw9Ws.js";import{E as ot}from"./eye-6HvzY3rR.js";import{C as nt}from"./circle-x-BBd6AacI.js";import"./index-ChDEJC2l.js";import"./createLucideIcon-Coc_9-2_.js";import"./index-BYOzUaWA.js";import"./index-vdhn3Fjw.js";import"./sun-BNSuMpoO.js";import"./index-BZw_b2Hb.js";import"./index-DGPcsmUV.js";import"./index-BStk-RuA.js";const dt={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50"},rt={class:"bg-white rounded-xl shadow-xl w-full max-w-md p-6 animate-drop-in relative"},it={class:"text-center text-lg font-medium text-gray-800 mb-2"},ut={class:"bg-gray-50 rounded-lg p-4 mb-4 space-y-2"},ct={class:"flex justify-between text-sm"},mt={class:"font-medium text-gray-800"},pt={class:"flex justify-between text-sm"},vt={class:"font-medium text-gray-800"},bt={class:"flex justify-between text-sm"},yt={class:"font-medium text-gray-800"},ft={class:"mb-4"},gt={class:"flex justify-center gap-3"},ht=["disabled"],wt={key:0,class:"spinner-border spinner-border-sm",role:"status"},xt=["disabled"],_t={__name:"OrderCancellationModal",props:{show:{type:Boolean,default:!1},order:{type:Object,default:null},loading:{type:Boolean,default:!1}},emits:["confirm","cancel"],setup(k,{emit:f}){const q=k,P=f,$=m("");ve(()=>q.show,g=>{g||($.value="")});const S=()=>{P("confirm",$.value||"Cancelled by admin from orders page")},O=()=>{P("cancel")},u=g=>new Intl.NumberFormat("en-GB",{style:"currency",currency:"GBP"}).format(g||0);return(g,b)=>(d(),Ge(Xe,{name:"fade-slide"},{default:ee(()=>[k.show?(d(),r("div",dt,[e("div",rt,[e("button",{class:"absolute top-2 right-2 p-2 rounded-full hover:bg-gray-100 transition transform hover:scale-110",onClick:O,"data-bs-dismiss":"modal","aria-label":"Close",title:"Close"},[...b[1]||(b[1]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)])]),b[6]||(b[6]=e("div",{class:"flex justify-center mb-4"},[e("div",{class:"bg-red-100 p-3 rounded-full"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-8 h-8 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})])])],-1)),e("h3",it," Cancel Order #"+a(k.order?.id)+"? ",1),b[7]||(b[7]=e("p",{class:"text-center text-sm text-gray-500 mb-4"}," This action will cancel the order and cannot be undone. ",-1)),e("div",ut,[e("div",ct,[b[2]||(b[2]=e("span",{class:"text-gray-600"},"Customer:",-1)),e("span",mt,a(k.order?.customer_name||"Walk In"),1)]),e("div",pt,[b[3]||(b[3]=e("span",{class:"text-gray-600"},"Total Amount:",-1)),e("span",vt,a(u(k.order?.total_amount)),1)]),e("div",bt,[b[4]||(b[4]=e("span",{class:"text-gray-600"},"Payment Type:",-1)),e("span",yt,a(k.order?.payment?.payment_type||"N/A"),1)])]),e("div",ft,[b[5]||(b[5]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Reason for Cancellation (Optional) ",-1)),A(e("textarea",{"onUpdate:modelValue":b[0]||(b[0]=R=>$.value=R),class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-1 focus:ring-white focus:border-transparent resize-none",rows:"3",placeholder:"Enter reason for cancelling this order..."},null,512),[[Y,$.value]])]),e("div",gt,[e("button",{onClick:S,disabled:k.loading,class:"btn btn-danger d-flex align-items-center gap-2 px-4 py-2 rounded-pill text-white"},[k.loading?(d(),r("span",wt)):v("",!0),T(" "+a(k.loading?"Cancelling...":"Cancel Order"),1)],8,ht),e("button",{onClick:O,disabled:k.loading,class:"btn btn-secondary d-flex align-items-center gap-2 px-4 py-2 rounded-pill text-white"}," Keep Order ",8,xt)])])])):v("",!0)]),_:1}))}},Ct=pe(_t,[["__scopeId","data-v-828b9886"]]),kt={class:"page-wrapper"},$t={class:"row g-3"},Tt={class:"col-md-6 col-xl-4"},St={class:"card border-0 shadow-sm rounded-4"},Ot={class:"card-body d-flex align-items-center justify-content-between"},Dt={class:"mb-0 fw-bold"},Mt={class:"col-md-6 col-xl-4"},Ft={class:"card border-0 shadow-sm rounded-4"},Pt={class:"card-body d-flex align-items-center justify-content-between"},jt={class:"mb-0 fw-bold"},Nt={class:"col-md-6 col-xl-4"},It={class:"card border-0 shadow-sm rounded-4"},At={class:"card-body d-flex align-items-center justify-content-between"},Rt={class:"mb-0 fw-bold"},Et={class:"col-md-6 col-xl-3"},Lt={class:"card border-0 shadow-sm rounded-4"},Bt={class:"card-body d-flex align-items-center justify-content-between"},Vt={class:"mb-0 fw-bold"},zt={class:"card border-0 shadow-lg rounded-4 mt-0"},qt={class:"card-body"},Ut={class:"d-flex flex-wrap gap-2 justify-content-between align-items-center mb-3"},Gt={class:"d-flex flex-wrap gap-2 align-items-center"},Xt={class:"search-wrap"},Wt={key:1,class:"form-control search-input",placeholder:"Search",disabled:"",type:"text"},Ht={class:"col-md-6"},Kt=["onUpdate:modelValue"],Yt=["value"],Qt={class:"col-md-6 mt-3"},Zt=["onUpdate:modelValue"],Jt=["value"],es={class:"table-responsive"},ts={class:"table table-hover align-middle mb-0"},ss={key:0},ls=["onClick"],as={style:{"font-size":"14px"}},os={class:"text-muted small"},ns={class:"text-left"},ds={class:"d-flex gap-2 justify-content-center align-items-center"},rs=["onClick"],is=["onClick","disabled"],us=["onClick","disabled"],cs={key:0},ms={key:0,class:"mt-4 d-flex justify-content-between align-items-center"},ps={class:"text-muted small"},vs={class:"modal fade",id:"paymentDetailsModal",tabindex:"-1","aria-hidden":"true"},bs={class:"modal-dialog modal-md modal-dialog-centered"},ys={class:"modal-content border-0 shadow-lg rounded-4 overflow-hidden"},fs={class:"modal-body p-4"},gs={class:"payment-info"},hs={class:"row g-3"},ws={class:"col-6"},xs={class:"info-card"},_s={class:"value"},Cs={class:"col-6"},ks={class:"info-card"},$s={class:"value"},Ts={key:0,class:"col-6"},Ss={class:"info-card"},Os={class:"value"},Ds={key:1,class:"col-6"},Ms={class:"info-card"},Fs={class:"value"},Ps={class:"col-6"},js={class:"info-card"},Ns={class:"value"},Is={key:2,class:"col-6"},As={class:"info-card"},Rs={class:"value text-capitalize"},Es={key:3,class:"col-6"},Ls={class:"info-card"},Bs={class:"value"},Vs={key:4,class:"col-6"},zs={class:"info-card"},qs={class:"value"},Us={key:5,class:"col-6"},Gs={class:"info-card"},Xs={class:"value"},Ws={class:"modal fade",id:"orderDetailsModal",tabindex:"-1","aria-hidden":"true"},Hs={class:"modal-dialog modal-lg modal-dialog-centered"},Ks={class:"modal-content rounded-4 shadow border-0"},Ys={class:"modal-header bg-white border-0 position-relative px-4 pt-4"},Qs={class:"d-flex align-items-center gap-3"},Zs={class:"d-flex flex-column"},Js={class:"modal-title fw-bold mb-0"},el={class:"text-muted"},tl={class:"modal-body bg-light px-4 pb-4"},sl={key:0,class:"rounded-3 bg-white shadow-sm p-4"},ll={class:"mb-4"},al={class:"row text-muted small"},ol={class:"col-md-4 mb-2"},nl={class:"col-md-4 mb-2"},dl={class:"table-responsive"},rl={class:"table align-middle table-striped table-hover border rounded-3 overflow-hidden shadow-sm"},il={class:"px-3"},ul={class:"fw-semibold"},cl={class:"fw-bold text-success"},ml={key:0,class:"no-border"},pl={class:"text-success fw-semibold",colspan:"3"},vl={key:1,class:"no-border"},bl={class:"text-success fw-semibold",colspan:"3"},yl={key:2,class:"no-border"},fl={class:"text-success fw-semibold",colspan:"3"},gl={key:3,class:"no-border"},hl={class:"text-success fw-semibold",colspan:"3"},wl={key:4,class:"no-border"},xl={class:"text-success fw-semibold",colspan:"3"},_l={key:5,class:"no-border"},Cl={class:"text-success fw-semibold",colspan:"3"},kl={class:"border-top-thick"},$l={class:"fw-bold text-success"},Tl={key:6},Sl={class:"modal-footer bg-white border-0 shadow-sm px-4 py-3"},Ol={class:"modal fade",id:"refundModal",tabindex:"-1","aria-hidden":"true"},Dl={class:"modal-dialog modal-dialog-centered"},Ml={class:"modal-content rounded-4 shadow border-0"},Fl={class:"modal-body"},Pl={class:"mb-3"},jl={class:"bg-light p-3 rounded-3"},Nl={class:"d-flex justify-content-between mb-2"},Il={class:"fw-semibold"},Al={class:"d-flex justify-content-between mb-2"},Rl={class:"fw-semibold"},El={class:"d-flex justify-content-between mb-2"},Ll={class:"fw-semibold"},Bl={class:"d-flex justify-content-between mb-2"},Vl={class:"fw-semibold text-capitalize"},zl={key:0,class:"d-flex justify-content-between mb-2"},ql={class:"fw-semibold text-success"},Ul={key:1,class:"d-flex justify-content-between"},Gl={class:"fw-semibold"},Xl={class:"mb-3"},Wl={class:"input-group"},Hl=["max"],Kl={class:"text-muted"},Yl={class:"mb-3"},Ql={class:"text-muted"},Zl={class:"modal-footer border-0"},Jl=["disabled"],ea=["disabled"],ta={key:0},sa={key:1},la={__name:"Order",setup(k){const{formatCurrencySymbol:f,dateFmt:q}=Ze(),P=m(null),$=m(null),S=m(0),O=m(""),u=m(null),g=m([]),b=m(!1),R=m(null),be=[{label:"PDF",value:"pdf"},{label:"Excel",value:"excel"},{label:"CSV",value:"csv"}],ye=s=>{s.value&&(Ne(s.value),R.value=null)},E=async(s=null)=>{b.value=!0;try{const t={q:j.value,page:s||_.value.current_page,per_page:_.value.per_page,sort_by:h.value.sortBy||"",order_type:h.value.orderType||"",payment_type:h.value.paymentType||"",status:h.value.status||"",price_min:h.value.priceMin||"",price_max:h.value.priceMax||"",date_from:h.value.dateFrom||"",date_to:h.value.dateTo||""};Object.keys(t).forEach(o=>{(t[o]===void 0||t[o]==="")&&delete t[o]});const l=await axios.get("/api/orders/all",{params:t});g.value=l.data.data||[],_.value={current_page:l.data.current_page,last_page:l.data.last_page,per_page:l.data.per_page,total:l.data.total,from:l.data.from,to:l.data.to,links:l.data.links}}catch(t){console.error("Error fetching orders:",t),x.error("Failed to load orders")}finally{b.value=!1}},fe=s=>{if(!s)return;const l=new URLSearchParams(s.split("?")[1]).get("page");l&&E(parseInt(l))};ce(async()=>{j.value="",te.value=Date.now(),await We(),setTimeout(()=>{se.value=!0;const t=document.getElementById(Q);t&&(t.value="",j.value="")},100),E();const s=document.getElementById("orderFilterModal");s&&s.addEventListener("hidden.bs.modal",()=>{L.value={sortBy:h.value.sortBy||"",orderType:h.value.orderType||"",paymentType:h.value.paymentType||"",status:h.value.status||"",priceMin:h.value.priceMin||null,priceMax:h.value.priceMax||null,dateFrom:h.value.dateFrom||"",dateTo:h.value.dateTo||""}})});const j=m(""),te=m(Date.now()),Q=`search-${Math.random().toString(36).substr(2,9)}`,se=m(!1),_=m({current_page:1,last_page:1,per_page:10,total:0,from:0,to:0,links:[]}),L=m({sortBy:"",orderType:"",paymentType:"",status:"",priceMin:null,priceMax:null,dateFrom:"",dateTo:""}),h=m({sortBy:"",orderType:"",paymentType:"",status:"",priceMin:null,priceMax:null,dateFrom:"",dateTo:""});m(["All","Dine In","Delivery","Takeaway"]),m(["All","Cash","Card","Split"]);const U=V(()=>({sortOptions:[{value:"date_desc",label:"Date: Newest First"},{value:"date_asc",label:"Date: Oldest First"},{value:"price_desc",label:"Price: High to Low"},{value:"price_asc",label:"Price: Low to High"},{value:"customer_asc",label:"Customer: A to Z"},{value:"customer_desc",label:"Customer: Z to A"}],orderTypeOptions:[{value:"Dine In",label:"Dine In"},{value:"Delivery",label:"Delivery"},{value:"Takeaway",label:"Takeaway"},{value:"Collection",label:"Collection"}],paymentTypeOptions:[{value:"Cash",label:"Cash"},{value:"Card",label:"Card"},{value:"Split",label:"Split"}],statusOptions:[{value:"paid",label:"Paid"},{value:"pending",label:"Pending"},{value:"cancelled",label:"Cancelled"}]})),ge=s=>{h.value={...L.value},_.value.current_page=1,E(1),bootstrap.Modal.getInstance(document.getElementById("orderFilterModal"))?.hide()},he=()=>{L.value={sortBy:"",orderType:"",paymentType:"",status:"",priceMin:null,priceMax:null,dateFrom:"",dateTo:""},h.value={sortBy:"",orderType:"",paymentType:"",status:"",priceMin:null,priceMax:null,dateFrom:"",dateTo:""},_.value.current_page=1,_.value.per_page=10,E(1)},we=V(()=>_.value.total||0),xe=V(()=>g.value.filter(s=>s.status==="paid").length),_e=V(()=>g.value.filter(s=>s.status==="cancelled").length),Ce=V(()=>g.value.reduce((s,t)=>s+(Number(t.total_amount)||0),0));function G(s){const t=new Date(s),l=t.getFullYear(),o=String(t.getMonth()+1).padStart(2,"0"),c=String(t.getDate()).padStart(2,"0");return`${l}-${o}-${c}`}function ke(s){const t=Date.now()-new Date(s).getTime(),l=Math.floor(t/6e4);if(l<60)return`${l} minute${l===1?"":"s"} ago`;const o=Math.floor(l/60);if(o<24)return`${o} hour${o===1?"":"s"} ago`;const c=Math.floor(o/24);return`${c} day${c===1?"":"s"} ago`}function Z(s){const t=Number(s??0);return`£${Number.isInteger(t)?t.toFixed(0):t.toFixed(1)}`}const $e=m(!1),w=m(null),p=m(null);function Te(s){w.value=s,$e.value=!0,new bootstrap.Modal(document.getElementById("paymentDetailsModal")).show()}const Se=s=>{p.value=s,new bootstrap.Modal(document.getElementById("orderDetailsModal")).show()};function Oe(s){const t=C=>`£${Number(C??0).toFixed(2)}`,l=C=>(C??"").toString(),o=s?.payment??{},c=(o.payment_type??s?.payment_method??"Cash").toLowerCase(),D=o.cash_amount??s?.cash_amount??s?.cash_received??0,i=o.card_amount??s?.card_amount??0,n=o.brand??s?.card_brand??"",N=o.last_digits??s?.last4??s?.last_digits??"";let X="";if(c==="split")X=`Payment: Split (Cash: ${t(D)}, Card: ${t(i)})`;else if(c==="card"||c==="stripe"){const C=n?` (${n})`:"",H=N?` •••• ${N}`:"";X=`Payment: Card${C}${H}`}else X=`Payment: ${l(s?.payment_method)||"Cash"}`;const Ee=s?.id??"N/A",Le=s?.type?.order_type??s?.order_type??"N/A",re=s?.type?.table_number??s?.table_number??null,Be=s?.customer_name||"Walk In",B=s?.created_at?new Date(s.created_at):new Date,Ve=`${B.getFullYear()}-${String(B.getMonth()+1).padStart(2,"0")}-${String(B.getDate()).padStart(2,"0")} ${String(B.getHours()).padStart(2,"0")}:${String(B.getMinutes()).padStart(2,"0")}`,ie=Array.isArray(s?.items)?s.items:[],ue=s?.sub_total??ie.reduce((C,H)=>C+Number(H.price??0)*Number(H.quantity??0),0),ze=s?.total_amount??ue,qe=ie.map(C=>`
    <div class="row">
      <span class="w-50 ellips">${l(C.title)}</span>
      <span class="w-20 right">x${Number(C.quantity??0)}</span>
      <span class="w-30 right">${t(C.price)}</span>
    </div>
  `).join(""),Ue=`
<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Receipt</title>
<style>
  :root { --w: 58mm; }
  html, body { margin:0; padding:0; }
  body { width: var(--w); font-family: monospace; font-size: 12px; line-height: 1.3; color:#000; }
  .center { text-align:center; }
  .right { text-align:right; }
  .row { display:flex; justify-content:space-between; gap:4px; }
  .w-50 { width:50%; } .w-20 { width:20%; } .w-30 { width:30%; }
  .ellips { white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
  hr { border:0; border-top:1px dashed #000; margin:4px 0; }
  h3 { margin:0 0 2px 0; font-size: 14px; }
  small { font-size:11px; }
  .mt-4 { margin-top:4px; }
  .mb-4 { margin-bottom:4px; }
  .bold { font-weight:bold; }
  @page { size: var(--w) auto; margin: 3mm; }
  @media print { body { -webkit-print-color-adjust: exact; print-color-adjust: exact; } }
</style>
</head>
<body>
  <div class="center">
    <h3>Goritmi</h3>
    <small>Order #${Ee}</small><br/>
    <small>${Ve}</small>
  </div>

  <hr/>
  <div><small>Customer: ${l(Be)}</small></div>
  <div><small>Order Type: ${l(Le)}${re?` | Table: ${l(re)}`:""}</small></div>
  <div><small>${X}</small></div>

  <hr/>
  <div class="row bold"><span class="w-50">Item</span><span class="w-20 right">Qty</span><span class="w-30 right">Price</span></div>
  ${qe}
  <hr/>

  <div class="row"><span>Subtotal:</span><span class="right">${t(ue)}</span></div>
  ${Number(s?.tax??0)?`<div class="row"><span>Tax:</span><span class="right">${t(s.tax)}</span></div>`:""}
  ${Number(s?.service_charges??0)?`<div class="row"><span>Service:</span><span class="right">${t(s.service_charges)}</span></div>`:""}
  ${Number(s?.delivery_charges??0)?`<div class="row"><span>Delivery:</span><span class="right">${t(s.delivery_charges)}</span></div>`:""}

  <div class="row bold mt-4"><span>Total:</span><span class="right">${t(ze)}</span></div>

  ${c==="cash"||!c?`<div class="row"><span>Cash Received:</span><span class="right">${t(s?.cash_received??o?.amount_received??0)}</span></div>
       <div class="row"><span>Change:</span><span class="right">${t(s?.change??0)}</span></div>`:""}

  <hr/>
  <div class="center">
    <small>Abdara Road, Peshawar</small><br/>
    <small>info@goritmi.com</small><br/>
    <small>Thank you for your visit!</small>
  </div>

<script>
  async function ready() {
    try { if (document.fonts && document.fonts.ready) { await document.fonts.ready; } } catch(e){}
    window.focus();
    const mq = window.matchMedia && window.matchMedia('print');
    if (mq && mq.addEventListener) {
      mq.addEventListener('change', function(e){ if(!e.matches) setTimeout(function(){ window.close(); }, 300); });
    } else if (mq && mq.addListener) { // older browsers
      mq.addListener(function(mql){ if(!mql.matches) setTimeout(function(){ window.close(); }, 300); });
    }
    window.onafterprint = function(){ setTimeout(function(){ window.close(); }, 300); };
    setTimeout(function(){ window.print(); }, 200);
  }
  if (document.readyState === 'complete') ready();
  else window.addEventListener('load', ready);
<\/script>
</body>
</html>
`,W=window.open("","","width=420,height=640");if(!W){console.error("Popup blocked or failed to open"),alert("Please allow popups for this site to print receipts");return}W.document.open(),W.document.write(Ue),W.document.close()}const le=m([]),ae=m(!1);ce(async()=>{ae.value=!0;try{const s=await axios.get("/api/printers");le.value=s.data.data.filter(t=>t.is_connected===!0||t.status==="OK").map(t=>({label:`${t.name}`,value:t.name,driver:t.driver,port:t.port}))}catch(s){console.error("Failed to fetch printers:",s)}finally{ae.value=!1}});const De=s=>{if(!s||!s.payment)return!1;const t=s.payment.payment_type?.toLowerCase(),l=s.status?.toLowerCase(),o=s.payment.refund_status?.toLowerCase();return(l==="paid"||l==="cancelled")&&(t==="card"||t==="split")&&(!o||o==="none")},Me=async s=>{if(!s)return;s.payment?.payment_type?.toLowerCase();const t=s.total_amount,l=s.payment?.card_amount||t;u.value=s,S.value=Number(l).toFixed(2),O.value="";const o=document.getElementById("refundModal");o&&new bootstrap.Modal(o).show()},Fe=async()=>{if(!u.value)return;const s=Number(S.value);if(s<=0){x.error("Refund amount must be greater than 0");return}const t=u.value.payment?.payment_type?.toLowerCase(),l=u.value.payment?.card_amount||u.value.total_amount;if(s>l){x.error(`Refund amount cannot exceed ${f(l)}`);return}$.value=u.value.id;try{const o=await axios.post(`/api/pos/orders/${u.value.id}/refund`,{amount:s,reason:O.value||"Refund requested by admin",payment_type:t});if(o.data.success){x.success(`Refund of ${f(s)} processed successfully`);const c=g.value.findIndex(i=>i.id===u.value.id);c!==-1&&(g.value[c]=o.data.order);const D=document.getElementById("refundModal");if(D){const i=bootstrap.Modal.getInstance(D);i&&i.hide()}u.value=null,S.value=0,O.value=""}}catch(o){console.error("Error processing refund:",o),x.error(o.response?.data?.message||"Failed to process refund")}finally{$.value=null}},oe=()=>{const s=document.getElementById("refundModal");if(s){const t=bootstrap.Modal.getInstance(s);t&&t.hide()}u.value=null,S.value=0,O.value=""},J=m(!1),M=m(null),Pe=s=>{s&&(M.value=s,J.value=!0)},ne=()=>{J.value=!1,M.value=null},je=async s=>{if(M.value){P.value=M.value.id;try{const t=await axios.post(`/api/pos/orders/${M.value.id}/cancel`,{reason:s});if(t.data.success){x.success("Order cancelled and stock restored successfully");const l=g.value.findIndex(o=>o.id===M.value.id);l!==-1&&(g.value[l]=t.data.order),ne()}}catch(t){console.error("Error cancelling order:",t),x.error(t.response?.data?.message||"Failed to cancel order")}finally{P.value=null}}};let de=null;ve(j,()=>{clearTimeout(de),de=setTimeout(()=>{_.value.current_page=1,E(1)},500)});const Ne=s=>{if(!g.value||g.value.length===0){x.error("No orders data to download");return}const t=j.value.trim()?filtered.value:g.value;if(t.length===0){x.error("No orders found to download");return}try{s==="pdf"?Ae(t):s==="excel"?Re(t):s==="csv"?Ie(t):x.error("Invalid download type")}catch(l){console.error("Download failed:",l),x.error(`Download failed: ${l.message}`)}},Ie=s=>{try{const t=["Order ID","Table No.","Order Type","Date","Customer","Payment Type","Sub Total","Promo Discount","Sales Discount","Approved Discount","Tax","Service Charges","Delivery Charges","Total Amount","Status","Promo Name"],l=s.map(n=>[`"${n.id||""}"`,`"${n.type?.table_number||"-"}"`,`"${n.type?.order_type||"-"}"`,`"${G(n.created_at)}"`,`"${n.customer_name||"-"}"`,`"${n.payment?.payment_type||"-"}"`,`"${n.sub_total||0}"`,`"${n.promo?.[0]?.discount_amount||0}"`,`"${n.sales_discount||0}"`,`"${n.approved_discounts||0}"`,`"${n.tax||0}"`,`"${n.service_charges||0}"`,`"${n.delivery_charges||0}"`,`"${n.total_amount||0}"`,`"${n.status||""}"`,`"${n.promo?.[0]?.promo_name||"-"}"`]),o=[t.join(","),...l.map(n=>n.join(","))].join(`
`),c=new Blob([o],{type:"text/csv;charset=utf-8;"}),D=URL.createObjectURL(c),i=document.createElement("a");i.setAttribute("href",D),i.setAttribute("download",`Orders_${new Date().toISOString().split("T")[0]}.csv`),document.body.appendChild(i),i.click(),document.body.removeChild(i),x.success("CSV downloaded successfully")}catch(t){console.error("CSV generation error:",t),x.error(`CSV generation failed: ${t.message}`,{autoClose:5e3})}},Ae=s=>{try{const t=new tt("l","mm","a4");t.setFontSize(18),t.setFont("helvetica","bold"),t.text("Orders Report",14,20),t.setFontSize(10),t.setFont("helvetica","normal");const l=new Date().toLocaleString();t.text(`Generated on: ${l}`,14,28),t.text(`Total Orders: ${s.length}`,14,34);const o=["Order ID","Table","Type","Date","Customer","Payment","Sub Total","Promo Disc.","Sales Disc.","Total","Status"],c=s.map(i=>[i.id||"",i.type?.table_number||"-",i.type?.order_type||"-",G(i.created_at),i.customer_name||"-",i.payment?.payment_type||"-",`£${Number(i.sub_total||0).toFixed(2)}`,`£${Number(i.promo?.[0]?.discount_amount||0).toFixed(2)}`,`£${Number(i.sales_discount||0).toFixed(2)}`,`£${Number(i.total_amount||0).toFixed(2)}`,i.status||""]);st(t,{head:[o],body:c,startY:40,styles:{fontSize:8,cellPadding:2,halign:"left",lineColor:[0,0,0],lineWidth:.1},headStyles:{fillColor:[41,128,185],textColor:255,fontStyle:"bold"},alternateRowStyles:{fillColor:[245,245,245]},margin:{left:14,right:14},didDrawPage:i=>{const n=t.internal.getNumberOfPages(),N=t.internal.pageSize.height;t.setFontSize(8),t.text(`Page ${i.pageNumber} of ${n}`,i.settings.margin.left,N-10)}});const D=`Orders_${new Date().toISOString().split("T")[0]}.pdf`;t.save(D),x.success("PDF downloaded successfully")}catch(t){console.error("PDF generation error:",t),x.error(`PDF generation failed: ${t.message}`,{autoClose:5e3})}},Re=s=>{try{if(typeof lt>"u")throw new Error("XLSX library is not loaded");const t=s.map(n=>({"Order ID":n.id||"","Table No.":n.type?.table_number||"-","Order Type":n.type?.order_type||"-",Date:G(n.created_at),Customer:n.customer_name||"-","Payment Type":n.payment?.payment_type||"-","Sub Total":Number(n.sub_total||0).toFixed(2),"Promo Discount":Number(n.promo?.[0]?.discount_amount||0).toFixed(2),"Sales Discount":Number(n.sales_discount||0).toFixed(2),"Approved Discount":Number(n.approved_discounts||0).toFixed(2),Tax:Number(n.tax||0).toFixed(2),"Service Charges":Number(n.service_charges||0).toFixed(2),"Delivery Charges":Number(n.delivery_charges||0).toFixed(2),"Total Amount":Number(n.total_amount||0).toFixed(2),Status:n.status||"","Promo Name":n.promo?.[0]?.promo_name||"-"})),l=z.book_new(),o=z.json_to_sheet(t);o["!cols"]=[{wch:10},{wch:10},{wch:12},{wch:12},{wch:20},{wch:12},{wch:12},{wch:15},{wch:15},{wch:17},{wch:10},{wch:15},{wch:16},{wch:13},{wch:10},{wch:20}],z.book_append_sheet(l,o,"Orders");const c=[{Info:"Generated On",Value:new Date().toLocaleString()},{Info:"Total Records",Value:s.length},{Info:"Total Revenue",Value:`£${s.reduce((n,N)=>n+Number(N.total_amount||0),0).toFixed(2)}`},{Info:"Exported By",Value:"Restaurant Management System"}],D=z.json_to_sheet(c);z.book_append_sheet(l,D,"Report Info");const i=`Orders_${new Date().toISOString().split("T")[0]}.xlsx`;at(l,i),x.success("Excel file downloaded successfully",{autoClose:2500})}catch(t){console.error("Excel generation error:",t),x.error(`Excel generation failed: ${t.message}`,{autoClose:5e3})}};return(s,t)=>(d(),r(I,null,[F(y(He),{title:"Orders"}),F(Qe,null,{default:ee(()=>[e("div",kt,[t[75]||(t[75]=e("h4",{class:"fw-semibold mb-3"},"Overall Orders",-1)),e("div",$t,[e("div",Tt,[e("div",St,[e("div",Ot,[e("div",null,[e("h3",Dt,a(we.value),1),t[7]||(t[7]=e("p",{class:"text-muted mb-0 small"},"Total Orders",-1))]),t[8]||(t[8]=e("div",{class:"rounded-circle p-2 d-flex align-items-center justify-content-center text-primary",style:{width:"40px",height:"40px"}},[e("i",{class:"bi bi-list-task fs-4"})],-1))])])]),e("div",Mt,[e("div",Ft,[e("div",Pt,[e("div",null,[e("h3",jt,a(xe.value),1),t[9]||(t[9]=e("p",{class:"text-muted mb-0 small"},"Completed Orders",-1))]),t[10]||(t[10]=e("div",{class:"rounded-circle p-3 d-flex align-items-center justify-content-center text-success",style:{width:"40px",height:"40px"}},[e("i",{class:"bi bi-check2-circle fs-4"})],-1))])])]),e("div",Nt,[e("div",It,[e("div",At,[e("div",null,[e("h3",Rt,a(_e.value),1),t[11]||(t[11]=e("p",{class:"text-muted mb-0 small"},"Cancelled Orders",-1))]),t[12]||(t[12]=e("div",{class:"rounded-circle p-3 d-flex align-items-center justify-content-center text-warning",style:{width:"40px",height:"40px"}},[e("i",{class:"bi bi-hourglass-split fs-4"})],-1))])])]),e("div",Et,[e("div",Lt,[e("div",Bt,[e("div",null,[e("h3",Vt,a(y(f)(Ce.value)),1),t[13]||(t[13]=e("p",{class:"text-muted mb-0 small"},"Total Revenue",-1))]),t[14]||(t[14]=e("div",{class:"rounded-circle p-3 d-flex align-items-center justify-content-center text-info",style:{width:"40px",height:"40px"}},[e("i",{class:"bi bi-currency-pound fs-4"})],-1))])])])]),e("div",zt,[e("div",qt,[e("div",Ut,[t[21]||(t[21]=e("h5",{class:"mb-0 fw-semibold"},"Orders",-1)),e("div",Gt,[e("div",Xt,[t[15]||(t[15]=e("i",{class:"bi bi-search"},null,-1)),t[16]||(t[16]=e("input",{type:"email",name:"email",autocomplete:"email",style:{position:"absolute",left:"-9999px",width:"1px",height:"1px"},tabindex:"-1","aria-hidden":"true"},null,-1)),se.value?A((d(),r("input",{id:Q,"onUpdate:modelValue":t[0]||(t[0]=l=>j.value=l),key:te.value,class:"form-control search-input",placeholder:"Search",type:"search",autocomplete:"new-password",name:Q,role:"presentation",onFocus:t[1]||(t[1]=(...l)=>s.handleFocus&&s.handleFocus(...l))},null,32)),[[Y,j.value]]):(d(),r("input",Wt))]),F(Je,{modelValue:L.value,"onUpdate:modelValue":t[2]||(t[2]=l=>L.value=l),title:"Orders","modal-id":"orderFilterModal","modal-size":"modal-lg","sort-options":U.value.sortOptions,"status-options":U.value.statusOptions,"show-stock-status":!1,"show-price-range":!0,"show-date-range":!0,"price-label":"Total Amount Range",onApply:ge,onClear:he},{customFilters:ee(({filters:l})=>[e("div",Ht,[t[18]||(t[18]=e("label",{class:"form-label fw-semibold text-dark"},[e("i",{class:"fas fa-concierge-bell me-2 text-muted"}),T("Order Type ")],-1)),A(e("select",{"onUpdate:modelValue":o=>l.orderType=o,class:"form-select"},[t[17]||(t[17]=e("option",{value:""},"All",-1)),(d(!0),r(I,null,K(U.value.orderTypeOptions,o=>(d(),r("option",{key:o.value,value:o.value},a(o.label),9,Yt))),128))],8,Kt),[[me,l.orderType]])]),e("div",Qt,[t[20]||(t[20]=e("label",{class:"form-label fw-semibold text-dark"},[e("i",{class:"fas fa-credit-card me-2 text-muted"}),T("Payment Type ")],-1)),A(e("select",{"onUpdate:modelValue":o=>l.paymentType=o,class:"form-select"},[t[19]||(t[19]=e("option",{value:""},"All",-1)),(d(!0),r(I,null,K(U.value.paymentTypeOptions,o=>(d(),r("option",{key:o.value,value:o.value},a(o.label),9,Jt))),128))],8,Zt),[[me,l.paymentType]])])]),_:1},8,["modelValue","sort-options","status-options"]),F(y(et),{modelValue:R.value,"onUpdate:modelValue":t[3]||(t[3]=l=>R.value=l),options:be,optionLabel:"label",optionValue:"value",placeholder:"Export",class:"export-dropdown",onChange:ye},null,8,["modelValue"])])]),e("div",es,[e("table",ts,[t[25]||(t[25]=e("thead",{class:"border-top small text-muted"},[e("tr",null,[e("th",{style:{width:"70px"}},"S. #"),e("th",null,"Table No."),e("th",null,"Order Type"),e("th",null,"Date"),e("th",null,"Time"),e("th",null,"Customer"),e("th",null,"Payment Type"),e("th",null,"Total"),e("th",null,"Status"),e("th",null,"Source"),e("th",{class:"text-center"},"Actions")])],-1)),e("tbody",null,[b.value?(d(),r("tr",ss,[...t[22]||(t[22]=[e("td",{colspan:"11",class:"text-center py-5"},[e("div",{class:"d-flex flex-column align-items-center justify-content-center"},[e("div",{class:"spinner-border mb-3",role:"status",style:{color:"#1B1670",width:"3rem",height:"3rem","border-width":"0.3em"}},[e("span",{class:"visually-hidden"},"Loading...")]),e("div",{class:"fw-semibold text-muted"},"Loading orders...")])],-1)])])):(d(),r(I,{key:1},[(d(!0),r(I,null,K(g.value,(l,o)=>(d(),r("tr",{key:l.id},[e("td",null,a(o+1),1),e("td",null,a(l.type?.table_number??"-"),1),e("td",null,a(l.type?.order_type??"-"),1),e("td",null,a(y(q)(l.created_at)),1),e("td",null,a(ke(l.created_at)),1),e("td",null,a(l.customer_name??"-"),1),e("td",null,[e("span",{class:"cursor-pointer",onClick:c=>Te(l.payment)},a(l.payment?.payment_type??"-"),9,ls)]),e("td",null,a(y(f)(l.total_amount)),1),e("td",as,[e("span",{class:Ke(["badge px-4 py-2 rounded-pill",{"bg-danger":l?.status==="cancelled","bg-warning text-dark":l?.status==="refunded","bg-success":l?.status==="paid"}])},a(l?.status.charAt(0).toUpperCase()+l?.status.slice(1)),3)]),e("td",null,[e("span",os,a(l.source==="Pos System"?"POS System":l.source==="website"?"Website":"-"),1)]),e("td",ns,[e("div",ds,[e("button",{onClick:c=>Se(l),title:"View Details",class:"p-2 rounded-full text-primary hover:bg-gray-100"},[F(y(ot),{class:"w-4 h-4"})],8,rs),l.status!=="cancelled"&&l.status!=="refunded"?(d(),r("button",{key:0,onClick:c=>Pe(l),title:"Cancel Order",disabled:P.value===l.id,class:"p-2 rounded-full text-danger hover:bg-gray-100"},[F(y(nt),{class:"w-4 h-4"})],8,is)):v("",!0),De(l)?(d(),r("button",{key:1,onClick:c=>Me(l),title:"Refund Payment",disabled:$.value===l.id,class:"p-2 rounded-full text-warning hover:bg-gray-100"},[...t[23]||(t[23]=[e("i",{class:"bi bi-arrow-counterclockwise",style:{"font-size":"1rem"}},null,-1)])],8,us)):v("",!0)])])]))),128)),!b.value&&g.value.length===0?(d(),r("tr",cs,[...t[24]||(t[24]=[e("td",{colspan:"11",class:"text-center text-muted py-4"},[e("div",{class:"d-flex flex-column align-items-center justify-content-center py-3"},[e("i",{class:"bi bi-inbox",style:{"font-size":"2rem",opacity:"0.5","margin-bottom":"0.5rem"}}),e("div",{class:"fw-semibold"},"No orders found"),e("div",{class:"small text-secondary mt-1"},"Try adjusting your filters or date range")])],-1)])])):v("",!0)],64))])])]),!b.value&&_.value.last_page>1?(d(),r("div",ms,[e("div",ps," Showing "+a(_.value.from)+" to "+a(_.value.to)+" of "+a(_.value.total)+" entries ",1),F(Ye,{pagination:_.value.links,isApiDriven:!0,onPageChanged:fe},null,8,["pagination"])])):v("",!0)])]),e("div",vs,[e("div",bs,[e("div",ys,[t[35]||(t[35]=e("div",{class:"modal-header border-0 text-black"},[e("h6",{class:"modal-title fw-semibold"},[e("i",{class:"bi bi-credit-card me-2"}),T(" Payment Details ")]),e("button",{class:"absolute top-2 right-2 p-2 rounded-full hover:bg-gray-100 transition transform hover:scale-110","data-bs-dismiss":"modal","aria-label":"Close",title:"Close"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-danger",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})])])],-1)),e("div",fs,[e("div",gs,[e("div",hs,[e("div",ws,[e("div",xs,[t[26]||(t[26]=e("span",{class:"label"},"Payment Type",-1)),e("span",_s,a(w.value?.payment_type??"-"),1)])]),e("div",Cs,[e("div",ks,[t[27]||(t[27]=e("span",{class:"label"},"Amount Received",-1)),e("span",$s,a(Z(w.value?.amount_received)),1)])]),w.value?.payment_type==="Split"?(d(),r("div",Ts,[e("div",Ss,[t[28]||(t[28]=e("span",{class:"label"},"Cash Amount",-1)),e("span",Os,a(Z(w.value?.cash_amount)),1)])])):v("",!0),w.value?.payment_type==="Split"?(d(),r("div",Ds,[e("div",Ms,[t[29]||(t[29]=e("span",{class:"label"},"Card Amount",-1)),e("span",Fs,a(Z(w.value?.card_amount)),1)])])):v("",!0),e("div",Ps,[e("div",js,[t[30]||(t[30]=e("span",{class:"label"},"Payment Date",-1)),e("span",Ns,a(G(w.value?.payment_date)),1)])]),w.value?.brand?(d(),r("div",Is,[e("div",As,[t[31]||(t[31]=e("span",{class:"label"},"Card Brand",-1)),e("span",Rs,a(w.value.brand),1)])])):v("",!0),w.value?.last_digits?(d(),r("div",Es,[e("div",Ls,[t[32]||(t[32]=e("span",{class:"label"},"Last 4 Digits",-1)),e("span",Bs,"**** **** **** "+a(w.value.last_digits),1)])])):v("",!0),w.value?.exp_month?(d(),r("div",Vs,[e("div",zs,[t[33]||(t[33]=e("span",{class:"label"},"Expiry",-1)),e("span",qs,a(w.value.exp_month)+"/"+a(w.value.exp_year),1)])])):v("",!0),w.value?.currency_code?(d(),r("div",Us,[e("div",Gs,[t[34]||(t[34]=e("span",{class:"label"},"Currency",-1)),e("span",Xs,a(w.value.currency_code),1)])])):v("",!0)])])])])])]),e("div",Ws,[e("div",Hs,[e("div",Ks,[e("div",Ys,[e("div",Qs,[t[36]||(t[36]=e("span",{class:"badge bg-gradient rounded-circle p-3 shadow-sm",style:{background:`linear-gradient(
                                            135deg,
                                            #4e73df,
                                            #224abe
                                        )`}},[e("i",{class:"bi bi-receipt fs-5 text-black"})],-1)),e("div",Zs,[e("h5",Js," Order #"+a(p.value?.id),1),e("small",el," Customer: "+a(p.value?.customer_name??"—"),1)])]),t[37]||(t[37]=e("button",{class:"absolute top-2 right-2 p-2 rounded-full hover:bg-gray-100 transition transform hover:scale-110","data-bs-dismiss":"modal","aria-label":"Close",title:"Close"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})])],-1))]),e("div",tl,[p.value?(d(),r("div",sl,[e("div",ll,[t[40]||(t[40]=e("h6",{class:"fw-bold mb-3 text-primary"}," Order Details ",-1)),e("div",al,[e("div",ol,[t[38]||(t[38]=e("span",{class:"fw-semibold text-dark"},"Order Type:",-1)),T(" "+a(p.value?.type?.order_type??"—"),1)]),e("div",nl,[t[39]||(t[39]=e("span",{class:"fw-semibold text-dark"},"Date:",-1)),T(" "+a(y(q)(p.value?.created_at)),1)])])]),t[72]||(t[72]=e("h6",{class:"fw-bold mb-3 text-primary"}," Order Items ",-1)),e("div",dl,[e("table",rl,[t[71]||(t[71]=e("thead",{class:"bg-light text-muted small"},[e("tr",null,[e("th",{class:"px-3"},"#"),e("th",null,"Item"),e("th",null,"Qty"),e("th",null,"Actual Price"),e("th",null,"="),e("th",null,"Promo Name"),e("th",null,"Total Price")])],-1)),e("tbody",null,[(d(!0),r(I,null,K(p.value.items??[],(l,o)=>(d(),r("tr",{key:l.id},[e("td",il,a(o+1),1),e("td",null,a(l.title),1),e("td",null,a(l.quantity),1),e("td",ul,a(y(f)(l.price)),1),t[41]||(t[41]=e("td",null,null,-1)),e("td",null,a(p.value.promo[0]?.promo_name||"-"),1),e("td",cl,a(y(f)(l.price)),1)]))),128)),p.value.promo?(d(),r("tr",ml,[t[42]||(t[42]=e("td",null,null,-1)),t[43]||(t[43]=e("td",null,null,-1)),t[44]||(t[44]=e("td",null,null,-1)),t[45]||(t[45]=e("td",{colspan:"3",class:"text-end text-muted text-adjusting"},"Promo Discount",-1)),e("td",pl," -"+a(y(f)(p.value.promo[0]?.discount_amount??0)),1)])):v("",!0),p.value.tax?(d(),r("tr",vl,[t[46]||(t[46]=e("td",null,null,-1)),t[47]||(t[47]=e("td",null,null,-1)),t[48]||(t[48]=e("td",null,null,-1)),t[49]||(t[49]=e("td",{colspan:"3",class:"text-end text-muted text-adjusting"},"Tax",-1)),e("td",bl," +"+a(y(f)(p.value.tax??0)),1)])):v("",!0),p.value.service_charges?(d(),r("tr",yl,[t[50]||(t[50]=e("td",null,null,-1)),t[51]||(t[51]=e("td",null,null,-1)),t[52]||(t[52]=e("td",null,null,-1)),t[53]||(t[53]=e("td",{colspan:"3",class:"text-end text-muted text-adjusting"},"Service Charges",-1)),e("td",fl," +"+a(y(f)(p.value.service_charges??0)),1)])):v("",!0),p.value.delivery_charges?(d(),r("tr",gl,[t[54]||(t[54]=e("td",null,null,-1)),t[55]||(t[55]=e("td",null,null,-1)),t[56]||(t[56]=e("td",null,null,-1)),t[57]||(t[57]=e("td",{colspan:"3",class:"text-end text-muted text-adjusting"},"Delivery Charges",-1)),e("td",hl," +"+a(y(f)(p.value.delivery_charges??0)),1)])):v("",!0),p.value.sales_discount?(d(),r("tr",wl,[t[58]||(t[58]=e("td",null,null,-1)),t[59]||(t[59]=e("td",null,null,-1)),t[60]||(t[60]=e("td",null,null,-1)),t[61]||(t[61]=e("td",{colspan:"3",class:"text-end text-muted text-adjusting"},"Sales Discount",-1)),e("td",xl," +"+a(y(f)(p.value.sales_discount??0)),1)])):v("",!0),p.value.approved_discounts?(d(),r("tr",_l,[t[62]||(t[62]=e("td",null,null,-1)),t[63]||(t[63]=e("td",null,null,-1)),t[64]||(t[64]=e("td",null,null,-1)),t[65]||(t[65]=e("td",{colspan:"3",class:"text-end text-muted text-adjusting"},"Approved Discounts",-1)),e("td",Cl," +"+a(y(f)(p.value.approved_discounts??0)),1)])):v("",!0),e("tr",kl,[t[66]||(t[66]=e("td",null,null,-1)),t[67]||(t[67]=e("td",null,null,-1)),t[68]||(t[68]=e("td",null,null,-1)),t[69]||(t[69]=e("td",{colspan:"3",class:"text-end text-muted text-adjusting"},"Grand Total ",-1)),e("td",$l,a(y(f)(p.value.total_amount)),1)]),(p.value.items??[]).length===0?(d(),r("tr",Tl,[...t[70]||(t[70]=[e("td",{colspan:"7",class:"text-center text-muted py-4"}," No items found ",-1)])])):v("",!0)])])])])):v("",!0)]),e("div",Sl,[t[74]||(t[74]=e("button",{class:"btn btn-secondary px-2 py-2","data-bs-dismiss":"modal"}," Close ",-1)),le.value.length>0?(d(),r("button",{key:0,class:"btn btn-primary shadow-sm rounded-pill px-4 py-2",onClick:t[4]||(t[4]=l=>Oe(p.value))},[...t[73]||(t[73]=[e("i",{class:"bi bi-printer me-1"},null,-1),T(" Print Receipt ",-1)])])):v("",!0)])])])])]),e("div",Ol,[e("div",Dl,[e("div",Ml,[e("div",{class:"modal-header border-0"},[t[77]||(t[77]=e("h5",{class:"modal-title fw-bold"},[e("i",{class:"bi bi-arrow-counterclockwise text-warning me-2"}),T(" Process Refund ")],-1)),e("button",{onClick:oe,class:"absolute top-2 right-2 p-2 rounded-full hover:bg-gray-100 transition transform hover:scale-110","data-bs-dismiss":"modal","aria-label":"Close",title:"Close"},[...t[76]||(t[76]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("div",Fl,[t[88]||(t[88]=e("div",{class:"alert alert-warning d-flex align-items-start gap-2"},[e("i",{class:"bi bi-exclamation-triangle-fill mt-1"}),e("div",null,[e("strong",null,"Important:"),T(" This will process a refund to the customer's card. This action cannot be undone. ")])],-1)),e("div",Pl,[t[84]||(t[84]=e("label",{class:"form-label fw-semibold"},"Order Details",-1)),e("div",jl,[e("div",Nl,[t[78]||(t[78]=e("span",{class:"text-muted"},"Order #:",-1)),e("span",Il,a(u.value?.id),1)]),e("div",Al,[t[79]||(t[79]=e("span",{class:"text-muted"},"Customer:",-1)),e("span",Rl,a(u.value?.customer_name||"Walk In"),1)]),e("div",El,[t[80]||(t[80]=e("span",{class:"text-muted"},"Total Amount:",-1)),e("span",Ll,a(y(f)(u.value?.total_amount)),1)]),e("div",Bl,[t[81]||(t[81]=e("span",{class:"text-muted"},"Payment Type:",-1)),e("span",Vl,a(u.value?.payment?.payment_type),1)]),u.value?.payment?.payment_type?.toLowerCase()==="split"?(d(),r("div",zl,[t[82]||(t[82]=e("span",{class:"text-muted"},"Card Amount:",-1)),e("span",ql,a(y(f)(u.value?.payment?.card_amount)),1)])):v("",!0),u.value?.payment?.brand?(d(),r("div",Ul,[t[83]||(t[83]=e("span",{class:"text-muted"},"Card:",-1)),e("span",Gl,a(u.value.payment.brand)+" •••• "+a(u.value.payment.last_digits),1)])):v("",!0)])]),e("div",Xl,[t[86]||(t[86]=e("label",{class:"form-label fw-semibold"},"Refund Amount",-1)),e("div",Wl,[t[85]||(t[85]=e("span",{class:"input-group-text"},"£",-1)),A(e("input",{"onUpdate:modelValue":t[5]||(t[5]=l=>S.value=l),type:"number",class:"form-control",max:u.value?.payment?.card_amount||u.value?.total_amount,step:"0.01",min:"0.01",required:""},null,8,Hl),[[Y,S.value,void 0,{number:!0}]])]),e("small",Kl," Maximum: "+a(y(f)(u.value?.payment?.card_amount||u.value?.total_amount)),1)]),e("div",Yl,[t[87]||(t[87]=e("label",{class:"form-label fw-semibold"},"Refund Reason (Optional)",-1)),A(e("textarea",{"onUpdate:modelValue":t[6]||(t[6]=l=>O.value=l),class:"form-control",rows:"3",placeholder:"Enter reason for refund...",maxlength:"500"},null,512),[[Y,O.value]]),e("small",Ql,a(O.value.length)+"/500 characters",1)])]),e("div",Zl,[e("button",{type:"button",class:"btn btn-secondary px-2 py-2",onClick:oe,disabled:$.value!==null}," Cancel ",8,Jl),e("button",{type:"button",class:"btn btn-primary px-2 py-2",onClick:Fe,disabled:$.value!==null||!S.value||S.value<=0},[$.value?(d(),r("span",ta,[...t[89]||(t[89]=[e("span",{class:"spinner-border spinner-border-sm me-2"},null,-1),T(" Processing... ",-1)])])):(d(),r("span",sa,[...t[90]||(t[90]=[e("i",{class:"bi bi-arrow-counterclockwise me-1"},null,-1),T(" Process Refund ",-1)])]))],8,ea)])])])]),F(Ct,{show:J.value,order:M.value,loading:P.value===M.value?.id,onConfirm:je,onCancel:ne},null,8,["show","order","loading"])]),_:1})],64))}},xa=pe(la,[["__scopeId","data-v-66b9ab44"]]);export{xa as default};
