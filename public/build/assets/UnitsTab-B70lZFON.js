import{_ as te,r as m,C as O,k as ae,j as se,g as i,o as d,a as D,b as t,d as T,h as oe,x as U,y as j,f as y,i as C,F,v as R,t as g,U as ne,V as z,n as A,I as le,A as k,p as re,m as n}from"./app-CYEkE9GK.js";import{E as ie,a as de,X as ue,u as N,w as ce}from"./xlsx-BmzxC8vr.js";import{I as me}from"./importFile-Dz0zDFVt.js";import{P as ve}from"./plus-BwDqOknZ.js";import{P as fe}from"./pencil-CHVYe7FI.js";import"./createLucideIcon-BvjKrCmJ.js";const pe={class:"card border-0 shadow-lg rounded-4"},be={class:"card-body"},ge={class:"d-flex flex-wrap gap-2 justify-content-between align-items-center mb-3"},he={class:"d-flex gap-2"},ye={class:"search-wrap"},we={class:"dropdown"},_e={class:"dropdown-menu dropdown-menu-end shadow rounded-4 py-2"},xe={class:"table-responsive"},Ue={class:"table table-hover"},Ce={class:"fw-semibold"},ke={class:"text-center"},Se={class:"d-inline-flex align-items-center gap-3"},Ee=["onClick"],De={key:0},Fe={colspan:"3",class:"text-center text-muted py-4"},Ne={class:"modal fade",id:"modalUnitForm",tabindex:"-1","aria-hidden":"true"},Pe={class:"modal-dialog modal-lg modal-dialog-centered"},Ie={class:"modal-content rounded-4"},$e={class:"modal-header"},Le={class:"modal-title"},Ve={class:"modal-body"},Te={class:"mb-3 d-flex gap-3 align-items-center"},je={class:"form-check-label"},Ae={class:"form-check-label"},Be={class:"text-muted d-block mt-1"},Me={key:0},Oe={key:0,class:"text-danger"},Re={key:1,class:"mt-3"},ze={key:0,class:"alert alert-warning"},Xe=["value"],qe={key:2,class:"text-danger"},He={key:3,class:"text-danger"},Ge={class:"col-md-2 mt-4"},We=["disabled"],Ye={__name:"UnitsTab",setup(Je){const S=m(!1),I=m(null),c=m(""),v=m("base"),h=m(null),p=m(null),x=m(""),B=O(()=>r.value.filter(s=>!s.base_unit_id)),P=()=>{c.value="",l.value={},v.value="base",h.value=null,p.value=null},$=O(()=>{const s=x.value.trim().toLowerCase();return s?r.value.filter(e=>e.name.toLowerCase().includes(s)):r.value}),X=()=>{S.value=!1,c.value=""},q=s=>{S.value=!0,I.value=s,c.value=s.name,v.value=s.base_unit_id?"derived":"base",h.value=s.base_unit_id,p.value=s.conversion_factor},H=async s=>{try{l.value={},await k.delete(`/units/${s.id}`),r.value=r.value.filter(e=>e.id!==s.id),n.success("Unit deleted successfully")}catch(e){e.response&&e.response.data&&e.response.data.message?(l.value.delete=e.response.data.message,n.error(e.response.data.message)):(l.value.delete="An unexpected error occurred while deleting the unit.",n.error("Delete failed"))}},b=m(!1),G=async()=>{if(!b.value){if(!c.value.trim()){n.error("Please fill out the field can't save an empty field."),l.value={name:["Please fill out the field can't save an empty field"]};return}if(S.value){if(v.value==="derived"){if(!h.value){n.error("Please select a base unit"),l.value={base_unit_id:["Base unit is required for derived units"]};return}if(!p.value||p.value<=0){n.error("Please enter a valid conversion factor"),l.value={conversion_factor:["Conversion factor must be greater than 0"]};return}}try{b.value=!0;const s={name:c.value.trim(),base_unit_id:v.value==="derived"?Number(h.value):null,conversion_factor:v.value==="derived"?Number(p.value):null},{data:e}=await k.put(`/units/${I.value.id}`,s),a=r.value.findIndex(o=>o.id===I.value.id);a!==-1&&(r.value[a]=e),n.success("Unit updated successfully"),await E(),P(),L("modalUnitForm")}catch(s){s.response?.data?.errors?(l.value={},Object.entries(s.response.data.errors).forEach(([e,a])=>{a.forEach(f=>n.error(f));const o=e.includes(".")?"name":e;l.value[o]=a})):n.error("Update failed")}finally{b.value=!1}}else{if(r.value.some(e=>e.name.toLowerCase()===c.value.trim().toLowerCase())){n.error(`Unit "${c.value.trim()}" already exists. Please use a different name or edit the existing unit.`),l.value={name:[`Unit "${c.value.trim()}" already exists`]};return}if(v.value==="derived"){if(!h.value){n.error("Please select a base unit"),l.value={base_unit_id:["Base unit is required"]};return}if(!p.value||p.value<=0){n.error("Please enter a valid conversion factor"),l.value={conversion_factor:["Conversion factor must be greater than 0"]};return}const e={name:c.value.trim(),base_unit_id:h.value,conversion_factor:p.value};try{b.value=!0;const a=await k.post("/units",{units:[e]}),o=a.data?.units??a.data;Array.isArray(o)&&o.length&&(r.value=[...r.value,...o]),n.success("Derived unit added successfully"),P(),L("modalUnitForm"),await E()}catch(a){a.response?.data?.errors?(l.value={},Object.entries(a.response.data.errors).forEach(([o,f])=>{f.forEach(u=>n.error(u));const w=o.includes(".name")?"name":o.includes(".base_unit_id")?"base_unit_id":o.includes(".conversion_factor")?"conversion_factor":o;l.value[w]=f})):(console.error(a),n.error("Create failed"))}finally{b.value=!1}}else{const e={name:c.value.trim(),base_unit_id:null,conversion_factor:null};try{b.value=!0;const a=await k.post("/units",{units:[e]}),o=a.data?.units??a.data;Array.isArray(o)&&o.length&&(r.value=[...r.value,...o]),n.success("Unit added successfully"),P(),L("modalUnitForm"),await E()}catch(a){a.response?.data?.errors?Object.values(a.response.data.errors).forEach(o=>o.forEach(f=>n.error(f))):(console.error(a),n.error("Create failed"))}finally{b.value=!1}}}}},L=s=>{const e=document.getElementById(s);if(!e)return;(window.bootstrap?.Modal.getInstance(e)||new window.bootstrap.Modal(e)).hide()},r=m([]),W=m(1),Y=m(15),M=m(!1),l=m({}),E=async()=>{M.value=!0;try{const{data:s}=await k.get("/units",{params:{q:x.value,page:W.value,per_page:Y.value}});r.value=s?.data??s?.units?.data??s??[],await re(),window.feather?.replace()}catch(s){console.error("Failed to fetch units",s)}finally{M.value=!1}},V=s=>{if(!r.value||r.value.length===0){n.error("No Units data to download");return}const e=x.value.trim()?$.value:r.value;if(e.length===0){n.error("No Units found to download");return}try{s==="pdf"?K(e):s==="excel"?Q(e):s==="csv"?J(e):n.error("Invalid download type")}catch(a){console.error("Download failed:",a),n.error(`Download failed: ${a.message}`)}},J=s=>{try{const e=["Name"],a=s.map(_=>[`"${_.name||""}"`]),o=[e.join(","),...a.map(_=>_.join(","))].join(`
`),f=new Blob([o],{type:"text/csv;charset=utf-8;"}),w=URL.createObjectURL(f),u=document.createElement("a");u.setAttribute("href",w),u.setAttribute("download",`units_${new Date().toISOString().split("T")[0]}.csv`),document.body.appendChild(u),u.click(),document.body.removeChild(u),n.success("CSV downloaded successfully")}catch(e){console.error("CSV generation error:",e),n.error(`CSV generation failed: ${e.message}`,{autoClose:5e3})}},K=s=>{try{const e=new ie("p","mm","a4");e.setFontSize(20),e.setFont("helvetica","bold"),e.text("Units Report",14,20),e.setFontSize(10),e.setFont("helvetica","normal");const a=new Date().toLocaleString();e.text(`Generated on: ${a}`,14,28),e.text(`Total Units: ${s.length}`,14,34);const o=["Name"],f=s.map(u=>[u.name||""]);de(e,{head:[o],body:f,startY:40,styles:{fontSize:10,cellPadding:3,halign:"left",lineColor:[0,0,0],lineWidth:.1},headStyles:{fillColor:[41,128,185],textColor:255,fontStyle:"bold"},alternateRowStyles:{fillColor:[240,240,240]},margin:{left:14,right:14},didDrawPage:u=>{const _=e.internal.getNumberOfPages(),ee=e.internal.pageSize.height;e.setFontSize(8),e.text(`Page ${u.pageNumber} of ${_}`,u.settings.margin.left,ee-10)}});const w=`units_${new Date().toISOString().split("T")[0]}.pdf`;e.save(w),n.success("PDF downloaded successfully")}catch(e){console.error("PDF generation error:",e),n.error(`PDF generation failed: ${e.message}`,{autoClose:5e3})}},Q=s=>{try{if(typeof ue>"u")throw new Error("XLSX library is not loaded");const e=s.map(_=>({Name:_.name||""})),a=N.book_new(),o=N.json_to_sheet(e);o["!cols"]=[{wch:25}],N.book_append_sheet(a,o,"Units");const f=[{Info:"Generated On",Value:new Date().toLocaleString()},{Info:"Total Units",Value:s.length},{Info:"Exported By",Value:"Units Management System"}],w=N.json_to_sheet(f);N.book_append_sheet(a,w,"Report Info");const u=`units_${new Date().toISOString().split("T")[0]}.xlsx`;ce(a,u),n.success("Excel file downloaded successfully",{autoClose:2500})}catch(e){console.error("Excel generation error:",e),n.error(`Excel generation failed: ${e.message}`,{autoClose:5e3})}};ae(async()=>{await E(),window.feather?.replace()}),se(c,s=>{s&&l.value.name&&delete l.value.name});const Z=s=>{if(console.log("Imported Data:",s),!s||s.length<=1){n.error("The file is empty",{autoClose:3e3});return}s[0];const e=s.slice(1);console.log(e);const a=e.map(o=>({name:o[0]||""}));k.post("/api/units/import",{units:a}).then(()=>{n.success("Units imported successfully"),E()}).catch(o=>{o?.response?.status===422&&o.response.data?.errors&&(l.value=o.response.data.errors,n.error("There may be some duplication in data",{autoClose:3e3}))})};return(s,e)=>(d(),i(F,null,[D(T(oe),{title:"Unit"}),t("div",pe,[t("div",be,[t("div",ge,[e[13]||(e[13]=t("h4",{class:"mb-0"},"Units",-1)),t("div",he,[t("div",ye,[e[10]||(e[10]=t("i",{class:"bi bi-search"},null,-1)),U(t("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>x.value=a),class:"form-control search-input",placeholder:"Search"},null,512),[[j,x.value]])]),t("button",{"data-bs-toggle":"modal","data-bs-target":"#modalUnitForm",onClick:e[1]||(e[1]=()=>{X(),P(),l.value={}}),class:"d-flex align-items-center gap-1 px-4 btn-sm py-2 rounded-pill btn btn-primary text-white"},[D(T(ve),{class:"w-4 h-4"}),e[11]||(e[11]=y(" Add Unit ",-1))]),D(me,{label:"Import",sampleHeaders:["Name"],sampleData:[["Example Unit 1"],["Example Unit 2"]],onOnImport:Z}),t("div",we,[e[12]||(e[12]=t("button",{class:"btn btn-outline-secondary btn-sm py-2 rounded-pill px-4 dropdown-toggle","data-bs-toggle":"dropdown"}," Export ",-1)),t("ul",_e,[t("li",null,[t("a",{class:"dropdown-item py-2",href:"javascript:;",onClick:e[2]||(e[2]=a=>V("pdf"))},"Export as PDF")]),t("li",null,[t("a",{class:"dropdown-item py-2",href:"javascript:;",onClick:e[3]||(e[3]=a=>V("excel"))},"Export as Excel")]),t("li",null,[t("a",{class:"dropdown-item py-2",href:"javascript:;",onClick:e[4]||(e[4]=a=>V("csv"))}," Export as CSV ")])])])])]),t("div",xe,[t("table",Ue,[e[14]||(e[14]=t("thead",{class:"border-top small text-muted"},[t("tr",null,[t("th",null,"S. #"),t("th",null,"Unit Name"),t("th",{class:"text-center"},"Action")])],-1)),t("tbody",null,[(d(!0),i(F,null,R($.value,(a,o)=>(d(),i("tr",{key:a.id},[t("td",null,g(o+1),1),t("td",Ce,g(a.name),1),t("td",ke,[t("div",Se,[t("button",{"data-bs-toggle":"modal","data-bs-target":"#modalUnitForm",onClick:()=>{q(a),l.value={}},title:"Edit",class:"p-2 rounded-full text-blue-600 hover:bg-blue-100"},[D(T(fe),{class:"w-4 h-4"})],8,Ee),D(ne,{title:"Confirm Delete",message:`Are you sure you want to delete ${a.name}?`,showDeleteButton:!0,onConfirm:()=>{H(a)},onCancel:()=>{}},null,8,["message","onConfirm"])])])]))),128)),$.value.length===0?(d(),i("tr",De,[t("td",Fe,g(x.value.trim()?"No units found matching your search.":"No units found."),1)])):C("",!0)])])])])]),t("div",Ne,[t("div",Pe,[t("div",Ie,[t("div",$e,[t("h5",Le,g(S.value?"Edit Unit":"Add Unit(s)"),1),e[15]||(e[15]=t("button",{class:"absolute top-2 right-2 p-2 rounded-full hover:bg-gray-100 transition transform hover:scale-110","data-bs-dismiss":"modal","aria-label":"Close",title:"Close"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})])],-1))]),t("div",Ve,[t("div",Te,[t("label",je,[U(t("input",{type:"radio",class:"form-check-input me-2",value:"base","onUpdate:modelValue":e[5]||(e[5]=a=>v.value=a)},null,512),[[z,v.value]]),e[16]||(e[16]=y(" Base Unit ",-1))]),t("label",Ae,[U(t("input",{type:"radio",class:"form-check-input me-2",value:"derived","onUpdate:modelValue":e[6]||(e[6]=a=>v.value=a)},null,512),[[z,v.value]]),e[17]||(e[17]=y(" Derived Unit ",-1))])]),t("div",null,[e[23]||(e[23]=t("label",{class:"form-label"},"Unit Name",-1)),U(t("input",{"onUpdate:modelValue":e[7]||(e[7]=a=>c.value=a),class:A(["form-control",{"is-invalid":l.value.name}]),placeholder:"e.g., Millilitre (ml)"},null,2),[[j,c.value]]),t("small",Be,[v.value==="derived"?(d(),i("span",Me,` ⚠️ Enter a NEW unit name (e.g., "ml" if base is "L"). Don't use existing unit names. `)):C("",!0)]),l.value.name?(d(),i("div",Oe,g(l.value.name[0]),1)):C("",!0),v.value==="derived"?(d(),i("div",Re,[e[19]||(e[19]=t("div",{class:"alert alert-info"},[t("strong",null,"Example:"),y(' If you want to create "Millilitre (ml)" from "Litre (L)":'),t("br"),y(' • Select "Litre (L)" as base unit'),t("br"),y(" • Enter conversion: 0.001 (because 1 ml = 0.001 L) ")],-1)),e[20]||(e[20]=t("label",{class:"form-label"},"Base Unit",-1)),B.value.length===0?(d(),i("div",ze," No base units available. Please create base units first before creating derived units. ")):U((d(),i("select",{key:1,"onUpdate:modelValue":e[8]||(e[8]=a=>h.value=a),class:A(["form-select",{"is-invalid":l.value.base_unit_id}])},[e[18]||(e[18]=t("option",{value:null,disabled:""},"Select base unit",-1)),(d(!0),i(F,null,R(B.value,a=>(d(),i("option",{key:a.id,value:a.id},g(a.name),9,Xe))),128))],2)),[[le,h.value]]),l.value.base_unit_id?(d(),i("div",qe,g(l.value.base_unit_id[0]),1)):C("",!0),e[21]||(e[21]=t("label",{class:"form-label mt-3"},"Conversion Factor",-1)),U(t("input",{type:"number",step:"any","onUpdate:modelValue":e[9]||(e[9]=a=>p.value=a),class:A(["form-control",{"is-invalid":l.value.conversion_factor}]),placeholder:"e.g., 0.001"},null,2),[[j,p.value,void 0,{number:!0}]]),e[22]||(e[22]=t("small",{class:"text-muted d-block mt-1"},"How many base units = 1 of this unit (e.g., 1 ml = 0.001 L)",-1)),l.value.conversion_factor?(d(),i("div",He,g(l.value.conversion_factor[0]),1)):C("",!0)])):C("",!0)]),t("div",Ge,[t("button",{class:"btn btn-primary rounded-pill py-2 btn-sm w-100",disabled:b.value,onClick:G},[b.value?(d(),i(F,{key:0},[e[24]||(e[24]=t("span",{class:"spinner-border spinner-border-sm me-2"},null,-1)),e[25]||(e[25]=y("Saving... ",-1))],64)):(d(),i(F,{key:1},[y(g((S.value,"Save")),1)],64))],8,We)])])])])])],64))}},st=te(Ye,[["__scopeId","data-v-a7227976"]]);export{st as default};
