import{_ as j,r as v,o as _,n as B,c as m,I as L,a as V,b as u,w as D,d as T,e,u as r,h as E,t as o,k as C,f as c,v as R,l as H,F,g as N,T as U,m as $}from"./app-CbaALDFq.js";import{_ as G}from"./Master-DgOeezfe.js";import{u as z}from"./useFormatters-CIpT4SD6.js";import{F as Q}from"./FilterModal-BL4Z7k-q.js";import"./index-Cmd-R4V0.js";import"./createLucideIcon-DEQDBvBF.js";import"./index-CCKTLXrc.js";import"./index-B2pb8CAK.js";import"./sun-CXQc7xiF.js";const Y={class:"page-wrapper"},q={class:"row g-3"},K={class:"col-6 col-md-4"},W={class:"card border-0 shadow-sm rounded-4"},J={class:"card-body d-flex align-items-center justify-content-between"},X={class:"mb-0 fw-bold"},Z={class:"col-6 col-md-4"},ee={class:"card border-0 shadow-sm rounded-4"},te={class:"card-body d-flex align-items-center justify-content-between"},se={class:"mb-0 fw-bold"},ae={class:"col-12 col-md-4"},le={class:"card border-0 shadow-sm rounded-4"},oe={class:"card-body d-flex align-items-center justify-content-between"},ne={class:"mb-0 fw-bold"},re={class:"card border-0 shadow-lg rounded-4 mt-3"},de={class:"card-body"},ie={class:"d-flex flex-wrap gap-2 justify-content-between align-items-center mb-3"},ue={class:"d-flex flex-wrap gap-2 align-items-center"},ce={class:"search-wrap"},me={key:1,class:"form-control search-input",placeholder:"Search",disabled:"",type:"text"},pe={class:"col-md-6"},ve=["onUpdate:modelValue"],ye=["value"],he={class:"dropdown"},be={class:"dropdown-menu dropdown-menu-end shadow rounded-4 py-2"},fe={class:"table-responsive"},we={class:"table table-hover align-middle",style:{"min-height":"320px"}},ge={class:"text-success"},xe={class:"text-success"},_e={class:"text-success"},De={class:"text-capitalize"},Te={key:0},Ce={__name:"Index",setup(Fe){const{formatCurrencySymbol:d,dateFmt:A}=z(),b=v([]),P=async()=>{try{const s=await axios.get("/api/orders/all");b.value=s.data.data}catch(s){console.error("Error fetching orders:",s)}};_(async()=>{p.value="",f.value=Date.now(),await B(),setTimeout(()=>{w.value=!0;const s=document.getElementById(h);s&&(s.value="",p.value="")},100),P()});const p=v(""),f=v(Date.now()),h=`search-${Math.random().toString(36).substr(2,9)}`,w=v(!1),n=v({sortBy:"",paymentType:"",dateFrom:"",dateTo:"",priceMin:null,priceMax:null}),y=m(()=>b.value.map(s=>{const t=Array.isArray(s.promo)&&s.promo.length>0?s.promo[0]:null;return{orderId:s.id,customer:s.customer_name,user:s.user?.name||"—",type:s.payment?.payment_type||"—",serviceCharges:Number(s.service_charges||0),deliveryCharges:Number(s.delivery_charges||0),tax:Number(s.tax||0),amountReceived:Number(s.sub_total||0),promoDiscount:t?Number(t.discount_amount||0):0,salesDiscount:Number(s.sales_discount||0),approvedDiscount:Number(s.approved_discounts||0),grandTotal:Number(s.total_amount||0),promoName:t?t.promo_name:"—",paidAt:s.payment?.payment_date||null,status:s.status}})),g=m(()=>{const s=p.value.trim().toLowerCase();let t=[...y.value];return s&&(t=t.filter(a=>[String(a.orderId),a.customer||"",a.user||"",a.type||"",String(a.amount),S(a.paidAt)].join(" ").toLowerCase().includes(s))),n.value.paymentType&&(t=t.filter(a=>(a.type??"").toLowerCase()===n.value.paymentType.toLowerCase())),(n.value.priceMin!==null||n.value.priceMax!==null)&&(t=t.filter(a=>{const l=Number(a.amount)||0,i=Number(n.value.priceMin)||0,O=n.value.priceMax?Number(n.value.priceMax):1/0;return l>=i&&l<=O})),n.value.dateFrom&&(t=t.filter(a=>{const l=new Date(a.paidAt),i=new Date(n.value.dateFrom);return l>=i})),n.value.dateTo&&(t=t.filter(a=>{const l=new Date(a.paidAt),i=new Date(n.value.dateTo);return i.setHours(23,59,59,999),l<=i})),t}),x=m(()=>({sortOptions:[{value:"date_desc",label:"Date: Newest First"},{value:"date_asc",label:"Date: Oldest First"},{value:"amount_desc",label:"Amount: High to Low"},{value:"amount_asc",label:"Amount: Low to High"},{value:"order_asc",label:"Order ID: Low to High"},{value:"order_desc",label:"Order ID: High to Low"}],paymentTypeOptions:[{value:"Cash",label:"Cash"},{value:"Card",label:"Card"},{value:"Split",label:"Split"},{value:"QR",label:"QR"},{value:"Bank",label:"Bank"}]})),k=m(()=>y.value.length),M=m(()=>{const s=new Date,t=new Date(s.getFullYear(),s.getMonth(),s.getDate()),a=new Date(s.getFullYear(),s.getMonth(),s.getDate()+1);return y.value.filter(l=>{if(!l.paidAt)return!1;const i=new Date(l.paidAt);return i>=t&&i<a}).length}),I=m(()=>y.value.reduce((s,t)=>s+Number(t.amount||0),0));function S(s){return s?new Date(s).toLocaleString("en-GB",{day:"2-digit",month:"short",year:"numeric",hour:"numeric",minute:"2-digit",hour12:!0}):"—"}return _(()=>window.feather?.replace()),L(()=>window.feather?.replace()),(s,t)=>(u(),V(G,null,{default:D(()=>[T(r(E),{title:"Payment"}),e("div",Y,[t[19]||(t[19]=e("h4",{class:"fw-semibold mb-3"},"Overall Payments",-1)),e("div",q,[e("div",K,[e("div",W,[e("div",J,[e("div",null,[e("h3",X,o(k.value),1),t[5]||(t[5]=e("p",{class:"text-muted mb-0 small"},"Total Payments",-1))]),t[6]||(t[6]=e("div",{class:"rounded-circle p-3 bg-primary-subtle text-primary d-flex align-items-center justify-content-center",style:{width:"56px",height:"56px"}},[e("i",{class:"bi bi-list-check fs-4"})],-1))])])]),e("div",Z,[e("div",ee,[e("div",te,[e("div",null,[e("h3",se,o(M.value),1),t[7]||(t[7]=e("p",{class:"text-muted mb-0 small"},"Today's Payments",-1))]),t[8]||(t[8]=e("div",{class:"rounded-circle p-3 bg-success-subtle text-success d-flex align-items-center justify-content-center",style:{width:"56px",height:"56px"}},[e("i",{class:"bi bi-calendar-day fs-4"})],-1))])])]),e("div",ae,[e("div",le,[e("div",oe,[e("div",null,[e("h3",ne,o(r(d)(I.value,"GBP")),1),t[9]||(t[9]=e("p",{class:"text-muted mb-0 small"},"Total Amount",-1))]),t[10]||(t[10]=e("div",{class:"rounded-circle p-3 bg-warning-subtle text-warning d-flex align-items-center justify-content-center",style:{width:"56px",height:"56px"}},[e("i",{class:"bi bi-currency-pound fs-4"})],-1))])])])]),e("div",re,[e("div",de,[e("div",ie,[t[16]||(t[16]=e("h5",{class:"mb-0 fw-semibold"},"Payments",-1)),e("div",ue,[e("div",ce,[t[11]||(t[11]=e("i",{class:"bi bi-search"},null,-1)),t[12]||(t[12]=e("input",{type:"email",name:"email",autocomplete:"email",style:{position:"absolute",left:"-9999px",width:"1px",height:"1px"},tabindex:"-1","aria-hidden":"true"},null,-1)),w.value?C((u(),c("input",{id:h,"onUpdate:modelValue":t[0]||(t[0]=a=>p.value=a),key:f.value,class:"form-control search-input",placeholder:"Search",type:"search",autocomplete:"new-password",name:h,role:"presentation",onFocus:t[1]||(t[1]=(...a)=>s.handleFocus&&s.handleFocus(...a))},null,32)),[[R,p.value]]):(u(),c("input",me))]),T(Q,{modelValue:n.value,"onUpdate:modelValue":t[2]||(t[2]=a=>n.value=a),title:"Payments","modal-id":"paymentFilterModal","modal-size":"modal-lg","sort-options":x.value.sortOptions,"show-price-range":!0,"show-date-range":!0,"price-label":"Amount Range",onApply:s.handleFilterApply,onClear:s.handleFilterClear},{customFilters:D(({filters:a})=>[e("div",pe,[t[14]||(t[14]=e("label",{class:"form-label fw-semibold text-dark"},[e("i",{class:"fas fa-credit-card me-2 text-muted"}),H("Payment Type ")],-1)),C(e("select",{"onUpdate:modelValue":l=>a.paymentType=l,class:"form-select"},[t[13]||(t[13]=e("option",{value:""},"All",-1)),(u(!0),c(F,null,N(x.value.paymentTypeOptions,l=>(u(),c("option",{key:l.value,value:l.value},o(l.label),9,ye))),128))],8,ve),[[U,a.paymentType]])])]),_:1},8,["modelValue","sort-options","onApply","onClear"]),e("div",he,[t[15]||(t[15]=e("button",{class:"btn btn-outline-secondary rounded-pill px-4 dropdown-toggle","data-bs-toggle":"dropdown"}," Export ",-1)),e("ul",be,[e("li",null,[e("a",{class:"dropdown-item py-2",href:"javascript:void(0)",onClick:t[3]||(t[3]=a=>s.onDownload("pdf"))},"Export as PDF")]),e("li",null,[e("a",{class:"dropdown-item py-2",href:"javascript:void(0)",onClick:t[4]||(t[4]=a=>s.onDownload("excel"))},"Export as Excel")])])])])]),e("div",fe,[e("table",we,[t[18]||(t[18]=e("thead",{class:"border-top small text-muted"},[e("tr",null,[e("th",null,"S. #"),e("th",null,"Order ID"),e("th",null,"Actual Payment"),e("th",null,"Promo Name"),e("th",null,"Promo Discount"),e("th",null,"Sales Discount"),e("th",null,"Approved Discount"),e("th",null,"Tax"),e("th",null,"Service Charges"),e("th",null,"Delivery Charges"),e("th",null,"Grand Total"),e("th",null,"Payment Date"),e("th",null,"Payment Type")])],-1)),e("tbody",null,[(u(!0),c(F,null,N(g.value,(a,l)=>(u(),c("tr",{key:a.orderId},[e("td",null,o(l+1),1),e("td",null,o(a.orderId),1),e("td",null,o(r(d)(a.amountReceived)),1),e("td",null,o(a.promoName),1),e("td",ge,o(a.promoDiscount?r(d)(a.promoDiscount):"—"),1),e("td",xe,o(a.salesDiscount?r(d)(a.salesDiscount):"—"),1),e("td",_e,o(a.approvedDiscount?r(d)(a.approvedDiscount):"—"),1),e("td",null,o(r(d)(a.tax)),1),e("td",null,o(r(d)(a.serviceCharges)),1),e("td",null,o(r(d)(a.deliveryCharges)),1),e("td",null,o(r(d)(a.grandTotal)),1),e("td",null,o(r(A)(a.paidAt)),1),e("td",De,o(a.type),1)]))),128)),g.value.length===0?(u(),c("tr",Te,[...t[17]||(t[17]=[e("td",{colspan:"13",class:"text-center text-muted py-4"}," No payments found. ",-1)])])):$("",!0)])])])])])])]),_:1}))}},Be=j(Ce,[["__scopeId","data-v-e938af71"]]);export{Be as default};
