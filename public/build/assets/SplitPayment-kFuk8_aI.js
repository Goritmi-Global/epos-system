import{_ as F,c as m,r as N,w as x,g as p,b,f as o,l as L,m as S,v as C,t as c,u as y,p as D,j as q,F as B,i as R,e as j}from"./app-DiO9MVPc.js";import O from"./StripePayment-eptZ-42M.js";import{u as U}from"./useFormatters-WSM0lB7P.js";const z={class:"row g-3"},E={class:"col-12 col-sm-6"},G={class:"input-group"},H=["max"],J={class:"small text-muted mt-1"},K={class:"col-12 col-sm-6"},Q={class:"input-group"},W=["max"],X={class:"small text-muted mt-1"},Y={class:"d-flex justify-content-between align-items-center mt-3"},Z={class:"fw-semibold"},$={class:"text-success"},_={key:0,class:"alert alert-danger rounded-3 mt-3 mb-0"},ee={class:"m-0 ps-3"},te={class:"pt-3 border-top mt-3"},oe={class:"d-flex gap-2 mt-3"},ae=["disabled"],re={__name:"SplitPayment",props:{order_code:String,show:Boolean,customer:String,phone:String,deliveryLocation:String,orderType:String,selectedTable:Object,orderItems:Array,grandTotal:Number,money:Function,cashReceived:Number,subTotal:Number,tax:Number,serviceCharges:Number,deliveryCharges:Number,note:[String,null],kitchenNote:[String,null],orderDate:String,orderTime:String,paymentMethod:String,paymentType:String,change:Number,promoDiscount:{type:Number,default:0},promoId:{type:[Number,String,null],default:null},promoName:{type:[String,null],default:null},promoType:{type:[String,null],default:null},promoDiscountAmount:{type:Number,default:0},appliedPromos:{type:Array,default:()=>[]},approvedDiscounts:{type:Number,default:0},approvedDiscountDetails:{type:Array,default:()=>[]}},emits:["confirm"],setup(e,{emit:w}){const{formatCurrencySymbol:v}=U(),l=e,I=w,s=m(()=>Number(l.grandTotal??0));ss;const f=Math.floor(s.value/2),r=N(f);let P=s.value-f;const a=N(P);a.value<.5&&(a.value=.5,r.value=s.value-a.value);let i=!1;x(r,n=>{if(i)return;i=!0;const t=Number(n)||0;a.value=Math.max(0,Math.round(s.value*100-t*100)/100),i=!1}),x(a,n=>{if(i)return;i=!0;const t=Number(n)||0;r.value=Math.max(0,Math.round(s.value*100-t*100)/100),i=!1});const k=m(()=>Array.isArray(l.orderItems)?l.orderItems.reduce((n,t)=>{const u=Number(t.price)||0,g=Number(t.qty??t.quantity)||0;return n+u*g},0):0),A=m(()=>Number.isFinite(l.subTotal)?Number(l.subTotal):k.value),M=m(()=>0);function d(n){return Math.round((Number(n)||0)*100)}const h=m(()=>{const n=[];return s.value<=0&&n.push("Total amount must be greater than 0."),r.value<0&&n.push("Cash cannot be negative."),a.value<0&&n.push("Card amount cannot be negative."),d(r.value)+d(a.value)!==d(s.value)&&n.push("Cash + Card must equal the total."),n}),T=m(()=>h.value.length===0);function V(){T.value&&I("confirm",{paymentMethod:"Split",cashReceived:Number(r.value)||0,cardAmount:Number(a.value)||0,changeAmount:0,promoDiscount:l.promoDiscount,promoId:l.promoId,promoName:l.promoName,promoType:l.promoType})}return(n,t)=>(b(),p("div",null,[t[9]||(t[9]=o("div",{class:"pay-header d-flex align-items-center gap-2 mb-3"},[o("i",{class:"bi bi-columns-gap"}),o("h6",{class:"m-0"},"Split Payment")],-1)),o("div",z,[o("div",E,[t[3]||(t[3]=o("label",{class:"form-label fw-semibold"},"Cash Portion",-1)),o("div",G,[t[2]||(t[2]=o("span",{class:"input-group-text"},"£",-1)),S(o("input",{type:"number",min:"0",max:s.value,step:"0.01","onUpdate:modelValue":t[0]||(t[0]=u=>r.value=u),class:"form-control rounded-3"},null,8,H),[[C,r.value,void 0,{number:!0}]])]),o("div",J,c(e.money?y(v)(r.value||0):r.value||0),1)]),o("div",K,[t[5]||(t[5]=o("label",{class:"form-label fw-semibold"},"Card Portion",-1)),o("div",Q,[t[4]||(t[4]=o("span",{class:"input-group-text"},"£",-1)),S(o("input",{type:"number",min:"0",max:s.value,step:"0.01","onUpdate:modelValue":t[1]||(t[1]=u=>a.value=u),class:"form-control rounded-3"},null,8,W),[[C,a.value,void 0,{number:!0}]])]),o("div",X,c(e.money?y(v)(a.value||0):a.value||0),1)])]),o("div",Y,[o("div",Z,[t[6]||(t[6]=D(" Total: ",-1)),o("span",$,c(e.money?y(v)(s.value):s.value),1)]),o("div",{class:q(["small",d(r.value)+d(a.value)===d(s.value)?"text-success":"text-danger"])}," Cash + Card = "+c(e.money?y(v)((r.value||0)+(a.value||0)):Number(r.value||0)+Number(a.value||0)),3)]),h.value.length?(b(),p("div",_,[o("ul",ee,[(b(!0),p(B,null,R(h.value,(u,g)=>(b(),p("li",{key:g},c(u),1))),128))])])):L("",!0),o("div",te,[t[7]||(t[7]=o("label",{class:"form-label fw-semibold"},"Pay Card Portion",-1)),j(O,{order_code:e.order_code,show:e.show,customer:e.customer,phone:e.phone,deliveryLocation:e.deliveryLocation,orderType:e.orderType,selectedTable:e.selectedTable,orderItems:e.orderItems,grandTotal:a.value,money:e.money,cashReceived:r.value,cardPayment:a.value,subTotal:A.value,tax:e.tax??0,serviceCharges:e.serviceCharges??0,deliveryCharges:e.deliveryCharges??0,note:e.note,"kitchen-note":e.kitchenNote,orderDate:e.orderDate??new Date().toISOString().split("T")[0],orderTime:e.orderTime??new Date().toTimeString().split(" ")[0],paymentMethod:"Card",change:M.value,paymentType:"split",type:"split-payment",cardCharge:a.value,"promo-discount":e.promoDiscount,"promo-id":e.promoId,"promo-name":e.promoName,"promo-type":e.promoType,"promo-discount-amount":e.promoDiscountAmount,"applied-promos":e.appliedPromos,"approved-discounts":e.approvedDiscounts,"approved-discount-details":e.approvedDiscountDetails},null,8,["order_code","show","customer","phone","deliveryLocation","orderType","selectedTable","orderItems","grandTotal","money","cashReceived","cardPayment","subTotal","tax","serviceCharges","deliveryCharges","note","kitchen-note","orderDate","orderTime","change","cardCharge","promo-discount","promo-id","promo-name","promo-type","promo-discount-amount","applied-promos","approved-discounts","approved-discount-details"])]),o("div",oe,[o("button",{class:"btn brand-btn rounded-pill px-3 py-2",disabled:!T.value,onClick:V},[...t[8]||(t[8]=[o("i",{class:"bi bi-check2-circle me-1"},null,-1),D(" Confirm Split ",-1)])],8,ae)])]))}},ue=F(re,[["__scopeId","data-v-8f677af9"]]);export{ue as default};
