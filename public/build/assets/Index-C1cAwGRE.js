import{_ as W,r as v,c as P,o as Q,z as K,f as a,b as o,d as G,e as s,u as H,h as J,i as z,t as n,m as d,F as _,g as b,K as N,l as p}from"./app-1wYiyYIQ.js";const X={class:"page-wrapper"},Y={class:"container-fluid px-4"},Z={class:"d-flex justify-content-between align-items-center py-2"},ee={class:"d-flex align-items-center gap-2"},se={class:"small fw-semibold"},te={class:"d-flex align-items-center gap-3"},le={class:"small fw-bold"},ae={class:"small"},oe={class:"container-fluid px-3 py-3"},ne={class:"row gx-3 gy-3"},ie={key:0,class:"row g-3"},re={class:"cat-card"},ce={class:"cat-icon-wrap"},de={class:"cat-icon"},ue=["src"],me={key:1},ve={class:"cat-name"},_e={class:"cat-pill"},he={key:0,class:"col-12"},ge={key:1},fe={class:"d-flex flex-wrap gap-2 align-items-center justify-content-between mb-3"},be={class:"d-flex align-items-center gap-2"},pe={class:"fw-bold mb-0"},ye={key:0,class:"search-display"},xe={class:"row g-3"},we={class:"position-relative",style:{flex:"0 0 40%","max-width":"40%"}},Ce=["src"],ke={key:0,class:"position-absolute bottom-0 start-0 end-0 text-center bg-light bg-opacity-75 fw-semibold",style:{"font-size":"0.6rem !important",padding:"2px 4px"}},Pe={key:0,class:"text-muted text-decoration-line-through me-1"},Ie={class:"fw-bold text-success me-2"},Se={key:1,class:"text-muted text-decoration-line-through me-1"},Ee={class:"fw-bold text-success"},Te={class:"text-decoration-line-through opacity-75 me-1"},De={class:"fw-bold text-white"},Fe={class:"p-3 d-flex flex-column justify-content-between",style:{flex:"1 1 60%","min-width":"0"}},Ve={key:0,class:"position-absolute px-2 py-1 rounded-pill bg-success text-white small fw-bold",style:{fontSize:"0.7rem",top:"7px",right:"7px"}},Oe={key:1,class:"mb-3"},ze=["value"],Ne=["value"],je={key:2},Be={class:"form-label small fw-semibold mb-2"},Me={key:0,class:"text-muted",style:{"font-size":"0.75rem"}},Ae={key:0,class:"d-flex flex-wrap gap-1"},Le={key:1,class:"text-muted small fst-italic"},Re={key:0,class:"col-lg-4"},Ue={class:"cart card border-0 shadow-lg rounded-4"},$e={class:"cart-header"},qe={class:"order-type"},We={class:"ot-pill active"},Qe={class:"cart-body"},Ke={class:"mb-3"},Ge={key:0,class:"row g-2"},He={class:"col-6"},Je={class:"form-control form-control-sm bg-light"},Xe={class:"col-6"},Ye={class:"form-control form-control-sm bg-light"},Ze={key:1},es={class:"form-control form-control-sm bg-light"},ss={class:"cart-lines"},ts={key:0,class:"empty"},ls={class:"line-left"},as=["src"],os={class:"meta d-flex align-items-center flex-wrap gap-1"},ns=["title"],is={key:0,class:"badge d-inline-flex align-items-center gap-1 sale-badge"},rs={key:1,class:"text-muted small d-inline-flex align-items-center"},cs={key:2,class:"badge ms-1",style:{"font-size":"0.65rem",background:"#1B1670",color:"white"}},ds={key:3,class:"badge bg-success ms-1",style:{"font-size":"0.65rem"}},us={key:0,class:"note text-muted small mt-1"},ms={class:"line-mid"},vs={class:"qty"},_s={class:"line-right"},hs={class:"price"},gs={class:"totals"},fs={class:"trow"},bs={class:"sub-total"},ps={key:0,class:"trow"},ys={class:"text-info"},xs={key:1,class:"d-flex justify-content-between mb-2"},ws={class:"fw-semibold"},Cs={key:2,class:"d-flex justify-content-between mb-2"},ks={class:"fw-semibold"},Ps={key:3,class:"trow"},Is={class:"text-danger"},Ss={key:4,class:"promos-section mb-3"},Es={class:"promo-total mt-2 rounded-3 bg-success-subtle"},Ts={class:"d-flex justify-content-between align-items-center"},Ds={class:"text-success fs-6"},Fs={class:"trow total"},Vs={key:0,class:"mt-3"},Os={class:"form-control form-control-sm rounded-3 bg-light",style:{"min-height":"60px"}},zs={class:"cart-footer"},Ns={class:"text-center py-2"},js={class:"text-muted small fw-semibold"},Bs={__name:"Index",props:{terminalId:{type:String,required:!0}},setup(j){const F=j,r=v({items:[],customer:"Walk In",orderType:"Dine In",table:null,subtotal:0,tax:0,serviceCharges:0,deliveryCharges:0,saleDiscount:0,promoDiscount:0,total:0,note:"",appliedPromos:[]}),y=v(!0),I=v(null),S=v([]),V=v([]),E=v(""),T=v({}),x=v({}),O=v(new Date().toLocaleTimeString()),m=v("Connecting...");let g=null;const u=l=>`Â£${(parseFloat(l)||0).toFixed(2)}`,B=P(()=>S.value.filter(l=>l.menu_items_count>0)),L=P(()=>{const l={};return V.value.forEach(t=>{const e=t.category?.id||"uncategorized",i=t.category?.name||"Uncategorized";l[e]||(l[e]=[]);const c={id:t.id,title:t.name,img:t.image_url||"/assets/img/default.png",price:Number(t.price),label_color:t.label_color||"#1B1670",family:i,description:t.description,variants:t.variants??[],addon_groups:t.addon_groups??[]};l[e].push(c)}),l}),M=P(()=>L.value[I.value]??[]),R=P(()=>{const l=(E.value||"").trim().toLowerCase();return l?M.value.filter(t=>t.title.toLowerCase().includes(l)||(t.family||"").toLowerCase().includes(l)||(t.description||"").toLowerCase().includes(l)):M.value}),U=P(()=>S.value.find(l=>l.id===I.value)?.name||"Items"),w=l=>{if(!l.variants||l.variants.length===0)return null;const t=T.value[l.id];return l.variants.find(e=>e.id===t)||l.variants[0]},D=(l,t=!1)=>{if(!l)return 0;const e=l.is_saleable??l?.menu_item?.is_saleable,i=l.resale_type??l?.menu_item?.resale_type,c=l.resale_value??l?.menu_item?.resale_value,h=parseFloat(l.price||0);return!e||!i||!c?0:i==="flat"?parseFloat(c):i==="percentage"?h*parseFloat(c)/100:0},C=(l,t=!1)=>{const e=parseFloat(l.price||0),i=D(l,t);return Math.max(0,e-i)},k=(l,t=!1)=>{if(!l)return null;const e=l.is_saleable??l?.menu_item?.is_saleable,i=l.resale_type??l?.menu_item?.resale_type,c=l.resale_value??l?.menu_item?.resale_value,h=D(l,t);return!e||!i||!c||h<=0?null:{type:i,value:c,amount:h,display:i==="flat"?`Sale ${u(h)}`:`${c}% OFF`}},f=l=>{if(!l.variants||l.variants.length===0){const c=D(l,!1)>0;return{min:C(l,!1),max:C(l,!1),minOriginal:c?parseFloat(l.price||0):null,maxOriginal:c?parseFloat(l.price||0):null}}const t=l.variants.map(c=>C(c,!0)),e=l.variants.map(c=>parseFloat(c.price||0)),i=l.variants.some(c=>D(c,!0)>0);return{min:Math.min(...t),max:Math.max(...t),minOriginal:i?Math.min(...e):null,maxOriginal:i?Math.max(...e):null}},A=l=>{const t=w(l);let e;t?e=C(t,!0):e=C(l,!1);const i=x.value[l.id]||{};let c=0;return Object.values(i).forEach(h=>{Array.isArray(h)&&h.forEach(q=>{c+=Number(q.price||0)})}),e+c},$=l=>!r.value.appliedPromos||r.value.appliedPromos.length===0?!1:r.value.appliedPromos.some(t=>!t.applied_to_items||t.applied_to_items.length===0?!0:t.applied_to_items.includes(l.id));return Q(()=>{if(setInterval(()=>{O.value=new Date().toLocaleTimeString()},1e3),console.log("ðŸ”Œ Terminal ID:",F.terminalId),!window.Echo){console.error("âŒ Echo not found - WebSocket connection failed"),m.value="Error: Echo not found";return}try{const l=`pos-terminal.${F.terminalId}`;if(console.log("ðŸ”Œ Subscribing to channel:",l),g=window.Echo.channel(l),g.subscribed(()=>{console.log("âœ… Successfully subscribed to:",l),m.value="Connected"}),g.listen(".cart.updated",t=>{console.log("ðŸ“¦ Cart update received:",t),r.value=t.cart,m.value="Connected"}),g.listen(".ui.updated",t=>{console.log("ðŸ–¥ï¸ UI update received:",t);const e=t.ui||t;e.showCategories!==void 0&&(y.value=e.showCategories),e.activeCat!==void 0&&(I.value=e.activeCat),e.menuCategories&&(S.value=e.menuCategories),e.menuItems&&(V.value=e.menuItems),e.searchQuery!==void 0&&(E.value=e.searchQuery),e.selectedCardVariant&&(T.value=e.selectedCardVariant),e.selectedCardAddons&&(x.value=e.selectedCardAddons),console.log("âœ… UI state updated:",{showCategories:y.value,activeCat:I.value,categoriesCount:S.value.length,itemsCount:V.value.length,selectedVariants:Object.keys(T.value).length,selectedAddons:Object.keys(x.value).length})}),g.error(t=>{console.error("âŒ Channel error:",t),m.value="Error"}),window.Echo.connector&&window.Echo.connector.pusher){const t=window.Echo.connector.pusher;t.connection.bind("connected",()=>{console.log("âœ… Pusher connected"),m.value="Connected"}),t.connection.bind("connecting",()=>{console.log("ðŸ”„ Pusher connecting..."),m.value="Connecting..."}),t.connection.bind("disconnected",()=>{console.log("âŒ Pusher disconnected"),m.value="Disconnected"}),t.connection.bind("unavailable",()=>{console.log("âŒ Pusher unavailable"),m.value="Unavailable"}),t.connection.bind("failed",()=>{console.log("âŒ Pusher connection failed"),m.value="Connection Failed"}),t.connection.bind("error",e=>{console.error("âŒ Pusher error:",e),m.value="Connection Error"}),console.log("ðŸ” Current Pusher state:",t.connection.state)}}catch(l){console.error("âŒ Echo setup error:",l),m.value="Setup Error"}setTimeout(()=>{if(window.Echo&&window.Echo.connector&&window.Echo.connector.pusher){const l=window.Echo.connector.pusher;console.log("ðŸ“Š Echo Debug Info:",{state:l.connection.state,key:l.key,config:l.config,channels:Object.keys(l.channels.channels)})}},2e3)}),K(()=>{g&&window.Echo.leaveChannel(`pos-terminal.${F.terminalId}`)}),(l,t)=>(o(),a(_,null,[G(H(J),{title:"Customer Display"}),s("div",X,[s("div",{class:z(["connection-bar",m.value==="Connected"?"connected":"disconnected"])},[s("div",Y,[s("div",Z,[s("div",ee,[s("span",{class:z(["status-dot",m.value==="Connected"?"active":""])},null,2),s("span",se,n(m.value),1)]),s("div",te,[s("span",le,n(O.value),1),s("span",ae,"Terminal: "+n(j.terminalId),1)])])])],2),s("div",oe,[s("div",ne,[s("div",{class:z(y.value?"col-md-12":"col-lg-8")},[y.value?(o(),a("div",ie,[t[1]||(t[1]=s("div",{class:"col-12 mb-3"},[s("h4",{class:"mb-3"},"Menu Categories"),s("hr",{class:"mt-2 mb-3"})],-1)),(o(!0),a(_,null,b(B.value,e=>(o(),a("div",{key:e.id,class:"col-6 col-md-4 col-lg-3"},[s("div",re,[s("div",ce,[s("span",de,[e.image_url?(o(),a("img",{key:0,src:e.image_url,alt:"Category Image",class:"cat-image"},null,8,ue)):(o(),a("span",me,"ðŸµ"))])]),s("div",ve,n(e.name),1),s("div",_e,n(e.menu_items_count)+" Menu ",1)])]))),128)),B.value.length===0?(o(),a("div",he,[...t[0]||(t[0]=[s("div",{class:"alert alert-light border text-center rounded-4"}," No categories found ",-1)])])):d("",!0)])):(o(),a("div",ge,[s("div",fe,[s("div",be,[t[2]||(t[2]=s("i",{class:"bi bi-arrow-left text-primary fs-5"},null,-1)),s("h5",pe,n(U.value),1)]),E.value?(o(),a("div",ye,[t[3]||(t[3]=s("i",{class:"bi bi-search me-2"},null,-1)),s("span",null,n(E.value),1)])):d("",!0)]),s("div",xe,[(o(!0),a(_,null,b(R.value,e=>(o(),a("div",{class:"col-12 col-md-6 col-xl-6 d-flex",key:e.id},[s("div",{class:"card rounded-4 shadow-sm overflow-hidden border-3 w-100 d-flex flex-row align-items-stretch",style:N({borderColor:e.label_color||"#1B1670"})},[s("div",we,[s("img",{src:e.img,alt:"",class:"w-100 h-100",style:{"object-fit":"cover"}},null,8,Ce),e.variants&&e.variants.length>0?(o(),a("div",ke,[f(e).minOriginal!==null?(o(),a("span",Pe,n(u(f(e).minOriginal)),1)):d("",!0),s("span",Ie,n(u(f(e).min))+" - ",1),f(e).maxOriginal!==null?(o(),a("span",Se,n(u(f(e).maxOriginal)),1)):d("",!0),s("span",Ee,n(u(f(e).max)),1)])):d("",!0),s("span",{class:"position-absolute top-0 start-0 m-2 px-2 py-1 rounded-pill text-white fw-semibold",style:N({background:e.label_color||"#1B1670",fontSize:"0.78rem"})},[k(w(e)||e,!!e.variants?.length)?(o(),a(_,{key:0},[s("span",Te,n(u(w(e)?.price||e.price)),1),s("span",De,n(u(A(e))),1)],64)):(o(),a(_,{key:1},[p(n(u(A(e))),1)],64))],4)]),s("div",Fe,[s("div",null,[e.variants&&e.variants.length>0&&k(w(e),!0)||(!e.variants||e.variants.length===0)&&k(e,!1)?(o(),a("span",Ve,n(e.variants&&e.variants.length>0?k(w(e),!0).display:k(e,!1).display),1)):d("",!0),s("div",{class:"h5 fw-bold mb-2",style:N({color:e.label_color||"#1B1670"})},n(e.title),5),e.variants&&e.variants.length>0?(o(),a("div",Oe,[t[4]||(t[4]=s("label",{class:"form-label small fw-semibold mb-1"}," Selected Variant: ",-1)),s("select",{value:T.value[e.id]||e.variants[0].id,class:"form-select form-select-sm variant-select",disabled:"",style:{"background-color":"#f8f9fa",cursor:"not-allowed"}},[(o(!0),a(_,null,b(e.variants,i=>(o(),a("option",{key:i.id,value:i.id},n(i.name)+" - "+n(u(i.price)),9,Ne))),128))],8,ze)])):d("",!0),e.addon_groups&&e.addon_groups.length>0?(o(),a("div",je,[(o(!0),a(_,null,b(e.addon_groups,i=>(o(),a("div",{key:i.group_id,class:"mb-3"},[s("label",Be,[p(n(i.group_name)+" ",1),i.max_select>0?(o(),a("span",Me," (Max "+n(i.max_select)+") ",1)):d("",!0)]),x.value[e.id]?.[i.group_id]?.length>0?(o(),a("div",Ae,[(o(!0),a(_,null,b(x.value[e.id][i.group_id],c=>(o(),a("span",{key:c.id,class:"badge bg-primary px-2 py-1"},n(c.name)+" +"+n(u(c.price)),1))),128))])):(o(),a("div",Le," No addons selected "))]))),128))])):d("",!0)])])],4)]))),128))])]))],2),y.value?d("",!0):(o(),a("div",Re,[s("div",Ue,[s("div",$e,[s("div",qe,[s("div",We,n(r.value.orderType),1)])]),s("div",Qe,[s("div",Ke,[r.value.orderType==="Dine In"?(o(),a("div",Ge,[s("div",He,[t[5]||(t[5]=s("label",{class:"form-label small"},"Table",-1)),s("div",Je,n(r.value.table?.name||"Select Table"),1)]),s("div",Xe,[t[6]||(t[6]=s("label",{class:"form-label small"},"Customer",-1)),s("div",Ye,n(r.value.customer),1)])])):(o(),a("div",Ze,[t[7]||(t[7]=s("label",{class:"form-label small"},"Customer",-1)),s("div",es,n(r.value.customer),1)]))]),s("div",ss,[r.value.items.length===0?(o(),a("div",ts," Add items from the left ")):d("",!0),(o(!0),a(_,null,b(r.value.items,(e,i)=>(o(),a("div",{key:i,class:"line"},[s("div",ls,[s("img",{src:e.img||"/assets/img/default.png",alt:""},null,8,as),s("div",os,[s("div",{class:"name fw-semibold text-truncate",title:e.title,style:{"max-width":"150px"}},n(e.title),9,ns),e.resale_discount_per_item>0?(o(),a("span",is,[t[8]||(t[8]=s("i",{class:"bi bi-star-fill blinking-star"},null,-1)),p(" -"+n(u(e.resale_discount_per_item)),1)])):d("",!0),e.addons&&e.addons.length>0?(o(),a("span",rs,[t[9]||(t[9]=s("i",{class:"bi bi-plus-circle-fill text-primary me-1",style:{"font-size":"0.9rem"}},null,-1)),p(" "+n(e.addons.length)+" addon(s) ",1)])):d("",!0),e.variant_name?(o(),a("span",cs,n(e.variant_name),1)):d("",!0),$(e)?(o(),a("span",ds,[...t[10]||(t[10]=[s("i",{class:"bi bi-tag-fill"},null,-1)])])):d("",!0)]),e.note?(o(),a("div",us,n(e.note),1)):d("",!0)]),s("div",ms,[s("div",vs,n(e.qty),1)]),s("div",_s,[s("div",hs,n(u(e.price)),1)])]))),128))]),s("div",gs,[s("div",fs,[t[11]||(t[11]=s("span",null,"Sub Total",-1)),s("b",bs,n(u(r.value.subtotal)),1)]),r.value.tax>0?(o(),a("div",ps,[t[12]||(t[12]=s("span",{class:"d-flex align-items-center gap-2"},[s("i",{class:"bi bi-receipt text-info"}),p(" Tax ")],-1)),s("b",ys,n(u(r.value.tax)),1)])):d("",!0),r.value.serviceCharges>0?(o(),a("div",xs,[t[13]||(t[13]=s("span",{class:"text-muted"},"Service Charges:",-1)),s("span",ws,n(u(r.value.serviceCharges)),1)])):d("",!0),r.value.deliveryCharges>0?(o(),a("div",Cs,[t[14]||(t[14]=s("span",{class:"text-muted"},"Delivery Charges:",-1)),s("span",ks,n(u(r.value.deliveryCharges)),1)])):d("",!0),r.value.saleDiscount>0?(o(),a("div",Ps,[t[15]||(t[15]=s("span",{class:"d-flex align-items-center gap-2"},[s("i",{class:"bi bi-tag text-danger"}),s("span",{class:"text-danger"},"Sale Discount:")],-1)),s("b",Is,"-"+n(u(r.value.saleDiscount)),1)])):d("",!0),r.value.appliedPromos&&r.value.appliedPromos.length>0?(o(),a("div",Ss,[s("div",Es,[s("div",Ts,[t[16]||(t[16]=s("span",{class:"text-success"},"Total Promo Savings:",-1)),s("b",Ds,"-"+n(u(r.value.promoDiscount)),1)])])])):d("",!0),s("div",Fs,[t[17]||(t[17]=s("span",null,"Total",-1)),s("b",null,n(u(r.value.total)),1)])]),r.value.note?(o(),a("div",Vs,[t[18]||(t[18]=s("label",{class:"form-label small fw-semibold"},"Note",-1)),s("div",Os,n(r.value.note),1)])):d("",!0)]),s("div",zs,[s("div",Ns,[s("span",js,[t[19]||(t[19]=s("i",{class:"bi bi-clock-fill me-1"},null,-1)),p(" "+n(O.value),1)])])])])]))])])])],64))}},As=W(Bs,[["__scopeId","data-v-0d4d6f83"]]);export{As as default};
