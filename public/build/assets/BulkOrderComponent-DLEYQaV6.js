import{_ as E,r as b,j as N,D as F,E as O,g as u,o as i,b as t,s as M,a as k,i as h,n as P,d as _,t as d,F as T,v as j,x as V,y as q,m as v}from"./app-DgHj6V6q.js";import{s as A}from"./index-Ctb2bikc.js";import{u as L}from"./useFormatters-CPHeofEZ.js";import"./index-BBadkYNm.js";const $={class:"modal fade",id:"bulkOrderModal",tabindex:"-1","aria-hidden":"true"},Q={class:"modal-dialog modal-xl modal-dialog-centered"},Z={class:"modal-content rounded-4"},z={class:"modal-body"},R={class:"mb-3"},G={key:0,class:"text-danger"},H={class:"table-responsive"},J={class:"table align-middle"},K=["onUpdate:modelValue","onInput"],W={key:0,class:"text-danger"},X=["onUpdate:modelValue","onInput"],Y={key:0,class:"text-danger"},ee={key:0,class:"text-danger"},te=["onClick"],le={class:"text-end fw-bold mt-3"},ae={class:"modal-footer"},se=["disabled"],oe={key:0},re={key:1},ne={__name:"BulkOrderComponent",props:{suppliers:{type:Array,default:()=>[]},items:{type:Array,default:()=>[]}},emits:["refresh-data"],setup(f,{emit:w}){const{formatCurrencySymbol:x,dateFmt:C}=L(),S=f,I=w,c=b(null),y=b(!1),s=b({}),n=b([]);N(()=>S.items,a=>{n.value=a.map(l=>({...l,qty:0,unitPrice:0,expiry:null,subtotal:0}))},{immediate:!0});function g(a){const l=Number(a.qty)||0,m=Number(a.unitPrice)||0;a.subtotal=l*m}function U(a){n.value[a].qty=0,n.value[a].unitPrice=0,n.value[a].expiry=null,n.value[a].subtotal=0}const B=F(()=>n.value.reduce((a,l)=>a+(Number(l.subtotal)||0),0));async function D(){s.value={},c.value||(s.value.supplier="Please select a supplier");const a=new Date().toISOString().split("T")[0],l=[];if(n.value.forEach((e,o)=>{const r=e.qty||e.unitPrice||e.expiry,p={};r&&((!e.qty||e.qty<=0)&&(p.qty="Quantity is required"),(!e.unitPrice||e.unitPrice<=0)&&(p.unitPrice="Unit Price is required"),e.expiry?new Date(e.expiry)<new Date(a)&&(p.expiry="Expiry must be today or later"):p.expiry="Expiry date is required",Object.keys(p).length>0?s.value[o]=p:l.push({product_id:e.id,quantity:e.qty,unit_price:e.unitPrice,expiry:e.expiry}))}),!c.value){v.error("Please select a supplier");return}if(l.length===0){v.error("No valid items to submit");return}if(Object.keys(s.value).length>0){v.error("Please fix the highlighted errors");return}const m={supplier_id:c.value,purchase_date:a,status:"completed",items:l};y.value=!0;try{await axios.post("/purchase-orders",m),v.success("Bulk order created successfully!"),I("refresh-data"),c.value=null,n.value.forEach(o=>{o.qty=0,o.unitPrice=0,o.expiry=null,o.subtotal=0}),bootstrap.Modal.getInstance(document.getElementById("bulkOrderModal"))?.hide()}catch(e){console.error(e),v.error("Failed to save bulk order")}finally{y.value=!1}}return(a,l)=>{const m=O("VueDatePicker");return i(),u("div",$,[t("div",Q,[t("div",Z,[l[3]||(l[3]=M('<div class="modal-header" data-v-ce9ae698><h5 class="modal-title fw-semibold" data-v-ce9ae698>Bulk Purchase</h5><button class="absolute top-2 right-2 p-2 rounded-full hover:bg-gray-100 transition transform hover:scale-110" data-bs-dismiss="modal" aria-label="Close" title="Close" data-v-ce9ae698><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" data-v-ce9ae698><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" data-v-ce9ae698></path></svg></button></div>',1)),t("div",z,[t("div",R,[l[1]||(l[1]=t("label",{class:"form-label"},"Preferred Supplier",-1)),k(_(A),{modelValue:c.value,"onUpdate:modelValue":l[0]||(l[0]=e=>c.value=e),options:f.suppliers,optionLabel:"name",optionValue:"id",placeholder:"Select Supplier",class:P(["w-100",{"is-invalid":s.value.supplier}]),appendTo:"self",autoZIndex:!0,baseZIndex:2e3},null,8,["modelValue","options","class"]),s.value.supplier?(i(),u("small",G,d(s.value.supplier),1)):h("",!0)]),t("div",H,[t("table",J,[l[2]||(l[2]=t("thead",null,[t("tr",null,[t("th",null,"Name"),t("th",null,"Category"),t("th",null,"Unit"),t("th",null,"Qty"),t("th",null,"Unit Price"),t("th",null,"Expiry"),t("th",null,"Subtotal"),t("th")])],-1)),t("tbody",null,[(i(!0),u(T,null,j(n.value,(e,o)=>(i(),u("tr",{key:e.id},[t("td",null,d(e.name),1),t("td",null,d(e.category?.name||"-"),1),t("td",null,d(e.unit_name),1),t("td",null,[V(t("input",{type:"number",min:"0","onUpdate:modelValue":r=>e.qty=r,class:"form-control",onInput:r=>g(e)},null,40,K),[[q,e.qty,void 0,{number:!0}]]),s.value[o]?.qty?(i(),u("small",W,d(s.value[o].qty),1)):h("",!0)]),t("td",null,[V(t("input",{type:"number",min:"0","onUpdate:modelValue":r=>e.unitPrice=r,class:"form-control",onInput:r=>g(e)},null,40,X),[[q,e.unitPrice,void 0,{number:!0}]]),s.value[o]?.unitPrice?(i(),u("small",Y,d(s.value[o].unitPrice),1)):h("",!0)]),t("td",null,[k(m,{modelValue:e.expiry,"onUpdate:modelValue":r=>e.expiry=r,format:_(C),"min-date":new Date,enableTimePicker:!1,teleport:!0,placeholder:"Select date",class:P({"is-invalid":s.value[e.id]&&s.value[e.id].expiry_date})},null,8,["modelValue","onUpdate:modelValue","format","min-date","class"]),s.value[o]?.expiry?(i(),u("small",ee,d(s.value[o].expiry),1)):h("",!0)]),t("td",null,d(_(x)(e.subtotal.toFixed(2))),1),t("td",null,[t("button",{class:"btn btn-sm btn-outline-danger",onClick:r=>U(o)}," Clear ",8,te)])]))),128))])])]),t("div",le," Total: "+d(_(x)(B.value.toFixed(2))),1)]),t("div",ae,[t("button",{class:"btn btn-primary rounded-pill px-4 py-2",disabled:y.value,onClick:D},[y.value?(i(),u("span",re,"Saving...")):(i(),u("span",oe,"Save"))],8,se)])])])])}}},pe=E(ne,[["__scopeId","data-v-ce9ae698"]]);export{pe as default};
