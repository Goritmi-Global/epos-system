import{_ as W,r as M,c as g,f as i,m as u,b as r,e as s,t as a,k as f,v as C,T as N,F as L,g as T,i as Y,x as G,u as V}from"./app-D-YzN2ok.js";import{u as H}from"./useFormatters-D-TQAFLH.js";const J={key:0,class:"modal fade show",tabindex:"-1","aria-hidden":"true",style:{display:"block"}},K={class:"modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable"},X={class:"modal-content rounded-4 border-0 shadow"},Z={class:"modal-header border-0"},ee={class:"d-flex align-items-center gap-3"},te={key:0,class:"badge bg-primary"},se={class:"modal-body"},le={class:"filters-section mb-4"},ne={class:"mb-3"},ae={class:"input-group"},oe={class:"row g-3"},ie={class:"col-md-3"},re={class:"col-md-3"},ce={class:"col-md-3"},ue={class:"col-md-3"},de={key:0,class:"mt-3 d-flex align-items-center justify-content-between"},me={class:"d-flex flex-wrap gap-2"},pe={class:"badge bg-secondary"},ve={key:0,class:"badge bg-info"},be={key:1,class:"badge bg-primary"},ge={key:2,class:"badge bg-warning"},fe={key:3,class:"badge bg-success"},he={key:4,class:"badge bg-dark"},ye={key:0,class:"text-center py-5"},_e={key:1},xe={key:0,class:"alert alert-light text-center dark:bg-gray-800 dark:text-white border-0"},ke={class:"mb-2"},we={class:"text-muted"},Ie={key:1,class:"promo-grid"},Me=["onClick"],Ce={class:"promo-checkbox"},Pe=["checked","onClick"],De={class:"promo-header d-flex align-items-center justify-content-between"},Fe={class:"fw-bold fs-6"},Ae={class:"badge bg-primary text-white small"},Se={class:"promo-desc"},$e={key:0,class:"promo-applies-to small mb-2"},Ne={class:"d-flex flex-wrap gap-1 mt-1"},Le={key:0,class:"badge bg-warning-subtle text-warning",style:{"font-size":"11px"}},Te={key:1,class:"promo-applies-to small mb-2"},Ve={class:"promo-info small"},Be={class:"promo-info small"},je={class:"promo-discount d-flex justify-content-between align-items-center mt-2"},ze={class:"fw-bold fs-5 text-danger"},Ue={key:2,class:"alert alert-warning p-2 mt-2 mb-0 small"},qe={class:"modal-footer border-0 justify-content-between"},Ee={key:0,class:"d-flex gap-2 align-items-center"},Oe={class:"text-end me-3"},Qe={class:"d-block text-muted"},Re={class:"text-success fs-5"},We={__name:"PromoModal",props:{show:Boolean,promos:{type:Array,default:()=>[]},orderItems:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1}},emits:["close","apply-promo","clear-promo"],setup(h,{emit:B}){const{formatCurrencySymbol:P}=H(),y=h,D=B,c=M([]),d=M(""),n=M({type:"",maxMinPurchase:null,minDiscount:null,applicability:""}),F=l=>{const e=c.value.findIndex(t=>t.id===l.id);e>=0?c.value.splice(e,1):c.value.push(l)},A=l=>c.value.some(e=>e.id===l.id),j=()=>{const l=c.value.filter(t=>$(t));if(l.length===0)return;const e=l.map(t=>{const o=parseFloat(x(t)),m=v(t);return{...t,applied_discount:o,applied_to_items:m.map(I=>I.id),applied_subtotal:_(t)}});D("apply-promo",e)},z=()=>{c.value=[],D("clear-promo")},U=()=>{d.value="",n.value={type:"",maxMinPurchase:null,minDiscount:null,applicability:""}},k=g(()=>d.value||n.value.type||n.value.maxMinPurchase!==null||n.value.minDiscount!==null||n.value.applicability),q=g(()=>c.value.reduce((l,e)=>l+parseFloat(x(e)),0)),E=g(()=>{const l=new Set;return c.value.forEach(e=>{v(e).forEach(o=>l.add(o.id))}),l.size}),S=l=>l?new Date(l).toLocaleDateString():"-",p=l=>{const e=parseFloat(l);return isNaN(e)?"0.00":e.toFixed(2)},O=g(()=>y.orderItems.map(l=>l.id)),Q=l=>!l.menu_items||l.menu_items.length===0?!0:l.menu_items.map(t=>t.id).some(t=>O.value.includes(t)),v=l=>{if(!l.menu_items||l.menu_items.length===0)return y.orderItems;const e=l.menu_items.map(t=>t.id);return y.orderItems.filter(t=>e.includes(t.id))},_=l=>v(l).reduce((t,o)=>{const m=parseFloat(o.unit_price??o.price??0)||0,I=parseFloat(o.qty??0)||0;return t+m*I},0),x=l=>{const e=parseFloat(l.discount_amount??0)||0,t=_(l);if(l.min_purchase&&t<parseFloat(l.min_purchase))return p(0);if(l.type==="flat")return p(e);if(l.type==="percent"){const o=t*e/100,m=parseFloat(l.max_discount??0)||0;return m>0&&o>m?p(m):p(o)}return p(0)},$=l=>{if(v(l).length===0)return!1;const t=_(l),o=parseFloat(l.min_purchase||0);return t>=o},R=l=>{if(v(l).length===0)return"Add eligible items to cart";const t=_(l),o=parseFloat(l.min_purchase||0);if(t<o){const m=o-t;return`Need $${p(m)} more for min purchase`}return""},b=()=>{n.value={...n.value}},w=g(()=>{let l=[...y.promos];if(d.value){const e=d.value.toLowerCase();l=l.filter(t=>t.name.toLowerCase().includes(e)||t.description&&t.description.toLowerCase().includes(e))}return n.value.type&&(l=l.filter(e=>e.type===n.value.type)),n.value.maxMinPurchase!==null&&n.value.maxMinPurchase>0&&(l=l.filter(e=>parseFloat(e.min_purchase||0)<=n.value.maxMinPurchase)),n.value.minDiscount!==null&&n.value.minDiscount>0&&(l=l.filter(e=>parseFloat(x(e))>=n.value.minDiscount)),n.value.applicability==="cart"?l=l.filter(e=>Q(e)&&v(e).length>0):n.value.applicability==="all"&&(l=l.filter(e=>!e.menu_items||e.menu_items.length===0)),l});return(l,e)=>h.show?(r(),i("div",J,[s("div",K,[s("div",X,[s("div",Z,[s("div",ee,[e[7]||(e[7]=s("h5",{class:"modal-title fw-bold mb-0"},"Select Promotions",-1)),c.value.length>0?(r(),i("span",te,a(c.value.length)+" Selected ",1)):u("",!0)]),s("button",{class:"absolute top-2 right-2 p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-100 transition transform hover:scale-110",onClick:e[0]||(e[0]=t=>l.$emit("close")),"aria-label":"Close",title:"Close"},[...e[8]||(e[8]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),s("div",se,[s("div",le,[s("div",ne,[s("div",ae,[e[9]||(e[9]=s("span",{class:"input-group-text bg-light border-end-0"},[s("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"},[s("path",{d:"M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"})])],-1)),f(s("input",{"onUpdate:modelValue":e[1]||(e[1]=t=>d.value=t),type:"text",class:"form-control border-start-0",placeholder:"Search promos by name or description...",onInput:b},null,544),[[C,d.value]])])]),s("div",oe,[s("div",ie,[e[11]||(e[11]=s("label",{class:"form-label small fw-semibold"},"Promo Type",-1)),f(s("select",{"onUpdate:modelValue":e[2]||(e[2]=t=>n.value.type=t),onChange:b,class:"form-select form-select-sm"},[...e[10]||(e[10]=[s("option",{value:""},"All Types",-1),s("option",{value:"flat"},"Flat Discount",-1),s("option",{value:"percent"},"Percentage",-1)])],544),[[N,n.value.type]])]),s("div",re,[e[12]||(e[12]=s("label",{class:"form-label small fw-semibold"},"Max Min Purchase",-1)),f(s("input",{"onUpdate:modelValue":e[3]||(e[3]=t=>n.value.maxMinPurchase=t),type:"number",class:"form-control form-control-sm",placeholder:"e.g., 50",step:"0.01",onInput:b},null,544),[[C,n.value.maxMinPurchase,void 0,{number:!0}]])]),s("div",ce,[e[13]||(e[13]=s("label",{class:"form-label small fw-semibold"},"Min Discount",-1)),f(s("input",{"onUpdate:modelValue":e[4]||(e[4]=t=>n.value.minDiscount=t),type:"number",class:"form-control form-control-sm",placeholder:"e.g., 5",step:"0.01",onInput:b},null,544),[[C,n.value.minDiscount,void 0,{number:!0}]])]),s("div",ue,[e[15]||(e[15]=s("label",{class:"form-label small fw-semibold"},"Applies To",-1)),f(s("select",{"onUpdate:modelValue":e[5]||(e[5]=t=>n.value.applicability=t),onChange:b,class:"form-select form-select-sm"},[...e[14]||(e[14]=[s("option",{value:""},"All Promos",-1),s("option",{value:"cart"},"Only My Cart Items",-1),s("option",{value:"all"},"All Items",-1)])],544),[[N,n.value.applicability]])])]),k.value?(r(),i("div",de,[s("div",me,[s("span",pe,a(w.value.length)+" of "+a(h.promos.length)+" promos",1),d.value?(r(),i("span",ve,'Search: "'+a(d.value)+'"',1)):u("",!0),n.value.type?(r(),i("span",be,"Type: "+a(n.value.type),1)):u("",!0),n.value.maxMinPurchase?(r(),i("span",ge,"Max Min: $"+a(n.value.maxMinPurchase),1)):u("",!0),n.value.minDiscount?(r(),i("span",fe,"Min Discount: $"+a(n.value.minDiscount),1)):u("",!0),n.value.applicability?(r(),i("span",he,a(n.value.applicability==="cart"?"Cart Items":"All Items"),1)):u("",!0)]),s("button",{onClick:U,class:"btn btn-sm btn-outline-secondary"},"Clear Filters")])):u("",!0)]),h.loading?(r(),i("div",ye,[...e[16]||(e[16]=[s("div",{class:"spinner-border text-primary",role:"status"},[s("span",{class:"visually-hidden"},"Loading...")],-1),s("p",{class:"mt-3 text-muted"},"Loading promotions...",-1)])])):(r(),i("div",_e,[w.value.length===0?(r(),i("div",xe,[s("p",ke,a(d.value||k.value?"No promotions match your filters":"No promotions available"),1),s("small",we,a(k.value?"Try adjusting your filters":"Add eligible items to see available promos"),1)])):(r(),i("div",Ie,[(r(!0),i(L,null,T(w.value,t=>(r(),i("div",{key:t.id,class:Y(["promo-card",{selected:A(t)}]),onClick:o=>F(t)},[s("div",Ce,[s("input",{type:"checkbox",checked:A(t),onClick:G(o=>F(t),["stop"]),class:"form-check-input"},null,8,Pe)]),s("div",De,[s("span",Fe,a(t.name),1),s("span",Ae,a(t.type.toUpperCase()),1)]),s("p",Se,a(t.description||"Special discount offer"),1),t.menu_items&&t.menu_items.length>0?(r(),i("div",$e,[e[17]||(e[17]=s("strong",null,"Applies to:",-1)),s("div",Ne,[(r(!0),i(L,null,T(v(t),o=>(r(),i("span",{key:o.id,class:"badge bg-success-subtle text-success",style:{"font-size":"11px"}},a(o.title)+" (×"+a(o.qty)+") ",1))),128)),v(t).length===0?(r(),i("span",Le," No cart items match ")):u("",!0)])])):(r(),i("div",Te,[...e[18]||(e[18]=[s("span",{class:"badge bg-info-subtle text-info"},"Applies to all items",-1)])])),s("div",Ve," Valid: "+a(S(t.start_date))+" → "+a(S(t.end_date)),1),s("div",Be," Min: $"+a(p(t.min_purchase))+" | Max: $"+a(t.max_discount?p(t.max_discount):"—"),1),s("div",je,[e[19]||(e[19]=s("span",{class:"fw-semibold"},"You Save:",-1)),s("span",ze,a(V(P)(x(t))),1)]),$(t)?u("",!0):(r(),i("div",Ue,a(R(t)),1))],10,Me))),128))]))]))]),s("div",qe,[s("button",{class:"btn btn-secondary rounded-pill py-2 px-4",onClick:e[6]||(e[6]=t=>l.$emit("close"))},"Close"),c.value.length>0?(r(),i("div",Ee,[s("div",Oe,[s("small",Qe,a(c.value.length)+" Promo(s) • "+a(E.value)+" Item(s) ",1),s("strong",Re,a(V(P)(q.value)),1)]),s("button",{class:"btn btn-success rounded-pill px-4",onClick:j}," Apply ("+a(c.value.length)+") ",1),s("button",{class:"btn btn-outline-danger rounded-pill",onClick:z},"Clear")])):u("",!0)])])]),e[20]||(e[20]=s("div",{class:"modal-backdrop fade show"},null,-1))])):u("",!0)}},He=W(We,[["__scopeId","data-v-9dfabf34"]]);export{He as default};
