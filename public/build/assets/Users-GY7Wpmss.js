import{_ as L,r as d,C as R,k as Z,D as H,g as i,o as n,b as e,i as v,f as P,F as N,v as z,t as r,n as u,c as O,a as U,d as V,x as g,y as D,z as A,e as W,A as h,m as f}from"./app-CYEkE9GK.js";import{s as $}from"./index-CxspGS8A.js";import{P as q}from"./pencil-CHVYe7FI.js";import"./index-CFvNnlhZ.js";import"./createLucideIcon-BvjKrCmJ.js";const G={class:"card border-0 rounded-4 shadow-sm"},J={class:"card-body p-0"},K={class:"table-responsive"},Q={class:"table table-hover mb-0 align-middle"},X={class:"d-flex align-items-center gap-2"},Y={class:"rounded-circle d-inline-flex align-items-center justify-content-center",style:{width:"32px",height:"32px",background:"#1C0D82",color:"#fff"}},ee={class:"fw-semibold"},se={class:"d-inline-flex align-items-center gap-3"},le=["onClick"],te={key:1,class:"inline-flex items-center justify-center p-2 rounded-full text-gray-400 cursor-not-allowed",disabled:"",title:"Cannot delete Super Admin/Admin users"},ae={key:0},oe={key:0,class:"text-center py-3"},ne={key:0,class:"modal show d-block",style:{background:"#0006",transition:"none"}},ie={class:"modal-dialog modal-dialog-centered modal-lg"},de={class:"modal-content rounded-4"},re={class:"modal-header"},ue={class:"modal-title"},ve={class:"modal-body"},ce={class:"row g-3"},pe={class:"col-md-6"},me={key:0,class:"invalid-feedback d-block"},be={class:"col-md-6"},fe={key:0,class:"invalid-feedback d-block"},ye={class:"col-md-6"},_e={class:"position-relative"},we=["type"],ge=["aria-label"],ke={key:0,class:"invalid-feedback d-block"},he={class:"col-md-6"},xe={class:"position-relative"},Ce=["type"],Ue=["aria-label"],Ve={class:"col-md-6"},Ae={class:"position-relative"},Se=["type"],Ie=["aria-label"],Pe={key:0,class:"invalid-feedback d-block"},Ne={class:"col-md-6"},De={key:0,class:"invalid-feedback d-block"},$e={class:"col-md-6"},Me={class:"modal-footer"},Ee=["disabled"],je={key:0,class:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"},Be={__name:"Users",setup(Te){const c=d([]),k=d([]),x=d(!1),y=d(!1),_=d(null),p=d(!1),m=d(!1),b=d(!1),o=d({name:"",email:"",password:"",password_confirmation:"",pin:"",status:"Active",role_id:null}),a=d({}),S=l=>!["Super Admin","Admin"].includes(l.role??"");function M(){_.value=null,o.value={name:"",email:"",password:"",password_confirmation:"",pin:"",status:"Active",role_id:k.value.find(l=>l.name==="Waiter")?.id??null},a.value={},p.value=m.value=b.value=!1,y.value=!0}function E(l){_.value=l.id,o.value={name:l.name,email:l.email,password:"",password_confirmation:"",pin:"",status:l.status||"Active",role_id:l.role_id||k.value.find(s=>s.name===l.role)?.id||null},a.value={},p.value=m.value=b.value=!1,y.value=!0}const j=[{name:"Active",value:"Active"},{name:"Inactive",value:"Inactive"}],I=d([]);async function B(){try{x.value=!0;const{data:l}=await h.get("/users");c.value=l.users||[],k.value=l.roles||[],I.value=(l.roles||[]).map(s=>({name:s.name,value:s.id}))}catch(l){console.error(l),f.error("Failed to load users")}finally{x.value=!1}}R(()=>(k.value||[]).map(l=>({label:l.name,value:l.id})));const w=d(!1);async function T(){try{if(w.value=!0,a.value={},_.value){const{data:l}=await h.put(`/users/${_.value}`,o.value),s=c.value.findIndex(C=>C.id===_.value);s!==-1&&(c.value[s]=l.user),f.success("User updated")}else{const{data:l}=await h.post("/users",o.value);c.value.push(l.user),f.success("User created Successfully")}y.value=!1}catch(l){if(l?.response?.status===422){a.value=l.response.data?.errors||{};const s=Object.values(a.value)?.[0]?.[0]??"Fix validation errors.";f.error(s)}else f.error(l?.response?.data?.message||"Something went wrong")}finally{w.value=!1}}async function F(l){if(S(l))try{await h.delete(`/users/${l.id}`),c.value=c.value.filter(s=>s.id!==l.id),f.success("User deleted successfully")}catch(s){f.error(s?.response?.data?.message||"Delete failed")}}return Z(B),(l,s)=>{const C=H("ConfirmModal");return n(),i(N,null,[e("div",G,[e("div",{class:"card-header d-flex align-items-center justify-content-between"},[s[14]||(s[14]=e("div",null,[e("h5",{class:"mb-0"},"Users"),e("small",{class:"text-muted"},"View and manage Users")],-1)),e("button",{class:"btn btn-primary rounded-pill px-3 py-2",onClick:M},[...s[13]||(s[13]=[e("i",{class:"bi bi-plus-lg me-1"},null,-1),P(" Add User ",-1)])])]),e("div",J,[e("div",K,[e("table",Q,[s[17]||(s[17]=e("thead",{class:"table-primary"},[e("tr",null,[e("th",null,"Username"),e("th",null,"Role"),e("th",null,"Status"),e("th",{style:{width:"120px"}},"Action")])],-1)),e("tbody",null,[(n(!0),i(N,null,z(c.value,t=>(n(),i("tr",{key:t.id},[e("td",null,[e("div",X,[e("div",Y,r((t.name||"U").charAt(0).toUpperCase()),1),e("div",ee,r(t.name),1)])]),e("td",null,r(t.role||"—"),1),e("td",null,[e("span",{class:u(["badge rounded-pill py-1 px-2",t.status==="Active"?"bg-success":"bg-secondary"])},r(t.status),3)]),e("td",null,[e("div",se,[e("button",{class:"p-2 rounded-full text-blue-600 hover:bg-blue-100",onClick:Fe=>E(t),title:"Edit"},[U(V(q),{class:"w-4 h-4"})],8,le),S(t)?(n(),O(C,{key:0,title:"Delete User",message:`Are you sure you want to delete user '${t.name}'?`,showDeleteButton:!0,onConfirm:()=>F(t),onCancel:()=>{}},null,8,["message","onConfirm"])):(n(),i("button",te,[...s[15]||(s[15]=[e("i",{class:"bi bi-trash"},null,-1)])]))])])]))),128)),c.value.length===0?(n(),i("tr",ae,[...s[16]||(s[16]=[e("td",{colspan:"4",class:"text-center text-muted py-4"},"No users found",-1)])])):v("",!0)])])]),x.value?(n(),i("div",oe,[...s[18]||(s[18]=[e("span",{class:"spinner-border"},null,-1)])])):v("",!0)])]),y.value?(n(),i("div",ne,[e("div",ie,[e("div",de,[e("div",re,[e("h6",ue,r(_.value?"Edit User":"Add New User"),1),e("button",{class:"absolute top-2 right-2 p-2 rounded-full hover:bg-gray-100 transition transform hover:scale-110",onClick:s[0]||(s[0]=t=>y.value=!1),"data-bs-dismiss":"modal","aria-label":"Close",title:"Close"},[...s[19]||(s[19]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("div",ve,[e("div",ce,[e("div",pe,[s[20]||(s[20]=e("label",{class:"form-label"},"User Name",-1)),g(e("input",{"onUpdate:modelValue":s[1]||(s[1]=t=>o.value.name=t),class:u(["form-control",{"is-invalid":a.value.name}])},null,2),[[D,o.value.name]]),a.value.name?(n(),i("div",me,r(a.value.name[0]),1)):v("",!0)]),e("div",be,[s[21]||(s[21]=e("label",{class:"form-label"},"Email",-1)),g(e("input",{"onUpdate:modelValue":s[2]||(s[2]=t=>o.value.email=t),type:"email",class:u(["form-control",{"is-invalid":a.value.email}])},null,2),[[D,o.value.email]]),a.value.email?(n(),i("div",fe,r(a.value.email[0]),1)):v("",!0)]),e("div",ye,[s[22]||(s[22]=e("label",{class:"form-label"},"Password",-1)),e("div",_e,[g(e("input",{type:p.value?"text":"password","onUpdate:modelValue":s[3]||(s[3]=t=>o.value.password=t),class:u(["form-control pe-5",{"is-invalid":a.value.password}]),placeholder:"Enter password"},null,10,we),[[A,o.value.password]]),e("button",{type:"button",class:"btn btn-link p-0 position-absolute top-50 end-0 translate-middle-y me-3",onClick:s[4]||(s[4]=t=>p.value=!p.value),"aria-label":p.value?"Hide password":"Show password"},[e("i",{class:u(p.value?"bi bi-eye-slash":"bi bi-eye")},null,2)],8,ge)]),a.value.password?(n(),i("div",ke,r(a.value.password[0]),1)):v("",!0)]),e("div",he,[s[23]||(s[23]=e("label",{class:"form-label"},"Confirm Password",-1)),e("div",xe,[g(e("input",{type:m.value?"text":"password","onUpdate:modelValue":s[5]||(s[5]=t=>o.value.password_confirmation=t),class:"form-control pe-5",placeholder:"Confirm password"},null,8,Ce),[[A,o.value.password_confirmation]]),e("button",{type:"button",class:"btn btn-link p-0 position-absolute top-50 end-0 translate-middle-y me-3",onClick:s[6]||(s[6]=t=>m.value=!m.value),"aria-label":m.value?"Hide password":"Show password"},[e("i",{class:u(m.value?"bi bi-eye-slash":"bi bi-eye")},null,2)],8,Ue)])]),e("div",Ve,[s[24]||(s[24]=e("label",{class:"form-label"},"Pin",-1)),e("div",Ae,[g(e("input",{type:b.value?"text":"password","onUpdate:modelValue":s[7]||(s[7]=t=>o.value.pin=t),maxlength:"4",inputmode:"numeric",pattern:"[0-9]*",class:u(["form-control pe-5 text-center",{"is-invalid":a.value.pin}]),style:{"letter-spacing":".5rem","font-variant-numeric":"tabular-nums"},placeholder:"••••",onPaste:s[8]||(s[8]=W(()=>{},["prevent"]))},null,42,Se),[[A,o.value.pin]]),e("button",{type:"button",class:"btn btn-link p-0 position-absolute top-50 end-0 translate-middle-y me-3",onClick:s[9]||(s[9]=t=>b.value=!b.value),"aria-label":b.value?"Hide PIN":"Show PIN",title:"Toggle PIN visibility"},[e("i",{class:u(b.value?"bi bi-eye-slash":"bi bi-eye")},null,2)],8,Ie)]),a.value.pin?(n(),i("div",Pe,r(a.value.pin[0]),1)):v("",!0)]),e("div",Ne,[s[25]||(s[25]=e("label",{class:"form-label"},"Select Role",-1)),U(V($),{modelValue:o.value.role_id,"onUpdate:modelValue":s[10]||(s[10]=t=>o.value.role_id=t),options:I.value,optionLabel:"name",optionValue:"value",placeholder:"Select Role",class:u(["w-100",{"is-invalid":a.value.role_id}]),appendTo:"self",autoZIndex:!0,baseZIndex:2e3},null,8,["modelValue","options","class"]),a.value.role_id?(n(),i("div",De,r(a.value.role_id[0]),1)):v("",!0)]),e("div",$e,[s[26]||(s[26]=e("label",{class:"form-label"},"Select Status",-1)),U(V($),{modelValue:o.value.status,"onUpdate:modelValue":s[11]||(s[11]=t=>o.value.status=t),options:j,optionLabel:"name",optionValue:"value",placeholder:"Status",class:u(["w-100",{"is-invalid":a.value.status}]),appendTo:"self",autoZIndex:!0,baseZIndex:2e3},null,8,["modelValue","class"])])])]),e("div",Me,[e("button",{class:"btn btn-primary rounded-pill px-3 py-2 d-flex align-items-center justify-content-center",onClick:T,disabled:w.value},[w.value?(n(),i("span",je)):v("",!0),P(" "+r(w.value?"Saving...":"Save"),1)],8,Ee),e("button",{class:"btn btn-secondary rounded-pill px-2 py-2",onClick:s[12]||(s[12]=t=>y.value=!1)},"Cancel")])])])])):v("",!0)],64)}}},Oe=L(Be,[["__scopeId","data-v-f3f42da2"]]);export{Oe as default};
