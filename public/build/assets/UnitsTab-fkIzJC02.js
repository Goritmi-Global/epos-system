import{_ as ie,r as p,c as X,w as H,o as de,g as r,b as i,e as S,f as t,u as $,h as ue,l as E,m as P,v as j,p as x,F as D,i as G,t as c,C as ce,P as me,Z as W,j as B,T as ve,q as F,n as pe,s as l}from"./app-DFa9wJfT.js";import{E as fe,a as be,X as ge,u as N,w as he}from"./xlsx-D7Bllkjp.js";import{I as _e}from"./importFile-DztHevzD.js";import{s as ye}from"./index-BS4qPMf4.js";import{P as we}from"./plus-D98gvM_U.js";import{P as xe}from"./pencil-BrP7vlBH.js";import"./index-BBh0WxyH.js";import"./index-V7bpXnBA.js";import"./index-obOPNEdp.js";import"./index-D7oJSlVI.js";import"./index-BjeygHyk.js";import"./createLucideIcon-4LHIASzF.js";const Ue={class:"card border-0 shadow-lg rounded-4"},Ce={class:"card-body"},ke={class:"d-flex flex-wrap gap-2 justify-content-between align-items-center mb-3"},Se={class:"d-flex gap-2"},Ee={class:"search-wrap"},Fe={class:"table-responsive"},Pe={class:"table table-hover"},De={key:0},Le={class:"fw-semibold"},Ve={class:"fw-semibold"},Ne={class:"fw-semibold"},Te={class:"text-center"},$e={class:"d-inline-flex align-items-center gap-3"},Ie=["onClick"],Ae={key:0},Me={colspan:"5",class:"text-center text-muted py-4"},je={key:0,class:"mt-4 d-flex justify-content-between align-items-center"},Be={class:"text-muted small"},Oe={class:"modal fade",id:"modalUnitForm",tabindex:"-1","aria-hidden":"true"},Re={class:"modal-dialog modal-lg modal-dialog-centered"},qe={class:"modal-content rounded-4"},ze={class:"modal-header"},Xe={class:"modal-title"},He={class:"modal-body"},Ge={class:"mb-3 d-flex gap-3 align-items-center"},We={class:"form-check-label"},Ye={class:"form-check-label"},Ze={class:"text-muted d-block mt-1"},Je={key:0},Ke={key:0,class:"text-danger"},Qe={key:1,class:"mt-3"},et={key:0,class:"alert alert-warning"},tt=["value"],at={key:2,class:"text-danger"},ot={key:3,class:"text-danger"},st={class:"col-md-2 mt-4"},lt=["disabled"],nt={__name:"UnitsTab",setup(rt){const L=p(!1),I=p(null),m=p(""),f=p("base"),w=p(null),g=p(null),U=p(""),A=p(null),Y=[{label:"PDF",value:"pdf"},{label:"Excel",value:"excel"},{label:"CSV",value:"csv"}],Z=o=>{o.value&&(oe(o.value),A.value=null)},O=X(()=>v.value.filter(o=>!o.base_unit_id)),T=()=>{m.value="",n.value={},f.value="base",w.value=null,g.value=null},R=X(()=>{const o=U.value.trim().toLowerCase();return o?v.value.filter(e=>e.name.toLowerCase().includes(o)):v.value}),J=()=>{L.value=!1,m.value=""},K=o=>{L.value=!0,I.value=o,m.value=o.name,f.value=o.base_unit_id?"derived":"base",w.value=o.base_unit_id,g.value=o.conversion_factor},Q=async o=>{try{n.value={},await F.delete(`/units/${o.id}`),v.value=v.value.filter(e=>e.id!==o.id),l.success("Unit deleted successfully")}catch(e){e.response&&e.response.data&&e.response.data.message?(n.value.delete=e.response.data.message,l.error(e.response.data.message)):(n.value.delete="An unexpected error occurred while deleting the unit.",l.error("Delete failed"))}},_=p(!1),ee=async()=>{if(!_.value){if(!m.value.trim()){l.error("Please fill out the field can't save an empty field."),n.value={name:["Please fill out the field can't save an empty field"]};return}if(L.value){if(f.value==="derived"){if(!w.value){l.error("Please select a base unit"),n.value={base_unit_id:["Base unit is required for derived units"]};return}if(!g.value||g.value<=0){l.error("Please enter a valid conversion factor"),n.value={conversion_factor:["Conversion factor must be greater than 0"]};return}}try{_.value=!0;const o={name:m.value.trim(),base_unit_id:f.value==="derived"?Number(w.value):null,conversion_factor:f.value==="derived"?Number(g.value):null},{data:e}=await F.put(`/units/${I.value.id}`,o),a=v.value.findIndex(s=>s.id===I.value.id);a!==-1&&(v.value[a]=e),l.success("Unit updated successfully"),await C(),T(),M("modalUnitForm")}catch(o){o.response?.data?.errors?(n.value={},Object.entries(o.response.data.errors).forEach(([e,a])=>{a.forEach(d=>l.error(d));const s=e.includes(".")?"name":e;n.value[s]=a})):l.error("Update failed")}finally{_.value=!1}}else{if(v.value.some(e=>e.name.toLowerCase()===m.value.trim().toLowerCase())){l.error(`Unit "${m.value.trim()}" already exists. Please use a different name or edit the existing unit.`),n.value={name:[`Unit "${m.value.trim()}" already exists`]};return}if(f.value==="derived"){if(!w.value){l.error("Please select a base unit"),n.value={base_unit_id:["Base unit is required"]};return}if(!g.value||g.value<=0){l.error("Please enter a valid conversion factor"),n.value={conversion_factor:["Conversion factor must be greater than 0"]};return}const e={name:m.value.trim(),base_unit_id:w.value,conversion_factor:g.value};try{_.value=!0;const a=await F.post("/units",{units:[e]}),s=a.data?.units??a.data;Array.isArray(s)&&s.length&&(v.value=[...v.value,...s]),l.success("Derived unit added successfully"),T(),M("modalUnitForm"),await C()}catch(a){a.response?.data?.errors?(n.value={},Object.entries(a.response.data.errors).forEach(([s,d])=>{d.forEach(u=>l.error(u));const b=s.includes(".name")?"name":s.includes(".base_unit_id")?"base_unit_id":s.includes(".conversion_factor")?"conversion_factor":s;n.value[b]=d})):(console.error(a),l.error("Create failed"))}finally{_.value=!1}}else{const e={name:m.value.trim(),base_unit_id:null,conversion_factor:null};try{_.value=!0;const a=await F.post("/units",{units:[e]}),s=a.data?.units??a.data;Array.isArray(s)&&s.length&&(v.value=[...v.value,...s]),l.success("Unit added successfully"),T(),M("modalUnitForm"),await C()}catch(a){a.response?.data?.errors?Object.values(a.response.data.errors).forEach(s=>s.forEach(d=>l.error(d))):(console.error(a),l.error("Create failed"))}finally{_.value=!1}}}}},M=o=>{const e=document.getElementById(o);if(!e)return;(window.bootstrap?.Modal.getInstance(e)||new window.bootstrap.Modal(e)).hide()},v=p([]),h=p({current_page:1,last_page:1,per_page:10,total:0,from:0,to:0,links:[]}),y=p(!1),n=p({}),C=async(o=null)=>{y.value=!0;try{const{data:e}=await F.get("/units",{params:{q:U.value,page:o||h.value.current_page,per_page:h.value.per_page}});v.value=e.data||[],h.value={current_page:e.current_page,last_page:e.last_page,per_page:e.per_page,total:e.total,from:e.from,to:e.to,links:e.links},await pe(),window.feather?.replace()}catch(e){console.error("Failed to fetch units",e),l.error("Failed to load units")}finally{y.value=!1}},te=o=>{if(!o)return;const a=new URLSearchParams(o.split("?")[1]).get("page");a&&C(parseInt(a))};let q=null;H(U,()=>{clearTimeout(q),q=setTimeout(()=>{h.value.current_page=1,C(1)},500)});const ae=async()=>{try{y.value=!0;const o=await F.get("/units",{params:{q:U.value.trim(),per_page:1e4,page:1}});return console.log("ðŸ“¦ Export data received:",{total:o.data.total,items:o.data.data.length}),o.data.data||[]}catch(o){return console.error("âŒ Error fetching export data:",o),l.error("Failed to load data for export"),[]}finally{y.value=!1}},oe=async o=>{try{y.value=!0,l.info("Preparing export data...",{autoClose:1500});const e=await ae();if(!e||e.length===0){l.error("No units found to download"),y.value=!1;return}console.log(`ðŸ“¥ Exporting ${e.length} units as ${o.toUpperCase()}`),o==="pdf"?le(e):o==="excel"?ne(e):o==="csv"?se(e):l.error("Invalid download type")}catch(e){console.error("Download failed:",e),l.error(`Download failed: ${e.message}`)}finally{y.value=!1}},se=o=>{try{const e=["Name"],a=o.map(k=>[(V=>V==null?'""':(V=String(V).replace(/"/g,'""'),`"${V}"`))(k.name)]),s=[e.join(","),...a.map(k=>k.join(","))].join(`
`),d=new Blob([s],{type:"text/csv;charset=utf-8;"}),b=URL.createObjectURL(d),u=document.createElement("a");u.setAttribute("href",b),u.setAttribute("download",`units_${new Date().toISOString().split("T")[0]}.csv`),document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(b),l.success(`CSV downloaded successfully (${o.length} units)`,{autoClose:2500})}catch(e){console.error("CSV generation error:",e),l.error(`CSV generation failed: ${e.message}`,{autoClose:5e3})}},le=o=>{try{const e=new fe("p","mm","a4");e.setFontSize(20),e.setFont("helvetica","bold"),e.text("Units Report",14,20),e.setFontSize(10),e.setFont("helvetica","normal");const a=new Date().toLocaleString();e.text(`Generated on: ${a}`,14,28),e.text(`Total Units: ${o.length}`,14,34);const s=["Name"],d=o.map(u=>[u.name||""]);be(e,{head:[s],body:d,startY:40,styles:{fontSize:10,cellPadding:3,halign:"left",lineColor:[0,0,0],lineWidth:.1},headStyles:{fillColor:[41,128,185],textColor:255,fontStyle:"bold"},alternateRowStyles:{fillColor:[240,240,240]},margin:{left:14,right:14},didDrawPage:u=>{const k=e.internal.getNumberOfPages(),z=e.internal.pageSize.height;e.setFontSize(8),e.text(`Page ${u.pageNumber} of ${k}`,u.settings.margin.left,z-10)}});const b=`units_${new Date().toISOString().split("T")[0]}.pdf`;e.save(b),l.success(`PDF downloaded successfully (${o.length} units)`,{autoClose:2500})}catch(e){console.error("PDF generation error:",e),l.error(`PDF generation failed: ${e.message}`,{autoClose:5e3})}},ne=o=>{try{if(typeof ge>"u")throw new Error("XLSX library is not loaded");const e=o.map(k=>({Name:k.name||""})),a=N.book_new(),s=N.json_to_sheet(e);s["!cols"]=[{wch:25}],N.book_append_sheet(a,s,"Units");const d=[{Info:"Generated On",Value:new Date().toLocaleString()},{Info:"Total Units",Value:o.length},{Info:"Exported By",Value:"Units Management System"}],b=N.json_to_sheet(d);N.book_append_sheet(a,b,"Report Info");const u=`units_${new Date().toISOString().split("T")[0]}.xlsx`;he(a,u),l.success(`Excel file downloaded successfully (${o.length} units)`,{autoClose:2500})}catch(e){console.error("Excel generation error:",e),l.error(`Excel generation failed: ${e.message}`,{autoClose:5e3})}};de(async()=>{await C(),window.feather?.replace()}),H(m,o=>{o&&n.value.name&&delete n.value.name});const re=o=>{if(!o||o.length<=1){l.error("The file is empty",{autoClose:3e3});return}o[0];const a=o.slice(1).map(s=>({name:s[0]||""}));F.post("/api/units/import",{units:a}).then(()=>{l.success("Units imported successfully");const s=document.querySelector(".modal.show");if(s){const d=bootstrap.Modal.getInstance(s);d&&d.hide()}setTimeout(()=>{document.querySelectorAll(".modal-backdrop").forEach(b=>b.remove()),document.body.classList.remove("modal-open"),document.body.style.overflow="",document.body.style.paddingRight=""},100),C()}).catch(s=>{s?.response?.status===422&&s.response.data?.errors&&(n.value=s.response.data.errors,l.error("There may be some duplication in data",{autoClose:3e3})),setTimeout(()=>{document.querySelectorAll(".modal-backdrop").forEach(b=>b.remove()),document.body.classList.remove("modal-open"),document.body.style.overflow="",document.body.style.paddingRight=""},100)})};return(o,e)=>(i(),r(D,null,[S($(ue),{title:"Unit"}),t("div",Ue,[t("div",Ce,[t("div",ke,[e[10]||(e[10]=t("h4",{class:"mb-0"},"Units",-1)),t("div",Se,[t("div",Ee,[e[8]||(e[8]=t("i",{class:"bi bi-search"},null,-1)),P(t("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>U.value=a),class:"form-control search-input",placeholder:"Search"},null,512),[[j,U.value]])]),t("button",{"data-bs-toggle":"modal","data-bs-target":"#modalUnitForm",onClick:e[1]||(e[1]=()=>{J(),T(),n.value={}}),class:"d-flex align-items-center gap-1 px-4 btn-sm py-2 rounded-pill btn btn-primary text-white"},[S($(we),{class:"w-4 h-4"}),e[9]||(e[9]=x(" Add Unit ",-1))]),S(_e,{label:"Import",sampleHeaders:["Name"],sampleData:[["Example Unit 1"],["Example Unit 2"]],onOnImport:re}),S($(ye),{modelValue:A.value,"onUpdate:modelValue":e[2]||(e[2]=a=>A.value=a),options:Y,optionLabel:"label",optionValue:"value",placeholder:"Export",class:"export-dropdown",onChange:Z},null,8,["modelValue"])])]),t("div",Fe,[t("table",Pe,[e[12]||(e[12]=t("thead",{class:"border-top small text-muted"},[t("tr",null,[t("th",null,"S. #"),t("th",null,"Unit Name"),t("th",null,"Derived From"),t("th",null,"Conversion Factor"),t("th",{class:"text-center"},"Action")])],-1)),t("tbody",null,[y.value?(i(),r("tr",De,[...e[11]||(e[11]=[t("td",{colspan:"5",class:"text-center py-5"},[t("div",{class:"spinner-border text-primary",role:"status"},[t("span",{class:"visually-hidden"},"Loading...")]),t("p",{class:"text-muted mt-2 mb-0"},"Loading units...")],-1)])])):(i(),r(D,{key:1},[(i(!0),r(D,null,G(R.value,(a,s)=>(i(),r("tr",{key:a.id},[t("td",null,c(h.value.from+s),1),t("td",Le,c(a.name),1),t("td",Ve,c(a?.base_unit?.name),1),t("td",Ne,c(a.base_unit_id?a.conversion_factor:"-"),1),t("td",Te,[t("div",$e,[t("button",{"data-bs-toggle":"modal","data-bs-target":"#modalUnitForm",onClick:()=>{K(a),n.value={}},title:"Edit",class:"p-2 rounded-full text-blue-600 hover:bg-blue-100"},[S($(xe),{class:"w-4 h-4"})],8,Ie),S(ce,{title:"Confirm Delete",message:`Are you sure you want to delete ${a.name}?`,showDeleteButton:!0,onConfirm:()=>{Q(a)},onCancel:()=>{}},null,8,["message","onConfirm"])])])]))),128)),R.value.length===0?(i(),r("tr",Ae,[t("td",Me,c(U.value.trim()?"No units found matching your search.":"No units found."),1)])):E("",!0)],64))])])]),!y.value&&h.value.last_page>1?(i(),r("div",je,[t("div",Be," Showing "+c(h.value.from)+" to "+c(h.value.to)+" of "+c(h.value.total)+" entries ",1),S(me,{pagination:h.value.links,isApiDriven:!0,onPageChanged:te},null,8,["pagination"])])):E("",!0)])]),t("div",Oe,[t("div",Re,[t("div",qe,[t("div",ze,[t("h5",Xe,c(L.value?"Edit Unit":"Add Unit(s)"),1),e[13]||(e[13]=t("button",{class:"absolute top-2 right-2 p-2 rounded-full hover:bg-gray-100 transition transform hover:scale-110","data-bs-dismiss":"modal","aria-label":"Close",title:"Close"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})])],-1))]),t("div",He,[t("div",Ge,[t("label",We,[P(t("input",{type:"radio",class:"form-check-input me-2",value:"base","onUpdate:modelValue":e[3]||(e[3]=a=>f.value=a)},null,512),[[W,f.value]]),e[14]||(e[14]=x(" Base Unit ",-1))]),t("label",Ye,[P(t("input",{type:"radio",class:"form-check-input me-2",value:"derived","onUpdate:modelValue":e[4]||(e[4]=a=>f.value=a)},null,512),[[W,f.value]]),e[15]||(e[15]=x(" Derived Unit ",-1))])]),t("div",null,[e[21]||(e[21]=t("label",{class:"form-label"},"Unit Name",-1)),P(t("input",{"onUpdate:modelValue":e[5]||(e[5]=a=>m.value=a),class:B(["form-control",{"is-invalid":n.value.name}]),placeholder:"e.g., Millilitre (ml)"},null,2),[[j,m.value]]),t("small",Ze,[f.value==="derived"?(i(),r("span",Je,` âš ï¸ Enter a NEW unit name (e.g., "ml" if base is "L"). Don't use existing unit names. `)):E("",!0)]),n.value.name?(i(),r("div",Ke,c(n.value.name[0]),1)):E("",!0),f.value==="derived"?(i(),r("div",Qe,[e[17]||(e[17]=t("div",{class:"alert alert-info"},[t("strong",null,"Example:"),x(' If you want to create "Millilitre (ml)" from "Litre (L)":'),t("br"),x(' â€¢ Select "Litre (L)" as base unit'),t("br"),x(" â€¢ Enter conversion: 0.001 (because 1 ml = 0.001 L) ")],-1)),e[18]||(e[18]=t("label",{class:"form-label"},"Base Unit",-1)),O.value.length===0?(i(),r("div",et," No base units available. Please create base units first before creating derived units. ")):P((i(),r("select",{key:1,"onUpdate:modelValue":e[6]||(e[6]=a=>w.value=a),class:B(["form-select",{"is-invalid":n.value.base_unit_id}])},[e[16]||(e[16]=t("option",{value:null,disabled:""},"Select base unit",-1)),(i(!0),r(D,null,G(O.value,a=>(i(),r("option",{key:a.id,value:a.id},c(a.name),9,tt))),128))],2)),[[ve,w.value]]),n.value.base_unit_id?(i(),r("div",at,c(n.value.base_unit_id[0]),1)):E("",!0),e[19]||(e[19]=t("label",{class:"form-label mt-3"},"Conversion Factor",-1)),P(t("input",{type:"number",step:"any","onUpdate:modelValue":e[7]||(e[7]=a=>g.value=a),class:B(["form-control",{"is-invalid":n.value.conversion_factor}]),placeholder:"e.g., 0.001"},null,2),[[j,g.value,void 0,{number:!0}]]),e[20]||(e[20]=t("small",{class:"text-muted d-block mt-1"},"How many base units = 1 of this unit (e.g., 1 ml = 0.001 L)",-1)),n.value.conversion_factor?(i(),r("div",ot,c(n.value.conversion_factor[0]),1)):E("",!0)])):E("",!0)]),t("div",st,[t("button",{class:"btn btn-primary rounded-pill py-2 btn-sm w-100",disabled:_.value,onClick:ee},[_.value?(i(),r(D,{key:0},[e[22]||(e[22]=t("span",{class:"spinner-border spinner-border-sm me-2"},null,-1)),e[23]||(e[23]=x("Saving... ",-1))],64)):(i(),r(D,{key:1},[x(c((L.value,"Save")),1)],64))],8,lt)])])])])])],64))}},yt=ie(nt,[["__scopeId","data-v-0a03fd3b"]]);export{yt as default};
