import{_ as w,c as i,r as N,w as f,g as p,b as y,f as a,l as M,m as T,v as S,t as c,u as b,p as k,j as V,F as B,i as F,e as L}from"./app-DR8KNMKR.js";import q from"./StripePayment-CBYaks-d.js";import{u as O}from"./useFormatters-DMXCh6bx.js";const j={class:"row g-3"},R={class:"col-12 col-sm-6"},U={class:"input-group"},z=["max"],E={class:"small text-muted mt-1"},G={class:"col-12 col-sm-6"},H={class:"input-group"},J=["max"],K={class:"small text-muted mt-1"},Q={class:"d-flex justify-content-between align-items-center mt-3"},W={class:"fw-semibold"},X={class:"text-success"},Y={key:0,class:"alert alert-danger rounded-3 mt-3 mb-0"},Z={class:"m-0 ps-3"},$={class:"pt-3 border-top mt-3"},_={__name:"SplitPayment",props:{order_code:String,show:Boolean,customer:String,phone:String,deliveryLocation:String,orderType:String,selectedTable:Object,orderItems:Array,grandTotal:Number,money:Function,cashReceived:Number,subTotal:Number,tax:Number,serviceCharges:Number,deliveryCharges:Number,note:[String,null],kitchenNote:[String,null],orderDate:String,orderTime:String,paymentMethod:String,paymentType:String,change:Number,promoDiscount:{type:Number,default:0},promoId:{type:[Number,String,null],default:null},promoName:{type:[String,null],default:null},promoType:{type:[String,null],default:null},promoDiscountAmount:{type:Number,default:0},appliedPromos:{type:Array,default:()=>[]},approvedDiscounts:{type:Number,default:0},approvedDiscountDetails:{type:Array,default:()=>[]},currentOrderId:{type:[Number,null],default:null},isPartialPayment:{type:Boolean,default:!1},selectedItemIds:{type:Array,default:()=>[]},paidItemIds:{type:Array,default:()=>[]},paidProductIds:{type:Array,default:()=>[]},paidDealIds:{type:Array,default:()=>[]}},emits:["confirm","payment-success"],setup(e,{emit:x}){const{formatCurrencySymbol:v}=O(),m=e,I=x,l=i(()=>Number(m.grandTotal??0)),s=N(0),o=N(0);f(l,r=>{if(r>0){const t=Math.floor(r/2);s.value=t,o.value=Math.round((r-t)*100)/100,o.value<.5&&r>=.5&&(o.value=.5,s.value=Math.round((r-.5)*100)/100)}else s.value=0,o.value=0},{immediate:!0});let d=!1;f(s,r=>{if(d)return;d=!0;const t=Number(r)||0;o.value=Math.max(0,Math.round(l.value*100-t*100)/100),d=!1}),f(o,r=>{if(d)return;d=!0;const t=Number(r)||0;s.value=Math.max(0,Math.round(l.value*100-t*100)/100),d=!1});const C=i(()=>Array.isArray(m.orderItems)?m.orderItems.reduce((r,t)=>{const n=Number(t.price)||0,g=Number(t.qty??t.quantity)||0;return r+n*g},0):0),D=i(()=>Number.isFinite(m.subTotal)?Number(m.subTotal):C.value),P=i(()=>0);function u(r){return Math.round((Number(r)||0)*100)}const h=i(()=>{const r=[];return l.value<=0&&r.push("Total amount must be greater than 0."),s.value<0&&r.push("Cash cannot be negative."),o.value<0&&r.push("Card amount cannot be negative."),u(s.value)+u(o.value)!==u(l.value)&&r.push("Cash + Card must equal the total."),r});i(()=>h.value.length===0);const A=r=>{I("payment-success",r)};return(r,t)=>(y(),p("div",null,[t[8]||(t[8]=a("div",{class:"pay-header d-flex align-items-center gap-2 mb-3"},[a("i",{class:"bi bi-columns-gap"}),a("h6",{class:"m-0"},"Split Payment")],-1)),a("div",j,[a("div",R,[t[3]||(t[3]=a("label",{class:"form-label fw-semibold"},"Cash Portion",-1)),a("div",U,[t[2]||(t[2]=a("span",{class:"input-group-text"},"£",-1)),T(a("input",{type:"number",min:"0",max:l.value,step:"0.01","onUpdate:modelValue":t[0]||(t[0]=n=>s.value=n),class:"form-control rounded-3"},null,8,z),[[S,s.value,void 0,{number:!0}]])]),a("div",E,c(e.money?b(v)(s.value||0):s.value||0),1)]),a("div",G,[t[5]||(t[5]=a("label",{class:"form-label fw-semibold"},"Card Portion",-1)),a("div",H,[t[4]||(t[4]=a("span",{class:"input-group-text"},"£",-1)),T(a("input",{type:"number",min:"0",max:l.value,step:"0.01","onUpdate:modelValue":t[1]||(t[1]=n=>o.value=n),class:"form-control rounded-3"},null,8,J),[[S,o.value,void 0,{number:!0}]])]),a("div",K,c(e.money?b(v)(o.value||0):o.value||0),1)])]),a("div",Q,[a("div",W,[t[6]||(t[6]=k(" Total: ",-1)),a("span",X,c(e.money?b(v)(l.value):l.value),1)]),a("div",{class:V(["small",u(s.value)+u(o.value)===u(l.value)?"text-success":"text-danger"])}," Cash + Card = "+c(e.money?b(v)((s.value||0)+(o.value||0)):Number(s.value||0)+Number(o.value||0)),3)]),h.value.length?(y(),p("div",Y,[a("ul",Z,[(y(!0),p(B,null,F(h.value,(n,g)=>(y(),p("li",{key:g},c(n),1))),128))])])):M("",!0),a("div",$,[t[7]||(t[7]=a("label",{class:"form-label fw-semibold"},"Pay Card Portion",-1)),L(q,{order_code:e.order_code,show:e.show,customer:e.customer,phone:e.phone,deliveryLocation:e.deliveryLocation,orderType:e.orderType,selectedTable:e.selectedTable,orderItems:e.orderItems,grandTotal:o.value,"order-total":l.value,money:e.money,cashReceived:s.value,cardPayment:o.value,subTotal:D.value,tax:e.tax??0,serviceCharges:e.serviceCharges??0,deliveryCharges:e.deliveryCharges??0,note:e.note,"kitchen-note":e.kitchenNote,orderDate:e.orderDate??new Date().toISOString().split("T")[0],orderTime:e.orderTime??new Date().toTimeString().split(" ")[0],paymentMethod:"Card",change:P.value,"payment-type":"split",type:"split-payment",cardCharge:o.value,"promo-discount":e.promoDiscount,"promo-id":e.promoId,"promo-name":e.promoName,"promo-type":e.promoType,"promo-discount-amount":e.promoDiscountAmount,"applied-promos":e.appliedPromos,"approved-discounts":e.approvedDiscounts,"approved-discount-details":e.approvedDiscountDetails,"current-order-id":e.currentOrderId,"is-partial-payment":e.isPartialPayment,"selected-item-ids":e.selectedItemIds,"paid-item-ids":e.paidItemIds,"paid-product-ids":e.paidProductIds,"paid-deal-ids":e.paidDealIds,onPaymentSuccess:A},null,8,["order_code","show","customer","phone","deliveryLocation","orderType","selectedTable","orderItems","grandTotal","order-total","money","cashReceived","cardPayment","subTotal","tax","serviceCharges","deliveryCharges","note","kitchen-note","orderDate","orderTime","change","cardCharge","promo-discount","promo-id","promo-name","promo-type","promo-discount-amount","applied-promos","approved-discounts","approved-discount-details","current-order-id","is-partial-payment","selected-item-ids","paid-item-ids","paid-product-ids","paid-deal-ids"])])]))}},re=w(_,[["__scopeId","data-v-beae23a1"]]);export{re as default};
