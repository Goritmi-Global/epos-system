import{_ as F,D as d,r as N,j as x,g as b,o as y,b as o,i as q,x as C,y as S,t as c,d as p,f as D,n as B,F as R,v as j,a as O}from"./app-DgHj6V6q.js";import U from"./StripePayment-BQtgsiKO.js";import{u as z}from"./useFormatters-CPHeofEZ.js";const E={class:"row g-3"},L={class:"col-12 col-sm-6"},G={class:"input-group"},H=["max"],J={class:"small text-muted mt-1"},K={class:"col-12 col-sm-6"},Q={class:"input-group"},W=["max"],X={class:"small text-muted mt-1"},Y={class:"d-flex justify-content-between align-items-center mt-3"},Z={class:"fw-semibold"},$={class:"text-success"},_={key:0,class:"alert alert-danger rounded-3 mt-3 mb-0"},ee={class:"m-0 ps-3"},te={class:"pt-3 border-top mt-3"},oe={class:"d-flex gap-2 mt-3"},ae=["disabled"],re={__name:"SplitPayment",props:{order_code:String,show:Boolean,customer:String,orderType:String,selectedTable:Object,orderItems:Array,grandTotal:Number,money:Function,cashReceived:Number,subTotal:Number,tax:Number,serviceCharges:Number,deliveryCharges:Number,note:[String,null],kitchenNote:[String,null],orderDate:String,orderTime:String,paymentMethod:String,paymentType:String,change:Number,promoDiscount:{type:Number,default:0},promoId:{type:[Number,String,null],default:null},promoName:{type:[String,null],default:null},promoType:{type:[String,null],default:null},promoDiscountAmount:{type:Number,default:0}},emits:["confirm"],setup(t,{emit:w}){const{formatCurrencySymbol:v}=z(),s=t,I=w,l=d(()=>Number(s.grandTotal??0)),f=Math.floor(l.value/2),n=N(f);let M=l.value-f;const a=N(M);a.value<.5&&(a.value=.5,n.value=l.value-a.value);let m=!1;x(n,r=>{if(m)return;m=!0;const e=Number(r)||0;a.value=Math.max(0,Math.round(l.value*100-e*100)/100),m=!1}),x(a,r=>{if(m)return;m=!0;const e=Number(r)||0;n.value=Math.max(0,Math.round(l.value*100-e*100)/100),m=!1});const k=d(()=>Array.isArray(s.orderItems)?s.orderItems.reduce((r,e)=>{const u=Number(e.price)||0,h=Number(e.qty??e.quantity)||0;return r+u*h},0):0),P=d(()=>Number.isFinite(s.subTotal)?Number(s.subTotal):k.value),A=d(()=>0);function i(r){return Math.round((Number(r)||0)*100)}const g=d(()=>{const r=[];return l.value<=0&&r.push("Total amount must be greater than 0."),n.value<0&&r.push("Cash cannot be negative."),a.value<0&&r.push("Card amount cannot be negative."),i(n.value)+i(a.value)!==i(l.value)&&r.push("Cash + Card must equal the total."),r}),T=d(()=>g.value.length===0);function V(){T.value&&I("confirm",{paymentMethod:"Split",cashReceived:Number(n.value)||0,cardAmount:Number(a.value)||0,changeAmount:0,promoDiscount:s.promoDiscount,promoId:s.promoId,promoName:s.promoName,promoType:s.promoType})}return(r,e)=>(y(),b("div",null,[e[9]||(e[9]=o("div",{class:"pay-header d-flex align-items-center gap-2 mb-3"},[o("i",{class:"bi bi-columns-gap"}),o("h6",{class:"m-0"},"Split Payment")],-1)),o("div",E,[o("div",L,[e[3]||(e[3]=o("label",{class:"form-label fw-semibold"},"Cash Portion",-1)),o("div",G,[e[2]||(e[2]=o("span",{class:"input-group-text"},"£",-1)),C(o("input",{type:"number",min:"0",max:l.value,step:"0.01","onUpdate:modelValue":e[0]||(e[0]=u=>n.value=u),class:"form-control rounded-3"},null,8,H),[[S,n.value,void 0,{number:!0}]])]),o("div",J,c(t.money?p(v)(n.value||0):n.value||0),1)]),o("div",K,[e[5]||(e[5]=o("label",{class:"form-label fw-semibold"},"Card Portion",-1)),o("div",Q,[e[4]||(e[4]=o("span",{class:"input-group-text"},"£",-1)),C(o("input",{type:"number",min:"0",max:l.value,step:"0.01","onUpdate:modelValue":e[1]||(e[1]=u=>a.value=u),class:"form-control rounded-3"},null,8,W),[[S,a.value,void 0,{number:!0}]])]),o("div",X,c(t.money?p(v)(a.value||0):a.value||0),1)])]),o("div",Y,[o("div",Z,[e[6]||(e[6]=D(" Total: ",-1)),o("span",$,c(t.money?p(v)(l.value):l.value),1)]),o("div",{class:B(["small",i(n.value)+i(a.value)===i(l.value)?"text-success":"text-danger"])}," Cash + Card = "+c(t.money?p(v)((n.value||0)+(a.value||0)):Number(n.value||0)+Number(a.value||0)),3)]),g.value.length?(y(),b("div",_,[o("ul",ee,[(y(!0),b(R,null,j(g.value,(u,h)=>(y(),b("li",{key:h},c(u),1))),128))])])):q("",!0),o("div",te,[e[7]||(e[7]=o("label",{class:"form-label fw-semibold"},"Pay Card Portion",-1)),O(U,{order_code:t.order_code,show:t.show,customer:t.customer,orderType:t.orderType,selectedTable:t.selectedTable,orderItems:t.orderItems,grandTotal:t.grandTotal,money:t.money,cashReceived:n.value,cardPayment:a.value,subTotal:P.value,tax:t.tax??0,serviceCharges:t.serviceCharges??0,deliveryCharges:t.deliveryCharges??0,note:t.note,"kitchen-note":t.kitchenNote,orderDate:t.orderDate??new Date().toISOString().split("T")[0],orderTime:t.orderTime??new Date().toTimeString().split(" ")[0],paymentMethod:t.paymentMethod,change:A.value,paymentType:t.paymentType,cardCharge:r.cardCharge,"promo-discount":t.promoDiscount,"promo-id":t.promoId,"promo-name":t.promoName,"promo-type":t.promoType,"promo-discount-amount":t.promoDiscountAmount},null,8,["order_code","show","customer","orderType","selectedTable","orderItems","grandTotal","money","cashReceived","cardPayment","subTotal","tax","serviceCharges","deliveryCharges","note","kitchen-note","orderDate","orderTime","paymentMethod","change","paymentType","cardCharge","promo-discount","promo-id","promo-name","promo-type","promo-discount-amount"])]),o("div",oe,[o("button",{class:"btn brand-btn rounded-pill px-3 py-2",disabled:!T.value,onClick:V},[...e[8]||(e[8]=[o("i",{class:"bi bi-check2-circle me-1"},null,-1),D(" Confirm Split ",-1)])],8,ae)])]))}},ue=F(re,[["__scopeId","data-v-aa384e53"]]);export{ue as default};
