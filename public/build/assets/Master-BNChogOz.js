import{_ as ie,c as A,o as l,w as T,g as n,i as u,b as e,t as r,T as de,q as ue,r as i,D as U,k as V,P as ce,I as pe,f as X,d as k,e as Z,F as g,v as j,n as c,a as H,G as q,V as ve,H as fe,s as me,x as I,y as N,az as he,m as D}from"./app-DgHj6V6q.js";import{u as ge,a as be}from"./index-Dhe4KWrB.js";import{S as we,M as ye}from"./sun-VCFAhO30.js";const xe={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50"},_e={class:"bg-white rounded-xl shadow-xl w-full max-w-md p-6 animate-drop-in relative"},ke={class:"text-center text-lg font-medium text-gray-800 mb-2"},Ce={class:"text-center text-sm text-gray-500 mb-6"},Me={__name:"LogoutModal",props:{title:{type:String,default:"Confirm Logout"},message:{type:String,default:"Are you sure you want to log out?"},show:{type:Boolean,default:!1}},emits:["confirm","cancel"],setup(R,{emit:C}){const f=C,z=()=>f("confirm"),m=()=>f("cancel");return(W,M)=>(l(),A(de,{name:"fade-slide"},{default:T(()=>[R.show?(l(),n("div",xe,[e("div",_e,[e("button",{class:"absolute top-2 right-2 p-2 rounded-full hover:bg-gray-100 transition transform hover:scale-110",onClick:m,title:"Close"},[...M[0]||(M[0]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)])]),M[1]||(M[1]=e("div",{class:"flex justify-center mb-4"},[e("div",{class:"bg-red-100 p-3 rounded-full"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-8 h-8 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"}),e("polyline",{points:"16 17 21 12 16 7"}),e("line",{x1:"21",y1:"12",x2:"9",y2:"12"})])])],-1)),e("h3",ke,r(R.title),1),e("p",Ce,r(R.message),1),e("div",{class:"flex justify-center gap-3"},[e("button",{onClick:z,class:"btn btn-danger d-flex align-items-center gap-1 px-3 py-2 rounded-pill text-white"}," Yes, Logout "),e("button",{onClick:m,class:"btn btn-secondary d-flex align-items-center gap-1 px-3 py-2 rounded-pill text-white"}," Cancel ")])])])):u("",!0)]),_:1}))}},Se=ie(Me,[["__scopeId","data-v-00f86d7b"]]),Pe={class:"header"},Le={class:"header-left"},Ee=["src"],$e={class:"fw-bold"},Ae={class:"nav user-menu"},Re={class:"nav-item"},Be={class:"nav-item dropdown"},Ue={href:"javascript:void(0);",class:"dropdown-toggle nav-link","data-bs-toggle":"dropdown"},Ve={key:0,class:"badge rounded-pill bg-danger"},je={class:"dropdown-menu dropdown-menu-end notifications shadow-lg"},Ie={class:"topnav-dropdown-header d-flex align-items-center justify-content-between px-3 py-2 border-bottom"},Ne={key:0,class:"text-primary"},De={class:"noti-content max-h-[350px] overflow-y-auto"},Te=["onClick"],ze={class:"flex-grow-1 me-2"},Oe={class:"fw-semibold text-sm text-gray-800"},Fe={class:"text-muted mt-1 d-block",style:{"font-size":"0.7rem"}},Ge={key:0,class:"align-self-start"},He={key:1,class:"p-3 text-center text-muted small"},qe={class:"nav-item dropdown has-arrow main-drop cursor-pointer","data-bs-toggle":"modal","data-bs-target":"#userProfileModal"},We={class:"ms-2 d-none d-sm-block"},Ke={class:"fw-bold text-black"},Qe={class:"super-admin text-black"},Ye={class:"sidebar",id:"sidebar","aria-label":"Primary"},Je={class:"sidebar-inner"},Xe={id:"sidebar-menu",class:"sidebar-menu px-2"},Ze={class:"mb-3"},es=["data-feather"],ss={class:"truncate-when-mini"},ts={key:0,class:"mt-3 mb-1 px-3 text-muted text-uppercase small section-title truncate-when-mini"},os={key:0,class:"dropdown-parent"},as=["onClick","title"],ls=["data-feather"],ns={class:"flex-grow-1 text-start truncate-when-mini"},rs=["data-feather"],is=["data-feather"],ds=["data-feather"],us={class:"truncate-when-mini"},cs={key:2,class:"side-link"},ps=["onClick","title"],vs=["data-feather"],fs={class:"truncate-when-mini"},ms={class:"content bg-white dark:bg-gray-900 text-black dark:text-white"},hs={class:"modal fade",id:"userProfileModal",tabindex:"-1","aria-hidden":"true"},gs={class:"modal-dialog modal-dialog-centered modal-lg"},bs={class:"modal-content text-black rounded-4"},ws={class:"modal-body"},ys={class:"row g-3"},xs={class:"col-md-6"},_s={key:0,class:"invalid-feedback"},ks={class:"col-md-6"},Cs={key:0,class:"invalid-feedback"},Ms={class:"col-md-6"},Ss={key:0,class:"invalid-feedback"},Ps={class:"col-md-6"},Ls={key:0,class:"invalid-feedback"},Rs={__name:"Master",setup(R){const C=ue(),f=i(!1),z=t=>{console.log("Sidebar action triggered:",t),t==="systemRestore"&&(f.value=!0,console.log("showConfirmRestore set to:",f.value))},m=i(!1),W=()=>{m.value=!1,he.post(route("logout"))},M=async()=>{try{(await axios.post(route("system.restore"))).data.success&&(D.success("System restored successfully!"),f.value=!1,window.location.href=route("front-page"))}catch(t){console.error("System restore error:",t);let s="Failed to restore system. Please try again.";t.response?t.response.data?.message?s=t.response.data.message:t.response.data?.error?s=t.response.data.error:s=`Error ${t.response.status}: ${t.response.statusText}`:t.message&&(s=t.message),D.error(s)}},O=U(()=>C.props.current_user?.permissions??[]),ee=U(()=>C.props.current_user?.roles??[]);console.log("userPermissions",O.value);const S=t=>!t||ee.value.includes("Super Admin")?!0:(Array.isArray(O.value)?O.value:[]).includes(t),d=i({}),P=U(()=>C.props.current_user??{});console.log("logedIUser",P.value);const K=U(()=>C.props.business_info??{}),Q=ge({selector:"html",attribute:"class",valueDark:"dark",valueLight:"light"}),se=be(Q);V(()=>{window.feather?.replace()});const Y=i([{label:"Dashboard",icon:"grid",route:"dashboard"},{section:"POS Management",children:[{label:"Inventory",icon:"package",children:[{label:"Items",icon:"box",route:"inventory.index"},{label:"Categories",icon:"layers",route:"inventory.categories.index"},{label:"Logs Moments",icon:"archive",route:"stock.logs.index"},{label:"Purchase Order",icon:"shopping-cart",route:"purchase.orders.index"},{label:"Reference Management",icon:"database",route:"reference.index"}]},{label:"Menu",icon:"book-open",children:[{label:"Categories",icon:"layers",route:"menu-categories.index"},{label:"Menus",icon:"box",route:"menu.index"}]},{label:"Sale",icon:"shopping-bag",route:"pos.order"},{label:"Orders",icon:"list",route:"orders.index"},{label:"KOT",icon:"clipboard",route:"kots.index"},{label:"Payment",icon:"credit-card",route:"payment.index"},{label:"Analytics",icon:"bar-chart-2",route:"analytics.index"},{label:"Promo",icon:"tag",route:"promos.index"}]},{section:"Other Menu",children:[{label:"Settings",icon:"settings",route:"settings.index"},{label:"Restore System",icon:"refresh-cw",action:"systemRestore"}]}]),B=t=>{try{return route().current(t)}catch{return!1}},b=i(new Set),te=t=>{b.value.has(t)?b.value.delete(t):b.value.add(t)},L=(t=[])=>t.some(s=>s.children?L(s.children):B(s.route)),oe=()=>{const t=(s=[])=>{s.forEach(o=>{o.children?.length&&(L(o.children)&&b.value.add(o.label),t(o.children))})};Y.value.forEach(s=>s.children&&t(s.children))},F=i("desktop");i(!0);const h=i(!1),E=i(!1),$=i(!0),w=i(!0),y=i(!1),G=()=>{const t=window.innerWidth;t<768?(F.value="mobile",h.value=!0,E.value=!1,$.value=!1,y.value=!1,w.value=!1):t<992?(F.value="tablet",h.value=!1,E.value=!0,$.value=!1,w.value=!1,y.value=!1):(F.value="desktop",h.value=!1,E.value=!1,$.value=!0,w.value=!0,y.value=!1)},J=()=>{h.value?y.value=!y.value:w.value=!w.value};V(()=>{G(),window.addEventListener("resize",G,{passive:!0}),window.feather?.replace(),oe()}),ce(()=>window.removeEventListener("resize",G)),pe(()=>window.feather?.replace());const p=i({username:P.value.name??"",password:"",pin:"",role:P.value.roles[0]??""}),ae=async()=>{try{(await axios.post("/api/profile/update",p.value)).data.success?(D.success("Profile updated successfully"),bootstrap.Modal.getInstance(document.getElementById("userProfileModal")).hide()):alert("Something went wrong!")}catch(t){t?.response?.status===422&&t.response.data?.errors&&(d.value=t.response.data.errors,D.error("Please fill in all required fields correctly."))}};V(()=>{document.getElementById("userProfileModal").addEventListener("hidden.bs.modal",()=>{d.value={},p.value.password="",p.value.pin=""})});const x=i([]),_=i(0),le=async()=>{const t=await axios.get("/api/notifications");x.value=t.data,console.log("notifications.value",x.value),_.value=x.value.filter(s=>!s.is_read).length},ne=async t=>{try{await axios.post(`/api/notifications/mark-as-read/${t}`);const s=x.value.find(o=>o.id===t);s&&!s.is_read&&(s.is_read=!0,_.value--)}catch(s){console.error("Error marking as read:",s)}},re=async()=>{try{await axios.post("/api/notifications/mark-all-as-read"),x.value.forEach(t=>t.is_read=!0),_.value=0}catch(t){console.error("Error marking all as read:",t)}};return V(le),(t,s)=>(l(),n(g,null,[e("div",{class:c(["layout-root",{"state-desktop":$.value,"state-tablet":E.value,"state-mobile":h.value,"sidebar-open":h.value?y.value:w.value,"sidebar-collapsed":($.value||E.value)&&!w.value,"sidebar-overlay":h.value}])},[e("header",Pe,[e("div",Le,[e("img",{src:K.value.image_url,alt:"logo",width:"50",height:"50px",class:"rounded-full border shadow"},null,8,Ee),e("h5",$e,r(K.value.business_name),1),e("button",{class:"icon-btn",onClick:J,"aria-label":"Toggle sidebar"},[...s[8]||(s[8]=[e("i",{"data-feather":"menu"},null,-1)])])]),s[17]||(s[17]=e("div",{class:"header-center"},null,-1)),e("ul",Ae,[s[16]||(s[16]=e("a",{class:"btn btn-primary rounded-pill py-2 px-3",href:"/pos/order"}," Quick Order ",-1)),e("button",{class:"btn btn-danger rounded-pill py-2 px-3 d-flex align-items-center",onClick:s[0]||(s[0]=o=>m.value=!0)},[...s[9]||(s[9]=[X(" Logout ",-1),e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-log-out ms-2"},[e("path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"}),e("polyline",{points:"16 17 21 12 16 7"}),e("line",{x1:"21",y1:"12",x2:"9",y2:"12"})],-1)])]),m.value?(l(),A(Se,{key:0,show:m.value,onConfirm:W,onCancel:s[1]||(s[1]=o=>m.value=!1)},null,8,["show"])):u("",!0),e("li",Re,[e("button",{class:"icon-btn",onClick:s[2]||(s[2]=o=>k(se)())},[k(Q)?(l(),A(k(we),{key:0,size:20})):(l(),A(k(ye),{key:1,size:20}))])]),e("li",Be,[e("a",Ue,[s[10]||(s[10]=e("img",{src:"/assets/img/icons/notification-bing.svg",alt:"noti"},null,-1)),_.value>0?(l(),n("span",Ve,r(_.value),1)):u("",!0)]),e("div",je,[e("div",Ie,[s[12]||(s[12]=e("span",{class:"notification-title fw-bold"},"Notifications",-1)),e("a",{href:"javascript:void(0)",class:"text-primary fw-semibold",style:{"font-size":"0.9rem"},onClick:Z(re,["stop"])},[s[11]||(s[11]=X(" Mark all as read ",-1)),_.value>0?(l(),n("span",Ne,"("+r(_.value)+")",1)):u("",!0)])]),e("div",De,[x.value.length?(l(!0),n(g,{key:0},j(x.value,o=>(l(),n("div",{key:o.id,class:c(["d-flex align-items-start justify-content-between p-3 border-bottom cursor-pointer transition-all",o.is_read?"bg-gray-50 m-2 mb-2":"bg-white shadow-sm m-2"]),onClick:Z(a=>ne(o.id),["stop"])},[e("div",ze,[e("div",Oe,r(o.message),1),e("span",{class:c(["inline-flex notifi-span items-center rounded-full px-2 py-0.5 text-xs font-medium mt-1",{"text-red-700 bg-red-300":o.status?.toLowerCase()==="out_of_stock","text-yellow-700 bg-yellow-100":o.status?.toLowerCase()==="low_stock","text-orange-700 bg-orange-200":o.status?.toLowerCase()==="expired","text-blue-700 bg-blue-100":o.status?.toLowerCase()==="near_expiry"}])},r(o.status.replace(/_/g," ").toUpperCase()),3),e("small",Fe,r(new Date(o.created_at).toLocaleString("en-US",{dateStyle:"medium",timeStyle:"short"})),1)]),o.is_read?u("",!0):(l(),n("div",Ge,[...s[13]||(s[13]=[e("span",{class:"inline-flex items-center px-2 py-0.5 text-xs font-medium rounded-full new-badge bg-green-100 text-green-600"}," NEW ",-1)])]))],10,Te))),128)):(l(),n("div",He,"No notifications"))])])]),e("li",qe,[s[15]||(s[15]=e("span",{class:"user-img"},[e("i",{class:"bi bi-person-circle"})],-1)),e("div",We,[e("b",Ke,r(P.value.name),1),s[14]||(s[14]=e("br",null,null,-1)),e("small",Qe,r(P.value.roles[0]),1)])])])]),e("aside",Ye,[e("div",Je,[e("div",Xe,[e("ul",Ze,[(l(!0),n(g,null,j(Y.value,o=>(l(),n(g,{key:o.label||o.section},[!o.section&&S(o.route)?(l(),n("li",{key:0,class:c({active:B(o.route)})},[H(k(q),{href:t.route(o.route),class:"d-flex align-items-center side-link px-3 py-2"},{default:T(()=>[e("i",{"data-feather":o.icon,class:"me-2 icons"},null,8,es),e("span",ss,r(o.label),1)]),_:2},1032,["href"])],2)):(l(),n(g,{key:1},[o.section&&o.children.some(a=>S(a.route))?(l(),n("li",ts,r(o.section),1)):u("",!0),(l(!0),n(g,null,j(o.children,a=>(l(),n(g,{key:a.label},[a.children&&a.children.length&&a.children.some(v=>S(v.route))?(l(),n("li",os,[e("button",{class:c(["d-flex align-items-center side-link px-3 py-2 w-100 border-0",{active:b.value.has(a.label)||L(a.children)}]),onClick:v=>te(a.label),type:"button",title:a.label},[e("i",{"data-feather":a.icon,class:"me-2"},null,8,ls),e("span",ns,r(a.label),1),e("i",{class:"chevron-icon","data-feather":b.value.has(a.label)||L(a.children)?"chevron-up":"chevron-down"},null,8,rs)],10,as),e("ul",{class:c(["list-unstyled my-1 submenu-dropdown",{expanded:b.value.has(a.label)||L(a.children)}])},[S(t.child?.route)?(l(!0),n(g,{key:0},j(a.children,v=>(l(),n("li",{key:v.label,class:c({active:B(v.route)})},[H(k(q),{href:t.route(v.route),method:v.method||"get",class:"d-flex align-items-center side-link px-3 py-2"},{default:T(()=>[e("i",{"data-feather":v.icon,class:"me-2"},null,8,is),e("span",null,r(v.label),1)]),_:2},1032,["href","method"])],2))),128)):u("",!0)],2)])):a.route&&S(a.route)?(l(),n("li",{key:1,class:c([{active:a.route?B(a.route):!1},"side-link"])},[H(k(q),{href:t.route(a.route),method:a.method||"get",class:"d-flex align-items-center side-link px-3 py-2",title:a.label},{default:T(()=>[e("i",{"data-feather":a.icon,class:"me-2"},null,8,ds),e("span",us,r(a.label),1)]),_:2},1032,["href","method","title"])],2)):a.action?(l(),n("li",cs,[e("button",{onClick:v=>z(a.action),class:"d-flex align-items-center side-link px-3 py-2 w-100 border-0",title:a.label},[e("i",{"data-feather":a.icon,class:"me-2"},null,8,vs),e("span",fs,r(a.label),1)],8,ps)])):u("",!0)],64))),128))],64))],64))),128))])])])]),f.value?(l(),A(ve,{key:0,title:"Confirm Restore",message:"Are you sure you want to restore the system? This action cannot be undone.",showConfirmRestore:f.value,onConfirm:M,onCancel:s[3]||(s[3]=o=>f.value=!1)},null,8,["showConfirmRestore"])):u("",!0),h.value&&y.value?(l(),n("div",{key:1,class:"overlay-backdrop","aria-hidden":"true",onClick:J})):u("",!0),e("main",ms,[fe(t.$slots,"default")])],2),e("div",hs,[e("div",gs,[e("div",bs,[s[22]||(s[22]=me('<div class="modal-header border-0"><h5 class="modal-title fw-bold">User Profile</h5><button class="absolute top-2 right-2 p-2 rounded-full hover:bg-gray-100 transition transform hover:scale-110" data-bs-dismiss="modal" aria-label="Close" title="Close"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"></path></svg></button></div>',1)),e("div",ws,[e("div",ys,[e("div",xs,[s[18]||(s[18]=e("label",{class:"form-label"},"UserName",-1)),I(e("input",{type:"text",class:c(["form-control",{"is-invalid":d.value.username}]),"onUpdate:modelValue":s[4]||(s[4]=o=>p.value.username=o)},null,2),[[N,p.value.username]]),d.value.username?(l(),n("div",_s,r(d.value.username[0]),1)):u("",!0)]),e("div",ks,[s[19]||(s[19]=e("label",{class:"form-label"},"Password",-1)),I(e("input",{type:"password",class:c(["form-control",{"is-invalid":d.value.password}]),placeholder:"Enter new password (leave blank to keep current)","onUpdate:modelValue":s[5]||(s[5]=o=>p.value.password=o)},null,2),[[N,p.value.password]]),d.value.password?(l(),n("div",Cs,r(d.value.password[0]),1)):u("",!0)]),e("div",Ms,[s[20]||(s[20]=e("label",{class:"form-label"},"Pin",-1)),I(e("input",{type:"text",class:c(["form-control",{"is-invalid":d.value.pin}]),placeholder:"Enter new PIN (leave blank to keep current)","onUpdate:modelValue":s[6]||(s[6]=o=>p.value.pin=o)},null,2),[[N,p.value.pin]]),d.value.pin?(l(),n("div",Ss,r(d.value.pin[0]),1)):u("",!0)]),e("div",Ps,[s[21]||(s[21]=e("label",{class:"form-label"},"Role",-1)),I(e("input",{type:"text",class:c(["form-control",{"is-invalid":d.value.role}]),"onUpdate:modelValue":s[7]||(s[7]=o=>p.value.role=o),readonly:""},null,2),[[N,p.value.role]]),d.value.role?(l(),n("div",Ls,r(d.value.role[0]),1)):u("",!0)])])]),e("div",{class:"modal-footer border-0"},[e("button",{type:"button",class:"btn btn-primary py-2 px-2 w-30 rounded-pill",onClick:ae}," Update ")])])])])],64))}};export{Rs as _};
