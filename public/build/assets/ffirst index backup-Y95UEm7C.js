import{_ as Z,r as b,o as V,c as ee,I as te,y as oe,a as se,b as r,w as le,e as t,k as h,v as w,f as u,m as k,F as I,g as ae,t as l,i as _,d as j,u as q,q as c}from"./app-CbaALDFq.js";import{_ as ne}from"./Master-DgOeezfe.js";import{E as ie,a as de,X as re,u as D,w as ce}from"./xlsx-CIB83LfT.js";import{P as ue}from"./pencil-Hecq5vTE.js";import{E as me}from"./eye-l1_vkT_h.js";import"./index-Cmd-R4V0.js";import"./createLucideIcon-DEQDBvBF.js";import"./index-CCKTLXrc.js";import"./index-B2pb8CAK.js";import"./sun-CXQc7xiF.js";const pe={class:"page-wrapper"},ge={class:"card border-0 shadow-lg rounded-4"},ye={class:"card-body p-4"},ve={class:"d-flex align-items-center justify-content-between mb-3"},fe={class:"d-flex gap-2 align-items-center"},be={class:"search-wrap"},he={class:"dropdown"},we={class:"dropdown-menu dropdown-menu-end shadow rounded-4 py-2"},_e={class:"table-responsive"},xe={class:"table table-hover align-middle"},ke={class:"fw-semibold text-capitalize"},De=["title"],Se={class:"text-muted ms-2"},Ce={key:1,class:"text-muted"},Pe={class:"text-break"},Te={key:1,class:"text-muted"},Le={key:1,class:"text-muted"},Me={class:"text-end"},Ne=["onClick"],$e=["onClick"],Ee={key:0},Ve={class:"modal fade",id:"viewLogModal",tabindex:"-1","aria-hidden":"true"},Ie={class:"modal-dialog modal-lg modal-dialog-centered"},je={class:"modal-content rounded-4 shadow-lg border-0"},qe={class:"modal-header align-items-center"},Fe={class:"d-flex align-items-center gap-2"},Ue={class:"d-flex flex-column"},Be={class:"text-muted"},Oe={class:"modal-body p-4 bg-light"},Re={key:0,class:"row g-4"},ze={class:"col-lg-12"},Ae={class:"card border-0 shadow-sm rounded-4 h-100"},Qe={class:"card-body"},Ge={class:"row g-3"},Xe={class:"col-md-6"},Ye={class:"fw-semibold"},He={class:"col-md-6"},We={class:"fw-semibold"},Je={class:"col-md-6"},Ke={class:"fw-semibold"},Ze={class:"col-md-6"},et={class:"row g-3 text-center"},tt={class:"col-md-4"},ot={class:"p-3 bg-light rounded-3"},st={class:"fs-6 fw-semibold"},lt={class:"col-md-4"},at={class:"p-3 bg-light rounded-3"},nt={class:"fs-6 fw-semibold"},it={class:"col-md-4"},dt={class:"p-3 bg-light rounded-3"},rt={class:"fs-6 fw-semibold"},ct={class:"row g-3"},ut={class:"col-md-6"},mt={class:"fw-semibold"},pt={class:"col-md-6"},gt={class:"fw-semibold"},yt={class:"modal fade",id:"editLogModal",tabindex:"-1","aria-hidden":"true"},vt={class:"modal-dialog modal-lg modal-dialog-centered"},ft={class:"modal-content rounded-4"},bt={class:"modal-body"},ht={class:"row g-3"},wt={class:"col-md-6 col-md-12"},_t={class:"col-md-6 col-md-12"},xt={key:0,class:"text-danger"},kt={class:"col-md-6 col-md-12"},Dt={key:0,class:"text-danger"},St={class:"col-md-6 col-md-12"},Ct={class:"col-12 col-md-6"},Pt={class:"mt-4"},Tt=["disabled","aria-busy"],Lt={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},Mt=864e5,Nt={__name:"ffirst index backup",setup($t){const f=b([]),S=b(""),M=async()=>{try{const{data:o}=await axios.get("stock_entries/stock-logs");f.value=o}catch(o){c.error("Failed to fetch logs",o)}};V(()=>{M()});const P=ee(()=>{const o=S.value.trim().toLowerCase();return o?f.value.filter(e=>[e.itemName,e.category,e.operationType,e.type,String(e.quantity),String(e.unitPrice),String(e.totalPrice),e.expiryDate??"",e.dateTime??""].join(" ").toLowerCase().includes(o)):f.value}),C=(o,e="GBP")=>new Intl.NumberFormat("en-GB",{style:"currency",currency:e}).format(o),T=o=>new Date(o).toLocaleString("en-GB",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0}),N=o=>new Date(o).toISOString().slice(0,10);V(()=>window.feather?.replace()),te(()=>window.feather?.replace());const i=b(null),m=b({}),F=o=>{i.value=o,new bootstrap.Modal(document.getElementById("viewLogModal")).show()},d=b({id:null,itemName:"",quantity:"",unitPrice:"",expiryDate:"",operationType:""});function U(o){d.value={...o},new bootstrap.Modal(document.getElementById("editLogModal")).show()}const y=b(!1),B=()=>{m.value={}};async function O(){if(!y.value){y.value=!0,m.value={};try{await axios.put(`stock_entries/stock-logs/${d.value.id}`,d.value),await M(),c.success("Stock log updated successfully");const o=bootstrap.Modal.getInstance(document.getElementById("editLogModal"));o&&o.hide()}catch(o){o?.response?.status===422&&o.response.data?.errors?(m.value=o.response.data.errors,c.error("Please fill in all required fields correctly.")):(c.error("Something went wrong. Please try again."),console.error(o))}finally{y.value=!1}}}const L=o=>{if(!f.value||f.value.length===0){c.error("No Allergies data to download");return}const e=S.value.trim()?P.value:f.value;if(e.length===0){c.error("No Logs Moment found to download");return}try{o==="pdf"?z(e):o==="excel"?A(e):o==="csv"?R(e):c.error("Invalid download type")}catch(s){console.error("Download failed:",s),c.error(`Download failed: ${s.message}`)}},R=o=>{try{const e=["Category","Supplier","Product","Quantity","Price","Value","Operation Type","Stock Type"],s=o.map(a=>[`"${a.category||""}"`,`"${a.supplier||""}"`,`"${a.itemName||""}"`,`"${a.quantity||""}"`,`"${a.unitPrice||""}"`,`"${a.totalPrice||""}"`,`"${a.operationType||""}"`,`"${a.type||""}"`]),p=[e.join(","),...s.map(a=>a.join(","))].join(`
`),v=new Blob([p],{type:"text/csv;charset=utf-8;"}),x=URL.createObjectURL(v),n=document.createElement("a");n.setAttribute("href",x),n.setAttribute("download",`logs_moment_${new Date().toISOString().split("T")[0]}.csv`),document.body.appendChild(n),n.click(),document.body.removeChild(n),c.success("CSV downloaded successfully")}catch(e){console.error("CSV generation error:",e),c.error(`CSV generation failed: ${e.message}`,{autoClose:5e3})}},z=o=>{try{const e=new ie("p","mm","a4");e.setFontSize(20),e.setFont("helvetica","bold"),e.text("Logs Moment Report",70,20),e.setFontSize(10),e.setFont("helvetica","normal");const s=new Date().toLocaleString();e.text(`Generated on: ${s}`,70,28),e.text(`Total Logs: ${o.length}`,70,34);const p=["Category","Supplier","Product","Quantity","Value","Price","Operation Type","Stock Type"],v=o.map(n=>[n.category||"",n.supplier||"",n.itemName||"",n.quantity||"",n.unitPrice||"",n.totalPrice||"",n.operationType||"",n.type||""]);de(e,{head:[p],body:v,startY:40,styles:{fontSize:8,cellPadding:2,halign:"left",lineColor:[0,0,0],lineWidth:.1},headStyles:{fillColor:[41,128,185],textColor:255,fontStyle:"bold"},alternateRowStyles:{fillColor:[240,240,240]},margin:{left:14,right:14},didDrawPage:n=>{const a=e.internal.getNumberOfPages(),K=e.internal.pageSize.height;e.setFontSize(8),e.text(`Page ${n.pageNumber} of ${a}`,n.settings.margin.left,K-10)}});const x=`logs_moment_${new Date().toISOString().split("T")[0]}.pdf`;e.save(x),c.success("PDF downloaded successfully")}catch(e){console.error("PDF generation error:",e),c.error(`PDF generation failed: ${e.message}`,{autoClose:5e3})}},A=o=>{try{if(typeof re>"u")throw new Error("XLSX library is not loaded");const e=o.map(a=>({Category:a.category||"",Supplier:a.supplier||"",Product:a.itemName||"",Quantity:a.quantity||"",Price:a.unitPrice||"",Value:a.totalPrice||"","Operation Type":a.operationType||"","Stock Type":a.type||""})),s=D.book_new(),p=D.json_to_sheet(e);p["!cols"]=[{wch:20},{wch:20},{wch:25},{wch:10},{wch:15},{wch:15},{wch:20},{wch:20}],D.book_append_sheet(s,p,"Logs Moments");const v=[{Info:"Generated On",Value:new Date().toLocaleString()},{Info:"Total Records",Value:o.length},{Info:"Exported By",Value:"Logs Management System"}],x=D.json_to_sheet(v);D.book_append_sheet(s,x,"Report Info");const n=`logs_moment_${new Date().toISOString().split("T")[0]}.xlsx`;ce(s,n),c.success("Excel file downloaded successfully ",{autoClose:2500})}catch(e){console.error("Excel generation error:",e),c.error(`Excel generation failed: ${e.message}`,{autoClose:5e3})}},Q=o=>{if(!o)return null;if(typeof o=="string"){const s=o.match(/^\d{4}-\d{2}-\d{2}/);if(s)return new Date(s[0]+"T00:00:00")}const e=new Date(o);return isNaN(e)?null:new Date(e.getFullYear(),e.getMonth(),e.getDate())},g=o=>{const e=Q(o);if(!e)return null;const s=new Date,p=new Date(s.getFullYear(),s.getMonth(),s.getDate());return Math.ceil((e-p)/Mt)},G=o=>{const e=g(o);return e===null?"bg-secondary":e<0||e<15?"bg-danger":e<30?"bg-warning text-dark":"bg-success"},$=o=>(o??"").toString().replace(/[_-]+/g," ").trim().replace(/\w\S*/g,e=>e[0].toUpperCase()+e.slice(1).toLowerCase()),X=o=>({inventory_stockin:"Inventory Stockin",inventory_stockout:"Inventory Stockout",purchase:"Purchase",adjustment:"Adjustment",return:"Return"})[o]??$(o),Y=o=>({stockin:"Stockin",stockout:"Stockout"})[o]??$(o),H=o=>{switch(o){case"inventory_stockin":case"purchase":return"text-success";case"inventory_stockout":return"text-danger";case"adjustment":return"text-warning";default:return"text-secondary"}},W=o=>o==="stockin"?"text-success":o==="stockout"?"text-danger":"text-secondary",E=o=>o===""||o===null||o===void 0?0:Number(o),J=o=>Math.round((o+Number.EPSILON)*100)/100;return oe(()=>[d.value.quantity,d.value.unitPrice],([o,e])=>{const s=E(o)*E(e);d.value.totalPrice=J(s)},{immediate:!0}),(o,e)=>(r(),se(ne,null,{default:le(()=>[t("div",pe,[t("div",ge,[t("div",ye,[t("div",ve,[e[11]||(e[11]=t("h4",{class:"fw-semibold mb-0"},"Stock Moment Logs",-1)),t("div",fe,[t("div",be,[e[9]||(e[9]=t("i",{class:"bi bi-search"},null,-1)),h(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>S.value=s),type:"text",class:"form-control search-input",placeholder:"Search"},null,512),[[w,S.value]])]),t("div",he,[e[10]||(e[10]=t("button",{class:"btn btn-outline-secondary rounded-pill px-4 dropdown-toggle","data-bs-toggle":"dropdown"}," Download all ",-1)),t("ul",we,[t("li",null,[t("a",{class:"dropdown-item py-2",href:"javascript:;",onClick:e[1]||(e[1]=s=>L("pdf"))},"Download as PDF")]),t("li",null,[t("a",{class:"dropdown-item py-2",href:"javascript:;",onClick:e[2]||(e[2]=s=>L("excel"))},"Download as Excel")]),t("li",null,[t("a",{class:"dropdown-item py-2",href:"javascript:;",onClick:e[3]||(e[3]=s=>L("csv"))}," Download as CSV ")])])])])]),t("div",_e,[t("table",xe,[e[13]||(e[13]=t("thead",{class:"small text-muted"},[t("tr",null,[t("th",null,"Item name"),t("th",null,"Total Price"),t("th",null,"Category"),t("th",null,"Unit Price"),t("th",null,"Date & Time"),t("th",null,"Expiry Date"),t("th",null,"Quantity"),t("th",null,"Operation Type"),t("th",null,"Type"),t("th",{class:"text-end"},"Action")])],-1)),t("tbody",null,[(r(!0),u(I,null,ae(P.value,(s,p)=>(r(),u("tr",{key:s.id},[t("td",ke,l(s.itemName),1),t("td",null,l(C(s.totalPrice)),1),t("td",null,l(s.category.name),1),t("td",null,l(C(s.unitPrice)),1),t("td",null,l(T(s.dateTime)),1),t("td",null,[s.expiryDate?(r(),u(I,{key:0},[t("span",{class:_(["badge","rounded-pill",G(s.expiryDate)]),title:g(s.expiryDate)!==null?g(s.expiryDate)<0?Math.abs(g(s.expiryDate))+" day(s) ago":g(s.expiryDate)+" day(s) left":""},l(N(s.expiryDate)),11,De),t("small",Se,l(g(s.expiryDate)<0?Math.abs(g(s.expiryDate))+" day(s) ago":g(s.expiryDate)+" day(s) left"),1)],64)):(r(),u("span",Ce,"—"))]),t("td",null,l(s.quantity),1),t("td",Pe,[s.operationType?(r(),u("span",{key:0,class:_(["fw-semibold",H(s.operationType)])},l(X(s.operationType)),3)):(r(),u("span",Te,"—"))]),t("td",null,[s.type?(r(),u("span",{key:0,class:_(["fw-semibold",W(s.type)])},l(Y(s.type)),3)):(r(),u("span",Le,"—"))]),t("td",Me,[t("button",{class:"p-2 rounded-full text-blue-600 hover:bg-blue-100",onClick:v=>U(s),title:"Adjustment"},[j(q(ue),{class:"w-4 h-4"})],8,Ne),t("button",{class:"p-2 rounded-full text-gray-600 hover:bg-blue-100",onClick:v=>F(s),title:"Show"},[j(q(me),{class:"w-4 h-4"})],8,$e)])]))),128)),P.value.length===0?(r(),u("tr",Ee,[...e[12]||(e[12]=[t("td",{colspan:"10",class:"text-center text-muted py-4"}," No logs found. ",-1)])])):k("",!0)])])]),t("div",Ve,[t("div",Ie,[t("div",je,[t("div",qe,[t("div",Fe,[e[15]||(e[15]=t("span",{class:"badge bg-primary rounded-circle p-2"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3 7.5L12 12l9-4.5M3 7.5V17a2 2 0 002 2h14a2 2 0 002-2V7.5M21 7.5L12 3 3 7.5"})])],-1)),t("div",Ue,[e[14]||(e[14]=t("h5",{class:"modal-title mb-0"}," View Stock Log ",-1)),t("small",Be,"Item: "+l(i.value?.itemName??"—"),1)])]),e[16]||(e[16]=t("button",{class:"absolute top-2 right-2 p-2 rounded-full hover:bg-gray-100 transition transform hover:scale-110","data-bs-dismiss":"modal","aria-label":"Close",title:"Close"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-danger",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})])],-1))]),t("div",Oe,[i.value?(r(),u("div",Re,[t("div",ze,[t("div",Ae,[t("div",Qe,[e[26]||(e[26]=t("h6",{class:"fw-semibold mb-3"}," Details ",-1)),t("div",Ge,[t("div",Xe,[e[17]||(e[17]=t("small",{class:"text-muted d-block"},"Category",-1)),t("div",Ye,l(i.value.category?.name??"—"),1)]),t("div",He,[e[18]||(e[18]=t("small",{class:"text-muted d-block"},"Operation",-1)),t("div",We,l(i.value.operationType??"—"),1)]),t("div",Je,[e[19]||(e[19]=t("small",{class:"text-muted d-block"},"Quantity",-1)),t("div",Ke,l(i.value.quantity??"—"),1)]),t("div",Ze,[e[20]||(e[20]=t("small",{class:"text-muted d-block"},"Type",-1)),t("span",{class:_(["badge rounded-pill",i.value.type==="stockin"?"bg-success":"bg-danger"])},l(i.value.type??"—"),3)])]),e[27]||(e[27]=t("hr",{class:"my-4"},null,-1)),t("div",et,[t("div",tt,[t("div",ot,[e[21]||(e[21]=t("small",{class:"text-muted d-block"},"Unit Price",-1)),t("div",st,l(C(i.value.unitPrice??0)),1)])]),t("div",lt,[t("div",at,[e[22]||(e[22]=t("small",{class:"text-muted d-block"},"Total Price",-1)),t("div",nt,l(C(i.value.totalPrice??0)),1)])]),t("div",it,[t("div",dt,[e[23]||(e[23]=t("small",{class:"text-muted d-block"},"Date",-1)),t("div",rt,l(T(i.value.dateTime)),1)])])]),e[28]||(e[28]=t("hr",{class:"my-4"},null,-1)),t("div",ct,[t("div",ut,[e[24]||(e[24]=t("small",{class:"text-muted d-block"},"Recorded On",-1)),t("div",mt,l(T(i.value.dateTime)),1)]),t("div",pt,[e[25]||(e[25]=t("small",{class:"text-muted d-block"},"Expiry Date",-1)),t("div",gt,l(i.value.expiryDate?N(i.value.expiryDate):"—"),1)])])])])])])):k("",!0)])])])]),t("div",yt,[t("div",vt,[t("div",ft,[t("div",{class:"modal-header"},[e[30]||(e[30]=t("h5",{class:"modal-title fw-semibold"}," Edit Stock Log ",-1)),t("button",{class:"absolute top-2 right-2 p-2 rounded-full hover:bg-gray-100 transition transform hover:scale-110","data-bs-dismiss":"modal","aria-label":"Close",title:"Close",onClick:B},[...e[29]||(e[29]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),t("div",bt,[t("div",ht,[t("div",wt,[e[31]||(e[31]=t("label",{class:"form-label"},"Item Name",-1)),h(t("input",{type:"text",class:"form-control","onUpdate:modelValue":e[4]||(e[4]=s=>d.value.itemName=s),disabled:""},null,512),[[w,d.value.itemName]])]),t("div",_t,[e[32]||(e[32]=t("label",{class:"form-label"},"Quantity",-1)),h(t("input",{type:"number",class:_(["form-control",{"is-invalid":m.value.quantity}]),"onUpdate:modelValue":e[5]||(e[5]=s=>d.value.quantity=s),required:""},null,2),[[w,d.value.quantity]]),m.value.quantity?(r(),u("small",xt,l(m.value.quantity[0]),1)):k("",!0)]),t("div",kt,[e[33]||(e[33]=t("label",{class:"form-label"},"Unit Price",-1)),h(t("input",{type:"number",class:_(["form-control",{"is-invalid":m.value.unitPrice}]),"onUpdate:modelValue":e[6]||(e[6]=s=>d.value.unitPrice=s),required:""},null,2),[[w,d.value.unitPrice]]),m.value.unitPrice?(r(),u("small",Dt,l(m.value.unitPrice[0]),1)):k("",!0)]),t("div",St,[e[34]||(e[34]=t("label",{class:"form-label"},"Value",-1)),h(t("input",{type:"number",readonly:"",class:"form-control","onUpdate:modelValue":e[7]||(e[7]=s=>d.value.totalPrice=s)},null,512),[[w,d.value.totalPrice]])]),t("div",Ct,[e[35]||(e[35]=t("label",{class:"form-label"},"Expiry Date",-1)),h(t("input",{type:"date",class:"form-control","onUpdate:modelValue":e[8]||(e[8]=s=>o.expiryDateModel=s)},null,512),[[w,o.expiryDateModel]])]),t("div",Pt,[t("button",{class:"btn btn-primary rounded-pill px-4 d-inline-flex align-items-center gap-2",disabled:y.value,"aria-busy":y.value?"true":"false",onClick:O},[y.value?(r(),u("span",Lt)):k("",!0),t("span",null,l(y.value?"Updating…":"Update"),1)],8,Tt)])])])])])])])])])]),_:1}))}},zt=Z(Nt,[["__scopeId","data-v-ed9dc145"]]);export{zt as default};
