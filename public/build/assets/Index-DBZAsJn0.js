import{_ as D,r as m,k as E,p as F,D as L,c as h,o as g,w as I,b as n,x as V,g as k,y as j,n as x,A as N,m as l}from"./app-COVoaSpv.js";import{_ as O}from"./Master-CU8Kbb5A.js";import{E as q,a as M,X as R,u as y,w as B}from"./xlsx-DJLHTQQj.js";import z from"./StockInLogs-LbadCxen.js";import U from"./StockOutLogs-D6wk2cLh.js";import"./index-BQbxzkdq.js";import"./sun-DqfGktyu.js";import"./useFormatters-BC277QyT.js";import"./pencil-DHZ4m_sc.js";import"./eye-Dwf2JI1u.js";const X={class:"page-wrapper"},A={class:"card border-0 shadow-lg rounded-4"},Q={class:"card-body p-4"},G={class:"d-flex align-items-center justify-content-between mb-3"},H={class:"d-flex gap-2 align-items-center"},K={class:"search-wrap"},W={key:1,class:"form-control search-input",placeholder:"Search",disabled:"",type:"text"},Y={class:"dropdown"},J={class:"dropdown-menu dropdown-menu-end shadow rounded-4 py-2"},Z={class:"tabs-underline mb-2"},ee={__name:"Index",setup(te){const s=m([]),i=m(""),b=m(Date.now()),f=`search-${Math.random().toString(36).substr(2,9)}`,S=m(!1),d=m("stockin"),w=async()=>{try{const{data:t}=await N.get("stock_entries/stock-logs");s.value=t}catch(t){l.error("Failed to fetch logs",t)}};E(async()=>{i.value="",b.value=Date.now(),await F(),setTimeout(()=>{S.value=!0;const t=document.getElementById(f);t&&(t.value="",i.value="")},100),w()});const _=L(()=>{const t=i.value.trim().toLowerCase();return t?s.value.filter(e=>[e.itemName,e.category?.name||e.category||"",e.operationType,e.type,String(e.quantity),String(e.unitPrice),String(e.totalPrice),e.expiryDate??"",e.dateTime??""].join(" ").toLowerCase().includes(t)):s.value}),v=t=>{if(!s.value||s.value.length===0){l.error("No Allergies data to download");return}const e=i.value.trim()?_.value:s.value;if(e.length===0){l.error("No Logs Moment found to download");return}try{t==="pdf"?$(e):t==="excel"?P(e):t==="csv"?C(e):l.error("Invalid download type")}catch(r){console.error("Download failed:",r),l.error(`Download failed: ${r.message}`)}},C=t=>{try{const e=["Category","Supplier","Product","Quantity","Price","Value","Operation Type","Stock Type"],r=t.map(o=>[`"${(o.category?.name||o.category||"").toString().replace(/"/g,'""')}"`,`"${(o.supplier||"").toString().replace(/"/g,'""')}"`,`"${(o.itemName||"").toString().replace(/"/g,'""')}"`,`"${o.quantity??""}"`,`"${o.unitPrice??""}"`,`"${o.totalPrice??""}"`,`"${(o.operationType||"").toString().replace(/"/g,'""')}"`,`"${(o.type||"").toString().replace(/"/g,'""')}"`]),c=[e.join(","),...r.map(o=>o.join(","))].join(`
`),u=new Blob([c],{type:"text/csv;charset=utf-8;"}),p=URL.createObjectURL(u),a=document.createElement("a");a.setAttribute("href",p),a.setAttribute("download",`logs_moment_${new Date().toISOString().split("T")[0]}.csv`),document.body.appendChild(a),a.click(),document.body.removeChild(a),l.success("CSV downloaded successfully")}catch(e){console.error("CSV generation error:",e),l.error(`CSV generation failed: ${e.message}`,{autoClose:5e3})}},$=t=>{try{const e=new q("p","mm","a4");e.setFontSize(20),e.setFont("helvetica","bold"),e.text("Logs Moment Report",70,20),e.setFontSize(10),e.setFont("helvetica","normal");const r=new Date().toLocaleString();e.text(`Generated on: ${r}`,70,28),e.text(`Total Logs: ${t.length}`,70,34);const c=["Category","Supplier","Product","Quantity","Value","Price","Operation Type","Stock Type"],u=t.map(a=>[a.category?.name||a.category||"",a.supplier||"",a.itemName||"",a.quantity??"",a.unitPrice??"",a.totalPrice??"",a.operationType||"",a.type||""]);M(e,{head:[c],body:u,startY:40,styles:{fontSize:8,cellPadding:2,halign:"left",lineColor:[0,0,0],lineWidth:.1},headStyles:{fillColor:[41,128,185],textColor:255,fontStyle:"bold"},alternateRowStyles:{fillColor:[240,240,240]},margin:{left:14,right:14},didDrawPage:a=>{const o=e.internal.getNumberOfPages(),T=e.internal.pageSize.height;e.setFontSize(8),e.text(`Page ${a.pageNumber} of ${o}`,a.settings.margin.left,T-10)}});const p=`logs_moment_${new Date().toISOString().split("T")[0]}.pdf`;e.save(p),l.success("PDF downloaded successfully")}catch(e){console.error("PDF generation error:",e),l.error(`PDF generation failed: ${e.message}`,{autoClose:5e3})}},P=t=>{try{if(typeof R>"u")throw new Error("XLSX library is not loaded");const e=t.map(o=>({Category:o.category?.name||o.category||"",Supplier:o.supplier||"",Product:o.itemName||"",Quantity:o.quantity??"",Price:o.unitPrice??"",Value:o.totalPrice??"","Operation Type":o.operationType||"","Stock Type":o.type||""})),r=y.book_new(),c=y.json_to_sheet(e);c["!cols"]=[{wch:20},{wch:20},{wch:25},{wch:10},{wch:15},{wch:15},{wch:20},{wch:20}],y.book_append_sheet(r,c,"Logs Moments");const u=[{Info:"Generated On",Value:new Date().toLocaleString()},{Info:"Total Records",Value:t.length},{Info:"Exported By",Value:"Logs Management System"}],p=y.json_to_sheet(u);y.book_append_sheet(r,p,"Report Info");const a=`logs_moment_${new Date().toISOString().split("T")[0]}.xlsx`;B(r,a),l.success("Excel file downloaded successfully ",{autoClose:2500})}catch(e){console.error("Excel generation error:",e),l.error(`Excel generation failed: ${e.message}`,{autoClose:5e3})}};return(t,e)=>(g(),h(O,null,{default:I(()=>[n("div",X,[n("div",A,[n("div",Q,[n("div",G,[e[10]||(e[10]=n("h4",{class:"mb-0"},"Stock Moment Logs",-1)),n("div",H,[n("div",K,[e[7]||(e[7]=n("i",{class:"bi bi-search"},null,-1)),e[8]||(e[8]=n("input",{type:"email",name:"email",autocomplete:"email",style:{position:"absolute",left:"-9999px",width:"1px",height:"1px"},tabindex:"-1","aria-hidden":"true"},null,-1)),S.value?V((g(),k("input",{id:f,"onUpdate:modelValue":e[0]||(e[0]=r=>i.value=r),key:b.value,class:"form-control search-input",placeholder:"Search",type:"search",autocomplete:"new-password",name:f,role:"presentation",onFocus:e[1]||(e[1]=(...r)=>t.handleFocus&&t.handleFocus(...r))},null,32)),[[j,i.value]]):(g(),k("input",W))]),n("div",Y,[e[9]||(e[9]=n("button",{class:"btn btn-outline-secondary rounded-pill px-4 dropdown-toggle","data-bs-toggle":"dropdown"}," Export ",-1)),n("ul",J,[n("li",null,[n("a",{class:"dropdown-item py-2",href:"javascript:;",onClick:e[2]||(e[2]=r=>v("pdf"))}," Export as PDF ")]),n("li",null,[n("a",{class:"dropdown-item py-2",href:"javascript:;",onClick:e[3]||(e[3]=r=>v("excel"))}," Export as Excel ")]),n("li",null,[n("a",{class:"dropdown-item py-2",href:"javascript:;",onClick:e[4]||(e[4]=r=>v("csv"))}," Export as CSV ")])])])])]),n("div",Z,[n("button",{class:x(["tab-link fw-semibold",{active:d.value==="stockin"}]),onClick:e[5]||(e[5]=r=>d.value="stockin")}," Stock In ",2),n("button",{class:x(["tab-link fw-semibold",{active:d.value==="stockout"}]),onClick:e[6]||(e[6]=r=>d.value="stockout")}," Stock Out ",2)]),e[11]||(e[11]=n("div",{class:"border-bottom mb-3"},null,-1)),d.value==="stockin"?(g(),h(z,{key:0,logs:s.value,q:i.value,onUpdated:w},null,8,["logs","q"])):(g(),h(U,{key:1,logs:s.value,q:i.value,onUpdated:w},null,8,["logs","q"]))])])])]),_:1}))}},pe=D(ee,[["__scopeId","data-v-3d017a4e"]]);export{pe as default};
