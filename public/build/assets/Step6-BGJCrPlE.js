import{_ as L,R as O,y as U,$ as F,r as g,o as M,f as l,b as n,m as u,e as t,k as _,v as C,i as p,t as a,d as k,X as Y,Y as w,l as f,u as B,B as J}from"./app-TGxiLcAW.js";import{s as E}from"./index-DdttPxST.js";import{u as K}from"./useFormatters-C4x7YHWO.js";import"./index-2u1IeWL4.js";import"./index-C29vjDIk.js";import"./index-gBL-8oHP.js";import"./index-0YkJ-kOr.js";const $={key:0,class:"fw-bold mb-3"},z={class:"row g-4"},A={class:"col-lg-7"},Q={key:0,class:"text-danger"},W={class:"row g-3 align-items-start mt-2"},X={class:"col-md-4 upload-image-area"},G={class:"logo-card"},H=["src"],Z={key:1,class:"placeholder"},ee={key:0,class:"text-danger"},te={class:"col-md-8 right-side-receipt-area"},se={key:0,class:"text-danger"},re={class:"mt-3"},oe={class:"segmented"},le={key:0,class:"text-danger"},ne={class:"mt-3"},ie={class:"segmented"},ae={class:"mt-3"},de={class:"d-flex align-items-center justify-content-between mb-2"},ue={key:0,class:"badge bg-success me-2"},ce={key:1,class:"badge bg-warning text-dark me-2"},pe={class:"d-flex gap-2"},me=["disabled"],ve=["disabled"],be={key:0,class:"alert alert-danger py-2 px-3 rounded-3 mb-2"},fe={key:1,class:"text-center py-3"},ge={key:2},_e={key:0,class:"alert alert-info py-2 px-3 rounded-3 mb-3"},ye={key:1,class:"alert alert-success py-2 px-3 rounded-3 mb-3"},we={key:1,class:"text-danger"},xe={class:"col-lg-5"},ke={class:"receipt-card"},he={class:"text-center"},Se={key:0,class:"mb-3 receipt-logo-container"},Ue=["src"],Ce={class:"mb-1"},Be={class:"text-center my-2"},Ee={class:"text-muted small"},Pe={class:"text-center my-2"},Ne={class:"text-muted small"},qe={class:"small"},Ie={class:"d-flex justify-content-between"},Ve={class:"d-flex justify-content-between"},De={class:"small"},je={class:"d-flex justify-content-between"},Re={class:"d-flex justify-content-between"},Te={class:"small"},Le={class:"d-flex justify-content-between"},Oe={key:0,class:"d-flex justify-content-center my-2"},Fe={class:"text-center small"},Me={__name:"Step6",props:{model:Object,formErrors:Object,isOnboarding:{type:Boolean,default:!1}},emits:["save"],setup(d,{emit:P}){const i=d,N=P;K();const s=O({receipt_header:i.model?.receipt_header??i.model?.business_name??"Enter store name",receipt_footer:i.model?.receipt_footer??"Thank You for Taste Us",receipt_logo:i.model?.receipt_logo_url??i.model?.logo_url??null,receipt_logo_file:null,show_qr:i.model?.show_qr??1,tax_breakdown:i.model?.tax_breakdown??!0,store_phone:i.model?.phone??"",store_name:i.model?.store_name??i.model?.business_name??"Enter store name",address:i.model?.address??"xyz",customer_printer:i.model?.customer_printer??"browser",kot_printer:i.model?.kot_printer??"browser"});U(s,()=>N("save",{step:6,data:F(s)}),{deep:!0,immediate:!0});const y=g(!1);function q(){y.value=!0}function I({file:o}){s.receipt_logo_file=o,s.receipt_logo=URL.createObjectURL(o),y.value=!1}const m=g([]),c=g(!1),v=g(!1),V=g(null),b=g(null),h=[1155,1046,1049,1208,1317,1659,5380,6790,3540,4070,8401,5455],S=()=>(v.value="usb"in navigator,v.value),D=async()=>{if(!v.value)return[];try{return(await navigator.usb.getDevices()).filter(e=>h.includes(e.vendorId)||e.productName?.toLowerCase().includes("printer")||e.productName?.toLowerCase().includes("pos")||e.productName?.toLowerCase().includes("thermal"))}catch(o){return console.error("Error getting USB devices:",o),[]}},j=async()=>{if(!v.value)return b.value="WebUSB is not supported in this browser. Please use Chrome or Edge.",null;try{b.value=null;const o=h.map(r=>({vendorId:r})),e=await navigator.usb.requestDevice({filters:o});if(e)return V.value={name:e.productName||"USB Thermal Printer",manufacturer:e.manufacturerName||"Unknown",vendorId:e.vendorId,productId:e.productId,device:e},await x(),e}catch(o){o.name!=="NotFoundError"&&(b.value="Failed to connect: "+o.message,console.error("USB request error:",o))}return null},x=async()=>{c.value=!0,b.value=null;try{const o=[{label:"ðŸ–¨ Browser Print Dialog",value:"browser",driver:"Browser",port:"System",type:"browser"}];if(S()){const e=await D();for(const r of e)o.push({label:"ðŸ”Œ "+(r.productName||"USB Printer"),value:"usb_"+r.vendorId+"_"+r.productId,driver:r.manufacturerName||"USB",port:"USB",type:"usb",device:r})}if(m.value=o,m.value.length>1&&s.customer_printer==="browser"){const e=m.value.find(r=>r.type==="usb");e&&(s.customer_printer=e.value,s.kot_printer=e.value)}}catch(o){console.error("Failed to fetch printers:",o),b.value="Failed to detect printers: "+o.message}finally{c.value=!1}},R=async()=>{c.value=!0;try{await j()}finally{c.value=!1}},T=()=>{const o={customer_printer:s.customer_printer,kot_printer:s.kot_printer,printers:m.value.map(e=>({label:e.label,value:e.value,type:e.type,vendorId:e.device?.vendorId,productId:e.device?.productId}))};localStorage.setItem("pos_printer_config",JSON.stringify(o))};return U(()=>[s.customer_printer,s.kot_printer],()=>{T()},{deep:!0}),M(()=>{S(),x();const o=localStorage.getItem("pos_printer_config");if(o)try{const e=JSON.parse(o);e.customer_printer&&(s.customer_printer=e.customer_printer),e.kot_printer&&(s.kot_printer=e.kot_printer)}catch(e){console.error("Error loading printer config:",e)}}),(o,e)=>(n(),l("div",null,[i.isOnboarding?(n(),l("h5",$,"Step 6 of 9 - Receipt & Printer Setup")):u("",!0),t("div",z,[t("div",A,[e[27]||(e[27]=t("label",{class:"form-label"},"Receipt header",-1)),_(t("input",{class:p(["form-control",{"is-invalid":d.formErrors?.receipt_header}]),"onUpdate:modelValue":e[0]||(e[0]=r=>s.receipt_header=r)},null,2),[[C,s.receipt_header]]),d.formErrors?.receipt_header?(n(),l("small",Q,a(d.formErrors.receipt_header[0]),1)):u("",!0),t("div",W,[t("div",X,[e[12]||(e[12]=t("small",{class:"text-muted mt-2"},"Upload Receipt Logo",-1)),t("div",G,[t("div",{class:"logo-frame",onClick:e[1]||(e[1]=r=>q())},[s.receipt_logo?(n(),l("img",{key:0,src:s.receipt_logo,alt:"Receipt Logo",class:"receipt-logo-preview"},null,8,H)):(n(),l("div",Z,[...e[10]||(e[10]=[t("i",{class:"bi bi-image"},null,-1)])]))]),k(Y,{show:y.value,onClose:e[2]||(e[2]=r=>y.value=!1),onCropped:I},null,8,["show"]),e[11]||(e[11]=t("small",{class:"d-block text-center mt-2 text-muted"},"Click to upload/change logo",-1))]),d.formErrors?.receipt_logo_file?(n(),l("small",ee,a(d.formErrors.receipt_logo_file[0]),1)):u("",!0)]),t("div",te,[e[26]||(e[26]=t("label",{class:"form-label"},"Receipt Footer",-1)),_(t("input",{class:p(["form-control",{"is-invalid":d.formErrors?.receipt_footer}]),"onUpdate:modelValue":e[3]||(e[3]=r=>s.receipt_footer=r)},null,2),[[C,s.receipt_footer]]),d.formErrors?.receipt_footer?(n(),l("small",se,a(d.formErrors.receipt_footer[0]),1)):u("",!0),t("div",re,[e[13]||(e[13]=t("label",{class:"form-label d-block mb-2"}," Show QR Code on Receipt ",-1)),t("div",oe,[_(t("input",{class:p(["segmented__input",{"is-invalid":d.formErrors?.show_qr}]),type:"radio",id:"qr-yes",value:1,"onUpdate:modelValue":e[4]||(e[4]=r=>s.show_qr=r)},null,2),[[w,s.show_qr,void 0,{number:!0}]]),t("label",{class:p(["segmented__btn",{"is-active":s.show_qr===1}]),for:"qr-yes"},"YES",2),_(t("input",{class:"segmented__input",type:"radio",id:"qr-no",value:0,"onUpdate:modelValue":e[5]||(e[5]=r=>s.show_qr=r)},null,512),[[w,s.show_qr,void 0,{number:!0}]]),t("label",{class:p(["segmented__btn",{"is-active":s.show_qr===0}]),for:"qr-no"},"NO",2),d.formErrors?.show_qr?(n(),l("small",le,a(d.formErrors.show_qr[0]),1)):u("",!0)])]),t("div",ne,[e[14]||(e[14]=t("label",{class:"form-label d-block mb-2"},"Tax Breakdown",-1)),t("div",ie,[_(t("input",{class:"segmented__input",type:"radio",id:"tb-yes",value:!0,"onUpdate:modelValue":e[6]||(e[6]=r=>s.tax_breakdown=r)},null,512),[[w,s.tax_breakdown]]),t("label",{class:p(["segmented__btn",{"is-active":s.tax_breakdown===!0}]),for:"tb-yes"},"YES",2),_(t("input",{class:"segmented__input",type:"radio",id:"tb-no",value:!1,"onUpdate:modelValue":e[7]||(e[7]=r=>s.tax_breakdown=r)},null,512),[[w,s.tax_breakdown]]),t("label",{class:p(["segmented__btn",{"is-active":s.tax_breakdown===!1}]),for:"tb-no"},"NO",2)])]),t("div",ae,[t("div",de,[t("div",null,[v.value?(n(),l("span",ue,[...e[15]||(e[15]=[t("i",{class:"bi bi-check-circle me-1"},null,-1),f(" Direct USB Supported ",-1)])])):(n(),l("span",ce,[...e[16]||(e[16]=[t("i",{class:"bi bi-exclamation-triangle me-1"},null,-1),f(" Browser Print Only ",-1)])]))]),t("div",pe,[v.value?(n(),l("button",{key:0,type:"button",class:"btn btn-sm btn-success custom-connect-btn d-flex align-items-center rounded-pill",onClick:R,disabled:c.value},[...e[17]||(e[17]=[t("i",{class:"bi bi-usb-plug me-1"},null,-1),f(" Connect USB Printer ",-1)])],8,me)):u("",!0),t("button",{type:"button",class:"btn btn-sm btn-outline-primary custom-refresh-btn d-flex align-items-center rounded-pill",onClick:x,disabled:c.value},[t("i",{class:p(["pi pi-refresh me-1 px-1",{"pi-spin":c.value}])},null,2),f(" "+a(c.value?"Refreshing...":"Refresh"),1)],8,ve)])]),b.value?(n(),l("div",be,[e[18]||(e[18]=t("i",{class:"bi bi-exclamation-circle me-2"},null,-1)),f(" "+a(b.value),1)])):u("",!0),c.value?(n(),l("div",fe,[...e[19]||(e[19]=[t("div",{class:"fw-semibold text-secondary mb-2"}," Scanning for printers, please wait... ",-1),t("div",{class:"spinner-border",role:"status",style:{color:"#1c0d82",width:"2rem",height:"2rem"}},[t("span",{class:"visually-hidden"},"Loading...")],-1)])])):(n(),l("div",ge,[v.value?u("",!0):(n(),l("div",_e,[...e[20]||(e[20]=[t("i",{class:"bi bi-info-circle me-2"},null,-1),t("strong",null,"Tip:",-1),f(" For direct USB thermal printing, use Chrome or Edge browser. Currently using browser print dialog. ",-1)])])),m.value.some(r=>r.type==="usb")?(n(),l("div",ye,[...e[21]||(e[21]=[t("i",{class:"bi bi-check-circle me-2"},null,-1),t("strong",null,"USB Printer Connected!",-1),f(" Direct thermal printing available. ",-1)])])):u("",!0),e[22]||(e[22]=t("label",{class:"form-label d-block mb-2"},"Customer Receipt Printer",-1)),k(B(E),{modelValue:s.customer_printer,"onUpdate:modelValue":e[8]||(e[8]=r=>s.customer_printer=r),options:m.value,optionLabel:"label",optionValue:"value",placeholder:"Select Customer Printer",loading:c.value,class:"w-100"},null,8,["modelValue","options","loading"]),e[23]||(e[23]=t("small",{class:"text-muted"},"Used for printing customer receipts",-1)),e[24]||(e[24]=t("label",{class:"form-label d-block mt-3 mb-2"},"Kitchen (KOT) Printer",-1)),k(B(E),{modelValue:s.kot_printer,"onUpdate:modelValue":e[9]||(e[9]=r=>s.kot_printer=r),options:m.value,optionLabel:"label",optionValue:"value",placeholder:"Select KOT Printer",loading:c.value,class:"w-100"},null,8,["modelValue","options","loading"]),e[25]||(e[25]=t("small",{class:"text-muted"},"Used for printing kitchen order tickets",-1))]))]),d.formErrors?.printers?(n(),l("small",we,a(d.formErrors.printers[0]),1)):u("",!0)])])]),t("div",xe,[t("div",ke,[t("div",he,[s.receipt_logo?(n(),l("div",Se,[t("img",{src:s.receipt_logo,alt:"Receipt Logo",class:"receipt-logo-display"},null,8,Ue)])):u("",!0),t("h6",Ce,a(s.receipt_header),1),t("div",Be,[t("div",Ee,a(s.store_phone),1)]),t("div",Pe,[t("div",Ne,a(s.address),1)])]),e[39]||(e[39]=t("hr",{class:"my-2"},null,-1)),t("div",qe,[t("div",Ie,[e[28]||(e[28]=t("span",null,"Date:",-1)),t("span",null,a(new Date().toLocaleDateString().replace(/\//g,"-")),1)]),t("div",Ve,[e[29]||(e[29]=t("span",null,"Time:",-1)),t("span",null,a(new Date().toLocaleTimeString()),1)]),e[30]||(e[30]=J('<div class="d-flex justify-content-between" data-v-1363db12><span data-v-1363db12>Customer Name:</span><span data-v-1363db12>John Snow</span></div><div class="d-flex justify-content-between" data-v-1363db12><span data-v-1363db12>Order Type:</span><span data-v-1363db12>Dine In</span></div><div class="d-flex justify-content-between" data-v-1363db12><span data-v-1363db12>Note:</span><span data-v-1363db12>One Cheese Burger Please</span></div><div class="d-flex justify-content-between" data-v-1363db12><span data-v-1363db12>Payment Type:</span><span data-v-1363db12>Cash/Card</span></div>',4))]),e[40]||(e[40]=t("hr",{class:"my-2"},null,-1)),t("div",De,[e[35]||(e[35]=t("div",{class:"d-flex justify-content-between fw-semibold"},[t("span",null,"Name"),t("span",null,"Qty"),t("span",null,"Price")],-1)),t("div",je,[e[31]||(e[31]=t("span",null,"Item A",-1)),e[32]||(e[32]=t("span",null,"1",-1)),t("span",null,a(i.model?.currency??"Â£")+" 950 ",1)]),t("div",Re,[e[33]||(e[33]=t("span",null,"Item B",-1)),e[34]||(e[34]=t("span",null,"2",-1)),t("span",null,a(i.model?.currency??"Â£")+" 50",1)])]),e[41]||(e[41]=t("hr",{class:"my-2"},null,-1)),t("div",Te,[t("div",Le,[e[36]||(e[36]=t("span",null,"Total Price:",-1)),t("span",null,a(i.model?.currency??"Â£")+" 2000",1)]),e[37]||(e[37]=t("div",{class:"d-flex justify-content-between"},[t("span",null,"Tax:"),t("span",null,"23%")],-1))]),s.show_qr===1?(n(),l("div",Oe,[...e[38]||(e[38]=[t("div",{class:"qr-box","aria-hidden":"true"},null,-1)])])):u("",!0),e[42]||(e[42]=t("hr",{class:"my-2"},null,-1)),t("div",Fe,a(s.receipt_footer||"Thank you!"),1)])])])]))}},We=L(Me,[["__scopeId","data-v-1363db12"]]);export{We as default};
