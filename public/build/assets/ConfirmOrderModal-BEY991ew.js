import{_ as J,A as X,r as w,c as y,w as A,g as n,l as c,b as r,f as e,p as h,t as i,j as C,F as K,i as Y,u as b,m as N,Z as O,v as _,e as F,s as M}from"./app-DR8KNMKR.js";import ee from"./StripePayment-CBYaks-d.js";import te from"./SplitPayment-DOec7cXC.js";import{u as se}from"./useFormatters-DMXCh6bx.js";const ae={key:0,class:"modal fade show d-block",tabindex:"-1",style:{background:"rgba(0, 0, 0, 0.5)"}},oe={class:"modal-dialog modal-xl modal-dialog-centered"},le={class:"modal-content rounded-4 s border-0"},de={class:"modal-header brand-gradient text-white py-3 position-sticky top-0 z-3"},ne={class:"modal-title fw-bold d-flex align-items-center gap-2 m-0"},re={class:"modal-body p-3 p-md-4 body-scroll"},ie={class:"row g-3"},ce={class:"col-12 col-md-6 d-flex"},ue={class:"w-100 d-flex flex-column gap-3"},me={class:"card border-0 brand-card h-100"},ve={class:"card-body"},pe={class:"d-flex justify-content-between align-items-center mb-3"},ye={class:"row g-3"},he={class:"col-12 col-sm-6"},be={class:"p-3 rounded-3 bg-light d-flex flex-column h-100"},ge={class:"fw-semibold"},fe={class:"col-12 col-sm-6"},xe={class:"p-3 rounded-3 bg-light d-flex flex-column h-100"},ke={class:"fw-semibold"},Te={class:"badge brand-badge px-3 py-2 service-badge"},we={key:0,class:"col-12 col-sm-6"},Ce={class:"p-3 rounded-3 bg-light d-flex flex-column"},Se={class:"fw-semibold"},Ie={key:1,class:"col-12 col-sm-6"},De={class:"p-3 rounded-3 bg-light d-flex flex-column"},Pe={class:"fw-semibold"},Ne={key:2,class:"col-12 col-sm-6"},Re={class:"p-3 rounded-3 bg-light d-flex flex-column"},Ae={class:"fw-semibold"},Oe={class:"table-responsive compact-table"},Me={class:"table align-middle table-hover mb-0"},Le={class:"table-light"},$e={key:0,style:{width:"40px"}},qe=["checked"],Ve={key:0},Be=["checked","onChange"],Ee={key:1,class:"text-success fw-bold d-flex align-items-center gap-1 bg-success-subtle p-1 rounded-pill"},Ke={class:"d-flex align-items-center gap-2"},Fe={class:"fw-semibold"},je={key:0,class:"small text-muted"},ze={key:1,class:"small text-muted"},Ue={key:2,class:"small text-warning fw-semibold"},Ge={class:"text-center"},Qe={class:"text-end"},We={class:"text-end fw-bold"},Ze={key:0,class:"table-info"},He=["colspan"],Je={class:"text-end fw-bold text-primary"},Xe={key:1},Ye=["colspan"],_e={key:0},et={class:"text-end text-success"},tt={class:"fw-bold"},st=["colspan"],at={class:"text-end text-success"},ot={key:2,class:"border-top-0 bg-light-subtle"},lt={class:"text-end text-muted py-2 fw-bold",style:{"font-size":"0.85rem"}},dt={class:"col-12 col-md-6 d-flex"},nt={class:"w-100"},rt={class:"card border-0 brand-card h-100"},it={class:"card-body d-flex flex-column"},ct={class:"segmented mt-1 mb-3",role:"tablist","aria-label":"Payment method"},ut={key:0,class:"pt-2 border-top"},mt={key:0,class:"text-danger"},vt={class:"mt-2"},pt={class:"d-flex gap-2 mt-3"},yt=["disabled"],ht={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},bt={key:1,class:"bi bi-check2-circle"},gt=["disabled"],ft={key:1,class:"pt-3 border-top"},xt={key:2,class:"pt-3 border-top"},kt={__name:"ConfirmOrderModal",props:{show:Boolean,customer:String,deliveryLocation:String,phone:String,orderType:String,selectedTable:Object,orderItems:Array,grandTotal:Number,money:Function,cashReceived:Number,order_code:String,subTotal:Number,tax:Number,serviceCharges:Number,deliveryCharges:Number,note:[String,null],kitchenNote:[String,null],orderDate:String,orderTime:String,paymentMethod:String,change:Number,promoDiscount:{type:Number,default:0},promoId:{type:[Number,String,null],default:null},promoName:{type:[String,null],default:null},promoType:{type:[String,null],default:null},promoDiscountAmount:{type:Number,default:0},appliedPromos:{type:Array,default:()=>[]},approvedDiscounts:{type:Number,default:0},approvedDiscountDetails:{type:Array,default:()=>[]},isPartialPayment:{type:Boolean,default:!1},isPaymentOnly:{type:Boolean,default:!1},currentOrderId:{type:[Number,null],default:null}},emits:["close","confirm","update:cashReceived","pay-item","partial-payment","payment-success"],setup(s,{emit:j}){const z=X(),{formatCurrencySymbol:g}=se(),u=s,L=w(!1),T=w({}),d=w([]),l=w(!1),R=j,m=w("Cash"),p=y({get:()=>u.cashReceived,set:o=>R("update:cashReceived",o)}),S=y(()=>m.value==="Cash"?p.value-f.value:0),f=y(()=>{let o=0;return l.value?d.value.length>0&&(o=d.value.reduce((t,a)=>{const v=Number(a.unit_price||a.price)||0,E=Number(a.qty||a.quantity)||0;return t+v*E},0)):o=u.grandTotal-(u.promoDiscount||0),Math.round(o*100)/100});A(f,o=>{l.value&&(p.value=o)}),A(()=>u.orderItems,o=>{o&&Array.isArray(o)&&(d.value=d.value.filter(t=>{const a=o.find(v=>k(v)===k(t));return a&&String(a.payment_status).toLowerCase()!=="paid"}))},{deep:!0}),A(l,o=>{o?d.value.length===0&&(p.value=0):(p.value=u.grandTotal-(u.promoDiscount||0),d.value=[])});const $=o=>{d.value=[],R("payment-success",o)},q=y(()=>Array.isArray(u.orderItems)?u.orderItems.reduce((o,t)=>o+(Number(t.unit_price||t.price)||0)*(Number(t.qty||t.quantity)||0),0):0),x=w(!1),k=o=>o.server_item_id?`server-${o.server_item_id}`:`${o.isDeal?"deal":"prod"}-${o.id}`,U=o=>{if(String(o.payment_status).toLowerCase()==="paid")return;const t=k(o),a=d.value.findIndex(v=>k(v)===t);a>-1?d.value.splice(a,1):d.value.push(o)},V=o=>{const t=k(o);return d.value.some(a=>k(a)===t)},G=()=>{l.value=!0,d.value=[]},Q=()=>{l.value=!1,d.value=[]},I=y(()=>d.value.filter(o=>o.server_item_id).map(o=>o.server_item_id)),D=y(()=>d.value.filter(o=>!o.server_item_id&&!o.isDeal).map(o=>o.id)),P=y(()=>d.value.filter(o=>!o.server_item_id&&o.isDeal).map(o=>o.id)),W=async()=>{L.value=!0,await B()},B=async()=>{T.value.cashReceived=null;const o=l.value?f.value:u.grandTotal;if(!u.cashReceived||u.cashReceived<=0){T.value.cashReceived="Enter a valid cash amount.",M.error("Enter a valid cash amount.");return}if(Math.round(u.cashReceived*100)/100<o){T.value.cashReceived="Cash received cannot be less than payment amount.",M.error("Cash received cannot be less than payment amount.");return}if(l.value&&d.value.length===0){M.error("Please select at least one item to pay for.");return}x.value||(x.value=!0,R("confirm",{paymentMethod:m.value,cashReceived:p.value,changeAmount:S.value,items:u.orderItems,autoPrintKot:L.value,existingOrderId:u.currentOrderId,isPartialPayment:l.value,selectedItems:d.value,selectedItemIds:I.value.concat(D.value).concat(P.value),paidItemIds:I.value,paidProductIds:D.value,paidDealIds:P.value,done:()=>{x.value=!1}}))},Z=y(()=>u.orderItems),H=y(()=>u.orderType?u.orderType.replace(/_/g," ").replace(/\b\w/g,o=>o.toUpperCase()):"");return(o,t)=>s.show?(r(),n("div",ae,[e("div",oe,[e("div",le,[e("div",de,[e("h5",ne,[t[9]||(t[9]=e("i",{class:"bi bi-receipt-cutoff"},null,-1)),h(" "+i(l.value?"Partial Payment":"Confirm Order"),1)]),e("button",{class:"absolute top-2 right-2 p-2 rounded-full hover:bg-gray-100 transition transform hover:scale-110",onClick:t[0]||(t[0]=a=>o.$emit("close")),"aria-label":"Close",title:"Close"},[...t[10]||(t[10]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("div",re,[e("div",ie,[e("div",ce,[e("div",ue,[e("div",me,[e("div",ve,[e("div",pe,[t[11]||(t[11]=e("h6",{class:"fw-bold brand-text m-0 d-flex align-items-center gap-2"},[e("i",{class:"bi bi-info-circle"}),h(" Order Summary ")],-1)),e("div",{class:"mode-toggle-container",onClick:t[1]||(t[1]=a=>{l.value=!l.value,l.value?G():Q()})},[e("div",{class:C(["mode-option",{active:!l.value}])},"Full Pay",2),e("div",{class:C(["mode-option",{active:l.value}])},"Partial ",2),e("div",{class:C(["mode-slider",{"slide-right":l.value}])},null,2)])]),e("div",ye,[e("div",he,[e("div",be,[t[12]||(t[12]=e("span",{class:"text-muted small"},"Customer",-1)),e("span",ge,i(s.customer||"Walk In"),1)])]),e("div",fe,[e("div",xe,[t[13]||(t[13]=e("span",{class:"text-muted small"},"Service",-1)),e("span",ke,[e("span",Te,i(H.value),1)])])]),s.orderType==="Dine_in"?(r(),n("div",we,[e("div",Ce,[t[14]||(t[14]=e("span",{class:"text-muted small"},"Table No",-1)),e("span",Se,i(s.selectedTable?.name||"N/A"),1)])])):c("",!0),s.orderType==="Delivery"?(r(),n("div",Ie,[e("div",De,[t[15]||(t[15]=e("span",{class:"text-muted small"},"Delivery Location",-1)),e("span",Pe,i(s.deliveryLocation||"N/A"),1)])])):c("",!0),s.orderType==="Delivery"?(r(),n("div",Ne,[e("div",Re,[t[16]||(t[16]=e("span",{class:"text-muted small"},"Phone No",-1)),e("span",Ae,i(s.phone||"N/A"),1)])])):c("",!0),e("div",Oe,[e("table",Me,[e("thead",Le,[e("tr",null,[l.value?(r(),n("th",$e,[e("input",{type:"checkbox",class:"form-check-input",onChange:t[2]||(t[2]=a=>a.target.checked?d.value=s.orderItems.filter(v=>v.payment_status!=="paid"):d.value=[]),checked:d.value.length>0&&d.value.length===s.orderItems.filter(a=>a.payment_status!=="paid").length},null,40,qe)])):c("",!0),t[17]||(t[17]=e("th",null,"#",-1)),t[18]||(t[18]=e("th",null,"Item",-1)),t[19]||(t[19]=e("th",{class:"text-center"},"Qty",-1)),t[20]||(t[20]=e("th",{class:"text-end"},"Price",-1)),t[21]||(t[21]=e("th",{class:"text-end"},"Total",-1))])]),e("tbody",null,[(r(!0),n(K,null,Y(Z.value,(a,v)=>(r(),n("tr",{key:k(a)||v,class:C({"table-primary shadow-sm":l.value&&V(a),"bg-success-subtle border-success-subtle transition-all duration-300":String(a.payment_status).toLowerCase()==="paid"})},[l.value?(r(),n("td",Ve,[String(a.payment_status).toLowerCase()!=="paid"?(r(),n("input",{key:0,type:"checkbox",class:"form-check-input cursor-pointer",checked:V(a),onChange:E=>U(a)},null,40,Be)):(r(),n("div",Ee,[...t[22]||(t[22]=[e("i",{class:"bi bi-check-circle-fill"},null,-1),e("small",null,"Paid",-1)])]))])):c("",!0),e("td",null,i(v+1),1),e("td",null,[e("div",Ke,[e("div",Fe,i(a.title),1)]),a.note?(r(),n("div",je," Note: "+i(a.note),1)):c("",!0),a.kitchen_note?(r(),n("div",ze," Kitchen Note: "+i(a.kitchen_note),1)):c("",!0),a.item_kitchen_note?(r(),n("div",Ue," Item Note: "+i(a.item_kitchen_note),1)):c("",!0)]),e("td",Ge,i(a.qty||a.quantity),1),e("td",Qe,i(b(g)(a.unit_price||a.price)),1),e("td",We,i(b(g)((Number(a.unit_price||a.price)||0)*(Number(a.qty||a.quantity)||0))),1)],2))),128))]),e("tfoot",null,[l.value&&d.value.length>0?(r(),n("tr",Ze,[e("td",{colspan:l.value?5:4,class:"text-end fw-semibold"}," Selected Items Subtotal ("+i(d.value.length)+" items) ",9,He),e("td",Je,i(b(g)(f.value)),1)])):c("",!0),s.promoDiscount>0&&!l.value?(r(),n("tr",Xe,[e("td",{colspan:l.value?5:4,class:"text-end text-muted"},[t[23]||(t[23]=h(" Promo ",-1)),s.promoName?(r(),n("span",_e,"("+i(s.promoName)+")",1)):c("",!0)],8,Ye),e("td",et," -"+i(b(g)(s.promoDiscount)),1)])):c("",!0),e("tr",tt,[e("td",{colspan:l.value?5:4,class:"text-end"},i(l.value?"Payment Amount":"Grand Total"),9,st),e("td",at,i(b(g)(f.value)),1)]),l.value?(r(),n("tr",ot,[t[24]||(t[24]=e("td",{colspan:5,class:"text-end text-muted py-2 fw-semibold",style:{"font-size":"0.85rem"}},[e("i",{class:"bi bi-cart-check me-1"}),h(" Full Order Total ")],-1)),e("td",lt,i(b(g)(s.grandTotal-(s.promoDiscount||0))),1)])):c("",!0)])])])])])])])]),e("div",dt,[e("div",nt,[e("div",rt,[e("div",it,[e("div",ct,[N(e("input",{class:"segmented-input",type:"radio",id:"paymentCash",name:"payMethod",value:"Cash","onUpdate:modelValue":t[3]||(t[3]=a=>m.value=a)},null,512),[[O,m.value]]),t[27]||(t[27]=e("label",{class:"segmented-label",for:"paymentCash"},[e("i",{class:"bi bi-cash-coin me-1"}),h(" Cash ")],-1)),b(z).props?.onboarding?.payment_methods?.card_enabled?(r(),n(K,{key:0},[N(e("input",{class:"segmented-input",type:"radio",id:"paymentCard",name:"payMethod",value:"Card","onUpdate:modelValue":t[4]||(t[4]=a=>m.value=a)},null,512),[[O,m.value]]),t[25]||(t[25]=e("label",{class:"segmented-label",for:"paymentCard"},[e("i",{class:"bi bi-credit-card-2-front me-1"}),h(" Card ")],-1)),N(e("input",{class:"segmented-input",type:"radio",id:"paymentSplit",name:"payMethod",value:"Split","onUpdate:modelValue":t[5]||(t[5]=a=>m.value=a)},null,512),[[O,m.value]]),t[26]||(t[26]=e("label",{class:"segmented-label",for:"paymentSplit"},[e("i",{class:"bi bi-columns-gap me-1"}),h(" Split ")],-1))],64)):c("",!0)]),m.value==="Cash"?(r(),n("div",ut,[t[29]||(t[29]=e("div",{class:"pay-header d-flex align-items-center gap-2 mb-3"},[e("i",{class:"bi bi-credit-card-2-front-fill"}),e("h6",{class:"m-0"},"Cash Received")],-1)),N(e("input",{type:"number","onUpdate:modelValue":t[6]||(t[6]=a=>p.value=a),class:C(["form-control rounded-3",{"is-invalid":T.value.cashReceived}])},null,2),[[_,p.value,void 0,{number:!0}]]),T.value.cashReceived?(r(),n("small",mt,i(T.value.cashReceived),1)):c("",!0),e("div",vt,[t[28]||(t[28]=e("strong",null,"Change:",-1)),e("span",{class:C(S.value<0?"text-danger fw-bold":"text-success fw-bold")},i(b(g)(S.value)),3)]),e("div",pt,[e("button",{class:"btn btn-secondary btn-sm rounded-pill px-3 py-2",onClick:t[7]||(t[7]=a=>o.$emit("close"))}," Cancel "),e("button",{class:"btn btn-primary brand-btn rounded-pill btn-sm px-2 py-2 d-flex align-items-center gap-2",onClick:B,disabled:x.value||l.value&&d.value.length===0},[x.value?(r(),n("span",ht)):(r(),n("i",bt)),e("span",null,i(x.value?"Processing...":l.value?d.value.length>0?"Pay Selected":"Select Items":"Confirm"),1)],8,yt),l.value?c("",!0):(r(),n("button",{key:0,class:"btn btn-primary rounded-pill btn-sm d-flex align-items-center justify-content-center text-nowrap",style:{"font-size":"0.75rem",padding:"6px 10px"},onClick:W,disabled:x.value}," Order & Print ",8,gt))])])):c("",!0),m.value==="Card"?(r(),n("div",ft,[F(ee,{order_code:s.order_code,show:s.show,customer:s.customer,phone:s.phone,"delivery-location":s.deliveryLocation,orderType:s.orderType,selectedTable:s.selectedTable,orderItems:s.orderItems,grandTotal:f.value,money:s.money,cashReceived:p.value,subTotal:q.value,tax:s.tax??0,serviceCharges:s.serviceCharges??0,deliveryCharges:s.deliveryCharges??0,note:s.note,"kitchen-note":s.kitchenNote,orderDate:s.orderDate??new Date().toISOString().split("T")[0],orderTime:s.orderTime??new Date().toTimeString().split(" ")[0],"payment-method":m.value,change:S.value,"promo-discount":s.promoDiscount,"promo-id":s.promoId,"promo-name":s.promoName,"promo-type":s.promoType,"promo-discount-amount":s.promoDiscountAmount,"applied-promos":s.appliedPromos,"approved-discounts":s.approvedDiscounts,"approved-discount-details":s.approvedDiscountDetails,"current-order-id":s.currentOrderId,"is-partial-payment":l.value,"paid-item-ids":I.value,"paid-product-ids":D.value,"paid-deal-ids":P.value,"selected-item-ids":d.value.map(a=>a.server_item_id||a.id),onPaymentSuccess:$,onPaymentError:o.handleStripeError},null,8,["order_code","show","customer","phone","delivery-location","orderType","selectedTable","orderItems","grandTotal","money","cashReceived","subTotal","tax","serviceCharges","deliveryCharges","note","kitchen-note","orderDate","orderTime","payment-method","change","promo-discount","promo-id","promo-name","promo-type","promo-discount-amount","applied-promos","approved-discounts","approved-discount-details","current-order-id","is-partial-payment","paid-item-ids","paid-product-ids","paid-deal-ids","selected-item-ids","onPaymentError"])])):c("",!0),m.value==="Split"?(r(),n("div",xt,[F(te,{order_code:s.order_code,show:s.show,customer:s.customer,phone:s.phone,"delivery-location":s.deliveryLocation,orderType:s.orderType,selectedTable:s.selectedTable,orderItems:s.orderItems,grandTotal:f.value,money:s.money,cashReceived:p.value,subTotal:q.value,tax:s.tax??0,serviceCharges:s.serviceCharges??0,deliveryCharges:s.deliveryCharges??0,note:s.note,"kitchen-note":s.kitchenNote,orderDate:s.orderDate??new Date().toISOString().split("T")[0],orderTime:s.orderTime??new Date().toTimeString().split(" ")[0],"payment-method":m.value,change:S.value,"payment-type":"split","promo-discount":s.promoDiscount,"promo-id":s.promoId,"promo-name":s.promoName,"promo-type":s.promoType,"promo-discount-amount":s.promoDiscountAmount,"applied-promos":s.appliedPromos,"approved-discounts":s.approvedDiscounts,"approved-discount-details":s.approvedDiscountDetails,"current-order-id":s.currentOrderId,"is-partial-payment":l.value,"paid-item-ids":I.value,"paid-product-ids":D.value,"paid-deal-ids":P.value,"selected-item-ids":d.value.map(a=>a.server_item_id||a.id),onConfirm:t[8]||(t[8]=a=>o.$emit("confirm",a)),onPaymentSuccess:$},null,8,["order_code","show","customer","phone","delivery-location","orderType","selectedTable","orderItems","grandTotal","money","cashReceived","subTotal","tax","serviceCharges","deliveryCharges","note","kitchen-note","orderDate","orderTime","payment-method","change","promo-discount","promo-id","promo-name","promo-type","promo-discount-amount","applied-promos","approved-discounts","approved-discount-details","current-order-id","is-partial-payment","paid-item-ids","paid-product-ids","paid-deal-ids","selected-item-ids"])])):c("",!0),t[30]||(t[30]=e("div",{class:"mt-auto small text-muted pt-2"},[e("i",{class:"bi bi-shield-check me-1"}),h(" Secured checkout â€¢ Keep this window open until payment completes ")],-1))])])])])])])])])])):c("",!0)}},It=J(kt,[["__scopeId","data-v-fa6ab9a3"]]);export{It as default};
