import{_ as M,r,c as S,o as U,Q as $,g as n,b as a,f as e,l as m,m as h,v as y,p as P,F as L,i as j,t as c,e as D,u as T,j as E,q as g,s as f}from"./app-O8d-RKSx.js";import{P as A}from"./pencil-yTKtpRsR.js";import"./createLucideIcon-CwRmIb17.js";const I={class:"card shadow-sm border-0 rounded-4"},q={class:"card-header d-flex flex-wrap gap-2 justify-content-between align-items-center"},F={class:"d-flex align-items-center gap-2"},z={class:"input-group"},K={class:"table-responsive"},O={class:"table table-hover mb-0"},Q={class:"badge bg-light py-2 text-dark"},G=["onClick"],H={key:0},J={key:1},R={colspan:"3",class:"text-center text-muted py-4"},W={key:0,class:"modal fade show d-block",style:{background:"#0006"}},X={class:"modal-dialog modal-dialog-end"},Y={class:"modal-content rounded-4"},Z={class:"modal-header"},ee={class:"modal-title"},se={class:"modal-body"},te={class:"mb-2"},le={key:0,class:"invalid-feedback d-block"},oe={class:"mb-2"},ne={key:0,class:"invalid-feedback d-block"},ae={class:"modal-footer"},ie=["disabled"],re={key:0,class:"spinner-border spinner-border-sm me-1"},w="/permissions",de={__name:"Permissions",setup(ue){const d=r(!1),v=r(null),p=r([]),i=r({name:"",description:""}),o=r({}),b=r(!1),u=r("");async function _(){const{data:t}=await g.get(w);p.value=t||[]}const k=S(()=>{const t=u.value.trim().toLowerCase();return t?p.value.filter(s=>{const l=(s.name||"").toLowerCase(),C=(s.description||"").toLowerCase();return l.includes(t)||C.includes(t)}):p.value});function x(t){t.key==="Escape"&&u.value&&(u.value="")}function N(){v.value=null,i.value={name:"",description:""},o.value={},d.value=!0}function V(t){v.value=t.id,i.value={name:t.name,description:t.description??""},o.value={},d.value=!0}async function B(){try{b.value=!0,o.value={},v.value?(await g.put(`${w}/${v.value}`,i.value),f.success("Permission updated successfully")):(await g.post(w,i.value),f.success("Permission created successfully")),await _(),d.value=!1}catch(t){if(t?.response?.status===422){const s=t.response.data?.errors||{};o.value=s;const l=Object.values(s)?.[0]?.[0]??"Please fix the highlighted fields and try again.";f.error(l)}else console.error("Save failed",t),f.error("Something went wrong. Please try again.")}finally{b.value=!1}}return U(()=>{_(),window.addEventListener("keydown",x)}),$(()=>{window.removeEventListener("keydown",x)}),(t,s)=>(a(),n(L,null,[e("div",I,[e("div",q,[s[6]||(s[6]=e("div",null,[e("h5",{class:"mb-0"},"List of Permissions"),e("small",{class:"text-muted"},"These are all the permissions that this system uses.")],-1)),e("div",F,[e("div",z,[h(e("input",{"onUpdate:modelValue":s[0]||(s[0]=l=>u.value=l),type:"text",class:"form-control rounded-pill shadow-sm",placeholder:"Search permissions…",style:{width:"360px"}},null,512),[[y,u.value,void 0,{trim:!0}]])]),e("button",{class:"btn btn-primary btn-sm rounded-pill w-100 px-3 py-2",onClick:N},[...s[5]||(s[5]=[e("i",{class:"bi bi-plus-lg me-1"},null,-1),P(" Add Permission ",-1)])])])]),e("div",K,[e("table",O,[s[8]||(s[8]=e("thead",{class:"table-primary"},[e("tr",null,[e("th",null,"Permission"),e("th",null,"Description"),e("th",{style:{width:"110px"}},"Action")])],-1)),e("tbody",null,[(a(!0),n(L,null,j(k.value,l=>(a(),n("tr",{key:l.id},[e("td",null,[e("span",Q,c(l.name),1)]),e("td",null,c(l.description),1),e("td",null,[e("button",{class:"p-2 rounded-full text-blue-600 hover:bg-blue-100",onClick:C=>V(l)},[D(T(A),{class:"w-4 h-4"})],8,G)])]))),128)),p.value.length?k.value.length?m("",!0):(a(),n("tr",J,[e("td",R," No results for “"+c(u.value)+"” ",1)])):(a(),n("tr",H,[...s[7]||(s[7]=[e("td",{colspan:"3",class:"text-center text-muted py-4"}," No permissions ",-1)])]))])])])]),d.value?(a(),n("div",W,[e("div",X,[e("div",Y,[e("div",Z,[e("h6",ee,c(v.value?"Edit Permission":"Create Permission"),1),e("button",{class:"absolute top-2 right-2 p-2 rounded-full hover:bg-gray-100 transition transform hover:scale-110",onClick:s[1]||(s[1]=l=>d.value=!1),"data-bs-dismiss":"modal","aria-label":"Close",title:"Close"},[...s[9]||(s[9]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("div",se,[e("div",te,[s[10]||(s[10]=e("label",{class:"form-label"},"Name",-1)),h(e("input",{"onUpdate:modelValue":s[2]||(s[2]=l=>i.value.name=l),class:E(["form-control",{"is-invalid":o.value.name,"bg-danger bg-opacity-10":o.value.name}]),placeholder:"inventory.view"},null,2),[[y,i.value.name]]),o.value.name?(a(),n("div",le,c(o.value.name[0]),1)):m("",!0)]),e("div",oe,[s[11]||(s[11]=e("label",{class:"form-label"},"Description",-1)),h(e("input",{"onUpdate:modelValue":s[3]||(s[3]=l=>i.value.description=l),class:E(["form-control",{"is-invalid":o.value.description,"bg-danger bg-opacity-10":o.value.description}]),placeholder:"Inventory"},null,2),[[y,i.value.description]]),o.value.description?(a(),n("div",ne,c(o.value.description[0]),1)):m("",!0)])]),e("div",ae,[e("button",{class:"btn btn-primary rounded-pill px-2 py-2",disabled:b.value,onClick:B},[b.value?(a(),n("span",re)):m("",!0),s[12]||(s[12]=P(" Save ",-1))],8,ie),e("button",{class:"btn btn-secondary rounded-pill px-2 py-2",onClick:s[4]||(s[4]=l=>d.value=!1)}," Cancel ")])])])])):m("",!0)],64))}},pe=M(de,[["__scopeId","data-v-f285e676"]]);export{pe as default};
