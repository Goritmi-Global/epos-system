import{_ as ae,r as d,c as U,o as oe,y as V,f as i,b as c,d as x,e as a,u as $,h as se,m as E,k as I,v as N,l as j,F as S,g as le,t as v,C as re,T as ne,i as B,p as T,n as de,q as l}from"./app-CLCV5sLN.js";import{E as ie,a as ce,X as ue,u as k,w as me}from"./xlsx-1Rd_lHfi.js";import{I as ge}from"./importFile-DV3LS74l.js";import{P as pe}from"./plus-HcOj3fDz.js";import{P as ve}from"./pencil-CwV097nl.js";import"./createLucideIcon-Doa7hx-B.js";const fe={class:"card border-0 shadow-lg rounded-4"},he={class:"card-body"},be={class:"d-flex flex-wrap gap-2 justify-content-between align-items-center mb-3"},ye={class:"d-flex gap-2"},we={class:"search-wrap"},_e={class:"dropdown"},xe={class:"dropdown-menu dropdown-menu-end shadow rounded-4"},Te={class:"table-responsive"},Ce={class:"table table-hover"},Se={key:0},ke={class:"fw-semibold"},Fe={class:"text-center"},Ee={class:"d-inline-flex align-items-center gap-3"},De=["onClick"],Le={key:0},Pe={colspan:"3",class:"text-center text-muted py-4"},Ve={key:0,class:"mt-4 d-flex justify-content-between align-items-center"},$e={class:"text-muted small"},Ie={class:"modal fade",id:"modalTagForm",tabindex:"-1","aria-hidden":"true"},Ne={class:"modal-dialog modal-lg modal-dialog-centered"},je={class:"modal-content rounded-4"},Re={class:"modal-header"},Ae={class:"modal-title"},Oe={class:"modal-body"},Me={key:0},Ue={key:0,class:"text-danger"},Be={key:1},qe={key:0,class:"text-danger"},ze={class:"col-md-2"},Xe=["disabled"],He={__name:"TagsTab",setup(Ge){const q=d([{label:"Vegan",value:"Vegan"},{label:"Vegetarian",value:"Vegetarian"},{label:"Halal",value:"Halal"},{label:"Kosher",value:"Kosher"},{label:"Organic",value:"Organic"},{label:"Locally Sourced",value:"Locally Sourced"},{label:"Fairtrade",value:"Fairtrade"},{label:"Spicy",value:"Spicy"},{label:"Free-From Nuts",value:"Free-From Nuts"},{label:"Contains Soy",value:"Contains Soy"},{label:"Free-From Egg",value:"Free-From Egg"},{label:"Sugar-Free",value:"Sugar-Free"},{label:"Ethically Sourced",value:"Ethically Sourced"},{label:"Red Tractor Certified",value:"Red Tractor Certified"},{label:"Scottish Produce",value:"Scottish Produce"},{label:"Welsh Lamb",value:"Welsh Lamb"}]);d([]);const D=d([]),z=d(""),w=d(!1),L=d(null),h=d(""),b=d(""),R=()=>{h.value="",D.value=[],r.value={}},A=U(()=>{const t=b.value.trim().toLowerCase();return t?m.value.filter(e=>e.name.toLowerCase().includes(t)):m.value}),X=()=>{w.value=!1,D.value=[],z.value=""};U(()=>q.value.filter(t=>!m.value.some(e=>e.name.toLowerCase()===t.value.toLowerCase())));const H=t=>{w.value=!0,L.value=t,h.value=t.name},G=async t=>{try{await T.delete(`/tags/${t.id}`),m.value=m.value.filter(e=>e.id!==t.id),l.success("Tag deleted successfully"),await _()}catch(e){l.error("Delete failed"),console.error(e)}},F=d(!1),W=async()=>{const t=h.value.trim();if(!t){l.error("Please fill out the field, can't save an empty field."),r.value={customTag:["Please fill out the field, can't save an empty field"]};return}try{if(F.value=!0,w.value){const{data:e}=await T.put(`/tags/${L.value.id}`,{name:t}),o=m.value.findIndex(s=>s.id===L.value.id);o!==-1&&(m.value[o]=e),l.success("Tag updated successfully")}else{if(m.value.some(n=>n.name.toLowerCase()===t.toLowerCase())){const n=`Tag "${t}" already exists.`;l.error(n),r.value={customTag:[n]};return}const{data:o}=await T.post("/tags",{tags:[{name:t}]}),s=Array.isArray(o)?o[0]:o;m.value.push(s),l.success("Tag added successfully")}R(),K("modalTagForm"),await _()}catch(e){e.response?.data?.errors?(r.value={},Object.entries(e.response.data.errors).forEach(([o,s])=>{s.forEach(n=>l.error(n)),r.value={customTag:s}})):(l.error("Operation failed âŒ"),console.error(e))}finally{F.value=!1}},K=t=>{const e=document.getElementById(t);if(!e)return;(window.bootstrap?.Modal.getInstance(e)||new window.bootstrap.Modal(e)).hide()},m=d([]),g=d({current_page:1,last_page:1,per_page:15,total:0,from:0,to:0,links:[]}),f=d(!1),r=d({}),_=async(t=null)=>{f.value=!0;try{const{data:e}=await T.get("/tags",{params:{q:b.value,page:t||g.value.current_page,per_page:g.value.per_page}});m.value=e.data||[],g.value={current_page:e.current_page,last_page:e.last_page,per_page:e.per_page,total:e.total,from:e.from,to:e.to,links:e.links},await de(),window.feather?.replace()}catch(e){console.error("Failed to fetch tags",e),l.error("Failed to load tags")}finally{f.value=!1}},Y=t=>{if(!t)return;const o=new URLSearchParams(t.split("?")[1]).get("page");o&&_(parseInt(o))},J=async()=>{try{f.value=!0;const t=await T.get("/tags",{params:{q:b.value.trim(),per_page:1e4,page:1}});return console.log("ðŸ“¦ Export data received:",{total:t.data.total,items:t.data.data.length}),t.data.data||[]}catch(t){return console.error("âŒ Error fetching export data:",t),l.error("Failed to load data for export"),[]}finally{f.value=!1}},P=async t=>{try{f.value=!0,l.info("Preparing export data...",{autoClose:1500});const e=await J();if(!e||e.length===0){l.error("No tags found to download"),f.value=!1;return}console.log(`ðŸ“¥ Exporting ${e.length} tags as ${t.toUpperCase()}`),t==="pdf"?Z(e):t==="excel"?ee(e):t==="csv"?Q(e):l.error("Invalid download type")}catch(e){console.error("Download failed:",e),l.error(`Download failed: ${e.message}`)}finally{f.value=!1}},Q=t=>{try{const e=["Name"],o=t.map(y=>[(C=>C==null?'""':(C=String(C).replace(/"/g,'""'),`"${C}"`))(y.name)]),s=[e.join(","),...o.map(y=>y.join(","))].join(`
`),n=new Blob([s],{type:"text/csv;charset=utf-8;"}),p=URL.createObjectURL(n),u=document.createElement("a");u.setAttribute("href",p),u.setAttribute("download",`tags_${new Date().toISOString().split("T")[0]}.csv`),document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(p),l.success(`CSV downloaded successfully (${t.length} tags)`,{autoClose:2500})}catch(e){console.error("CSV generation error:",e),l.error(`CSV generation failed: ${e.message}`,{autoClose:5e3})}},Z=t=>{try{const e=new ie("p","mm","a4");e.setFont("helvetica","bold"),e.setFontSize(18),e.text("Tags Report",80,20),e.setFont("helvetica","normal"),e.setFontSize(10);const o=new Date().toLocaleString();e.text(`Generated on: ${o}`,14,30),e.text(`Total Tags: ${t.length}`,14,36);const s=["Name"],n=t.map(u=>[u.name||""]);ce(e,{head:[s],body:n,startY:45,styles:{fontSize:10,cellPadding:3,halign:"left",valign:"middle",lineColor:[200,200,200],lineWidth:.1},headStyles:{fillColor:[41,128,185],textColor:255,fontStyle:"bold"},alternateRowStyles:{fillColor:[245,245,245]},margin:{left:14,right:14},didDrawPage:u=>{const y=e.internal.getNumberOfPages(),M=e.internal.pageSize.height;e.setFontSize(8),e.text(`Page ${u.pageNumber} of ${y}`,14,M-10)}});const p=`tags_${new Date().toISOString().split("T")[0]}.pdf`;e.save(p),l.success(`PDF downloaded successfully (${t.length} tags)`,{autoClose:2500})}catch(e){console.error("PDF generation error:",e),l.error(`PDF generation failed: ${e.message}`,{autoClose:5e3})}},ee=t=>{try{if(typeof ue>"u")throw new Error("XLSX library is not loaded");const e=t.map(y=>({Name:y.name||""})),o=k.book_new(),s=k.json_to_sheet(e);s["!cols"]=[{wch:25}],k.book_append_sheet(o,s,"Tags");const n=[{Info:"Generated On",Value:new Date().toLocaleString()},{Info:"Total Records",Value:t.length},{Info:"Exported By",Value:"Tags Management System"}],p=k.json_to_sheet(n);k.book_append_sheet(o,p,"Report Info");const u=`tags_${new Date().toISOString().split("T")[0]}.xlsx`;me(o,u),l.success(`Excel file downloaded successfully (${t.length} tags)`,{autoClose:2500})}catch(e){console.error("Excel generation error:",e),l.error(`Excel generation failed: ${e.message}`,{autoClose:5e3})}};oe(async()=>{await _(),window.feather?.replace()}),V(h,t=>{t&&r.value.customTag&&delete r.value.customTag});let O=null;V(b,()=>{clearTimeout(O),O=setTimeout(()=>{g.value.current_page=1,_(1)},500)}),V(D,t=>{t.length>0&&r.value.tags&&delete r.value.tags});const te=t=>{if(!t||t.length<=1){l.error("The file is empty",{autoClose:3e3});return}t[0];const o=t.slice(1).map(s=>({name:s[0]?.trim()||""}));T.post("/api/tags/import",{tags:o}).then(()=>{l.success("Tags imported successfully");const s=document.querySelector(".modal.show");if(s){const n=bootstrap.Modal.getInstance(s);n&&n.hide()}setTimeout(()=>{document.querySelectorAll(".modal-backdrop").forEach(p=>p.remove()),document.body.classList.remove("modal-open"),document.body.style.overflow="",document.body.style.paddingRight=""},100),_()}).catch(s=>{s?.response?.status===422&&s.response.data?.errors?(r.value=s.response.data.errors,l.error("Validation failed â€” check for duplicates or missing data",{autoClose:3e3})):l.error("Import failed. Please try again.",{autoClose:3e3}),setTimeout(()=>{document.querySelectorAll(".modal-backdrop").forEach(p=>p.remove()),document.body.classList.remove("modal-open"),document.body.style.overflow="",document.body.style.paddingRight=""},300)})};return(t,e)=>(c(),i(S,null,[x($(se),{title:"Tag"}),a("div",fe,[a("div",he,[a("div",be,[e[10]||(e[10]=a("h4",{class:"mb-0"},"Tags",-1)),a("div",ye,[a("div",we,[e[7]||(e[7]=a("i",{class:"bi bi-search"},null,-1)),I(a("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>b.value=o),class:"form-control search-input",placeholder:"Search"},null,512),[[N,b.value]])]),a("button",{"data-bs-toggle":"modal","data-bs-target":"#modalTagForm",onClick:e[1]||(e[1]=()=>{X(),R(),r.value={}}),class:"d-flex align-items-center gap-1 btn-sm px-4 py-2 rounded-pill btn btn-primary text-white"},[x($(pe),{class:"w-4 h-4"}),e[8]||(e[8]=j(" Add Tag ",-1))]),x(ge,{label:"Import",sampleHeaders:["Name"],sampleData:[["Vegan"],["Gluten-Free"],["Organic"]],onOnImport:te}),a("div",_e,[e[9]||(e[9]=a("button",{class:"btn btn-outline-secondary btn-sm rounded-pill py-2 px-4 dropdown-toggle","data-bs-toggle":"dropdown"}," Export ",-1)),a("ul",xe,[a("li",null,[a("a",{class:"dropdown-item py-2",href:"javascript:;",onClick:e[2]||(e[2]=o=>P("pdf"))},"Export as PDF")]),a("li",null,[a("a",{class:"dropdown-item py-2",href:"javascript:;",onClick:e[3]||(e[3]=o=>P("excel"))},"Export as Excel")]),a("li",null,[a("a",{class:"dropdown-item py-2",href:"javascript:;",onClick:e[4]||(e[4]=o=>P("csv"))}," Export as CSV ")])])])])]),a("div",Te,[a("table",Ce,[e[12]||(e[12]=a("thead",{class:"border-top small text-muted"},[a("tr",null,[a("th",null,"S. #"),a("th",null,"Tag Name"),a("th",{class:"text-center"},"Action")])],-1)),a("tbody",null,[f.value?(c(),i("tr",Se,[...e[11]||(e[11]=[a("td",{colspan:"3",class:"text-center py-5"},[a("div",{class:"spinner-border text-primary",role:"status"},[a("span",{class:"visually-hidden"},"Loading...")]),a("p",{class:"text-muted mt-2 mb-0"},"Loading tags...")],-1)])])):(c(),i(S,{key:1},[(c(!0),i(S,null,le(A.value,(o,s)=>(c(),i("tr",{key:o.id},[a("td",null,v(g.value.from+s),1),a("td",ke,v(o.name),1),a("td",Fe,[a("div",Ee,[a("button",{"data-bs-toggle":"modal","data-bs-target":"#modalTagForm",onClick:()=>{H(o),r.value={}},title:"Edit",class:"p-2 rounded-full text-blue-600 hover:bg-blue-100"},[x($(ve),{class:"w-4 h-4"})],8,De),x(re,{title:"Confirm Delete",message:`Are you sure you want to delete ${o.name}?`,showDeleteButton:!0,onConfirm:()=>{G(o)},onCancel:()=>{}},null,8,["message","onConfirm"])])])]))),128)),A.value.length===0?(c(),i("tr",Le,[a("td",Pe,v(b.value.trim()?"No tags found matching your search.":"No tags found."),1)])):E("",!0)],64))])])]),!f.value&&g.value.last_page>1?(c(),i("div",Ve,[a("div",$e," Showing "+v(g.value.from)+" to "+v(g.value.to)+" of "+v(g.value.total)+" entries ",1),x(ne,{pagination:g.value.links,isApiDriven:!0,onPageChanged:Y},null,8,["pagination"])])):E("",!0)])]),a("div",Ie,[a("div",Ne,[a("div",je,[a("div",Re,[a("h5",Ae,v(w.value?"Edit Tag":"Add Tag"),1),e[13]||(e[13]=a("button",{class:"absolute top-2 right-2 p-2 rounded-full hover:bg-gray-100 transition transform hover:scale-110","data-bs-dismiss":"modal","aria-label":"Close",title:"Close"},[a("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})])],-1))]),a("div",Oe,[w.value?(c(),i("div",Me,[e[14]||(e[14]=a("label",{class:"form-label"},"Tag Name",-1)),I(a("input",{"onUpdate:modelValue":e[5]||(e[5]=o=>h.value=o),class:B(["form-control",{"is-invalid":r.value.customTag}]),placeholder:"e.g., Vegan"},null,2),[[N,h.value]]),r.value.customTag?(c(),i("span",Ue,v(r.value.customTag[0]),1)):E("",!0)])):(c(),i("div",Be,[e[15]||(e[15]=a("label",{class:"form-label"},"Tag Name",-1)),I(a("input",{"onUpdate:modelValue":e[6]||(e[6]=o=>h.value=o),class:B(["form-control",{"is-invalid":r.value.customTag}]),placeholder:"Enter tag name"},null,2),[[N,h.value]]),r.value.customTag?(c(),i("span",qe,v(r.value.customTag[0]),1)):E("",!0)])),a("div",ze,[a("button",{class:"btn btn-primary rounded-pill py-2 btn-sm w-100 mt-4",disabled:F.value,onClick:W},[F.value?(c(),i(S,{key:0},[e[16]||(e[16]=a("span",{class:"spinner-border spinner-border-sm me-2"},null,-1)),e[17]||(e[17]=j(" Saving... ",-1))],64)):(c(),i(S,{key:1},[j(v((w.value,"Save")),1)],64))],8,Xe)])])])])])],64))}},et=ae(He,[["__scopeId","data-v-0677ba98"]]);export{et as default};
