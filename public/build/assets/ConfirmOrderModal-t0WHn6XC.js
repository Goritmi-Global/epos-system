import{_ as V,A as B,r as g,c as f,g as l,l as r,b as d,f as e,p as v,t as a,F as I,i as U,u as h,m as x,Z as T,v as j,j as C,e as M,s as A}from"./app-Cc-dChBz.js";import E from"./StripePayment-CnkIADEb.js";import F from"./SplitPayment-uMEPmKHu.js";import{u as K}from"./useFormatters-BFnLb0rR.js";const $={key:0,class:"modal fade show d-block",tabindex:"-1",style:{background:"rgba(0, 0, 0, 0.5)"}},q={class:"modal-dialog modal-xl modal-dialog-centered"},z={class:"modal-content rounded-4 s border-0"},G={class:"modal-header brand-gradient text-white py-3 position-sticky top-0 z-3"},Q={class:"modal-body p-3 p-md-4 body-scroll"},W={class:"row g-3"},Z={class:"col-12 col-md-6 d-flex"},H={class:"w-100 d-flex flex-column gap-3"},J={class:"card border-0 brand-card h-100"},X={class:"card-body"},Y={class:"row g-3"},_={class:"col-12 col-sm-6"},ee={class:"p-3 rounded-3 bg-light d-flex flex-column h-100"},te={class:"fw-semibold"},oe={class:"col-12 col-sm-6"},se={class:"p-3 rounded-3 bg-light d-flex flex-column h-100"},ae={class:"fw-semibold"},le={class:"badge brand-badge px-3 py-2"},de={key:0,class:"col-12 col-sm-6"},ne={class:"p-3 rounded-3 bg-light d-flex flex-column"},re={class:"fw-semibold"},ie={key:1,class:"col-12 col-sm-6"},ce={class:"p-3 rounded-3 bg-light d-flex flex-column"},me={class:"fw-semibold"},ue={key:2,class:"col-12 col-sm-6"},ve={class:"p-3 rounded-3 bg-light d-flex flex-column"},he={class:"fw-semibold"},pe={class:"table-responsive compact-table"},be={class:"table align-middle table-hover mb-0"},ye={class:"fw-semibold"},ge={key:0,class:"small text-muted"},fe={key:1,class:"small text-muted"},xe={key:2,class:"small text-warning fw-semibold"},Te={class:"text-center"},Ce={class:"text-end"},we={class:"text-end fw-bold"},ke={key:0},Ne={colspan:"4",class:"text-end text-muted"},De={key:0},Se={class:"text-end text-success"},Re={class:"fw-bold"},Ie={class:"text-end text-success"},Me={class:"col-12 col-md-6 d-flex"},Ae={class:"w-100"},Pe={class:"card border-0 brand-card h-100"},Oe={class:"card-body d-flex flex-column"},Le={class:"segmented mt-1 mb-3",role:"tablist","aria-label":"Payment method"},Ve={key:0,class:"pt-2 border-top"},Be={key:0,class:"text-danger"},Ue={class:"mt-2"},je={class:"d-flex gap-2 mt-3"},Ee=["disabled"],Fe={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},Ke={key:1,class:"bi bi-check2-circle"},$e=["disabled"],qe={key:1,class:"pt-3 border-top"},ze={class:"mt-2"},Ge={key:2,class:"pt-3 border-top"},Qe={__name:"ConfirmOrderModal",props:{show:Boolean,customer:String,deliveryLocation:String,phone:String,orderType:String,selectedTable:Object,orderItems:Array,grandTotal:Number,money:Function,cashReceived:Number,order_code:String,subTotal:Number,tax:Number,serviceCharges:Number,deliveryCharges:Number,note:[String,null],kitchenNote:[String,null],orderDate:String,orderTime:String,paymentMethod:String,change:Number,promoDiscount:{type:Number,default:0},promoId:{type:[Number,String,null],default:null},promoName:{type:[String,null],default:null},promoType:{type:[String,null],default:null},promoDiscountAmount:{type:Number,default:0},appliedPromos:{type:Array,default:()=>[]},approvedDiscounts:{type:Number,default:0},approvedDiscountDetails:{type:Array,default:()=>[]}},emits:["close","confirm","update:cashReceived"],setup(t,{emit:P}){const w=B(),{formatCurrencySymbol:p}=K(),i=t,k=g(!1),b=g({});console.log("ConfirmOrderModal props:",w.props);const N=P,n=g("Cash"),y=f({get:()=>i.cashReceived,set:c=>N("update:cashReceived",c)}),m=f(()=>n.value==="Cash"?y.value-i.grandTotal:0),D=f(()=>Array.isArray(i.orderItems)?i.orderItems.reduce((c,o)=>c+(Number(o.unit_price)||0)*(Number(o.qty)||0),0):0),u=g(!1),O=async()=>{k.value=!0,await S()},S=async()=>{if(b.value.cashReceived=null,!i.cashReceived||i.cashReceived<=0){b.value.cashReceived="Enter a valid cash amount.",A.error("Enter a valid cash amount.");return}if(i.cashReceived<i.grandTotal){b.value.cashReceived="Cash received cannot be less than total amount.",A.error("Cash received cannot be less than total amount.");return}u.value||(u.value=!0,N("confirm",{paymentMethod:n.value,cashReceived:y.value,changeAmount:m.value,items:i.orderItems,autoPrintKot:k.value,done:()=>{u.value=!1}}))},L=f(()=>i.orderType?i.orderType.replace(/_/g," ").replace(/\b\w/g,c=>c.toUpperCase()):"");return(c,o)=>t.show?(d(),l("div",$,[e("div",q,[e("div",z,[e("div",G,[o[7]||(o[7]=e("h5",{class:"modal-title fw-bold d-flex align-items-center gap-2 m-0"},[e("i",{class:"bi bi-receipt-cutoff"}),v(" Confirm Order ")],-1)),e("button",{class:"absolute top-2 right-2 p-2 rounded-full hover:bg-gray-100 transition transform hover:scale-110",onClick:o[0]||(o[0]=s=>c.$emit("close")),"data-bs-dismiss":"modal","aria-label":"Close",title:"Close"},[...o[6]||(o[6]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("div",Q,[e("div",W,[e("div",Z,[e("div",H,[e("div",J,[e("div",X,[o[16]||(o[16]=e("h6",{class:"fw-bold brand-text mb-3 d-flex align-items-center gap-2"},[e("i",{class:"bi bi-info-circle"}),v(" Order Summary ")],-1)),e("div",Y,[e("div",_,[e("div",ee,[o[8]||(o[8]=e("span",{class:"text-muted small"},"Customer",-1)),e("span",te,a(t.customer||"Walk In"),1)])]),e("div",oe,[e("div",se,[o[9]||(o[9]=e("span",{class:"text-muted small"},"Service",-1)),e("span",ae,[e("span",le,a(L.value),1)])])]),t.orderType==="Dine_in"?(d(),l("div",de,[e("div",ne,[o[10]||(o[10]=e("span",{class:"text-muted small"},"Table No",-1)),e("span",re,a(t.selectedTable?.name||"N/A"),1)])])):r("",!0),t.orderType==="Delivery"?(d(),l("div",ie,[e("div",ce,[o[11]||(o[11]=e("span",{class:"text-muted small"},"Delivery Location",-1)),e("span",me,a(t.deliveryLocation||"N/A"),1)])])):r("",!0),t.orderType==="Delivery"?(d(),l("div",ue,[e("div",ve,[o[12]||(o[12]=e("span",{class:"text-muted small"},"Phone No",-1)),e("span",he,a(t.phone||"N/A"),1)])])):r("",!0),e("div",pe,[e("table",be,[o[15]||(o[15]=e("thead",{class:"table-light"},[e("tr",null,[e("th",null,"#"),e("th",null,"Item"),e("th",{class:"text-center"}," Qty "),e("th",{class:"text-end"}," Price "),e("th",{class:"text-end"}," Total ")])],-1)),e("tbody",null,[(d(!0),l(I,null,U(t.orderItems,(s,R)=>(d(),l("tr",{key:s.id||R},[e("td",null,a(R+1),1),e("td",null,[e("div",ye,a(s.title),1),s.note?(d(),l("div",ge," Note: "+a(s.note),1)):r("",!0),s.kitchen_note?(d(),l("div",fe," Kitchen Note: "+a(s.kitchen_note),1)):r("",!0),s.item_kitchen_note?(d(),l("div",xe," ðŸ³ Item Note: "+a(s.item_kitchen_note),1)):r("",!0)]),e("td",Te,a(s.qty),1),e("td",Ce,a(h(p)(s.unit_price)),1),e("td",we,a(h(p)((Number(s.unit_price)||0)*(Number(s.qty)||0))),1)]))),128))]),e("tfoot",null,[t.promoDiscount>0?(d(),l("tr",ke,[e("td",Ne,[o[13]||(o[13]=v(" Promo ",-1)),t.promoName?(d(),l("span",De,"("+a(t.promoName)+")",1)):r("",!0)]),e("td",Se," -"+a(h(p)(t.promoDiscount)),1)])):r("",!0),e("tr",Re,[o[14]||(o[14]=e("td",{colspan:"4",class:"text-end"}," Grand Total ",-1)),e("td",Ie,a(h(p)(t.grandTotal)),1)])])])])])])])])]),e("div",Me,[e("div",Ae,[e("div",Pe,[e("div",Oe,[e("div",Le,[x(e("input",{class:"segmented-input",type:"radio",id:"paymentCash",name:"payMethod",value:"Cash","onUpdate:modelValue":o[1]||(o[1]=s=>n.value=s)},null,512),[[T,n.value]]),o[19]||(o[19]=e("label",{class:"segmented-label",for:"paymentCash"},[e("i",{class:"bi bi-cash-coin me-1"}),v(" Cash ")],-1)),h(w).props?.onboarding?.payment_methods?.card_enabled?(d(),l(I,{key:0},[x(e("input",{class:"segmented-input",type:"radio",id:"paymentCard",name:"payMethod",value:"Card","onUpdate:modelValue":o[2]||(o[2]=s=>n.value=s)},null,512),[[T,n.value]]),o[17]||(o[17]=e("label",{class:"segmented-label",for:"paymentCard"},[e("i",{class:"bi bi-credit-card-2-front me-1"}),v(" Card ")],-1)),x(e("input",{class:"segmented-input",type:"radio",id:"paymentSplit",name:"payMethod",value:"Split","onUpdate:modelValue":o[3]||(o[3]=s=>n.value=s)},null,512),[[T,n.value]]),o[18]||(o[18]=e("label",{class:"segmented-label",for:"paymentSplit"},[e("i",{class:"bi bi-columns-gap me-1"}),v(" Split ")],-1))],64)):r("",!0)]),n.value==="Cash"?(d(),l("div",Ve,[o[21]||(o[21]=e("div",{class:"pay-header d-flex align-items-center gap-2 mb-3"},[e("i",{class:"bi bi-credit-card-2-front-fill"}),e("h6",{class:"m-0"}," Cash Received ")],-1)),x(e("input",{type:"number","onUpdate:modelValue":o[4]||(o[4]=s=>y.value=s),class:C(["form-control rounded-3",{"is-invalid":b.value.cashReceived}])},null,2),[[j,y.value,void 0,{number:!0}]]),b.value.cashReceived?(d(),l("small",Be,a(b.value.cashReceived),1)):r("",!0),e("div",Ue,[o[20]||(o[20]=e("strong",null,"Change:",-1)),e("span",{class:C([m.value]<0?"text-danger fw-bold":"text-success fw-bold")},a(h(p)(m.value)),3)]),e("div",je,[e("button",{class:"btn btn-secondary btn-sm rounded-pill px-3 py-2",onClick:o[5]||(o[5]=s=>c.$emit("close"))}," Cancel "),e("button",{class:"btn btn-primary brand-btn rounded-pill btn-sm px-2 py-2 d-flex align-items-center gap-2",onClick:S,disabled:u.value},[u.value?(d(),l("span",Fe)):(d(),l("i",Ke)),e("span",null,a(u.value?"Processing...":"Confirm"),1)],8,Ee),e("button",{class:"btn btn-primary rounded-pill btn-sm d-flex align-items-center justify-content-center text-nowrap",style:{"font-size":"0.75rem",padding:"6px 10px"},onClick:O,disabled:u.value}," Order & Print ",8,$e)])])):r("",!0),n.value==="Card"?(d(),l("div",qe,[M(E,{order_code:t.order_code,show:t.show,customer:t.customer,phone:t.phone,"delivery-location":t.deliveryLocation,orderType:t.orderType,selectedTable:t.selectedTable,orderItems:t.orderItems,grandTotal:t.grandTotal,money:t.money,cashReceived:y.value,subTotal:D.value,tax:t.tax??0,serviceCharges:t.serviceCharges??0,deliveryCharges:t.deliveryCharges??0,note:t.note,"kitchen-note":t.kitchenNote,orderDate:t.orderDate??new Date().toISOString().split("T")[0],orderTime:t.orderTime??new Date().toTimeString().split(" ")[0],paymentMethod:n.value,change:m.value,"promo-discount":t.promoDiscount,"promo-id":t.promoId,"promo-name":t.promoName,"promo-type":t.promoType,"promo-discount-amount":t.promoDiscountAmount,"applied-promos":t.appliedPromos,"approved-discounts":t.approvedDiscounts,"approved-discount-details":t.approvedDiscountDetails},null,8,["order_code","show","customer","phone","delivery-location","orderType","selectedTable","orderItems","grandTotal","money","cashReceived","subTotal","tax","serviceCharges","deliveryCharges","note","kitchen-note","orderDate","orderTime","paymentMethod","change","promo-discount","promo-id","promo-name","promo-type","promo-discount-amount","applied-promos","approved-discounts","approved-discount-details"]),e("div",ze,[o[22]||(o[22]=e("strong",null,"Change:",-1)),e("span",{class:C(m.value<0?"text-danger fw-bold":"text-success fw-bold")},a(h(p)(m.value)),3)])])):r("",!0),n.value==="Split"?(d(),l("div",Ge,[M(F,{order_code:t.order_code,show:t.show,customer:t.customer,phone:t.phone,"delivery-location":t.deliveryLocation,orderType:t.orderType,selectedTable:t.selectedTable,orderItems:t.orderItems,grandTotal:t.grandTotal,money:t.money,cashReceived:y.value,subTotal:D.value,tax:t.tax??0,serviceCharges:t.serviceCharges??0,deliveryCharges:t.deliveryCharges??0,note:t.note,"kitchen-note":t.kitchenNote,orderDate:t.orderDate??new Date().toISOString().split("T")[0],orderTime:t.orderTime??new Date().toTimeString().split(" ")[0],paymentMethod:n.value,change:m.value,paymentType:n.value,"promo-discount":t.promoDiscount,"promo-id":t.promoId,"promo-name":t.promoName,"promo-type":t.promoType,"promo-discount-amount":t.promoDiscountAmount,"applied-promos":t.appliedPromos,"approved-discounts":t.approvedDiscounts,"approved-discount-details":t.approvedDiscountDetails},null,8,["order_code","show","customer","phone","delivery-location","orderType","selectedTable","orderItems","grandTotal","money","cashReceived","subTotal","tax","serviceCharges","deliveryCharges","note","kitchen-note","orderDate","orderTime","paymentMethod","change","paymentType","promo-discount","promo-id","promo-name","promo-type","promo-discount-amount","applied-promos","approved-discounts","approved-discount-details"])])):r("",!0),o[23]||(o[23]=e("div",{class:"mt-auto small text-muted pt-2"},[e("i",{class:"bi bi-shield-check me-1"}),v(" Secured checkout â€¢ Keep this window open until payment completes ")],-1))])])])])])])])])])):r("",!0)}},Xe=V(Qe,[["__scopeId","data-v-40ac50e8"]]);export{Xe as default};
