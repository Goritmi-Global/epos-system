import{_ as le,A as ne,r as h,o as re,n as ie,c as H,E as de,a as R,b as d,d as O,e as g,f as t,u as x,h as me,g as u,F as T,i as A,j as D,k as ce,t as f,m as U,v as z,p as N,l as I,C as ue,q as M,s as l}from"./app-DwNPAkRi.js";import{_ as pe}from"./Master--p-90JeK.js";import{E as fe,a as ve,X as he,u as S,w as ge}from"./xlsx-A8KY7rFH.js";import{I as be}from"./importFile-CA_NMKY3.js";import{s as _e}from"./index-CKZidvl4.js";import{c as ye}from"./createLucideIcon-IoE8C8vO.js";import{P as we}from"./plus-C2ryka42.js";import{P as xe}from"./pencil-Zp6s5WUr.js";import{T as Me}from"./trash-2-K3zJWZJD.js";import"./index-SM1eeh2q.js";import"./index-BsWRXlA_.js";import"./index-DDHekjA2.js";import"./sun-5Jk0idAQ.js";import"./index-DDUWCXCg.js";import"./index-qTzoPHZe.js";import"./index-BOSxYtLC.js";import"./index-DKYWs9Z5.js";/**
 * @license lucide-vue-next v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Se=ye("utensils",[["path",{d:"M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2",key:"cjf0a3"}],["path",{d:"M7 2v20",key:"1473qp"}],["path",{d:"M21 15V2a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7",key:"j28e5"}]]),Ce={class:"page-wrapper"},ke={class:"row g-3"},Ee={class:"card border-0 shadow-sm rounded-4"},Te={class:"card-body d-flex align-items-center"},De={class:"mb-0 fw-bold"},Ie={class:"text-muted mb-0 small"},Ve={class:"card border-0 shadow-lg rounded-4 mt-4"},$e={class:"card-body"},Fe={class:"d-flex flex-wrap gap-2 justify-content-between align-items-center mb-3"},Ne={class:"d-flex flex-wrap gap-2 align-items-center"},Le={class:"search-wrap"},je={key:1,class:"form-control search-input",placeholder:"Search",disabled:"",type:"text"},Pe={class:"table-responsive"},Be={class:"table table-striped"},He={class:"fw-semibold"},Re={class:"text-center"},Oe={class:"d-inline-flex align-items-center gap-3"},Ae=["onClick"],Ue={title:"Delete",class:"p-2 rounded-full text-red-600 hover:bg-red-100"},ze={key:0},qe={class:"modal fade",id:"mealModal",tabindex:"-1","aria-hidden":"true"},Xe={class:"modal-dialog modal-lg modal-dialog-centered"},Ge={class:"modal-content rounded-4"},Ye={class:"modal-header"},Ke={class:"modal-title fw-semibold"},We={class:"modal-body"},Ze={class:"row g-3"},Je={class:"col-12"},Qe={key:0,class:"text-danger"},et={class:"col-md-6"},tt={key:0,class:"text-danger"},st={class:"col-md-6"},ot={key:0,class:"text-danger"},at={class:"mt-4"},lt=["disabled"],nt={__name:"Index",setup(rt){ne();const b=h([]),y=h(null),C=h(!1),m=h({}),k=async()=>{try{const s=await M.get("api/meals/all");b.value=s.data.data}catch(s){console.error("Failed to fetch meals:",s),l.error("Failed to load meals")}};re(async()=>{_.value="",L.value=Date.now(),await ie(),setTimeout(()=>{j.value=!0;const e=document.getElementById($);e&&(e.value="",_.value="")},100),k();const s=document.getElementById("mealModal");s&&s.addEventListener("hidden.bs.modal",()=>{document.body.classList.remove("modal-open"),document.body.style.overflow="",document.querySelectorAll(".modal-backdrop").forEach(a=>a.remove())})});const q=H(()=>[{label:"Total Meals",value:b.value.length,icon:Se,iconBg:"bg-light-primary",iconColor:"text-primary"}]),_=h(""),V=h(null),X=[{label:"PDF",value:"pdf"},{label:"Excel",value:"excel"},{label:"CSV",value:"csv"}],G=s=>{s.value&&(J(s.value),V.value=null)},L=h(Date.now()),$=`search-${Math.random().toString(36).substr(2,9)}`,j=h(!1),Y=s=>{s.target.value=_.value},F=H(()=>{const s=_.value.trim().toLowerCase();return s?b.value.filter(e=>e.name.toLowerCase().includes(s)):b.value}),p=h({name:"",start_time:"",end_time:""}),E=()=>{p.value={name:"",start_time:"",end_time:""},y.value=null,m.value={}},P=s=>{if(!s)return null;if(typeof s=="string"&&/^\d{2}:\d{2}$/.test(s))return s;const e=new Date(s),a=e.getHours().toString().padStart(2,"0"),o=e.getMinutes().toString().padStart(2,"0");return`${a}:${o}`},K=async()=>{C.value=!0,m.value={};const s={...p.value,start_time:P(p.value.start_time),end_time:P(p.value.end_time)};try{y.value?(await M.post(`/meals/${y.value.id}`,s),l.success("Meal updated successfully")):(await M.post("/meals",s),l.success("Meal created successfully"));const e=document.getElementById("mealModal"),a=bootstrap.Modal.getInstance(e);a&&a.hide(),setTimeout(()=>{document.body.classList.remove("modal-open"),document.body.style.overflow="",document.body.style.paddingRight="",document.querySelectorAll(".modal-backdrop").forEach(c=>c.remove())},100),E(),await k()}catch(e){if(console.error("❌ Error:",e.response?.data||e.message),e.response?.status===422&&e.response?.data?.errors){m.value=e.response.data.errors;const a=Object.values(e.response.data.errors).flat();l.error(a.join(`
`))}else{const a=e.response?.data?.message||"Failed to save meal";l.error(a)}}finally{C.value=!1}},W=s=>{y.value=s,p.value={name:s.name,start_time:s.start_time,end_time:s.end_time};const e=document.getElementById("mealModal");new bootstrap.Modal(e).show()},Z=async s=>{if(s?.id)try{await M.delete(`/meals/${s.id}`),l.success("Meal deleted successfully"),await k()}catch(e){console.error("❌ Delete error:",e.response?.data||e.message),l.error("Failed to delete meal")}},J=s=>{if(!b.value||b.value.length===0){l.error("No Meals data to download");return}const e=_.value.trim()?F.value:b.value;if(e.length===0){l.error("No Meals found to download");return}try{s==="pdf"?ee(e):s==="excel"?te(e):s==="csv"?Q(e):l.error("Invalid download type")}catch(a){console.error("Download failed:",a),l.error(`Download failed: ${a.message}`)}},Q=s=>{try{const e=["ID","Meal Name","Start Time","End Time"],a=s.map(i=>[`${i.id||""}`,`"${i.name||""}"`,`"${i.start_time||""}"`,`"${i.end_time||""}"`]),o=[e.join(","),...a.map(i=>i.join(","))].join(`
`),c=new Blob([o],{type:"text/csv;charset=utf-8;"}),v=URL.createObjectURL(c),r=document.createElement("a");r.setAttribute("href",v),r.setAttribute("download",`Meals_${new Date().toISOString().split("T")[0]}.csv`),document.body.appendChild(r),r.click(),document.body.removeChild(r),l.success("CSV downloaded successfully")}catch(e){console.error("CSV generation error:",e),l.error(`CSV generation failed: ${e.message}`,{autoClose:5e3})}},ee=s=>{try{const e=new fe("p","mm","a4");e.setFontSize(18),e.setFont("helvetica","bold"),e.text("Meals Report",14,20),e.setFontSize(10),e.setFont("helvetica","normal");const a=new Date().toLocaleString();e.text(`Generated on: ${a}`,14,28),e.text(`Total Meals: ${s.length}`,14,34);const o=["ID","Meal Name","Start Time","End Time"],c=s.map(r=>[r.id||"",r.name||"",r.start_time||"",r.end_time||""]);ve(e,{head:[o],body:c,startY:40,styles:{fontSize:9,cellPadding:2,halign:"left",lineColor:[0,0,0],lineWidth:.1},headStyles:{fillColor:[41,128,185],textColor:255,fontStyle:"bold"},alternateRowStyles:{fillColor:[245,245,245]},margin:{left:14,right:14},didDrawPage:r=>{const i=e.internal.getNumberOfPages(),B=e.internal.pageSize.height;e.setFontSize(8),e.text(`Page ${r.pageNumber} of ${i}`,r.settings.margin.left,B-10)}});const v=`Meals_${new Date().toISOString().split("T")[0]}.pdf`;e.save(v),l.success("PDF downloaded successfully")}catch(e){console.error("PDF generation error:",e),l.error(`PDF generation failed: ${e.message}`,{autoClose:5e3})}},te=s=>{try{if(typeof he>"u")throw new Error("XLSX library is not loaded");const e=s.map(i=>({ID:i.id||"","Meal Name":i.name||"","Start Time":i.start_time||"","End Time":i.end_time||""})),a=S.book_new(),o=S.json_to_sheet(e);o["!cols"]=[{wch:8},{wch:25},{wch:15},{wch:15}],S.book_append_sheet(a,o,"Meals");const c=[{Info:"Report",Value:"Meals Export"},{Info:"Generated On",Value:new Date().toLocaleString()},{Info:"Total Records",Value:s.length},{Info:"Exported By",Value:"Inventory Management System"}],v=S.json_to_sheet(c);S.book_append_sheet(a,v,"Report Info");const r=`Meals_${new Date().toISOString().split("T")[0]}.xlsx`;ge(a,r),l.success("Excel file downloaded successfully",{autoClose:2500})}catch(e){console.error("Excel generation error:",e),l.error(`Excel generation failed: ${e.message}`,{autoClose:5e3})}},se=["Meal Name","Start Time","End Time"],oe=[["Breakfast","06:00","10:00"],["Lunch","12:00","14:00"],["Dinner","18:00","21:00"]],ae=s=>{if(!s||s.length<=1){l.error("The imported file is empty.");return}s[0];const a=s.slice(1).map(n=>({name:n[0]||"",start_time:n[1]||"",end_time:n[2]||""})).filter(n=>n.name.trim());if(a.length===0){l.error("No valid meals found in the file.");return}const o=a.map(n=>n.name.trim().toLowerCase()),c=o.filter((n,w)=>o.indexOf(n)!==w);if(c.length>0){l.error(`Duplicate meal names found in CSV: ${[...new Set(c)].join(", ")}`);return}const v=b.value.map(n=>n.name.trim().toLowerCase()),r=a.filter(n=>v.includes(n.name.trim().toLowerCase()));if(r.length>0){const n=r.map(w=>w.name).join(", ");l.error(`Meals already exist in the table: ${n}`);return}const i=/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/;if(a.filter(n=>!i.test(n.start_time)||!i.test(n.end_time)).length>0){l.error("Invalid time format. Times must be in HH:mm format (e.g., 09:30).");return}M.post("/api/meals/import",{meals:a}).then(()=>{l.success("Meals imported successfully"),k()}).catch(n=>{console.error("Import error:",n);const w=n.response?.data?.message||"Import failed";l.error(w)})};return(s,e)=>{const a=de("VueDatePicker");return d(),R(pe,null,{default:O(()=>[g(x(me),{title:"Meals"}),t("div",Ce,[e[19]||(e[19]=t("h4",{class:"fw-semibold mb-3"},"Meal Management",-1)),t("div",ke,[(d(!0),u(T,null,A(q.value,o=>(d(),u("div",{key:o.label,class:"col-md-6 col-xl-3"},[t("div",Ee,[t("div",Te,[t("div",{class:D([[o.iconBg,o.iconColor],"rounded-circle p-3 d-flex align-items-center justify-content-center me-3"]),style:{width:"56px",height:"56px"}},[(d(),R(ce(o.icon),{class:"w-6 h-6"}))],2),t("div",null,[t("h3",De,f(o.value),1),t("p",Ie,f(o.label),1)])])])]))),128))]),t("div",Ve,[t("div",$e,[t("div",Fe,[e[9]||(e[9]=t("h5",{class:"mb-0 fw-semibold"},"Meals",-1)),t("div",Ne,[t("div",Le,[e[6]||(e[6]=t("i",{class:"bi bi-search"},null,-1)),e[7]||(e[7]=t("input",{type:"email",name:"email",autocomplete:"email",style:{position:"absolute",left:"-9999px",width:"1px",height:"1px"},tabindex:"-1","aria-hidden":"true"},null,-1)),j.value?U((d(),u("input",{id:$,"onUpdate:modelValue":e[0]||(e[0]=o=>_.value=o),key:L.value,class:"form-control search-input",placeholder:"Search",type:"search",autocomplete:"new-password",name:$,role:"presentation",onFocus:Y},null,32)),[[z,_.value]]):(d(),u("input",je))]),t("button",{"data-bs-toggle":"modal","data-bs-target":"#mealModal",onClick:E,class:"d-flex align-items-center gap-1 px-4 py-2 rounded-pill btn btn-primary text-white"},[g(x(we),{class:"w-4 h-4"}),e[8]||(e[8]=N(" Add Meal ",-1))]),g(be,{label:"Import Meals",sampleHeaders:se,sampleData:oe,onOnImport:ae}),g(x(_e),{modelValue:V.value,"onUpdate:modelValue":e[1]||(e[1]=o=>V.value=o),options:X,optionLabel:"label",optionValue:"value",placeholder:"Export",class:"export-dropdown",onChange:G},null,8,["modelValue"])])]),t("div",Pe,[t("table",Be,[e[11]||(e[11]=t("thead",{class:"border-top small text-muted"},[t("tr",null,[t("th",null,"S.#"),t("th",null,"Name"),t("th",null,"Start Time"),t("th",null,"End Time"),t("th",{class:"text-center"},"Actions")])],-1)),t("tbody",null,[(d(!0),u(T,null,A(F.value,(o,c)=>(d(),u("tr",{key:o.id},[t("td",null,f(c+1),1),t("td",He,f(o.name),1),t("td",null,f(o.start_time),1),t("td",null,f(o.end_time),1),t("td",Re,[t("div",Oe,[t("button",{onClick:v=>W(o),title:"Edit",class:"p-2 rounded-full text-blue-600 hover:bg-blue-100"},[g(x(xe),{class:"w-4 h-4"})],8,Ae),g(ue,{title:"Confirm Delete",message:`Are you sure you want to delete ${o.name}?`,confirmText:"Yes, Delete",cancelText:"Cancel",onConfirm:v=>Z(o)},{trigger:O(()=>[t("button",Ue,[g(x(Me),{class:"w-4 h-4"})])]),_:1},8,["message","onConfirm"])])])]))),128)),F.value.length===0?(d(),u("tr",ze,[...e[10]||(e[10]=[t("td",{colspan:"5",class:"text-center text-muted py-4"}," No meals found. ",-1)])])):I("",!0)])])])])]),t("div",qe,[t("div",Xe,[t("div",Ge,[t("div",Ye,[t("h5",Ke,f(y.value?"Edit Meal":"Add New Meal"),1),t("button",{class:"absolute top-2 right-2 p-2 rounded-full hover:bg-gray-100 transition transform hover:scale-110",onClick:E,"data-bs-dismiss":"modal","aria-label":"Close",title:"Close"},[...e[12]||(e[12]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),t("div",We,[t("div",Ze,[t("div",Je,[e[13]||(e[13]=t("label",{class:"form-label"},"Meal Name",-1)),U(t("input",{"onUpdate:modelValue":e[2]||(e[2]=o=>p.value.name=o),type:"text",class:D(["form-control",{"is-invalid":m.value.name}]),placeholder:"Enter meal name"},null,2),[[z,p.value.name]]),m.value.name?(d(),u("small",Qe,f(m.value.name[0]),1)):I("",!0)]),t("div",et,[e[14]||(e[14]=t("label",{class:"form-label"},"Start Time",-1)),g(a,{modelValue:p.value.start_time,"onUpdate:modelValue":e[3]||(e[3]=o=>p.value.start_time=o),"time-picker":"",format:"HH:mm","model-type":"HH:mm",placeholder:"Select start time",class:D({"is-invalid":m.value.start_time})},null,8,["modelValue","class"]),m.value.start_time?(d(),u("small",tt,f(m.value.start_time[0]),1)):I("",!0)]),t("div",st,[e[15]||(e[15]=t("label",{class:"form-label"},"End Time",-1)),g(a,{modelValue:p.value.end_time,"onUpdate:modelValue":e[4]||(e[4]=o=>p.value.end_time=o),"time-picker":"",format:"HH:mm","model-type":"HH:mm",placeholder:"Select end time",class:D({"is-invalid":m.value.end_time})},null,8,["modelValue","class"]),m.value.end_time?(d(),u("small",ot,f(m.value.end_time[0]),1)):I("",!0)])]),e[18]||(e[18]=t("hr",{class:"my-4"},null,-1)),t("div",at,[t("button",{class:"btn btn-primary rounded-pill px-4",disabled:C.value,onClick:e[5]||(e[5]=o=>K())},[C.value?(d(),u(T,{key:0},[e[16]||(e[16]=t("span",{class:"spinner-border spinner-border-sm me-2"},null,-1)),e[17]||(e[17]=N(" Saving... ",-1))],64)):(d(),u(T,{key:1},[N(f(y.value?"Update":"Save"),1)],64))],8,lt),t("button",{class:"btn btn-secondary rounded-pill px-4 ms-2","data-bs-dismiss":"modal",onClick:E}," Cancel ")])])])])])])]),_:1})}}},Ct=le(nt,[["__scopeId","data-v-1f43221f"]]);export{Ct as default};
