import{_ as $,b2 as A,r as m,C as H,j as x,k as q,W as G,g as r,o as i,i as c,b as t,x as v,y as g,n as y,t as d,a as N,S as J,w as V,f as K,d as Q}from"./app-CYEkE9GK.js";import{s as X}from"./index-CxspGS8A.js";import{i as Y,p as Z}from"./isValidPhoneNumber-2-_3nWfh.js";import"./index-CFvNnlhZ.js";const ee={key:0,class:"fw-bold mb-4"},oe={class:"row g-4"},se={class:"col-12"},le={key:0,class:"text-danger"},te={class:"col-md-4"},ne={class:"logo-card"},ae=["src"],re={key:1,class:"placeholder"},ie={key:0,class:"text-danger"},de={class:"col-md-8"},ue={key:0},me={key:1},ce={class:"d-flex align-items-center gap-2"},pe={key:0,class:"badge bg-primary text-white",style:{"font-size":"10px"}},fe={key:0,class:"p-2 border-top"},be={key:0,class:"text-danger"},he={key:1,class:"text-danger"},ve={class:"row g-3 mt-1"},ge={class:"col-md-6"},ye={class:"input-group"},_e={class:"input-group-text p-0"},we={key:0,class:"text-danger d-block mt-1"},ke={key:1,class:"text-danger d-block mt-1"},xe={key:2,class:"text-success d-block mt-1"},Ee={class:"col-md-6"},Ce={key:0,class:"text-danger"},Ve={key:2,class:"text-danger"},Te={__name:"Step2",props:{model:Object,formErrors:Object,isOnboarding:{type:Boolean,default:!1}},emits:["save"],setup(a,{emit:P}){const n=a,F=P,o=A({business_name:n.model?.business_name??"",business_type:n.model?.business_type??"",address:n.model?.address??"",email:n.model?.email??"",website:n.model?.website??"",legal_name:n.model?.legal_name??"",phone_country:n.model?.phone_country??"",phone_code:n.model?.phone_code??"",phone_local:n.model?.phone_local??"",phone:n.model?.phone??"",logo:n.model?.logo??null,logo_url:n.model?.logo_url??null,logo_file:null}),f=m(""),w=m(!1),k=()=>{f.value="",w.value=!1;const s=String(o.phone_local||"").trim(),e=o.phone_code+s;if(!s)return f.value="Phone number is required",!1;try{if(!Y(e,o.phone_country))return f.value=`Invalid phone number for ${o.phone_country}`,!1;const u=Z(e,o.phone_country);return console.log("ðŸ“± Phone details:",{country:u.country,nationalNumber:u.nationalNumber,isValid:u.isValid(),type:u.getType()}),w.value=!0,!0}catch(l){return console.error("Phone validation error:",l),f.value="Invalid phone number format",!1}},_=m([{name:"Cafe",code:"cafe"},{name:"Restaurant",code:"restaurant"},{name:"Bakery",code:"bakery"},{name:"Takeaway",code:"takeaway"},{name:"Food Truck",code:"food_truck"}]),L=()=>{const s=n.model?.business_type;if(!s){h.value=null;return}let e=_.value.find(l=>l.name===s);if(!e){const l={name:s,code:s.toLowerCase().replace(/\s+/g,"_"),custom:!0};_.value.push(l),e=l}h.value=e},h=m(null),b=m(""),U=H(()=>{if(!b.value||b.value.trim()==="")return!1;const s=b.value.toLowerCase().trim();return!_.value.some(e=>e.name.toLowerCase()===s)}),D=()=>{const s=b.value.trim();if(!s)return;const e={name:s,code:s.toLowerCase().replace(/\s+/g,"_"),custom:!0};_.value.push(e),h.value=e,b.value=""};x(h,s=>{o.business_type=s?.name||"",p()});const E=m([]),T=m(null),O=async()=>{try{console.log("ðŸŸ¡ [FETCH] Fetching countries dial...");const{data:s}=await axios.get("/api/countries");E.value=s.map(e=>({name:e.name,iso:e.code,dial:e.phone_code}))}catch(s){console.error("âŒ [FETCH] fetchCountriesDial error:",s)}};function S(s){if(!s)return;const e=E.value.find(l=>l.iso===s.toUpperCase());e&&(T.value=e,o.phone_country=e.iso,o.phone_code=e.dial)}function C(){const s=(o.phone_code||"").trim(),e=String(o.phone_local||"").replace(/\D+/g,"");o.phone=s+e}q(async()=>{L(),await O(),M()});function M(){const s=n.model?.country_code||n.model?.phone_country;s&&S(s);let e=n.model?.phone_local||"";if(!e&&n.model?.phone){const l=n.model.phone,u=E.value.find(W=>l.startsWith(W.dial));u&&u.iso===s&&(e=l.slice(u.dial.length))}o.phone_local=e,C(),!o.logo_url&&n.model?.upload_id&&n.model?.logo_path&&(o.logo_url=n.model.logo_url||`/storage/${n.model.logo_path}`)}x(T,(s,e)=>{s&&(o.phone_country=s.iso,o.phone_code=s.dial,C(),p())}),x(()=>o.phone_local,(s,e)=>{C(),k(),p()}),x(()=>o.phone_country,()=>{o.phone_local&&k()});const I=m(!1),j=m(!1),B=m(null);function z(s){B.value=o.logo_url,B.value&&(j.value=!0)}function R({file:s}){o.logo_file=s,o.logo_url=URL.createObjectURL(s),p()}function p(){const s=k();F("save",{step:2,data:G(o),valid:s})}return(s,e)=>(i(),r("div",null,[n.isOnboarding?(i(),r("h5",ee,"Step 2 of 9 - Business Information")):c("",!0),t("div",oe,[t("div",se,[e[10]||(e[10]=t("label",{class:"form-label"},"Business Name*",-1)),v(t("input",{class:y(["form-control",{"is-invalid":a.formErrors?.business_name}]),"onUpdate:modelValue":e[0]||(e[0]=l=>o.business_name=l),onInput:p},null,34),[[g,o.business_name]]),a.formErrors?.business_name?(i(),r("small",le,d(a.formErrors.business_name[0]),1)):c("",!0)]),t("div",te,[e[12]||(e[12]=t("small",{class:"text-muted mt-2"},"Upload Logo",-1)),t("div",ne,[t("div",{class:"logo-frame",onClick:e[1]||(e[1]=l=>o.logo_url&&z())},[o.logo_url?(i(),r("img",{key:0,src:o.logo_url,alt:"Logo"},null,8,ae)):(i(),r("div",re,[...e[11]||(e[11]=[t("i",{class:"bi bi-image"},null,-1)])]))]),N(J,{show:I.value,onClose:e[2]||(e[2]=l=>I.value=!1),onCropped:R},null,8,["show"]),a.formErrors?.logo_file?(i(),r("small",ie,d(a.formErrors.logo_file[0]),1)):c("",!0)])]),t("div",de,[e[16]||(e[16]=t("label",{class:"form-label"},"Business Type*",-1)),N(Q(X),{modelValue:h.value,"onUpdate:modelValue":e[3]||(e[3]=l=>h.value=l),options:_.value,optionLabel:"name",filter:!0,onFilter:e[4]||(e[4]=l=>b.value=l.value),pt:{listContainer:{class:"bg-white text-black"},option:{class:"text-black hover:bg-gray-100"},header:{class:"bg-white text-black"},IconField:{class:"bg-white"},InputText:{class:"bg-white"},pcFilter:{class:"bg-white"},pcFilterContainer:{class:"bg-white"}},placeholder:"Select or type business type",class:y(["w-100",{"is-invalid":a.formErrors?.business_type}])},{value:V(({value:l,placeholder:u})=>[l?(i(),r("span",ue,d(l.name),1)):(i(),r("span",me,d(u),1))]),option:V(({option:l})=>[t("div",ce,[t("span",null,d(l.name),1),l.custom?(i(),r("span",pe,"Custom")):c("",!0)])]),footer:V(()=>[U.value?(i(),r("div",fe,[t("button",{type:"button",class:"btn btn-sm btn-primary w-100",onClick:D},[e[13]||(e[13]=t("i",{class:"bi bi-plus-circle me-1"},null,-1)),K(' Add "'+d(b.value)+'" ',1)])])):c("",!0)]),_:1},8,["modelValue","options","class"]),a.formErrors?.business_type?(i(),r("small",be,d(a.formErrors.business_type[0]),1)):c("",!0),e[17]||(e[17]=t("br",null,null,-1)),e[18]||(e[18]=t("label",{class:"form-label mt-3"},"Address*",-1)),v(t("input",{class:y(["form-control",{"is-invalid":a.formErrors?.address}]),"onUpdate:modelValue":e[5]||(e[5]=l=>o.address=l),onInput:p},null,34),[[g,o.address]]),a.formErrors?.address?(i(),r("small",he,d(a.formErrors.address[0]),1)):c("",!0),t("div",ve,[t("div",ge,[e[14]||(e[14]=t("label",{class:"form-label"},"Phone*",-1)),t("div",ye,[t("span",_e,[v(t("input",{type:"text",class:"form-control text-center border-0 bg-light fw-semibold","onUpdate:modelValue":e[6]||(e[6]=l=>o.phone_code=l),readonly:"",style:{width:"70px"}},null,512),[[g,o.phone_code]])]),v(t("input",{class:y(["form-control phone-input",{"is-invalid":a.formErrors?.phone_local||f.value,"is-valid":w.value&&o.phone_local}]),inputmode:"numeric",placeholder:"Phone number","onUpdate:modelValue":e[7]||(e[7]=l=>o.phone_local=l),onBlur:k},null,34),[[g,o.phone_local]])]),f.value?(i(),r("small",we,d(f.value),1)):a.formErrors?.phone_local?(i(),r("small",ke,d(a.formErrors.phone_local[0]),1)):w.value&&o.phone_local?(i(),r("small",xe," âœ“ Valid phone number ")):c("",!0)]),t("div",Ee,[e[15]||(e[15]=t("label",{class:"form-label"},"Email*",-1)),v(t("input",{type:"email",class:y(["form-control",{"is-invalid":a.formErrors?.email}]),"onUpdate:modelValue":e[8]||(e[8]=l=>o.email=l),onInput:p},null,34),[[g,o.email]]),a.formErrors?.email?(i(),r("small",Ce,d(a.formErrors.email[0]),1)):c("",!0)])]),e[19]||(e[19]=t("label",{class:"form-label mt-3"},"Website",-1)),v(t("input",{class:y(["form-control",{"is-invalid":a.formErrors?.website}]),"onUpdate:modelValue":e[9]||(e[9]=l=>o.website=l),onInput:p},null,34),[[g,o.website]]),a.formErrors?.website?(i(),r("small",Ve,d(a.formErrors.website[0]),1)):c("",!0)])])]))}},Fe=$(Te,[["__scopeId","data-v-e6f4bdac"]]);export{Fe as default};
