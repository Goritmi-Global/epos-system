import{c as M,r as b,y as $,o as z,I as R,E as G,f as d,b as r,e as t,m as g,F as S,g as H,t as a,u,i as f,d as x,k as _,v as h,p as J,q as k}from"./app-0e2Q59ss.js";import{u as K}from"./useFormatters-op_GlAk3.js";import{P as W}from"./pencil-ByNDZqw3.js";import{E as X}from"./eye-Cd-zOyn8.js";import"./createLucideIcon-CXN2vx4G.js";const Z={class:"table-responsive"},tt={class:"table table-hover align-middle"},et={class:"fw-semibold text-capitalize"},st=["title"],lt={class:"text-muted ms-2"},ot={key:1,class:"text-muted"},at={class:"text-break"},nt={key:1,class:"text-muted"},it={class:"text-end"},dt=["onClick"],rt=["onClick"],ut={key:0},ct={class:"modal fade",id:"viewLogModal_in",tabindex:"-1","aria-hidden":"true"},mt={class:"modal-dialog modal-lg modal-dialog-centered"},pt={class:"modal-content rounded-4 shadow-lg border-0"},vt={class:"modal-header align-items-center"},gt={class:"d-flex align-items-center gap-2"},yt={class:"d-flex flex-column"},bt={class:"text-muted"},ft={class:"modal-body p-4 bg-light"},_t={key:0,class:"row g-4"},ht={class:"col-lg-12"},xt={class:"card border-0 shadow-sm rounded-4 h-100"},kt={class:"card-body"},wt={class:"row g-3"},Dt={class:"col-md-6"},Pt={class:"fw-semibold"},Ct={class:"col-md-6"},Mt={class:"fw-semibold"},St={class:"col-md-6"},Lt={class:"badge rounded-pill bg-success"},Tt={class:"row g-3 text-center"},Nt={class:"col-md-3"},Vt={class:"p-3 bg-light rounded-3 card"},qt={class:"fs-6 fw-semibold"},Et={class:"col-md-3"},It={class:"p-3 bg-light rounded-3 card"},Ut={class:"fs-6 fw-semibold"},Bt={class:"col-md-3"},jt={class:"p-3 bg-light rounded-3 card"},Ft={class:"fs-6 fw-semibold"},Ot={class:"col-md-3"},At={class:"p-3 bg-light rounded-3 card"},Qt={class:"fs-6 fw-semibold"},Yt={class:"modal fade",id:"editLogModal_in",tabindex:"-1","aria-hidden":"true"},$t={class:"modal-dialog modal-lg modal-dialog-centered"},zt={class:"modal-content rounded-4"},Rt={class:"modal-body"},Gt={class:"row g-3"},Ht={class:"col-md-6 col-md-12"},Jt={class:"col-md-6 col-md-12"},Kt={key:0,class:"text-danger"},Wt={class:"col-md-6 col-md-12"},Xt={key:0,class:"text-danger"},Zt={class:"col-md-6 col-md-12"},te={class:"mt-4"},ee=["disabled","aria-busy"],se={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},le=864e5,re={__name:"StockInLogs",props:{logs:{type:Array,default:()=>[]},q:{type:String,default:""}},emits:["updated"],setup(L,{emit:T}){const{formatCurrencySymbol:y,dateFmt:v}=K(),w=L,N=T,D=M(()=>{const s=(w.q||"").trim().toLowerCase(),e=w.logs.filter(o=>o.type==="stockin");return s?e.filter(o=>[o.itemName,o.category?.name||o.category||"",o.operationType,o.type,String(o.quantity),String(o.unitPrice),String(o.totalPrice),o.expiryDate??"",o.dateTime??""].join(" ").toLowerCase().includes(s)):e}),V=s=>new Date(s).toISOString().slice(0,10),q=s=>{if(!s)return null;if(typeof s=="string"){const o=s.match(/^\d{4}-\d{2}-\d{2}/);if(o)return new Date(o[0]+"T00:00:00")}const e=new Date(s);return isNaN(e)?null:new Date(e.getFullYear(),e.getMonth(),e.getDate())},m=s=>{const e=q(s);if(!e)return null;const o=new Date,l=new Date(o.getFullYear(),o.getMonth(),o.getDate());return Math.ceil((e-l)/le)},E=s=>{const e=m(s);return e===null?"bg-secondary":e<0||e<15?"bg-danger":e<30?"bg-warning text-dark":"bg-success"},I=s=>(s??"").toString().replace(/[_-]+/g," ").trim().replace(/\w\S*/g,e=>e[0].toUpperCase()+e.slice(1).toLowerCase()),U=s=>({inventory_stockin:"Inventory Stockin",inventory_stockout:"Inventory Stockout",purchase:"Purchase",adjustment:"Adjustment",return:"Return"})[s]??I(s),B=s=>{switch(s){case"inventory_stockin":case"purchase":return"text-success";case"inventory_stockout":return"text-danger";case"adjustment":return"text-warning";default:return"text-secondary"}},i=b(null),c=b({}),n=b({id:null,itemName:"",quantity:"",unitPrice:"",totalPrice:"",expiryDate:"",operationType:"",type:"stockin"}),j=s=>{i.value=s,new bootstrap.Modal(document.getElementById("viewLogModal_in")).show()};function F(s){n.value={...s},new bootstrap.Modal(document.getElementById("editLogModal_in")).show()}const p=b(!1),O=()=>c.value={},P=M({get:()=>n.value.expiryDate?V(n.value.expiryDate):"",set:s=>n.value.expiryDate=s||null}),C=s=>s===""||s===null||s===void 0?0:Number(s),A=s=>Math.round((s+Number.EPSILON)*100)/100;$(()=>[n.value.quantity,n.value.unitPrice],([s,e])=>n.value.totalPrice=A(C(s)*C(e)),{immediate:!0});async function Q(){if(!p.value){p.value=!0,c.value={};try{await J.put(`stock_entries/stock-logs/${n.value.id}`,n.value),k.success("Stock log updated successfully"),N("updated");const s=bootstrap.Modal.getInstance(document.getElementById("editLogModal_in"));s&&s.hide()}catch(s){s?.response?.status===422&&s.response.data?.errors?(c.value=s.response.data.errors,k.error("Please fill in all required fields correctly.")):(k.error("Something went wrong. Please try again."),console.error(s))}finally{p.value=!1}}}return z(()=>window.feather?.replace()),R(()=>window.feather?.replace()),(s,e)=>{const o=G("VueDatePicker");return r(),d("div",null,[t("div",Z,[t("table",tt,[e[6]||(e[6]=t("thead",{class:"small text-muted"},[t("tr",null,[t("th",null,"Item name"),t("th",null,"Quantity"),t("th",null,"Unit Price"),t("th",null,"Total Price"),t("th",null,"Category"),t("th",null,"Date & Time"),t("th",null,"Expiry Date"),t("th",null,"Operation Type"),t("th",{class:"text-end"},"Action")])],-1)),t("tbody",null,[(r(!0),d(S,null,H(D.value,l=>(r(),d("tr",{key:l.id},[t("td",et,a(l.itemName),1),t("td",null,a(l.quantity),1),t("td",null,a(u(y)(l.unitPrice)),1),t("td",null,a(u(y)(l.totalPrice)),1),t("td",null,a(l.category?.name||l.category),1),t("td",null,a(u(v)(l.dateTime)),1),t("td",null,[l.expiryDate?(r(),d(S,{key:0},[t("span",{class:f(["badge","rounded-pill",E(l.expiryDate)]),title:m(l.expiryDate)!==null?m(l.expiryDate)<0?Math.abs(m(l.expiryDate))+" day(s) ago":m(l.expiryDate)+" day(s) left":""},a(u(v)(l.expiryDate)),11,st),t("small",lt,a(m(l.expiryDate)<0?Math.abs(m(l.expiryDate))+" day(s) ago":m(l.expiryDate)+" day(s) left"),1)],64)):(r(),d("span",ot,"—"))]),t("td",at,[l.operationType?(r(),d("span",{key:0,class:f(["fw-semibold",B(l.operationType)])},a(U(l.operationType)),3)):(r(),d("span",nt,"—"))]),t("td",it,[t("button",{class:"p-2 rounded-full text-blue-600 hover:bg-blue-100",onClick:Y=>F(l),title:"Adjustment"},[x(u(W),{class:"w-4 h-4"})],8,dt),t("button",{class:"p-2 rounded-full text-primary hover:bg-blue-100",onClick:Y=>j(l),title:"Show"},[x(u(X),{class:"w-4 h-4"})],8,rt)])]))),128)),D.value.length===0?(r(),d("tr",ut,[...e[5]||(e[5]=[t("td",{colspan:"10",class:"text-center text-muted py-4"}," No logs found. ",-1)])])):g("",!0)])])]),t("div",ct,[t("div",mt,[t("div",pt,[t("div",vt,[t("div",gt,[e[8]||(e[8]=t("span",{class:"badge bg-primary rounded-circle p-2"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3 7.5L12 12l9-4.5M3 7.5V17a2 2 0 002 2h14a2 2 0 002-2V7.5M21 7.5L12 3 3 7.5"})])],-1)),t("div",yt,[e[7]||(e[7]=t("h5",{class:"modal-title mb-0"},"View Stock Log",-1)),t("small",bt,"Item: "+a(i.value?.itemName??"—"),1)])]),e[9]||(e[9]=t("button",{class:"absolute top-2 right-2 p-2 rounded-full hover:bg-gray-100 transition transform hover:scale-110","data-bs-dismiss":"modal","aria-label":"Close",title:"Close"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-danger",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})])],-1))]),t("div",ft,[i.value?(r(),d("div",_t,[t("div",ht,[t("div",xt,[t("div",kt,[e[17]||(e[17]=t("h6",{class:"fw-semibold mb-3"}," Details ",-1)),t("div",wt,[t("div",Dt,[e[10]||(e[10]=t("small",{class:"text-muted d-block"},"Category",-1)),t("div",Pt,a(i.value.category?.name??i.value.category??"—"),1)]),t("div",Ct,[e[11]||(e[11]=t("small",{class:"text-muted d-block"},"Stock In Quantity",-1)),t("div",Mt,a(i.value.quantity??"—"),1)]),t("div",St,[e[12]||(e[12]=t("small",{class:"text-muted d-block"},"Operation",-1)),t("div",Lt,a(i.value.operationType??"—"),1)])]),e[18]||(e[18]=t("hr",{class:"my-4"},null,-1)),t("div",Tt,[t("div",Nt,[t("div",Vt,[e[13]||(e[13]=t("small",{class:"text-muted d-block"},"Unit Price",-1)),t("div",qt,a(u(y)(i.value.unitPrice??0)),1)])]),t("div",Et,[t("div",It,[e[14]||(e[14]=t("small",{class:"text-muted d-block"},"Total Price",-1)),t("div",Ut,a(u(y)(i.value.totalPrice??0)),1)])]),t("div",Bt,[t("div",jt,[e[15]||(e[15]=t("small",{class:"text-muted d-block"},"Expiry Date",-1)),t("div",Ft,a(i.value.expiryDate?u(v)(i.value.expiryDate):"—"),1)])]),t("div",Ot,[t("div",At,[e[16]||(e[16]=t("small",{class:"text-muted d-block"},"Date",-1)),t("div",Qt,a(u(v)(i.value.dateTime)),1)])])])])])])])):g("",!0)])])])]),t("div",Yt,[t("div",$t,[t("div",zt,[t("div",{class:"modal-header"},[e[20]||(e[20]=t("h5",{class:"modal-title fw-semibold"},"Edit Stock Log",-1)),t("button",{class:"absolute top-2 right-2 p-2 rounded-full hover:bg-gray-100 transition transform hover:scale-110","data-bs-dismiss":"modal","aria-label":"Close",title:"Close",onClick:O},[...e[19]||(e[19]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),t("div",Rt,[t("div",Gt,[t("div",Ht,[e[21]||(e[21]=t("label",{class:"form-label"},"Item Name",-1)),_(t("input",{type:"text",class:"form-control","onUpdate:modelValue":e[0]||(e[0]=l=>n.value.itemName=l),disabled:""},null,512),[[h,n.value.itemName]])]),t("div",Jt,[e[22]||(e[22]=t("label",{class:"form-label"},"Quantity",-1)),_(t("input",{type:"number",class:f(["form-control",{"is-invalid":c.value.quantity}]),"onUpdate:modelValue":e[1]||(e[1]=l=>n.value.quantity=l),required:""},null,2),[[h,n.value.quantity]]),c.value.quantity?(r(),d("small",Kt,a(c.value.quantity[0]),1)):g("",!0)]),t("div",Wt,[e[23]||(e[23]=t("label",{class:"form-label"},"Unit Price",-1)),_(t("input",{type:"number",class:f(["form-control",{"is-invalid":c.value.unitPrice}]),"onUpdate:modelValue":e[2]||(e[2]=l=>n.value.unitPrice=l),required:""},null,2),[[h,n.value.unitPrice]]),c.value.unitPrice?(r(),d("small",Xt,a(c.value.unitPrice[0]),1)):g("",!0)]),t("div",Zt,[e[24]||(e[24]=t("label",{class:"form-label"},"Value",-1)),_(t("input",{type:"number",readonly:"",class:"form-control","onUpdate:modelValue":e[3]||(e[3]=l=>n.value.totalPrice=l)},null,512),[[h,n.value.totalPrice]])]),e[25]||(e[25]=t("label",null,"Expiry Date",-1)),x(o,{modelValue:P.value,"onUpdate:modelValue":e[4]||(e[4]=l=>P.value=l),format:u(v),enableTimePicker:!1,"min-date":new Date,placeholder:"Select date"},null,8,["modelValue","format","min-date"]),t("div",te,[t("button",{class:"btn btn-primary rounded-pill btn-sm px-4 d-inline-flex align-items-center gap-2",disabled:p.value,"aria-busy":p.value?"true":"false",onClick:Q},[p.value?(r(),d("span",se)):g("",!0),t("span",null,a(p.value?"Saving…":"Save"),1)],8,ee)])])])])])])])}}};export{re as default};
