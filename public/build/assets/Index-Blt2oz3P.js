import{_ as we,r as g,c as I,o as te,n as ke,y as Se,I as Ce,E as Fe,a as se,b as l,w as Pe,d as F,e as t,u as b,h as De,f as n,m as y,l as O,k as T,v as N,F as Y,g as oe,t as i,i as H,T as $e,p as P,q as m}from"./app-DrUr72II.js";import{_ as Ie}from"./Master-BeW6Lctk.js";import{E as ae,a as le,u as V,w as Oe}from"./xlsx-7aOw9oZM.js";import Te from"./PurchaseComponent-BvlMI52v.js";import Ne from"./OrderComponent-B-39Ui9x.js";import{u as Ve}from"./useFormatters-DMzlbhVl.js";import Ee from"./BulkOrderComponent-BF5gPOVQ.js";import{E as Ue}from"./eye-ByYm4Jhk.js";import{T as Ae}from"./trash-2-O8vdyQKr.js";import"./index-BLyqyTLg.js";import"./createLucideIcon-BENYThoS.js";import"./index-DMd6VC55.js";import"./index-DfwVUbck.js";import"./sun-pxRjjhfX.js";import"./index-C4HWvfN4.js";import"./index-CAExNS8U.js";import"./index-IACkjU4I.js";const je={class:"page-wrapper"},Me={class:"card border-0 shadow-lg rounded-4"},Re={class:"card-body p-4"},ze={class:"d-flex align-items-center justify-content-between mb-3"},Le={class:"d-flex align-items-center gap-2"},qe={class:"position-relative"},Be={key:0,class:"help-popover shadow-lg rounded-3 p-3 bg-white border position-absolute",style:{width:"300px",right:"0","z-index":"999"}},Ge={class:"d-flex gap-2 align-items-center"},Ye={class:"search-wrap me-1"},He={key:1,class:"form-control search-input",placeholder:"Search",disabled:"",type:"text"},We={class:"dropdown"},Qe={class:"dropdown-menu dropdown-menu-end shadow rounded-4 py-2"},Ke={class:"table-responsive"},Xe={class:"table table-striped"},Je={key:0},Ze={class:"text-nowrap"},et={class:"small text-muted"},tt={class:"text-start"},st={class:"text-end"},ot={class:"d-flex gap-2 justify-content-end"},at=["onClick"],lt=["onClick","disabled"],nt={key:0},rt={colspan:"6",class:"text-center text-muted py-4"},it={key:0,class:"mt-4 d-flex justify-content-between align-items-center"},dt={class:"text-muted small"},ut={class:"modal fade",id:"orderDetailsModal",tabindex:"-1","aria-hidden":"true"},ct={class:"modal-dialog modal-xl modal-dialog-centered"},pt={class:"modal-content rounded-4 shadow-lg border-0"},mt={class:"modal-header align-items-center"},vt={class:"d-flex align-items-center gap-2"},ht={class:"d-flex flex-column"},gt={class:"modal-title mb-0"},bt={class:"text-muted"},yt={key:0,class:"modal-body p-4 bg-light"},ft={class:"row g-3"},_t={class:"col-md-6"},xt={class:"fw-semibold"},wt={class:"col-md-6"},kt={class:"col-md-6"},St={class:"fw-semibold"},Ct={class:"fw-semibold mb-3"},Ft={class:"table-responsive"},Pt={class:"table table-bordered align-middle"},Dt={class:"table-light"},$t={key:0},It={key:0},Ot=["onUpdate:modelValue"],Tt={key:0},Nt=["onUpdate:modelValue","onInput"],Vt={key:0},Et=["onUpdate:modelValue","onInput"],Ut={key:0},At=["onUpdate:modelValue"],jt={key:0},Mt={key:2,class:"text-danger"},Rt={key:0},zt=["onClick"],Lt={key:0},qt=["colspan"],Bt={class:"footer"},Gt={class:"fw-bold"},Yt={key:0,class:"alert alert-info mt-3"},Ht={key:1,class:"modal-footer"},Wt=["disabled"],Qt={key:0},Kt={key:1},Xt={__name:"Index",setup(Jt){const{formatCurrencySymbol:D,dateFmt:M}=Ve(),R=(o,e="GBP")=>new Intl.NumberFormat("en-GB",{style:"currency",currency:e}).format(Number(o||0)),x=g(""),W=g(Date.now()),z=`search-${Math.random().toString(36).substr(2,9)}`,Q=g(!1),$=o=>new Date(o).toLocaleString("en-GB",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0}),L=o=>Math.round((Number(o)||0)*100)/100,E=g(!1),U=g([]),ne=async()=>{const o=await P.get("/api/suppliers/pluck");U.value=o.data},q=g([]),B=g(""),re=async()=>{try{const o=await P.get("/inventory/api-inventories");q.value=o.data.data}catch(o){console.error("Error fetching inventory:",o)}},A=I(()=>{const o=B.value.trim().toLowerCase();return o?q.value.filter(e=>[e.name,e.category??"",e.subcategory??"",String(e.stock??"")].join(" ").toLowerCase().includes(o)):q.value});console.log("p_filteredInv",A);const K=I(()=>{const o=B.value.trim().toLowerCase();return o?X.value.filter(e=>[e.supplier??"",e.status??"",String(e.total??""),$(e.purchasedAt)??""].join(" ").toLowerCase().includes(o)):X.value});te(async()=>{x.value="",W.value=Date.now(),await ke(),setTimeout(()=>{Q.value=!0;const o=document.getElementById(z);o&&(o.value="",x.value="")},100),re(),ne()});const f=g(!1),v=g({data:[],current_page:1,last_page:1,per_page:10,total:0,from:0,to:0,links:[]}),X=I(()=>v.value.data||[]),ie=I(()=>({current_page:v.value.current_page,last_page:v.value.last_page,per_page:v.value.per_page,total:v.value.total}));I(()=>v.value.links||[]);const w=async(o=null)=>{f.value=!0;try{const{data:e}=await P.get("/api/purchase-orders/fetch-orders",{params:{q:x.value,page:o||v.value.current_page,per_page:v.value.per_page}});v.value={data:e.data||[],current_page:e.current_page,last_page:e.last_page,per_page:e.per_page,total:e.total,from:e.from,to:e.to,links:e.links}}catch(e){console.error("Failed to fetch purchase orders:",e),m.error("Failed to load purchase orders")}finally{f.value=!1}},de=o=>{if(!o)return;const a=new URLSearchParams(o.split("?")[1]).get("page");a&&w(parseInt(a))},h=g(null),k=g([]),u=g(!1),S=g({}),ue=()=>{S.value={}},j=g(!1);g(!1);let J=null;Se(x,()=>{clearTimeout(J),J=setTimeout(()=>{v.value.current_page=1,w(1)},500)});async function ce(o){try{const e=await P.get(`/purchase-orders/${o.id}`);h.value=e.data,console.log("selectedOrder.value",h.value),o.status==="pending"?(u.value=!0,k.value=h.value.items.map(s=>({id:s.id,product_id:s.product_id,name:s.product?.name||"Unknown",quantity:s.quantity,unit_price:s.unit_price,expiry:s.expiry||"",sub_total:s.sub_total}))):u.value=!1,new bootstrap.Modal(document.getElementById("orderDetailsModal")).show()}catch(e){console.error(e),m.error("Failed to load order details")}}async function pe(){if(h.value){j.value=!0;try{const o={status:"completed",items:k.value.map(a=>({purchase_id:h.value.id,product_id:a.product_id,qty:a.quantity,unit_price:a.unit_price,expiry:a.expiry||null}))};await P.put(`/purchase-orders/${h.value.id}`,o),bootstrap.Modal.getInstance(document.getElementById("orderDetailsModal"))?.hide(),S.value={},await w(),await w(ie.value.current_page),m.success("Order updated successfully and stock entries created!")}catch(o){if(o.response?.status===422&&o.response?.data?.errors){S.value=o.response.data.errors;const e=Object.values(S.value).flat().join(`
`);m.error(e)}else console.error("Error updating order:",o),m.error("Failed to update order")}finally{j.value=!1}}}function Z(o){const e=parseFloat(o.quantity)||0,a=parseFloat(o.unit_price)||0;o.sub_total=(e*a).toFixed(2)}const me=async()=>{try{f.value=!0;const{data:o}=await P.get("/api/purchase-orders/fetch-orders",{params:{q:x.value,page:1,per_page:1e4}});return o.data||[]}catch(o){return console.error("Failed to fetch data for export:",o),m.error("Failed to load data for export"),[]}finally{f.value=!1}},G=async o=>{try{f.value=!0;const e=await me();if(!e||e.length===0){m.error("No purchase orders found to download"),f.value=!1;return}console.log(`ðŸ“¥ Exporting ${e.length} purchase orders as ${o.toUpperCase()}`),o==="pdf"?he(e):o==="excel"?ge(e):o==="csv"?ve(e):m.error("Invalid download type")}catch(e){console.error("Download failed:",e),m.error(`Download failed: ${e.message}`)}finally{f.value=!1}},ve=o=>{try{const e=["S.No","Supplier Name","Purchase Date","Status","Total Value"],a=o.map((p,C)=>[C+1,`"${p.supplier||""}"`,`"${$(p.purchasedAt)||""}"`,`"${p.status||""}"`,`"${L(p.total)||0}"`]),s=[e.join(","),...a.map(p=>p.join(","))].join(`
`),d=new Blob([s],{type:"text/csv;charset=utf-8;"}),r=URL.createObjectURL(d),c=document.createElement("a");c.href=r,c.download=`purchase_orders_${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(r),m.success(`CSV downloaded successfully (${o.length} records)`,{autoClose:2500})}catch(e){console.error("CSV generation error:",e),m.error(`CSV generation failed: ${e.message}`)}},he=o=>{try{const e=new ae("p","mm","a4");e.setFontSize(18),e.setFont("helvetica","bold"),e.text("Purchase Orders Report",60,20),e.setFontSize(10),e.setFont("helvetica","normal");const a=new Date().toLocaleString();e.text(`Generated on: ${a}`,14,28),e.text(`Total Records: ${o.length}`,14,33);const s=["S.No","Supplier Name","Purchase Date","Status","Total Value"],d=o.map((c,p)=>[p+1,c.supplier||"",$(c.purchasedAt)||"",c.status||"",L(c.total)||0]);le(e,{head:[s],body:d,startY:40,styles:{fontSize:9,cellPadding:2,lineWidth:.1,halign:"left"},headStyles:{fillColor:[41,128,185],textColor:255,fontStyle:"bold"},alternateRowStyles:{fillColor:[240,240,240]},margin:{left:14,right:14},didDrawPage:c=>{const p=e.internal.getNumberOfPages(),C=e.internal.pageSize.height;e.setFontSize(8),e.text(`Page ${c.pageNumber} of ${p}`,c.settings.margin.left,C-10)}});const r=`purchase_orders_${new Date().toISOString().split("T")[0]}.pdf`;e.save(r),m.success(`PDF downloaded successfully (${o.length} records)`,{autoClose:2500})}catch(e){console.error("PDF generation error:",e),m.error(`PDF generation failed: ${e.message}`)}},ge=o=>{try{const e=o.map((p,C)=>({"S.No":C+1,"Supplier Name":p.supplier||"","Purchase Date":$(p.purchasedAt)||"",Status:p.status||"","Total Value":L(p.total)||0})),a=V.book_new(),s=V.json_to_sheet(e);s["!cols"]=[{wch:8},{wch:25},{wch:25},{wch:15},{wch:15}],V.book_append_sheet(a,s,"Purchase Orders");const d=[{Info:"Generated On",Value:new Date().toLocaleString()},{Info:"Total Records",Value:o.length},{Info:"Exported By",Value:"Purchase Order System"}],r=V.json_to_sheet(d);V.book_append_sheet(a,r,"Report Info");const c=`purchase_orders_${new Date().toISOString().split("T")[0]}.xlsx`;Oe(a,c),m.success(`Excel file downloaded successfully (${o.length} records)`,{autoClose:2500})}catch(e){console.error("Excel generation error:",e),m.error(`Excel generation failed: ${e.message}`)}};te(()=>{w(1)}),Ce(()=>window.feather?.replace?.());const be=async o=>{try{const a=(await P.get(`/purchase-orders/${o.id}`)).data,s=new ae("p","mm","a4");s.setFontSize(24),s.setFont("helvetica","bold"),s.setTextColor(41,128,185),s.text("INVOICE",14,20),s.setFontSize(10),s.setFont("helvetica","normal"),s.setTextColor(0,0,0);const d=140;s.text(`Invoice #: ${a.id}`,d,20),s.text(`Date: ${$(a.purchasedAt||a.purchase_date)}`,d,26),s.text(`Status: ${a.status?.toUpperCase()||"PENDING"}`,d,32),s.setFontSize(12),s.setFont("helvetica","bold"),s.text("FROM (Your Company):",14,45),s.setFontSize(10),s.setFont("helvetica","normal"),s.text("Your Company Name",14,52),s.text("123 Business Street",14,58),s.text("City, Country",14,64),s.text("contact@company.com",14,70),s.setFontSize(12),s.setFont("helvetica","bold"),s.text("TO (Supplier):",100,45),s.setFontSize(10),s.setFont("helvetica","normal");const r=a.supplier?.name||a.supplier||"N/A";s.text(r,100,52),s.text("Supplier Details",100,58),s.text("Contact: "+(a.supplier?.contact||"N/A"),100,64),s.text("Email: "+(a.supplier?.email||"N/A"),100,70),s.setDrawColor(41,128,185),s.setLineWidth(.5),s.line(14,78,196,78);const c=["Item","Quantity","Unit Price","Subtotal"],p=a.items.map(_=>[_.product?.name||_.name||"Unknown Product",_.quantity,R(_.unit_price),R(_.sub_total||_.quantity*_.unit_price)]);le(s,{head:[c],body:p,startY:85,styles:{fontSize:10,cellPadding:3,lineWidth:.1,halign:"left"},headStyles:{fillColor:[41,128,185],textColor:255,fontStyle:"bold",halign:"center"},alternateRowStyles:{fillColor:[245,245,245]},margin:{left:14,right:14},columnStyles:{1:{halign:"center"},2:{halign:"right"},3:{halign:"right"}}});const C=s.lastAutoTable.finalY||150;s.setFontSize(11),s.setFont("helvetica","bold");const ye=a.items.reduce((_,xe)=>_+(parseFloat(xe.sub_total)||0),0);s.text(`Total Amount: ${R(ye)}`,140,C+15),s.setFontSize(9),s.setFont("helvetica","normal"),s.setTextColor(128,128,128);const ee=s.internal.pageSize.height,fe=s.internal.getNumberOfPages();s.text(`Page 1 of ${fe}`,14,ee-10),s.text("Thank you for your business!",100,ee-10);const _e=`invoice_${a.id}_${new Date().toISOString().split("T")[0]}.pdf`;s.save(_e),m.success("Invoice downloaded successfully",{autoClose:2500})}catch(e){console.error("Invoice generation error:",e),m.error(`Invoice generation failed: ${e.message}`)}};return(o,e)=>{const a=Fe("VueDatePicker");return l(),se(Ie,null,{default:Pe(()=>[F(b(De),{title:"Purchase Order"}),t("div",je,[t("div",Me,[t("div",Re,[t("div",ze,[t("div",Le,[e[14]||(e[14]=t("h3",{class:"fw-semibold mb-0"},"Purchase Order",-1)),t("div",qe,[t("button",{class:"btn btn-link p-0 ms-2",onClick:e[0]||(e[0]=s=>E.value=!E.value),title:"Help"},[...e[8]||(e[8]=[t("i",{class:"bi bi-question-circle fs-5"},null,-1)])]),E.value?(l(),n("div",Be,[t("button",{onClick:e[1]||(e[1]=s=>E.value=!1),class:"btn btn-sm btn-light border-0 position-absolute top-0 end-0 mt-1 me-1 text-secondary",title:"Close"},[...e[9]||(e[9]=[t("i",{class:"bi bi-x-lg"},null,-1)])]),e[10]||(e[10]=t("h6",{class:"fw-semibold mb-3"},"Purchase Order Help",-1)),e[11]||(e[11]=t("p",{class:"mb-2 small text-muted"}," This screen allows you to view, manage, and update all purchase orders. ",-1)),e[12]||(e[12]=t("p",{class:"mb-1 small"},[t("strong",null,"Add Purchase:"),O(" Create a purchase and stock-in immediately. ")],-1)),e[13]||(e[13]=t("p",{class:"small mb-0"},[t("strong",null,"Add Order:"),O(" Create a purchase order for later delivery. ")],-1))])):y("",!0)])]),t("div",Ge,[t("div",Ye,[e[15]||(e[15]=t("i",{class:"bi bi-search"},null,-1)),e[16]||(e[16]=t("input",{type:"email",name:"email",autocomplete:"email",style:{position:"absolute",left:"-9999px",width:"1px",height:"1px"},tabindex:"-1","aria-hidden":"true"},null,-1)),Q.value?T((l(),n("input",{id:z,"onUpdate:modelValue":e[2]||(e[2]=s=>x.value=s),key:W.value,class:"form-control search-input",placeholder:"Search",type:"search",autocomplete:"new-password",name:z,role:"presentation",onFocus:e[3]||(e[3]=(...s)=>o.handleFocus&&o.handleFocus(...s))},null,32)),[[N,x.value]]):(l(),n("input",He))]),e[18]||(e[18]=t("button",{class:"btn btn-primary btn-sm py-2 rounded-pill px-4","data-bs-toggle":"modal","data-bs-target":"#bulkOrderModal"}," Bulk Purchase ",-1)),F(Ee,{suppliers:U.value,items:A.value,onRefreshData:w},null,8,["suppliers","items"]),F(Te,{suppliers:U.value,items:A.value,onRefreshData:w,"onUpdate:search":e[4]||(e[4]=s=>B.value=s)},null,8,["suppliers","items"]),e[19]||(e[19]=t("button",{class:"btn btn-primary btn-sm py-2 rounded-pill px-4 py-2","data-bs-toggle":"modal","data-bs-target":"#addOrderModal"}," Order ",-1)),F(Ne,{suppliers:U.value,items:A.value,onRefreshData:w},null,8,["suppliers","items"]),t("div",We,[e[17]||(e[17]=t("button",{class:"btn btn-outline-secondary btn-sm rounded-pill py-2 px-4 dropdown-toggle","data-bs-toggle":"dropdown"}," Export ",-1)),t("ul",Qe,[t("li",null,[t("a",{class:"dropdown-item py-2",href:"javascript:;",onClick:e[5]||(e[5]=s=>G("pdf"))},"Export as PDF")]),t("li",null,[t("a",{class:"dropdown-item py-2",href:"javascript:;",onClick:e[6]||(e[6]=s=>G("excel"))},"Export as Excel")]),t("li",null,[t("a",{class:"dropdown-item py-2",href:"javascript:;",onClick:e[7]||(e[7]=s=>G("csv"))}," Export as CSV ")])])])])]),t("div",Ke,[t("table",Xe,[e[22]||(e[22]=t("thead",{class:"small text-muted"},[t("tr",null,[t("th",{style:{width:"80px"}},"S. #"),t("th",null,"Supplier Name"),t("th",null,"Purchase date"),t("th",{class:"text-start"},"Status"),t("th",null,"Total value"),t("th",{class:"text-end"},"Action")])],-1)),t("tbody",null,[f.value?(l(),n("tr",Je,[...e[20]||(e[20]=[t("td",{colspan:"6",class:"text-center py-5"},[t("div",{class:"spinner-border text-primary",role:"status"},[t("span",{class:"visually-hidden"},"Loading...")]),t("p",{class:"text-muted mt-2 mb-0"},"Loading purchase orders...")],-1)])])):(l(),n(Y,{key:1},[(l(!0),n(Y,null,oe(K.value,(s,d)=>(l(),n("tr",{key:s.id},[t("td",null,i(v.value.from+d),1),t("td",null,i(s.supplier),1),t("td",Ze,[O(i(s.purchasedAt)+" ",1),t("div",et,i(b(M)(s.purchasedAt).split(",")[1]?.trim()),1)]),t("td",tt,[t("span",{class:H(["badge rounded-pill",s.status==="pending"?"bg-warning text-dark":s.status==="completed"?"bg-success":"bg-secondary"])},i(s.status),3)]),t("td",null,i(b(D)(s.total)),1),t("td",st,[t("div",ot,[t("button",{class:"p-2 rounded-pill text-primary hover:bg-gray-100 btn",onClick:r=>ce(s),title:"View Item"},[F(b(Ue),{class:"w-4 h-4"})],8,at),t("button",{class:"p-2 rounded-pill text-success hover:bg-gray-100 btn",onClick:r=>be(s),disabled:f.value,title:"Print Invoice"},[...e[21]||(e[21]=[t("i",{class:"bi bi-printer fs-5"},null,-1)])],8,lt)])])]))),128)),K.value.length===0?(l(),n("tr",nt,[t("td",rt,i(x.value.trim()?"No purchase orders found matching your search.":"No purchase orders found."),1)])):y("",!0)],64))])])]),v.value.last_page>1?(l(),n("div",it,[t("div",dt," Showing "+i(v.value.from)+" to "+i(v.value.to)+" of "+i(v.value.total)+" entries ",1),F($e,{pagination:v.value.links,isApiDriven:!0,onPageChanged:de},null,8,["pagination"])])):y("",!0)])]),t("div",ut,[t("div",ct,[t("div",pt,[t("div",mt,[t("div",vt,[e[23]||(e[23]=t("span",{class:"badge bg-success rounded-circle p-2"},[t("i",{class:"bi bi-basket"})],-1)),t("div",ht,[t("h5",gt,i(u.value?"Edit Purchase Order":"Purchase Details"),1),t("small",bt," Supplier: "+i(h.value?.supplier?.name??"â€”"),1)])]),t("button",{onClick:ue,class:"absolute top-2 right-2 p-2 rounded-full hover:bg-gray-100 transition transform hover:scale-110","data-bs-dismiss":"modal","aria-label":"Close",title:"Close"},[...e[24]||(e[24]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),h.value?(l(),n("div",yt,[e[37]||(e[37]=t("h6",{class:"fw-semibold mb-3"},"Order Summary",-1)),t("div",ft,[t("div",_t,[e[25]||(e[25]=t("small",{class:"text-muted d-block"},"Purchase Date",-1)),t("div",xt,i(b(M)(h.value.purchase_date).split(",")[0]),1)]),t("div",wt,[e[26]||(e[26]=t("small",{class:"text-muted d-block"},"Status",-1)),t("span",{class:H(["badge rounded-pill",h.value.status==="completed"?"bg-success":"bg-warning"])},i(h.value.status),3)]),t("div",kt,[e[27]||(e[27]=t("small",{class:"text-muted d-block"},"Total Amount",-1)),t("div",St,i(b(D)(h.value.total_amount)),1)])]),e[38]||(e[38]=t("hr",{class:"my-4"},null,-1)),t("h6",Ct,i(u.value?"Edit Items":"Purchased Items"),1),t("div",Ft,[t("table",Pt,[t("thead",Dt,[t("tr",null,[e[28]||(e[28]=t("th",null,"Product",-1)),e[29]||(e[29]=t("th",null,"Qty",-1)),e[30]||(e[30]=t("th",null,"Unit Price",-1)),e[31]||(e[31]=t("th",null,"Subtotal",-1)),e[32]||(e[32]=t("th",null,"Expiry",-1)),u.value?(l(),n("th",$t,"Action")):y("",!0)])]),t("tbody",null,[(l(!0),n(Y,null,oe(u.value?k.value:h.value.items,(s,d)=>(l(),n("tr",{class:"black-row",key:s.id||d},[t("td",null,[u.value?T((l(),n("input",{key:1,"onUpdate:modelValue":r=>s.name=r,class:"form-control",readonly:""},null,8,Ot)),[[N,s.name]]):(l(),n("span",It,i(s.product?.name||s.name||"Unknown Product"),1))]),t("td",null,[u.value?T((l(),n("input",{key:1,"onUpdate:modelValue":r=>s.quantity=r,type:"number",class:"form-control",onInput:r=>Z(s)},null,40,Nt)),[[N,s.quantity,void 0,{number:!0}]]):(l(),n("span",Tt,i(b(D)(s.quantity)),1))]),t("td",null,[u.value?T((l(),n("input",{key:1,"onUpdate:modelValue":r=>s.unit_price=r,type:"number",class:"form-control",onInput:r=>Z(s)},null,40,Et)),[[N,s.unit_price,void 0,{number:!0}]]):(l(),n("span",Vt,i(s.unit_price),1))]),t("td",null,[u.value?T((l(),n("input",{key:1,"onUpdate:modelValue":r=>s.sub_total=r,class:"form-control",readonly:""},null,8,At)),[[N,s.sub_total]]):(l(),n("span",Ut,i(b(D)(s.sub_total)),1))]),t("td",null,[u.value?(l(),se(a,{key:1,modelValue:s.expiry,"onUpdate:modelValue":r=>s.expiry=r,enableTimePicker:!1,"min-date":new Date,teleport:!0,format:"yyyy-MM-dd",placeholder:"Select expiry date",class:H({"is-invalid":S.value[`items.${d}.expiry`]})},null,8,["modelValue","onUpdate:modelValue","min-date","class"])):(l(),n("span",jt,i(b(M)(s.expiry_date)),1)),S.value[`items.${d}.expiry`]?(l(),n("small",Mt,i(S.value[`items.${d}.expiry`][0]),1)):y("",!0)]),e[33]||(e[33]=t("br",null,null,-1)),u.value?(l(),n("td",Rt,[t("button",{class:"p-2 rounded-full transition transform hover:bg-gray-100 hover:scale-110",onClick:r=>k.value.splice(d,1),title:"Delete"},[F(b(Ae),{class:"w-4 h-4 text-red-500"})],8,zt)])):y("",!0)]))),128)),(u.value?k.value.length:h.value.items.length)===0?(l(),n("tr",Lt,[t("td",{colspan:u.value?6:5,class:"text-center text-muted py-3"}," No items found ",8,qt)])):y("",!0)]),t("tfoot",Bt,[t("tr",null,[e[34]||(e[34]=t("td",{colspan:"3",class:"text-end fw-bold"}," Total: ",-1)),t("td",Gt,i(b(D)((u.value?k.value:h.value.items).reduce((s,d)=>s+parseFloat(d.sub_total||0),0))),1),e[35]||(e[35]=t("td",{colspan:"2"},null,-1))])])])]),u.value?(l(),n("div",Yt,[...e[36]||(e[36]=[t("i",{class:"bi bi-info-circle me-2"},null,-1),O(" Updating will mark this order as completed and create stock entries. ",-1)])])):y("",!0)])):y("",!0),u.value?(l(),n("div",Ht,[t("button",{type:"button",class:"btn btn-primary rounded-pill px-4 py-2",onClick:pe,disabled:j.value||k.value.length===0},[j.value?(l(),n("span",Qt,[...e[39]||(e[39]=[t("span",{class:"spinner-border spinner-border-sm me-2"},null,-1),O(" Updating... ",-1)])])):(l(),n("span",Kt,"Complete Order & Update Stock"))],8,Wt),e[40]||(e[40]=t("button",{type:"button",class:"btn btn-secondary rounded-pill px-4 py-2","data-bs-dismiss":"modal"}," Cancel ",-1))])):y("",!0)])])])])]),_:1})}}},gs=we(Xt,[["__scopeId","data-v-924a36fa"]]);export{gs as default};
