import{_ as ee,r as i,c as R,o as te,y as N,f as d,b as u,d as y,e as t,u as V,h as ae,m as F,k as L,v as I,l as $,F as T,g as oe,t as p,C as se,S as le,i as M,p as x,n as ne,q as s}from"./app-COfeKFco.js";import{E as re,a as ie,X as de,u as C,w as ue}from"./xlsx-CQiPhMNw.js";import{I as ce}from"./importFile-BBmPz4pU.js";import{P as me}from"./plus-JqLDZRav.js";import{P as ge}from"./pencil-whvBZMvZ.js";import"./createLucideIcon-BHjiP04p.js";const pe={class:"card border-0 shadow-lg rounded-4"},ve={class:"card-body"},fe={class:"d-flex flex-wrap gap-2 justify-content-between align-items-center mb-3"},he={class:"d-flex gap-2"},be={class:"search-wrap"},we={class:"dropdown"},ye={class:"dropdown-menu dropdown-menu-end shadow rounded-4"},_e={class:"table-responsive"},Te={class:"table table-hover"},xe={key:0},Ce={class:"fw-semibold"},Se={class:"text-center"},ke={class:"d-inline-flex align-items-center gap-3"},Fe=["onClick"],Ee={key:0},De={colspan:"3",class:"text-center text-muted py-4"},Pe={key:0,class:"mt-4 d-flex justify-content-between align-items-center"},Ne={class:"text-muted small"},Ve={class:"modal fade",id:"modalTagForm",tabindex:"-1","aria-hidden":"true"},Le={class:"modal-dialog modal-lg modal-dialog-centered"},Ie={class:"modal-content rounded-4"},$e={class:"modal-header"},je={class:"modal-title"},Oe={class:"modal-body"},Ae={key:0},Re={key:0,class:"text-danger"},Me={key:1},Be={key:0,class:"text-danger"},ze={class:"col-md-2"},Ue=["disabled"],Xe={__name:"TagsTab",setup(He){const B=i([{label:"Vegan",value:"Vegan"},{label:"Vegetarian",value:"Vegetarian"},{label:"Halal",value:"Halal"},{label:"Kosher",value:"Kosher"},{label:"Organic",value:"Organic"},{label:"Locally Sourced",value:"Locally Sourced"},{label:"Fairtrade",value:"Fairtrade"},{label:"Spicy",value:"Spicy"},{label:"Free-From Nuts",value:"Free-From Nuts"},{label:"Contains Soy",value:"Contains Soy"},{label:"Free-From Egg",value:"Free-From Egg"},{label:"Sugar-Free",value:"Sugar-Free"},{label:"Ethically Sourced",value:"Ethically Sourced"},{label:"Red Tractor Certified",value:"Red Tractor Certified"},{label:"Scottish Produce",value:"Scottish Produce"},{label:"Welsh Lamb",value:"Welsh Lamb"}]);i([]);const E=i([]),z=i(""),b=i(!1),D=i(null),v=i(""),f=i(""),j=()=>{v.value="",E.value=[],n.value={}},O=R(()=>{const a=f.value.trim().toLowerCase();return a?r.value.filter(e=>e.name.toLowerCase().includes(a)):r.value}),U=()=>{b.value=!1,E.value=[],z.value=""};R(()=>B.value.filter(a=>!r.value.some(e=>e.name.toLowerCase()===a.value.toLowerCase())));const X=a=>{b.value=!0,D.value=a,v.value=a.name},H=async a=>{try{await x.delete(`/tags/${a.id}`),r.value=r.value.filter(e=>e.id!==a.id),s.success("Tag deleted successfully"),await w()}catch(e){s.error("Delete failed"),console.error(e)}},S=i(!1),q=async()=>{const a=v.value.trim();if(!a){s.error("Please fill out the field, can't save an empty field."),n.value={customTag:["Please fill out the field, can't save an empty field"]};return}try{if(S.value=!0,b.value){const{data:e}=await x.put(`/tags/${D.value.id}`,{name:a}),o=r.value.findIndex(l=>l.id===D.value.id);o!==-1&&(r.value[o]=e),s.success("Tag updated successfully")}else{if(r.value.some(c=>c.name.toLowerCase()===a.toLowerCase())){const c=`Tag "${a}" already exists.`;s.error(c),n.value={customTag:[c]};return}const{data:o}=await x.post("/tags",{tags:[{name:a}]}),l=Array.isArray(o)?o[0]:o;r.value.push(l),s.success("Tag added successfully")}j(),G("modalTagForm"),await w()}catch(e){e.response?.data?.errors?(n.value={},Object.entries(e.response.data.errors).forEach(([o,l])=>{l.forEach(c=>s.error(c)),n.value={customTag:l}})):(s.error("Operation failed ❌"),console.error(e))}finally{S.value=!1}},G=a=>{const e=document.getElementById(a);if(!e)return;(window.bootstrap?.Modal.getInstance(e)||new window.bootstrap.Modal(e)).hide()},r=i([]),g=i({current_page:1,last_page:1,per_page:15,total:0,from:0,to:0,links:[]}),k=i(!1),n=i({}),w=async(a=null)=>{k.value=!0;try{const{data:e}=await x.get("/tags",{params:{q:f.value,page:a||g.value.current_page,per_page:g.value.per_page}});r.value=e.data||[],g.value={current_page:e.current_page,last_page:e.last_page,per_page:e.per_page,total:e.total,from:e.from,to:e.to,links:e.links},await ne(),window.feather?.replace()}catch(e){console.error("Failed to fetch tags",e),s.error("Failed to load tags")}finally{k.value=!1}},W=a=>{if(!a)return;const o=new URLSearchParams(a.split("?")[1]).get("page");o&&w(parseInt(o))},P=a=>{if(!r.value||r.value.length===0){s.error("No Tags data to download");return}const e=f.value.trim()?filtered.value:r.value;if(e.length===0){s.error("No Tags found to download");return}try{a==="pdf"?Y(e):a==="excel"?J(e):a==="csv"?K(e):s.error("Invalid download type")}catch(o){console.error("Download failed:",o),s.error(`Download failed: ${o.message}`)}},K=a=>{try{const e=["Name"],o=a.map(h=>[`"${h.name||""}"`]),l=[e.join(","),...o.map(h=>h.join(","))].join(`
`),c=new Blob([l],{type:"text/csv;charset=utf-8;"}),_=URL.createObjectURL(c),m=document.createElement("a");m.setAttribute("href",_),m.setAttribute("download",`tags_${new Date().toISOString().split("T")[0]}.csv`),document.body.appendChild(m),m.click(),document.body.removeChild(m),s.success("CSV downloaded successfully",{autoClose:2500})}catch(e){console.error("CSV generation error:",e),s.error(`CSV generation failed: ${e.message}`,{autoClose:5e3})}},Y=a=>{try{const e=new re("p","mm","a4");e.setFont("helvetica","bold"),e.setFontSize(18),e.text("Tags Report",80,20),e.setFont("helvetica","normal"),e.setFontSize(10);const o=new Date().toLocaleString();e.text(`Generated on: ${o}`,14,30),e.text(`Total Tags: ${a.length}`,14,36);const l=["Name"],c=a.map(m=>[m.name||""]);ie(e,{head:[l],body:c,startY:45,styles:{fontSize:10,cellPadding:3,halign:"left",valign:"middle",lineColor:[200,200,200],lineWidth:.1},headStyles:{fillColor:[41,128,185],textColor:255,fontStyle:"bold"},alternateRowStyles:{fillColor:[245,245,245]},margin:{left:14,right:14},didDrawPage:m=>{const h=e.internal.getNumberOfPages(),Z=e.internal.pageSize.height;e.setFontSize(8),e.text(`Page ${m.pageNumber} of ${h}`,14,Z-10)}});const _=`tags_${new Date().toISOString().split("T")[0]}.pdf`;e.save(_),s.success("PDF downloaded successfully",{autoClose:2500})}catch(e){console.error("PDF generation error:",e),s.error(`PDF generation failed: ${e.message}`,{autoClose:5e3})}},J=a=>{try{if(typeof de>"u")throw new Error("XLSX library is not loaded");const e=a.map(h=>({Name:h.name||""})),o=C.book_new(),l=C.json_to_sheet(e);l["!cols"]=[{wch:25}],C.book_append_sheet(o,l,"Tags");const c=[{Info:"Generated On",Value:new Date().toLocaleString()},{Info:"Total Records",Value:a.length},{Info:"Exported By",Value:"Tags Management System"}],_=C.json_to_sheet(c);C.book_append_sheet(o,_,"Report Info");const m=`tags_${new Date().toISOString().split("T")[0]}.xlsx`;ue(o,m),s.success("Excel file downloaded successfully",{autoClose:2500})}catch(e){console.error("Excel generation error:",e),s.error(`Excel generation failed: ${e.message}`,{autoClose:5e3})}};te(async()=>{await w(),window.feather?.replace()}),N(v,a=>{a&&n.value.customTag&&delete n.value.customTag});let A=null;N(f,()=>{clearTimeout(A),A=setTimeout(()=>{g.value.current_page=1,w(1)},500)}),N(E,a=>{a.length>0&&n.value.tags&&delete n.value.tags});const Q=a=>{if(!a||a.length<=1){s.error("The file is empty",{autoClose:3e3});return}a[0];const o=a.slice(1).map(l=>({name:l[0]?.trim()||""}));x.post("/api/tags/import",{tags:o}).then(()=>{s.success("Tags imported successfully"),w()}).catch(l=>{l?.response?.status===422&&l.response.data?.errors?(n.value=l.response.data.errors,s.error("Validation failed — check for duplicates or missing data",{autoClose:3e3})):s.error("Import failed. Please try again.",{autoClose:3e3})})};return(a,e)=>(u(),d(T,null,[y(V(ae),{title:"Tag"}),t("div",pe,[t("div",ve,[t("div",fe,[e[10]||(e[10]=t("h4",{class:"mb-0"},"Tags",-1)),t("div",he,[t("div",be,[e[7]||(e[7]=t("i",{class:"bi bi-search"},null,-1)),L(t("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>f.value=o),class:"form-control search-input",placeholder:"Search"},null,512),[[I,f.value]])]),t("button",{"data-bs-toggle":"modal","data-bs-target":"#modalTagForm",onClick:e[1]||(e[1]=()=>{U(),j(),n.value={}}),class:"d-flex align-items-center gap-1 btn-sm px-4 py-2 rounded-pill btn btn-primary text-white"},[y(V(me),{class:"w-4 h-4"}),e[8]||(e[8]=$(" Add Tag ",-1))]),y(ce,{label:"Import",sampleHeaders:["Name"],sampleData:[["Vegan"],["Gluten-Free"],["Organic"]],onOnImport:Q}),t("div",we,[e[9]||(e[9]=t("button",{class:"btn btn-outline-secondary btn-sm rounded-pill py-2 px-4 dropdown-toggle","data-bs-toggle":"dropdown"}," Export ",-1)),t("ul",ye,[t("li",null,[t("a",{class:"dropdown-item py-2",href:"javascript:;",onClick:e[2]||(e[2]=o=>P("pdf"))},"Export as PDF")]),t("li",null,[t("a",{class:"dropdown-item py-2",href:"javascript:;",onClick:e[3]||(e[3]=o=>P("excel"))},"Export as Excel")]),t("li",null,[t("a",{class:"dropdown-item py-2",href:"javascript:;",onClick:e[4]||(e[4]=o=>P("csv"))}," Export as CSV ")])])])])]),t("div",_e,[t("table",Te,[e[12]||(e[12]=t("thead",{class:"border-top small text-muted"},[t("tr",null,[t("th",null,"S. #"),t("th",null,"Tag Name"),t("th",{class:"text-center"},"Action")])],-1)),t("tbody",null,[k.value?(u(),d("tr",xe,[...e[11]||(e[11]=[t("td",{colspan:"3",class:"text-center py-5"},[t("div",{class:"spinner-border text-primary",role:"status"},[t("span",{class:"visually-hidden"},"Loading...")]),t("p",{class:"text-muted mt-2 mb-0"},"Loading tags...")],-1)])])):(u(),d(T,{key:1},[(u(!0),d(T,null,oe(O.value,(o,l)=>(u(),d("tr",{key:o.id},[t("td",null,p(g.value.from+l),1),t("td",Ce,p(o.name),1),t("td",Se,[t("div",ke,[t("button",{"data-bs-toggle":"modal","data-bs-target":"#modalTagForm",onClick:()=>{X(o),n.value={}},title:"Edit",class:"p-2 rounded-full text-blue-600 hover:bg-blue-100"},[y(V(ge),{class:"w-4 h-4"})],8,Fe),y(se,{title:"Confirm Delete",message:`Are you sure you want to delete ${o.name}?`,showDeleteButton:!0,onConfirm:()=>{H(o)},onCancel:()=>{}},null,8,["message","onConfirm"])])])]))),128)),O.value.length===0?(u(),d("tr",Ee,[t("td",De,p(f.value.trim()?"No tags found matching your search.":"No tags found."),1)])):F("",!0)],64))])])]),!k.value&&g.value.last_page>1?(u(),d("div",Pe,[t("div",Ne," Showing "+p(g.value.from)+" to "+p(g.value.to)+" of "+p(g.value.total)+" entries ",1),y(le,{pagination:g.value.links,isApiDriven:!0,onPageChanged:W},null,8,["pagination"])])):F("",!0)])]),t("div",Ve,[t("div",Le,[t("div",Ie,[t("div",$e,[t("h5",je,p(b.value?"Edit Tag":"Add Tag"),1),e[13]||(e[13]=t("button",{class:"absolute top-2 right-2 p-2 rounded-full hover:bg-gray-100 transition transform hover:scale-110","data-bs-dismiss":"modal","aria-label":"Close",title:"Close"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})])],-1))]),t("div",Oe,[b.value?(u(),d("div",Ae,[e[14]||(e[14]=t("label",{class:"form-label"},"Tag Name",-1)),L(t("input",{"onUpdate:modelValue":e[5]||(e[5]=o=>v.value=o),class:M(["form-control",{"is-invalid":n.value.customTag}]),placeholder:"e.g., Vegan"},null,2),[[I,v.value]]),n.value.customTag?(u(),d("span",Re,p(n.value.customTag[0]),1)):F("",!0)])):(u(),d("div",Me,[e[15]||(e[15]=t("label",{class:"form-label"},"Tag Name",-1)),L(t("input",{"onUpdate:modelValue":e[6]||(e[6]=o=>v.value=o),class:M(["form-control",{"is-invalid":n.value.customTag}]),placeholder:"Enter tag name"},null,2),[[I,v.value]]),n.value.customTag?(u(),d("span",Be,p(n.value.customTag[0]),1)):F("",!0)])),t("div",ze,[t("button",{class:"btn btn-primary rounded-pill py-2 btn-sm w-100 mt-4",disabled:S.value,onClick:q},[S.value?(u(),d(T,{key:0},[e[16]||(e[16]=t("span",{class:"spinner-border spinner-border-sm me-2"},null,-1)),e[17]||(e[17]=$(" Saving... ",-1))],64)):(u(),d(T,{key:1},[$(p((b.value,"Save")),1)],64))],8,Ue)])])])])])],64))}},Qe=ee(Xe,[["__scopeId","data-v-2f10f4d3"]]);export{Qe as default};
