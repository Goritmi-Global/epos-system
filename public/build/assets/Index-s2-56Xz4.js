import{_ as Ke,r as b,D as h,k as le,p as Xe,I as We,j as Qe,E as Je,c as X,o as c,w as se,b as t,g as p,F as N,v as L,t as i,n as x,C as Ye,a as M,x as A,y as V,f as ne,d as k,i as _,S as _e,U as et,m,X as tt}from"./app-COVoaSpv.js";import{_ as at}from"./Master-CU8Kbb5A.js";import{s as re}from"./index-CcYqNmWE.js";import{s as we}from"./index-CRdBSNBG.js";import{E as ot,a as lt,X as st,u as q,w as nt}from"./xlsx-DJLHTQQj.js";import{u as rt}from"./useFormatters-BC277QyT.js";import{F as it}from"./FilterModal-TUcCt8rr.js";import{I as dt}from"./importFile-CDTRveMr.js";import{P as ut}from"./package-Drfq-FVC.js";import{C as ct}from"./circle-check-big-BYPVIkCb.js";import{C as pt}from"./circle-x-58lGbV50.js";import{P as mt}from"./plus-Cb5BFGxI.js";import{P as vt}from"./pencil-DHZ4m_sc.js";import"./index-BQbxzkdq.js";import"./sun-DqfGktyu.js";import"./index-DHNrrZoT.js";const gt={class:"page-wrapper"},bt={class:"row g-3"},ft={class:"card border-0 shadow-sm rounded-4"},yt={class:"card-body d-flex align-items-center justify-content-between"},ht={class:"fw-bold fs-4"},_t={class:"text-muted fs-6"},wt={class:"card border-0 shadow-lg rounded-4 mt-0"},xt={class:"card-body"},Ct={class:"d-flex flex-wrap gap-2 justify-content-between align-items-center mb-3"},It={class:"d-flex flex-wrap gap-2 align-items-center"},kt={class:"search-wrap"},Mt={key:1,class:"form-control search-input",placeholder:"Search",disabled:"",type:"text"},St={class:"dropdown"},Pt={class:"dropdown"},$t={class:"dropdown-menu dropdown-menu-end shadow rounded-4 py-2"},Ft={class:"table-responsive"},Nt={class:"table table-hover"},At={class:"fw-semibold"},Vt={class:"text-truncate",style:{"max-width":"260px"}},Et={key:0,class:"badge bg-red-600 rounded-pill d-inline-block text-center px-3 py-1"},Ut={key:1,class:"badge bg-success rounded-pill d-inline-block text-center px-3 py-1"},Dt={class:"text-center"},jt={class:"d-inline-flex align-items-center gap-3"},Tt=["onClick"],Bt=["title"],Lt={key:0},qt={class:"modal fade",id:"addItemModal",tabindex:"-1","aria-hidden":"true"},Ot={class:"modal-dialog modal-lg modal-dialog-centered",role:"document"},Rt={class:"modal-content rounded-4"},zt={class:"modal-header"},Gt={class:"modal-title fw-semibold"},Ht={class:"modal-body"},Zt={class:"row g-3"},Kt={class:"col-md-6"},Xt={key:0,class:"text-danger"},Wt={class:"col-md-6"},Qt={key:0,class:"text-danger"},Jt={class:"col-md-6"},Yt={key:0,class:"text-danger"},ea={class:"col-md-6"},ta={key:0,class:"text-danger"},aa={key:0,class:"col-md-6"},oa={key:0,class:"text-danger"},la={class:"col-12"},sa={key:0,class:"text-danger"},na={class:"row g-4 mt-1"},ra={class:"col-md-6"},ia={key:0,class:"text-danger"},da={class:"col-md-6"},ua={key:0,class:"text-danger"},ca={class:"row g-3 mt-2 align-items-center"},pa={class:"col-md-4"},ma=["src"],va={key:1,class:"placeholder"},ga={class:"mt-4 col-sm-6 col-md-8"},ba={key:0,class:"text-danger d-block mt-1"},fa={key:1,class:"mt-3"},ya={class:"card border rounded-4 mb-3"},ha={class:"p-3 fw-semibold"},_a={class:"d-flex flex-wrap gap-2"},wa={class:"badge bg-primary px-3 py-2 rounded-pill"},xa={class:"badge bg-success px-3 py-2 rounded-pill"},Ca={class:"badge bg-warning text-dark px-3 py-2 rounded-pill"},Ia={class:"badge bg-danger px-3 py-2 rounded-pill"},ka={class:"card border rounded-4"},Ma={class:"table-responsive"},Sa={class:"table align-middle mb-0"},Pa={class:"p-3 fw-semibold text-end"},$a={class:"mt-4"},Fa=["disabled"],Na={class:"modal fade",id:"addIngredientModal",tabindex:"-1","aria-hidden":"true"},Aa={class:"modal-dialog modal-xl modal-dialog-centered"},Va={class:"modal-content rounded-4"},Ea={class:"modal-header"},Ua={class:"modal-title fw-semibold"},Da={class:"modal-body"},ja={class:"row g-4"},Ta={class:"col-lg-5"},Ba={class:"search-wrap mb-2"},La={class:"card-body"},qa={class:"d-flex align-items-start gap-3"},Oa=["src"],Ra={class:"flex-grow-1"},za={class:"fw-semibold"},Ga={class:"text-muted small"},Ha={class:"text-muted small"},Za={class:"small mt-2 text-muted"},Ka=["onClick"],Xa={class:"row g-2 mt-3"},Wa={class:"col-4"},Qa=["onUpdate:modelValue"],Ja={key:0,class:"text-danger"},Ya={class:"col-4"},eo=["onUpdate:modelValue"],to={key:0,class:"text-danger"},ao={class:"col-lg-7"},oo={class:"card border rounded-4 mb-3"},lo={class:"p-3 fw-semibold"},so={class:"card border rounded-4"},no={class:"table-responsive"},ro={class:"table align-middle mb-0"},io={class:"text-end"},uo=["onClick"],co={key:0},po={class:"p-3 fw-semibold text-end"},mo={__name:"Index",props:{allergies:{type:Array},tags:{type:Array},categories:{type:Array}},setup(O){const{formatCurrencySymbol:j}=rt(),ie=O,xe=[{name:"Meat",value:"#E74C3C"},{name:"Vegetables",value:"#27AE60"},{name:"Seafood",value:"#2980B9"},{name:"Drinks",value:"#8E44AD"},{name:"Staples",value:"#E67E22"}],W=b([]);b(!1),b(null);const Q=b(""),f=b([]),Ce=async()=>{try{const o=await axios.get("/inventory/api-inventories");W.value=o.data.data}catch(o){console.error("Error fetching inventory:",o)}},de=h(()=>{const o=Q.value.trim().toLowerCase();return o?W.value.filter(e=>[e.name,e.category??"",e.subcategory??""].join(" ").toLowerCase().includes(o)):W.value});function J(o){return Math.round(o*100)/100}const Y=h(()=>J(f.value.reduce((o,e)=>o+Number(e.cost||0),0)));function Ie(o){const e=Number(o.qty||0),l=o.unitPrice!==""&&o.unitPrice!=null?Number(o.unitPrice):Number(o.defaultPrice||0);if(d.value[o.id]={},(!e||e<=0)&&(d.value[o.id].qty="Enter a valid quantity."),(!l||l<=0)&&(d.value[o.id].unitPrice="Enter a valid unit price."),Object.keys(d.value[o.id]).length>0){const r=Object.values(d.value[o.id]).join(`
`);m.error(r,{style:{whiteSpace:"pre-line"}});return}const a=f.value.find(r=>r.id===o.id);a?(a.qty=e,a.unitPrice=l,a.cost=J(e*l)):f.value.push({id:o.id,name:o.name,category:o.category,qty:e,unitPrice:l,cost:J(e*l),nutrition:o.nutrition||{calories:0,protein:0,carbs:0,fat:0}}),D.value||(o.qty=null,o.unitPrice=null)}function ke(o){const e=f.value[o];if(!e)return;f.value.splice(o,1);const l=he.value.find(a=>a.id===e.id);l&&(l.qty=null,l.unitPrice=null,l.cost=null)}const C=h(()=>f.value.reduce((o,e)=>{const l=Number(e.qty)||0;return o.calories+=Number(e.nutrition?.calories||0)*l,o.protein+=Number(e.nutrition?.protein||0)*l,o.carbs+=Number(e.nutrition?.carbs||0)*l,o.fat+=Number(e.nutrition?.fat||0)*l,o},{calories:0,protein:0,carbs:0,fat:0}));function Me(){ye(),n.ingredients=[...f.value],bootstrap.Modal.getInstance(document.getElementById("addIngredientModal")).hide(),new bootstrap.Modal(document.getElementById("addItemModal")).show()}const Se=()=>{new bootstrap.Modal(document.getElementById("addItemModal")).show()};le(async()=>{E.value="",pe.value=Date.now(),await Xe(),setTimeout(()=>{me.value=!0;const o=document.getElementById(ee);o&&(o.value="",E.value="")},100),Ce()});const ue=b(ie.inventories?.data||[]),R=h(()=>ue.value),ce=async()=>{try{const e=(await axios.get("inventory/api-inventories")).data.data||[];ue.value=await Promise.all(e.map(async l=>{const r=(await axios.get(`/stock_entries/total/${l.id}`)).data.total?.original||{};return{...l,availableStock:r.available||0,stockValue:r.stockValue||0,minAlert:r.minAlert||0}}))}catch(o){console.error(o)}},S=b([]),T=async()=>{try{const o=await axios.get("/api/menu/items");S.value=o.data.data||[]}catch(o){console.error("❌ Error fetching menus:",o)}};le(()=>{ce(),T()});const E=b(""),pe=b(Date.now()),ee=`search-${Math.random().toString(36).substr(2,9)}`,me=b(!1),ve={sortBy:"",category:"",status:"",priceMin:null,priceMax:null,dateFrom:"",dateTo:""},w=b({...ve}),Pe=h(()=>{let o=[...S.value];const e=E.value.trim().toLowerCase();return e&&(o=o.filter(l=>[l.name,l.category?.name,l.description].some(a=>(a||"").toLowerCase().includes(e)))),w.value.category&&(o=o.filter(l=>(typeof l.category=="object"?l.category.id:l.category_id)==w.value.category)),w.value.status!==""&&(o=o.filter(l=>l.status==w.value.status)),(w.value.priceMin!==null||w.value.priceMax!==null)&&(o=o.filter(l=>{const a=l.price||0,r=w.value.priceMin||0,g=w.value.priceMax||1/0;return a>=r&&a<=g})),w.value.dateFrom&&(o=o.filter(l=>{const a=new Date(l.created_at),r=new Date(w.value.dateFrom);return a>=r})),w.value.dateTo&&(o=o.filter(l=>{const a=new Date(l.created_at),r=new Date(w.value.dateTo);return a<=r})),o}),ge=h(()=>{const o=[...Pe.value];switch(w.value.sortBy){case"price_desc":return o.sort((l,a)=>(a.price||0)-(l.price||0));case"price_asc":return o.sort((l,a)=>(l.price||0)-(a.price||0));case"name_asc":return o.sort((l,a)=>(l.name||"").localeCompare(a.name||""));case"name_desc":return o.sort((l,a)=>(a.name||"").localeCompare(l.name||""));default:return o}}),te=h(()=>({sortOptions:[{value:"price_desc",label:"Price: High to Low"},{value:"price_asc",label:"Price: Low to High"},{value:"name_asc",label:"Name: A to Z"},{value:"name_desc",label:"Name: Z to A"}],categories:ie.categories||[],statusOptions:[{value:1,label:"Active"},{value:0,label:"Inactive"}]})),$e=o=>{console.log("Filters applied:",o)},Fe=()=>{w.value={...ve}};h(()=>new Set(R.value.map(o=>o.category)).size),h(()=>R.value.length);const Ne=h(()=>S.value.length),Ae=h(()=>S.value.filter(o=>o.status===1).length),Ve=h(()=>S.value.filter(o=>o.status===0).length);h(()=>R.value.filter(o=>o.availableStock>0&&o.availableStock<(o.minAlert||5)).length),h(()=>R.value.filter(o=>o.availableStock<=0).length);const Ee=h(()=>[{label:"Total Menus",value:Ne.value??0,icon:ut,iconBg:"bg-soft-success",iconColor:"text-success"},{label:"Active Menus",value:Ae.value??0,icon:ct,iconBg:"bg-soft-danger",iconColor:"text-success"},{label:"Inactive Menus",value:Ve.value??0,icon:pt,iconBg:"bg-soft-warning",iconColor:"text-danger"}]);le(()=>window.feather?.replace()),We(()=>window.feather?.replace());const be=b({Poultry:["Chicken","Broiler","Wings","Breast"],Produce:["Tomatoes","Onions","Potatoes"],Grains:["Rice","Wheat","Oats"],Grocery:["Oil","Spices","Sugar"],Meat:["Beef","Mutton","Veal"]}),fe=h(()=>(be.value[n.value.category]||[]).map(o=>({name:o,value:o})));h(()=>Object.keys(be.value).map(o=>({name:o,value:o})));const d=b({});function ye(){d.value={}}const n=b({name:"",category_id:null,label_color:null,subcategory:"",unit:[],price:"",supplier:[],sku:"",description:"",nutrition:{calories:"",fat:"",protein:"",carbs:""},allergies:[],tags:[],imageFile:null,imageUrl:null}),z=b(!1),B=b(!1),G=b(null);function Ue(o){G.value=n.value.imageUrl,G.value&&(B.value=!0)}function De({file:o}){n.value.imageFile=o,n.value.imageUrl=URL.createObjectURL(o)}const U=b(!1),je=async()=>{U.value=!0,d.value={};const o=new FormData;o.append("name",n.value.name.trim()),n.value.price!==""&&n.value.price!==null&&o.append("price",n.value.price),n.value.category_id&&o.append("category_id",n.value.category_id),n.value.label_color&&o.append("label_color",n.value.label_color),n.value.subcategory_id&&o.append("subcategory_id",n.value.subcategory_id),o.append("description",n.value.description||""),o.append("nutrition[calories]",C.value.calories),o.append("nutrition[fat]",C.value.fat),o.append("nutrition[protein]",C.value.protein),o.append("nutrition[carbs]",C.value.carbs),n.value.allergies.forEach((e,l)=>o.append(`allergies[${l}]`,e)),n.value.tags.forEach((e,l)=>o.append(`tags[${l}]`,e)),f.value.forEach((e,l)=>{o.append(`ingredients[${l}][inventory_item_id]`,e.id),o.append(`ingredients[${l}][qty]`,e.qty),o.append(`ingredients[${l}][unit_price]`,e.unitPrice),o.append(`ingredients[${l}][cost]`,e.cost)}),n.value.imageFile&&o.append("image",n.value.imageFile);try{n.value.id?(await axios.post(`/menu/${n.value.id}?_method=PUT`,o,{headers:{"Content-Type":"multipart/form-data"}}),m.success("Menu updated successfully")):(await axios.post("/menu",o,{headers:{"Content-Type":"multipart/form-data"}}),m.success("Menu created successfully")),H(),await T(),bootstrap.Modal.getInstance(document.getElementById("addItemModal"))?.hide()}catch(e){e?.response?.status===422&&e.response.data?.errors?(d.value=e.response.data.errors,Object.values(e.response.data.errors).flat().join(`
`),m.error("Please filled all the required fields")):(console.error("❌ Error saving:",e.response?.data||e.message),m.error("Failed to save menu item"))}finally{U.value=!1}};Qe(n,o=>{Object.keys(d.value).forEach(e=>{if(e.includes(".")){const[l,a]=e.split(".");o[l]&&o[l][a]!==""&&delete d.value[e]}else{const l=o[e];l!=null&&l!==""&&(!Array.isArray(l)||l.length>0)&&delete d.value[e]}})},{deep:!0});const Te=b({calories:0,protein:0,carbs:0,fat:0}),D=b(!1),he=h(()=>de.value.map(o=>{const e=f.value.find(l=>l.id===o.id);return e?{...o,qty:e.qty,unitPrice:e.unitPrice,cost:e.cost}:{...o,qty:0,unitPrice:0,cost:0}})),Be=o=>{n.value.imageUrl&&n.value.imageUrl.startsWith("blob:")&&URL.revokeObjectURL(n.value.imageUrl),D.value=!0;const e=tt(o);console.log(e),n.value={id:e.id,name:e.name,price:e.price,category_id:e.category?.id||null,description:e.description,label_color:e.label_color,ingredients:e.ingredients||[],allergies:e.allergies?.map(a=>a.id)||[],tags:e.tags?.map(a=>a.id)||[],imageFile:null,imageUrl:e.image_url||null},Te.value={calories:parseFloat(e.nutrition?.calories||0),protein:parseFloat(e.nutrition?.protein||0),carbs:parseFloat(e.nutrition?.carbs||0),fat:parseFloat(e.nutrition?.fat||0)},f.value=(e.ingredients||[]).map(a=>{const r=parseFloat(a.quantity||a.qty||0),g=parseFloat(a.cost||0),I=r>0?g/r:0,s=de.value.find(u=>u.id===(a.inventory_item_id||a.id||a.product_id));return{id:a.inventory_item_id||a.id||a.product_id,image_url:s?.image_url||"—",name:a.product_name||a.name||s?.name||"—",category:s?.category||a.category||{name:""},unit:s?.unit||a.unit||"",qty:r,unitPrice:I,cost:g,nutrition:a.nutrition?typeof a.nutrition=="string"?JSON.parse(a.nutrition):a.nutrition:s?.nutrition||{calories:0,protein:0,carbs:0,fat:0}}}),console.log("Hydrated cart with details:",f.value),new bootstrap.Modal(document.getElementById("addItemModal")).show()},Le=async()=>{U.value=!0,d.value={};try{const o=f.value.reduce((a,r)=>{const g=Number(r.qty||0);return a.calories+=Number(r.nutrition?.calories||0)*g,a.protein+=Number(r.nutrition?.protein||0)*g,a.carbs+=Number(r.nutrition?.carbs||0)*g,a.fat+=Number(r.nutrition?.fat||0)*g,a},{calories:0,protein:0,carbs:0,fat:0}),e=new FormData;e.append("name",n.value.name.trim()),e.append("price",n.value.price||0),n.value.category_id&&e.append("category_id",n.value.category_id),e.append("description",n.value.description||""),e.append("label_color",n.value.label_color||""),e.append("nutrition[calories]",o.calories),e.append("nutrition[fat]",o.fat),e.append("nutrition[protein]",o.protein),e.append("nutrition[carbs]",o.carbs),n.value.allergies.forEach((a,r)=>e.append(`allergies[${r}]`,a)),n.value.tags.forEach((a,r)=>e.append(`tags[${r}]`,a)),f.value.forEach((a,r)=>{e.append(`ingredients[${r}][inventory_item_id]`,a.id),e.append(`ingredients[${r}][qty]`,a.qty),e.append(`ingredients[${r}][unit_price]`,a.unitPrice),e.append(`ingredients[${r}][cost]`,a.cost)}),n.value.imageFile&&e.append("image",n.value.imageFile),e.append("_method","PUT"),await axios.post(`/menu/${n.value.id}`,e,{headers:{"Content-Type":"multipart/form-data"}}),m.success("Menu updated successfully"),H(),await T(),bootstrap.Modal.getInstance(document.getElementById("addItemModal"))?.hide()}catch(o){if(o?.response?.status===422&&o.response.data?.errors){d.value=o.response.data.errors;const e=Object.values(o.response.data.errors).flat().join(`
`);m.error(e)}else console.error("❌ Update failed:",o.response?.data||o.message),m.error("Failed to update menu item")}finally{U.value=!1}},qe=async o=>{try{const e=o.status===1?0:1;await axios.patch(`/menu/${o.id}/status`,{status:e}),m.success(`Menu item is now ${e===1?"Active":"Inactive"}`),await T()}catch(e){console.error("Failed to toggle status",e),m.error("Failed to update status")}};function H(){n.value.imageUrl&&n.value.imageUrl.startsWith("blob:")&&URL.revokeObjectURL(n.value.imageUrl),n.value={name:"",category:"Poultry",subcategory:"",unit:"gram (g)",minAlert:"",supplier:"Noor",sku:"",description:"",label_color:"",nutrition:{calories:"",fat:"",protein:"",carbs:""},allergies:[],tags:[],imageFile:null,imageUrl:null},z.value=!1,B.value=!1,G.value=null,d.value={},D.value=null,f.value=[],Y.value=0,C.value={calories:0,protein:0,carbs:0,fat:0}}const ae=o=>{if(!S.value||S.value.length===0){m.error("No Allergies data to download");return}const e=E.value.trim()?filtered.value:S.value;if(e.length===0){m.error("No Inventory Item found to download");return}try{o==="pdf"?Re(e):o==="excel"?ze(e):o==="csv"?Oe(e):m.error("Invalid download type")}catch(l){console.error("Download failed:",l),m.error(`Download failed: ${l.message}`)}},Oe=o=>{console.log("menu Items",o);try{const e=["Item Name","Category","Description","Price","Nutrition","Allergies","Tags"],l=o.map(s=>{let u="";s.nutrition&&typeof s.nutrition=="object"?u=["calories","protein","fat","carbs"].map(F=>s.nutrition[F]!==void 0?`${F}: ${s.nutrition[F]}`:null).filter(Boolean).join("; "):typeof s.nutrition=="string"&&(u=s.nutrition);const y=typeof s.category=="object"?s.category?.name||"":s.category||"",P=Array.isArray(s.allergies)?s.allergies.map(v=>v.name||v).join(", "):s.allergies||"",$=Array.isArray(s.tags)?s.tags.map(v=>v.name||v).join(", "):s.tags||"";return[`"${s.name||""}"`,`"${y}"`,`"${s.description||""}"`,`"${s.price||""}"`,`"${u}"`,`"${P}"`,`"${$}"`]}),a=[e.join(","),...l.map(s=>s.join(","))].join(`
`),r=new Blob([a],{type:"text/csv;charset=utf-8;"}),g=URL.createObjectURL(r),I=document.createElement("a");I.setAttribute("href",g),I.setAttribute("download",`menu_items_${new Date().toISOString().split("T")[0]}.csv`),document.body.appendChild(I),I.click(),document.body.removeChild(I),m.success("CSV downloaded successfully ",{autoClose:2500})}catch(e){console.error("CSV generation error:",e),m.error(`CSV generation failed: ${e.message}`,{autoClose:5e3})}},Re=o=>{try{const e=new ot("p","mm","a4");e.setFontSize(18),e.setFont("helvetica","bold"),e.text("Menu Items Report",65,20),e.setFontSize(10),e.setFont("helvetica","normal");const l=new Date().toLocaleString();e.text(`Generated on: ${l}`,14,28),e.text(`Total Menu Items: ${o.length}`,14,34);const a=["Item Name","Category","Description","Price","Nutrition","Allergies","Tags"],r=s=>{if(!s)return"";if(typeof s=="string")try{s=JSON.parse(s)}catch{return s}return typeof s=="object"?["calories","protein","fat","carbs"].map(y=>s[y]!==void 0?`${y}: ${s[y]}`:null).filter(Boolean).join("; "):String(s??"")},g=o.map(s=>{const u=typeof s.category=="object"?s.category?.name||"":s.category||"",y=Array.isArray(s.allergies)?s.allergies.map(v=>v.name||v).join(", "):s.allergies||"",P=Array.isArray(s.tags)?s.tags.map(v=>v.name||v).join(", "):s.tags||"",$=r(s.nutrition);return[s.name||"",u,s.description||"",s.price||"",$,y,P]});lt(e,{head:[a],body:g,startY:40,styles:{fontSize:8,cellPadding:2,halign:"left",lineColor:[0,0,0],lineWidth:.1},headStyles:{fillColor:[41,128,185],textColor:255,fontStyle:"bold"},alternateRowStyles:{fillColor:[245,245,245]},margin:{left:14,right:14},didDrawPage:s=>{const u=e.internal.getNumberOfPages(),y=e.internal.pageSize.height;e.setFontSize(8),e.text(`Page ${s.pageNumber} of ${u}`,s.settings.margin.left,y-10)}});const I=`menu_items_${new Date().toISOString().split("T")[0]}.pdf`;e.save(I),m.success("PDF downloaded successfully",{autoClose:2500})}catch(e){console.error("PDF generation error:",e),m.error(`PDF generation failed: ${e.message}`,{autoClose:5e3})}},ze=o=>{try{if(typeof st>"u")throw new Error("XLSX library is not loaded");const e=o.map(s=>{let u="";s.nutrition&&typeof s.nutrition=="object"?u=["calories","protein","fat","carbs"].map(F=>s.nutrition[F]!==void 0?`${F}: ${s.nutrition[F]}`:null).filter(Boolean).join("; "):typeof s.nutrition=="string"&&(u=s.nutrition);const y=typeof s.category=="object"?s.category?.name||"":s.category||"",P=Array.isArray(s.allergies)?s.allergies.map(v=>v.name||v).join(", "):s.allergies||"",$=Array.isArray(s.tags)?s.tags.map(v=>v.name||v).join(", "):s.tags||"";return{"Item Name":s.name||"",Category:y,Description:s.description||"",Price:s.price||"",Nutrition:u,Allergies:P,Tags:$}}),l=q.book_new(),a=q.json_to_sheet(e);a["!cols"]=[{wch:20},{wch:20},{wch:30},{wch:10},{wch:30},{wch:25},{wch:25}],q.book_append_sheet(l,a,"Menu Items");const r=[{Info:"Generated On",Value:new Date().toLocaleString()},{Info:"Total Menu Items",Value:o.length},{Info:"Exported By",Value:"Menu Management System"}],g=q.json_to_sheet(r);q.book_append_sheet(l,g,"Report Info");const I=`menu_items_${new Date().toISOString().split("T")[0]}.xlsx`;nt(l,I),m.success("Excel file downloaded successfully",{autoClose:2500})}catch(e){console.error("Excel generation error:",e),m.error(`Excel generation failed: ${e.message}`,{autoClose:5e3})}},Ge=o=>{if(!o||o.length<=1){m.error("The imported file is empty.");return}const e=o[0];console.log("headers are ",e);const l=o.slice(1);console.log("rows data",l);const a=l.map(u=>{let y=0,P=0,$=0,v=0;return u[4]&&u[4].split(";").map(oe=>oe.trim()).forEach(oe=>{const[Z,He]=oe.split(":").map(Ze=>Ze.trim()),K=parseFloat(He)||0;Z==="calories"?y=K:Z==="protein"?P=K:Z==="fat"?$=K:Z==="carbs"&&(v=K)}),{name:u[0]||"",category:u[1]||"",description:u[2]||"",price:parseFloat(u[3])||0,calories:y,protein:P,fat:$,carbs:v,allergies:u[5]?u[5].trim():"",tags:u[6]?u[6].trim():"",active:1}});console.log("Items to import:",a);const r=a.map(u=>u.name.trim().toLowerCase()),g=r.filter((u,y)=>r.indexOf(u)!==y);if(g.length>0){m.error(`Duplicate item names found in CSV: ${[...new Set(g)].join(", ")}`);return}const I=S.value.map(u=>u.name.trim().toLowerCase()),s=a.filter(u=>I.includes(u.name.trim().toLowerCase()));if(s.length>0){const u=s.map(y=>y.name).join(", ");m.error(`Menu items already exist in the table: ${u}`);return}axios.post("/api/menu/menu_items/import",{items:a}).then(()=>{m.success("Items imported successfully"),ce(),T()}).catch(u=>{console.error(u),m.error("Import failed")})};return(o,e)=>{const l=Je("ConfirmModal");return c(),X(at,null,{default:se(()=>[t("div",gt,[e[51]||(e[51]=t("h4",{class:"mb-3"},"Menus",-1)),t("div",bt,[(c(!0),p(N,null,L(Ee.value,a=>(c(),p("div",{key:a.label,class:"col-md-6 col-xl-4"},[t("div",ft,[t("div",yt,[t("div",null,[t("div",ht,i(a.value),1),t("div",_t,i(a.label),1)]),t("div",{class:x(["icon-chip",a.iconBg])},[(c(),X(Ye(a.icon),{class:x(a.iconColor),size:"26"},null,8,["class"]))],2)])])]))),128))]),t("div",wt,[t("div",xt,[t("div",Ct,[e[25]||(e[25]=t("h4",{class:"mb-0"},"Menu",-1)),t("div",It,[t("div",kt,[e[20]||(e[20]=t("i",{class:"bi bi-search"},null,-1)),e[21]||(e[21]=t("input",{type:"email",name:"email",autocomplete:"email",style:{position:"absolute",left:"-9999px",width:"1px",height:"1px"},tabindex:"-1","aria-hidden":"true"},null,-1)),me.value?A((c(),p("input",{id:ee,"onUpdate:modelValue":e[0]||(e[0]=a=>E.value=a),key:pe.value,class:"form-control search-input",placeholder:"Search",type:"search",autocomplete:"new-password",name:ee,role:"presentation",onFocus:e[1]||(e[1]=(...a)=>o.handleFocus&&o.handleFocus(...a))},null,32)),[[V,E.value]]):(c(),p("input",Mt))]),t("div",St,[M(it,{modelValue:w.value,"onUpdate:modelValue":e[2]||(e[2]=a=>w.value=a),title:"Menu Items","modal-id":"menuFilterModal","modal-size":"modal-lg",categories:te.value.categories,"sort-options":te.value.sortOptions,"status-options":te.value.statusOptions,"show-price-range":!0,"show-date-range":!0,onApply:$e,onClear:Fe},{customFilters:se(({filters:a})=>[...e[22]||(e[22]=[])]),_:1},8,["modelValue","categories","sort-options","status-options"])]),t("button",{"data-bs-toggle":"modal",onClick:ye,"data-bs-target":"#addItemModal",class:"d-flex align-items-center gap-1 px-4 btn-sm py-2 rounded-pill btn btn-primary text-white"},[M(k(mt),{class:"w-4 h-4"}),e[23]||(e[23]=ne(" Add Menu ",-1))]),M(dt,{label:"Import",sampleHeaders:["Item Name","Category","Description","price","Nutrition","Allergies","Tags"],sampleData:[["Chicken","Spices & Herbs","Test","100","calories: 99.00; protein: 69.00; fat: 132.00; carbs: 93.00","Gluten","Gluten-Free"],["Aalo","Spices & Herbs","xzc","100","calories: 66.00; protein: 46.00; fat: 88.00; carbs: 62.00","Gluten","Gluten-Free"]],onOnImport:Ge}),t("div",Pt,[e[24]||(e[24]=t("button",{class:"btn btn-outline-secondary btn-sm rounded-pill py-2 px-4 dropdown-toggle","data-bs-toggle":"dropdown"}," Export ",-1)),t("ul",$t,[t("li",null,[t("a",{class:"dropdown-item py-2",href:"javascript:;",onClick:e[3]||(e[3]=a=>ae("pdf"))},"Export as PDF")]),t("li",null,[t("a",{class:"dropdown-item py-2",href:"javascript:;",onClick:e[4]||(e[4]=a=>ae("excel"))},"Export as Excel")]),t("li",null,[t("a",{class:"dropdown-item py-2",href:"javascript:;",onClick:e[5]||(e[5]=a=>ae("csv"))}," Export as CSV ")])])])])]),t("div",Ft,[t("table",Nt,[e[27]||(e[27]=t("thead",{class:"border-top small text-muted"},[t("tr",null,[t("th",null,"S.#"),t("th",null,"Image"),t("th",null,"Menu Name"),t("th",null,"Category"),t("th",null,"Price"),t("th",null,"Status"),t("th",{class:"text-center"},"Action")])],-1)),t("tbody",null,[(c(!0),p(N,null,L(ge.value,(a,r)=>(c(),p("tr",{key:a.id},[t("td",null,i(r+1),1),t("td",null,[a.image_url?(c(),X(_e,{key:0,file:a.image_url,alt:a.name,width:50,height:50,custom_class:"cursor-pointer"},null,8,["file","alt"])):_("",!0)]),t("td",At,i(a.name),1),t("td",Vt,i(a.category?.name||"—"),1),t("td",null,i(k(j)(a.price||0,"GBP")),1),t("td",null,[a.status===0?(c(),p("span",Et,"Inactive")):(c(),p("span",Ut,"Active"))]),t("td",Dt,[t("div",jt,[t("button",{onClick:g=>Be(a),"data-bs-toggle":"modal",title:"Edit",class:"p-2 rounded-full text-blue-600 hover:bg-blue-100"},[M(k(vt),{class:"w-4 h-4"})],8,Tt),M(l,{title:"Confirm Status Change",message:`Are you sure you want to ${a.status===1?"deactivate":"activate"} this item?`,showStatusButton:!0,status:a.status===1?"active":"inactive",onConfirm:()=>qe(a)},{trigger:se(()=>[t("button",{class:x(["relative inline-flex items-center w-8 h-4 rounded-full transition-colors duration-300 focus:outline-none",a.status===1?"bg-green-500 hover:bg-green-600":"bg-red-400 hover:bg-red-500"]),title:a.status===1?"Set Inactive":"Set Active"},[t("span",{class:x(["absolute left-0.5 top-0.5 w-3 h-3 bg-white rounded-full shadow transform transition-transform duration-300",a.status===1?"translate-x-4":"translate-x-0"])},null,2)],10,Bt)]),_:2},1032,["message","status","onConfirm"])])])]))),128)),ge.value.length===0?(c(),p("tr",Lt,[...e[26]||(e[26]=[t("td",{colspan:"7",class:"text-center text-muted py-4"}," No Menu items found. ",-1)])])):_("",!0)])])])])]),t("div",qt,[t("div",Ot,[t("div",Rt,[t("div",zt,[t("h5",Gt,i(D.value==!0?"Edit Menu":"Add Menu"),1),t("button",{onClick:H,class:"absolute top-2 right-2 p-2 rounded-full hover:bg-gray-100 transition transform hover:scale-110","data-bs-dismiss":"modal","aria-label":"Close",title:"Close"},[...e[28]||(e[28]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),t("div",Ht,[t("div",Zt,[t("div",Kt,[e[29]||(e[29]=t("label",{class:"form-label"},"Menu Name",-1)),A(t("input",{"onUpdate:modelValue":e[6]||(e[6]=a=>n.value.name=a),type:"text",class:x(["form-control",{"is-invalid":d.value.name}]),placeholder:"e.g., Chicken Breast"},null,2),[[V,n.value.name]]),d.value.name?(c(),p("small",Xt,i(d.value.name[0]),1)):_("",!0)]),t("div",Wt,[e[30]||(e[30]=t("label",{class:"form-label d-block"},"Base Price",-1)),A(t("input",{"onUpdate:modelValue":e[7]||(e[7]=a=>n.value.price=a),type:"number",min:"0",class:x(["form-control",{"is-invalid":d.value.price}]),placeholder:"e.g., 0.00"},null,2),[[V,n.value.price]]),d.value.price?(c(),p("small",Qt,i(d.value.price[0]),1)):_("",!0)]),t("div",Jt,[e[31]||(e[31]=t("label",{class:"form-label d-block"}," Label Color ",-1)),M(k(re),{modelValue:n.value.label_color,"onUpdate:modelValue":e[8]||(e[8]=a=>n.value.label_color=a),options:xe,optionLabel:"name",optionValue:"value",placeholder:"Select Label Color",class:x(["w-100",{"is-invalid":d.value.label_color}]),appendTo:"self",autoZIndex:!0,baseZIndex:2e3},null,8,["modelValue","class"]),e[32]||(e[32]=t("br",null,null,-1)),d.value.label_color?(c(),p("small",Yt,i(d.value.label_color[0]),1)):_("",!0)]),t("div",ea,[e[33]||(e[33]=t("label",{class:"form-label"},"Category",-1)),M(k(re),{modelValue:n.value.category_id,"onUpdate:modelValue":[e[9]||(e[9]=a=>n.value.category_id=a),e[10]||(e[10]=a=>n.value.subcategory="")],options:O.categories,optionLabel:"name",optionValue:"id",placeholder:"Select Category",class:x(["w-100",{"is-invalid":d.value.category_id}]),appendTo:"self",autoZIndex:!0,baseZIndex:2e3},null,8,["modelValue","options","class"]),d.value.category_id?(c(),p("small",ta,i(d.value.category_id[0]),1)):_("",!0)]),fe.value.length?(c(),p("div",aa,[e[34]||(e[34]=t("label",{class:"form-label"},"Subcategory",-1)),M(k(re),{modelValue:n.value.subcategory,"onUpdate:modelValue":e[11]||(e[11]=a=>n.value.subcategory=a),options:fe.value,optionLabel:"name",optionValue:"value",placeholder:"Select Subcategory",class:x(["w-100",{"is-invalid":d.value.subcategory}]),appendTo:o.body,autoZIndex:!0,baseZIndex:2e3},null,8,["modelValue","options","appendTo","class"]),d.value.subcategory?(c(),p("small",oa,i(d.value.subcategory[0]),1)):_("",!0)])):_("",!0),t("div",la,[e[35]||(e[35]=t("label",{class:"form-label"},"Description",-1)),A(t("textarea",{"onUpdate:modelValue":e[12]||(e[12]=a=>n.value.description=a),rows:"4",class:x(["form-control",{"is-invalid":d.value.description}]),placeholder:"Notes about this product"},null,2),[[V,n.value.description]]),d.value.description?(c(),p("small",sa,i(d.value.description[0]),1)):_("",!0)])]),t("div",na,[t("div",ra,[e[36]||(e[36]=t("label",{class:"form-label d-block"},"Allergies",-1)),M(k(we),{modelValue:n.value.allergies,"onUpdate:modelValue":e[13]||(e[13]=a=>n.value.allergies=a),options:O.allergies,optionLabel:"name",optionValue:"id",filter:"",placeholder:"Select Allergies",class:x(["select w-full md:w-80",{"is-invalid":d.value.allergies}]),appendTo:"self"},null,8,["modelValue","options","class"]),e[37]||(e[37]=t("br",null,null,-1)),d.value.allergies?(c(),p("small",ia,i(d.value.allergies[0]),1)):_("",!0)]),t("div",da,[e[38]||(e[38]=t("label",{class:"form-label d-block"},"Tags (Halal, Haram, etc.)",-1)),M(k(we),{modelValue:n.value.tags,"onUpdate:modelValue":e[14]||(e[14]=a=>n.value.tags=a),options:O.tags,optionLabel:"name",optionValue:"id",filter:"",placeholder:"Select Tags",class:x(["w-full md:w-80",{"is-invalid":d.value.tags}]),appendTo:"self"},null,8,["modelValue","options","class"]),e[39]||(e[39]=t("br",null,null,-1)),d.value.tags?(c(),p("small",ua,i(d.value.tags[0]),1)):_("",!0)])]),t("div",ca,[t("div",pa,[t("div",{class:x(["logo-card",{"is-invalid":d.value.image}])},[t("div",{class:"logo-frame",onClick:e[15]||(e[15]=a=>n.value.imageUrl?Ue():z.value=!0)},[n.value.imageUrl?(c(),p("img",{key:0,src:n.value.imageUrl,alt:"Menu Item Image"},null,8,ma)):(c(),p("div",va,[...e[40]||(e[40]=[t("i",{class:"bi bi-image"},null,-1)])]))]),e[41]||(e[41]=t("small",{class:"text-muted mt-2 d-block"},"Upload Image",-1)),M(et,{show:z.value,onClose:e[16]||(e[16]=a=>z.value=!1),onCropped:De},null,8,["show"]),B.value?(c(),X(_e,{key:0,show:B.value,image:G.value,onClose:e[17]||(e[17]=a=>B.value=!1)},null,8,["show","image"])):_("",!0)],2)]),t("div",ga,[t("button",{class:x(["btn btn-primary rounded-pill px-4",{"is-invalid":d.value.ingredients}]),"data-bs-toggle":"modal","data-bs-target":"#addIngredientModal"},i(D.value==!0?"Ingredients":"+ Add Ingredients"),3),d.value.ingredients?(c(),p("small",ba,i(d.value.ingredients[0]),1)):_("",!0),f.value.length>0?(c(),p("div",fa,[t("div",ya,[t("div",ha,[e[42]||(e[42]=t("div",{class:"mb-2"}," Total Nutrition (Menu) ",-1)),t("div",_a,[t("span",wa," Calories: "+i(C.value.calories),1),t("span",xa," Protein: "+i(C.value.protein)+" g ",1),t("span",Ca," Carbs: "+i(C.value.carbs)+" g ",1),t("span",Ia," Fat: "+i(C.value.fat)+" g ",1)])])]),t("div",ka,[t("div",Ma,[t("table",Sa,[e[43]||(e[43]=t("thead",null,[t("tr",null,[t("th",null,"Name"),t("th",null,"Qty"),t("th",null,"Unit Price"),t("th",null,"Cost")])],-1)),t("tbody",null,[(c(!0),p(N,null,L(f.value,(a,r)=>(c(),p("tr",{key:r},[t("td",null,i(a.name),1),t("td",null,i(a.qty),1),t("td",null,i(k(j)(a.unitPrice)),1),t("td",null,i(k(j)(a.cost)),1)]))),128))])])]),t("div",Pa," Total Cost: "+i(k(j)(Y.value)),1)])])):_("",!0)])]),t("div",$a,[t("button",{class:"btn btn-primary rounded-pill btn-sm px-5 py-2",disabled:U.value,onClick:e[18]||(e[18]=a=>n.value.id?Le():je())},[U.value?(c(),p(N,{key:0},[e[44]||(e[44]=t("span",{class:"spinner-border spinner-border-sm me-2"},null,-1)),ne(" "+i(n.value.id?"Saving...":"saving..."),1)],64)):(c(),p(N,{key:1},[ne(i((n.value.id,"Save")),1)],64))],8,Fa),t("button",{class:"btn btn-secondary btn-sm rounded-pill py-2 px-4 ms-2","data-bs-dismiss":"modal",onClick:H}," Cancel ")])])])])]),t("div",Na,[t("div",Aa,[t("div",Va,[t("div",Ea,[t("h5",Ua,i(D.value==!0?"Edit Ingredients":"Add Ingredients"),1),t("button",{class:"absolute top-2 right-2 p-2 rounded-full hover:bg-gray-100 transition transform hover:scale-110","data-bs-dismiss":"modal","aria-label":"Close",onClick:Se,title:"Close"},[...e[45]||(e[45]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),t("div",Da,[t("div",ja,[t("div",Ta,[t("div",Ba,[A(t("input",{"onUpdate:modelValue":e[19]||(e[19]=a=>Q.value=a),type:"text",class:"form-control search-input",placeholder:"Search Items..."},null,512),[[V,Q.value]])]),(c(!0),p(N,null,L(he.value,a=>(c(),p("div",{key:a.id,class:"card shadow-sm border-0 rounded-4 mb-3"},[t("div",La,[t("div",qa,[t("img",{src:a.image_url?`${a.image_url}`:"/default.png",class:"rounded",style:{width:"56px",height:"56px","object-fit":"cover"}},null,8,Oa),t("div",Ra,[t("div",za,i(a.name),1),t("div",Ga," Category: "+i(a.category.name),1),t("div",Ha," Unit: "+i(a.unit_name),1),t("div",Za," Calories: "+i(a.nutrition?.calories||0)+", Protein: "+i(a.nutrition?.protein||0)+", Carbs: "+i(a.nutrition?.carbs||0)+" , Fat: "+i(a.nutrition?.fat||0),1)]),t("button",{class:"btn btn-primary btn-sm py-2 px-4 rounded-pill",onClick:r=>Ie(a)},i(f.value.some(r=>r.id===a.id)?"Update":"Add"),9,Ka)]),t("div",Xa,[t("div",Wa,[e[46]||(e[46]=t("label",{class:"small text-muted"},"Quantity",-1)),A(t("input",{"onUpdate:modelValue":r=>a.qty=r,type:"number",min:"0",class:"form-control form-control-sm"},null,8,Qa),[[V,a.qty,void 0,{number:!0}]]),d.value[a.id]?.qty?(c(),p("small",Ja,i(d.value[a.id].qty),1)):_("",!0)]),t("div",Ya,[e[47]||(e[47]=t("label",{class:"small text-muted"},"Unit Price",-1)),A(t("input",{"onUpdate:modelValue":r=>a.unitPrice=r,type:"number",min:"0",class:"form-control form-control-sm"},null,8,eo),[[V,a.unitPrice,void 0,{number:!0}]]),d.value[a.id]?.unitPrice?(c(),p("small",to,i(d.value[a.id].unitPrice),1)):_("",!0)])])])]))),128))]),t("div",ao,[t("div",oo,[t("div",lo,[e[48]||(e[48]=t("div",null,"Total Nutrition (Menu)",-1)),t("div",null," Calories: "+i(C.value.calories),1),t("div",null," Protein: "+i(C.value.protein)+" g ",1),t("div",null," Carbs: "+i(C.value.carbs)+" g ",1),t("div",null," Fat: "+i(C.value.fat)+" g ",1)])]),t("div",so,[t("div",no,[t("table",ro,[e[50]||(e[50]=t("thead",null,[t("tr",null,[t("th",null,"Name"),t("th",null,"Qty"),t("th",null,"Unit Price"),t("th",null,"Cost"),t("th",{class:"text-end"}," Action ")])],-1)),t("tbody",null,[(c(!0),p(N,null,L(f.value,(a,r)=>(c(),p("tr",{key:r},[t("td",null,i(a.name),1),t("td",null,i(a.qty),1),t("td",null,i(a.unitPrice),1),t("td",null,i(a.cost),1),t("td",io,[t("button",{class:"btn btn-sm btn-danger",onClick:g=>ke(r)}," Remove ",8,uo)])]))),128)),f.value.length===0?(c(),p("tr",co,[...e[49]||(e[49]=[t("td",{colspan:"6",class:"text-center text-muted py-3"}," No ingredients added. ",-1)])])):_("",!0)])])]),t("div",po," Total Cost: "+i(k(j)(Y.value)),1)]),t("div",{class:"mt-3 text-center"},[t("button",{class:"btn btn-primary btn-sm py-2 px-5 rounded-pill",onClick:Me}," Done ")])])])])])])])])]),_:1})}}},No=Ke(mo,[["__scopeId","data-v-434fa390"]]);export{No as default};
