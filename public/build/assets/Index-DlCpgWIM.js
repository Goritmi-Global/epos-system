import{_ as Ce,r as h,c as I,o as te,n as Pe,w as Fe,I as De,E as $e,a as se,b as l,d as Ie,e as k,f as t,u as b,h as Oe,g as n,l as f,p as O,m as V,v as N,F as Y,i as oe,t as i,j as H,P as Ve,q as F,s as m}from"./app-BQcLyXae.js";import{_ as Ne}from"./Master-CqVL6ONQ.js";import{E as ae,a as le,u as T,w as Te}from"./xlsx-BYTrw9Ws.js";import Ee from"./PurchaseComponent-CP6HUH33.js";import Ue from"./OrderComponent-Bwf_H-1a.js";import{u as Ae}from"./useFormatters-gZqjEMKN.js";import Le from"./BulkOrderComponent-XivsyDRD.js";import{s as Me}from"./index-CTconj2N.js";import{E as Re}from"./eye-6HvzY3rR.js";import{T as ze}from"./trash-2-CGlm7_El.js";import"./index-ChDEJC2l.js";import"./createLucideIcon-Coc_9-2_.js";import"./index-BYOzUaWA.js";import"./index-vdhn3Fjw.js";import"./sun-BNSuMpoO.js";import"./index-BZw_b2Hb.js";import"./index-DGPcsmUV.js";import"./index-BStk-RuA.js";const je={class:"page-wrapper"},qe={class:"card border-0 shadow-lg rounded-4"},Be={class:"card-body p-4"},Ge={class:"d-flex align-items-center justify-content-between mb-3"},Ye={class:"d-flex align-items-center gap-2"},He={class:"position-relative"},We={key:0,class:"help-popover shadow-lg rounded-3 p-3 bg-white border position-absolute",style:{width:"300px",right:"0","z-index":"999"}},Qe={class:"d-flex gap-2 align-items-center"},Ke={class:"search-wrap me-1"},Xe={key:1,class:"form-control search-input",placeholder:"Search",disabled:"",type:"text"},Je={class:"table-responsive"},Ze={class:"table table-striped"},et={key:0},tt={class:"text-nowrap"},st={class:"small text-muted"},ot={class:"text-start"},at={class:"text-end"},lt={class:"d-flex gap-2 justify-content-end"},nt=["onClick"],rt=["onClick","disabled"],it={key:0},dt={colspan:"6",class:"text-center text-muted py-4"},ut={key:0,class:"mt-4 d-flex justify-content-between align-items-center"},ct={class:"text-muted small"},pt={class:"modal fade",id:"orderDetailsModal",tabindex:"-1","aria-hidden":"true"},mt={class:"modal-dialog modal-xl modal-dialog-centered"},vt={class:"modal-content rounded-4 shadow-lg border-0"},ht={class:"modal-header align-items-center"},gt={class:"d-flex align-items-center gap-2"},bt={class:"d-flex flex-column"},ft={class:"modal-title mb-0"},yt={class:"text-muted"},_t={key:0,class:"modal-body p-4 bg-light"},xt={class:"row g-3"},wt={class:"col-md-6"},kt={class:"fw-semibold"},St={class:"col-md-6"},Ct={class:"col-md-6"},Pt={class:"fw-semibold"},Ft={class:"fw-semibold mb-3"},Dt={class:"table-responsive"},$t={class:"table table-bordered align-middle"},It={class:"table-light"},Ot={key:0},Vt={key:0},Nt=["onUpdate:modelValue"],Tt={key:0},Et=["onUpdate:modelValue","onInput"],Ut={key:0},At=["onUpdate:modelValue","onInput"],Lt={key:0},Mt=["onUpdate:modelValue"],Rt={key:0},zt={key:2,class:"text-danger"},jt={key:0},qt=["onClick"],Bt={key:0},Gt=["colspan"],Yt={class:"footer"},Ht={class:"fw-bold"},Wt={key:0,class:"alert alert-info mt-3"},Qt={key:1,class:"modal-footer"},Kt=["disabled"],Xt={key:0},Jt={key:1},Zt={__name:"Index",setup(es){const{formatCurrencySymbol:D,dateFmt:M}=Ae(),R=(o,e="GBP")=>new Intl.NumberFormat("en-GB",{style:"currency",currency:e}).format(Number(o||0)),x=h(""),W=h(Date.now()),z=`search-${Math.random().toString(36).substr(2,9)}`,Q=h(!1),j=h(null),ne=[{label:"PDF",value:"pdf"},{label:"Excel",value:"excel"},{label:"CSV",value:"csv"}],re=o=>{o.value&&(ge(o.value),j.value=null)},$=o=>new Date(o).toLocaleString("en-GB",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0}),q=o=>Math.round((Number(o)||0)*100)/100,E=h(!1),U=h([]),ie=async()=>{const o=await F.get("/api/suppliers/pluck");U.value=o.data},B=h([]),G=h(""),de=async()=>{try{const o=await F.get("/inventory/api-inventories");B.value=o.data.data}catch(o){console.error("Error fetching inventory:",o)}},A=I(()=>{const o=G.value.trim().toLowerCase();return o?B.value.filter(e=>[e.name,e.category??"",e.subcategory??"",String(e.stock??"")].join(" ").toLowerCase().includes(o)):B.value});console.log("p_filteredInv",A);const K=I(()=>{const o=G.value.trim().toLowerCase();return o?X.value.filter(e=>[e.supplier??"",e.status??"",String(e.total??""),$(e.purchasedAt)??""].join(" ").toLowerCase().includes(o)):X.value});te(async()=>{x.value="",W.value=Date.now(),await Pe(),setTimeout(()=>{Q.value=!0;const o=document.getElementById(z);o&&(o.value="",x.value="")},100),de(),ie()});const y=h(!1),v=h({data:[],current_page:1,last_page:1,per_page:10,total:0,from:0,to:0,links:[]}),X=I(()=>v.value.data||[]),ue=I(()=>({current_page:v.value.current_page,last_page:v.value.last_page,per_page:v.value.per_page,total:v.value.total}));I(()=>v.value.links||[]);const w=async(o=null)=>{y.value=!0;try{const{data:e}=await F.get("/api/purchase-orders/fetch-orders",{params:{q:x.value,page:o||v.value.current_page,per_page:v.value.per_page}});v.value={data:e.data||[],current_page:e.current_page,last_page:e.last_page,per_page:e.per_page,total:e.total,from:e.from,to:e.to,links:e.links}}catch(e){console.error("Failed to fetch purchase orders:",e),m.error("Failed to load purchase orders")}finally{y.value=!1}},ce=o=>{if(!o)return;const a=new URLSearchParams(o.split("?")[1]).get("page");a&&w(parseInt(a))},g=h(null),S=h([]),u=h(!1),C=h({}),pe=()=>{C.value={}},L=h(!1);h(!1);let J=null;Fe(x,()=>{clearTimeout(J),J=setTimeout(()=>{v.value.current_page=1,w(1)},500)});async function me(o){try{const e=await F.get(`/purchase-orders/${o.id}`);g.value=e.data,console.log("selectedOrder.value",g.value),o.status==="pending"?(u.value=!0,S.value=g.value.items.map(s=>({id:s.id,product_id:s.product_id,name:s.product?.name||"Unknown",quantity:s.quantity,unit_price:s.unit_price,expiry:s.expiry||"",sub_total:s.sub_total}))):u.value=!1,new bootstrap.Modal(document.getElementById("orderDetailsModal")).show()}catch(e){console.error(e),m.error("Failed to load order details")}}async function ve(){if(g.value){L.value=!0;try{const o={status:"completed",items:S.value.map(a=>({purchase_id:g.value.id,product_id:a.product_id,qty:a.quantity,unit_price:a.unit_price,expiry:a.expiry||null}))};await F.put(`/purchase-orders/${g.value.id}`,o),bootstrap.Modal.getInstance(document.getElementById("orderDetailsModal"))?.hide(),C.value={},await w(),await w(ue.value.current_page),m.success("Order updated successfully and stock entries created!")}catch(o){if(o.response?.status===422&&o.response?.data?.errors){C.value=o.response.data.errors;const e=Object.values(C.value).flat().join(`
`);m.error(e)}else console.error("Error updating order:",o),m.error("Failed to update order")}finally{L.value=!1}}}function Z(o){const e=parseFloat(o.quantity)||0,a=parseFloat(o.unit_price)||0;o.sub_total=(e*a).toFixed(2)}const he=async()=>{try{y.value=!0;const{data:o}=await F.get("/api/purchase-orders/fetch-orders",{params:{q:x.value,page:1,per_page:1e4}});return o.data||[]}catch(o){return console.error("Failed to fetch data for export:",o),m.error("Failed to load data for export"),[]}finally{y.value=!1}},ge=async o=>{try{y.value=!0;const e=await he();if(!e||e.length===0){m.error("No purchase orders found to download"),y.value=!1;return}console.log(`ðŸ“¥ Exporting ${e.length} purchase orders as ${o.toUpperCase()}`),o==="pdf"?fe(e):o==="excel"?ye(e):o==="csv"?be(e):m.error("Invalid download type")}catch(e){console.error("Download failed:",e),m.error(`Download failed: ${e.message}`)}finally{y.value=!1}},be=o=>{try{const e=["S.No","Supplier Name","Purchase Date","Status","Total Value"],a=o.map((p,P)=>[P+1,`"${p.supplier||""}"`,`"${$(p.purchasedAt)||""}"`,`"${p.status||""}"`,`"${q(p.total)||0}"`]),s=[e.join(","),...a.map(p=>p.join(","))].join(`
`),d=new Blob([s],{type:"text/csv;charset=utf-8;"}),r=URL.createObjectURL(d),c=document.createElement("a");c.href=r,c.download=`purchase_orders_${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(r),m.success(`CSV downloaded successfully (${o.length} records)`,{autoClose:2500})}catch(e){console.error("CSV generation error:",e),m.error(`CSV generation failed: ${e.message}`)}},fe=o=>{try{const e=new ae("p","mm","a4");e.setFontSize(18),e.setFont("helvetica","bold"),e.text("Purchase Orders Report",60,20),e.setFontSize(10),e.setFont("helvetica","normal");const a=new Date().toLocaleString();e.text(`Generated on: ${a}`,14,28),e.text(`Total Records: ${o.length}`,14,33);const s=["S.No","Supplier Name","Purchase Date","Status","Total Value"],d=o.map((c,p)=>[p+1,c.supplier||"",$(c.purchasedAt)||"",c.status||"",q(c.total)||0]);le(e,{head:[s],body:d,startY:40,styles:{fontSize:9,cellPadding:2,lineWidth:.1,halign:"left"},headStyles:{fillColor:[41,128,185],textColor:255,fontStyle:"bold"},alternateRowStyles:{fillColor:[240,240,240]},margin:{left:14,right:14},didDrawPage:c=>{const p=e.internal.getNumberOfPages(),P=e.internal.pageSize.height;e.setFontSize(8),e.text(`Page ${c.pageNumber} of ${p}`,c.settings.margin.left,P-10)}});const r=`purchase_orders_${new Date().toISOString().split("T")[0]}.pdf`;e.save(r),m.success(`PDF downloaded successfully (${o.length} records)`,{autoClose:2500})}catch(e){console.error("PDF generation error:",e),m.error(`PDF generation failed: ${e.message}`)}},ye=o=>{try{const e=o.map((p,P)=>({"S.No":P+1,"Supplier Name":p.supplier||"","Purchase Date":$(p.purchasedAt)||"",Status:p.status||"","Total Value":q(p.total)||0})),a=T.book_new(),s=T.json_to_sheet(e);s["!cols"]=[{wch:8},{wch:25},{wch:25},{wch:15},{wch:15}],T.book_append_sheet(a,s,"Purchase Orders");const d=[{Info:"Generated On",Value:new Date().toLocaleString()},{Info:"Total Records",Value:o.length},{Info:"Exported By",Value:"Purchase Order System"}],r=T.json_to_sheet(d);T.book_append_sheet(a,r,"Report Info");const c=`purchase_orders_${new Date().toISOString().split("T")[0]}.xlsx`;Te(a,c),m.success(`Excel file downloaded successfully (${o.length} records)`,{autoClose:2500})}catch(e){console.error("Excel generation error:",e),m.error(`Excel generation failed: ${e.message}`)}};te(()=>{w(1)}),De(()=>window.feather?.replace?.());const _e=async o=>{try{const a=(await F.get(`/purchase-orders/${o.id}`)).data,s=new ae("p","mm","a4");s.setFontSize(24),s.setFont("helvetica","bold"),s.setTextColor(41,128,185),s.text("INVOICE",14,20),s.setFontSize(10),s.setFont("helvetica","normal"),s.setTextColor(0,0,0);const d=140;s.text(`Invoice #: ${a.id}`,d,20),s.text(`Date: ${$(a.purchasedAt||a.purchase_date)}`,d,26),s.text(`Status: ${a.status?.toUpperCase()||"PENDING"}`,d,32),s.setFontSize(12),s.setFont("helvetica","bold"),s.text("FROM (Your Company):",14,45),s.setFontSize(10),s.setFont("helvetica","normal"),s.text("Your Company Name",14,52),s.text("123 Business Street",14,58),s.text("City, Country",14,64),s.text("contact@company.com",14,70),s.setFontSize(12),s.setFont("helvetica","bold"),s.text("TO (Supplier):",100,45),s.setFontSize(10),s.setFont("helvetica","normal");const r=a.supplier?.name||a.supplier||"N/A";s.text(r,100,52),s.text("Supplier Details",100,58),s.text("Contact: "+(a.supplier?.contact||"N/A"),100,64),s.text("Email: "+(a.supplier?.email||"N/A"),100,70),s.setDrawColor(41,128,185),s.setLineWidth(.5),s.line(14,78,196,78);const c=["Item","Quantity","Unit Price","Subtotal"],p=a.items.map(_=>[_.product?.name||_.name||"Unknown Product",_.quantity,R(_.unit_price),R(_.sub_total||_.quantity*_.unit_price)]);le(s,{head:[c],body:p,startY:85,styles:{fontSize:10,cellPadding:3,lineWidth:.1,halign:"left"},headStyles:{fillColor:[41,128,185],textColor:255,fontStyle:"bold",halign:"center"},alternateRowStyles:{fillColor:[245,245,245]},margin:{left:14,right:14},columnStyles:{1:{halign:"center"},2:{halign:"right"},3:{halign:"right"}}});const P=s.lastAutoTable.finalY||150;s.setFontSize(11),s.setFont("helvetica","bold");const xe=a.items.reduce((_,Se)=>_+(parseFloat(Se.sub_total)||0),0);s.text(`Total Amount: ${R(xe)}`,140,P+15),s.setFontSize(9),s.setFont("helvetica","normal"),s.setTextColor(128,128,128);const ee=s.internal.pageSize.height,we=s.internal.getNumberOfPages();s.text(`Page 1 of ${we}`,14,ee-10),s.text("Thank you for your business!",100,ee-10);const ke=`invoice_${a.id}_${new Date().toISOString().split("T")[0]}.pdf`;s.save(ke),m.success("Invoice downloaded successfully",{autoClose:2500})}catch(e){console.error("Invoice generation error:",e),m.error(`Invoice generation failed: ${e.message}`)}};return(o,e)=>{const a=$e("VueDatePicker");return l(),se(Ne,null,{default:Ie(()=>[k(b(Oe),{title:"Purchase Order"}),t("div",je,[t("div",qe,[t("div",Be,[t("div",Ge,[t("div",Ye,[e[12]||(e[12]=t("h3",{class:"fw-semibold mb-0"},"Purchase Order",-1)),t("div",He,[t("button",{class:"btn btn-link p-0 ms-2",onClick:e[0]||(e[0]=s=>E.value=!E.value),title:"Help"},[...e[6]||(e[6]=[t("i",{class:"bi bi-question-circle fs-5"},null,-1)])]),E.value?(l(),n("div",We,[t("button",{onClick:e[1]||(e[1]=s=>E.value=!1),class:"btn btn-sm btn-light border-0 position-absolute top-0 end-0 mt-1 me-1 text-secondary",title:"Close"},[...e[7]||(e[7]=[t("i",{class:"bi bi-x-lg"},null,-1)])]),e[8]||(e[8]=t("h6",{class:"fw-semibold mb-3"},"Purchase Order Help",-1)),e[9]||(e[9]=t("p",{class:"mb-2 small text-muted"}," This screen allows you to view, manage, and update all purchase orders. ",-1)),e[10]||(e[10]=t("p",{class:"mb-1 small"},[t("strong",null,"Add Purchase:"),O(" Create a purchase and stock-in immediately. ")],-1)),e[11]||(e[11]=t("p",{class:"small mb-0"},[t("strong",null,"Add Order:"),O(" Create a purchase order for later delivery. ")],-1))])):f("",!0)])]),t("div",Qe,[t("div",Ke,[e[13]||(e[13]=t("i",{class:"bi bi-search"},null,-1)),e[14]||(e[14]=t("input",{type:"email",name:"email",autocomplete:"email",style:{position:"absolute",left:"-9999px",width:"1px",height:"1px"},tabindex:"-1","aria-hidden":"true"},null,-1)),Q.value?V((l(),n("input",{id:z,"onUpdate:modelValue":e[2]||(e[2]=s=>x.value=s),key:W.value,class:"form-control search-input",placeholder:"Search",type:"search",autocomplete:"new-password",name:z,role:"presentation",onFocus:e[3]||(e[3]=(...s)=>o.handleFocus&&o.handleFocus(...s))},null,32)),[[N,x.value]]):(l(),n("input",Xe))]),e[15]||(e[15]=t("button",{class:"btn btn-primary btn-sm py-2 rounded-pill px-4","data-bs-toggle":"modal","data-bs-target":"#bulkOrderModal"}," Bulk Purchase ",-1)),k(Le,{suppliers:U.value,items:A.value,onRefreshData:w},null,8,["suppliers","items"]),k(Ee,{suppliers:U.value,items:A.value,onRefreshData:w,"onUpdate:search":e[4]||(e[4]=s=>G.value=s)},null,8,["suppliers","items"]),e[16]||(e[16]=t("button",{class:"btn btn-primary btn-sm py-2 rounded-pill px-4 py-2","data-bs-toggle":"modal","data-bs-target":"#addOrderModal"}," Order ",-1)),k(Ue,{suppliers:U.value,items:A.value,onRefreshData:w},null,8,["suppliers","items"]),k(b(Me),{modelValue:j.value,"onUpdate:modelValue":e[5]||(e[5]=s=>j.value=s),options:ne,optionLabel:"label",optionValue:"value",placeholder:"Export",class:"export-dropdown",onChange:re},null,8,["modelValue"])])]),t("div",Je,[t("table",Ze,[e[19]||(e[19]=t("thead",{class:"small text-muted"},[t("tr",null,[t("th",{style:{width:"80px"}},"S. #"),t("th",null,"Supplier Name"),t("th",null,"Purchase date"),t("th",{class:"text-start"},"Status"),t("th",null,"Total value"),t("th",{class:"text-end"},"Action")])],-1)),t("tbody",null,[y.value?(l(),n("tr",et,[...e[17]||(e[17]=[t("td",{colspan:"6",class:"text-center py-5"},[t("div",{class:"spinner-border text-primary",role:"status"},[t("span",{class:"visually-hidden"},"Loading...")]),t("p",{class:"text-muted mt-2 mb-0"},"Loading purchase orders...")],-1)])])):(l(),n(Y,{key:1},[(l(!0),n(Y,null,oe(K.value,(s,d)=>(l(),n("tr",{key:s.id},[t("td",null,i(v.value.from+d),1),t("td",null,i(s.supplier),1),t("td",tt,[O(i(s.purchasedAt)+" ",1),t("div",st,i(b(M)(s.purchasedAt).split(",")[1]?.trim()),1)]),t("td",ot,[t("span",{class:H(["badge rounded-pill",s.status==="pending"?"bg-warning text-dark":s.status==="completed"?"bg-success":"bg-secondary"])},i(s.status),3)]),t("td",null,i(b(D)(s.total)),1),t("td",at,[t("div",lt,[t("button",{class:"p-2 rounded-pill text-primary hover:bg-gray-100 btn",onClick:r=>me(s),title:"View Item"},[k(b(Re),{class:"w-4 h-4"})],8,nt),t("button",{class:"p-2 rounded-pill text-success hover:bg-gray-100 btn",onClick:r=>_e(s),disabled:y.value,title:"Print Invoice"},[...e[18]||(e[18]=[t("i",{class:"bi bi-printer fs-5"},null,-1)])],8,rt)])])]))),128)),K.value.length===0?(l(),n("tr",it,[t("td",dt,i(x.value.trim()?"No purchase orders found matching your search.":"No purchase orders found."),1)])):f("",!0)],64))])])]),v.value.last_page>1?(l(),n("div",ut,[t("div",ct," Showing "+i(v.value.from)+" to "+i(v.value.to)+" of "+i(v.value.total)+" entries ",1),k(Ve,{pagination:v.value.links,isApiDriven:!0,onPageChanged:ce},null,8,["pagination"])])):f("",!0)])]),t("div",pt,[t("div",mt,[t("div",vt,[t("div",ht,[t("div",gt,[e[20]||(e[20]=t("span",{class:"badge bg-success rounded-circle p-2"},[t("i",{class:"bi bi-basket"})],-1)),t("div",bt,[t("h5",ft,i(u.value?"Edit Purchase Order":"Purchase Details"),1),t("small",yt," Supplier: "+i(g.value?.supplier?.name??"â€”"),1)])]),t("button",{onClick:pe,class:"absolute top-2 right-2 p-2 rounded-full hover:bg-gray-100 transition transform hover:scale-110","data-bs-dismiss":"modal","aria-label":"Close",title:"Close"},[...e[21]||(e[21]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),g.value?(l(),n("div",_t,[e[34]||(e[34]=t("h6",{class:"fw-semibold mb-3"},"Order Summary",-1)),t("div",xt,[t("div",wt,[e[22]||(e[22]=t("small",{class:"text-muted d-block"},"Purchase Date",-1)),t("div",kt,i(b(M)(g.value.purchase_date).split(",")[0]),1)]),t("div",St,[e[23]||(e[23]=t("small",{class:"text-muted d-block"},"Status",-1)),t("span",{class:H(["badge rounded-pill",g.value.status==="completed"?"bg-success":"bg-warning"])},i(g.value.status),3)]),t("div",Ct,[e[24]||(e[24]=t("small",{class:"text-muted d-block"},"Total Amount",-1)),t("div",Pt,i(b(D)(g.value.total_amount)),1)])]),e[35]||(e[35]=t("hr",{class:"my-4"},null,-1)),t("h6",Ft,i(u.value?"Edit Items":"Purchased Items"),1),t("div",Dt,[t("table",$t,[t("thead",It,[t("tr",null,[e[25]||(e[25]=t("th",null,"Product",-1)),e[26]||(e[26]=t("th",null,"Qty",-1)),e[27]||(e[27]=t("th",null,"Unit Price",-1)),e[28]||(e[28]=t("th",null,"Subtotal",-1)),e[29]||(e[29]=t("th",null,"Expiry",-1)),u.value?(l(),n("th",Ot,"Action")):f("",!0)])]),t("tbody",null,[(l(!0),n(Y,null,oe(u.value?S.value:g.value.items,(s,d)=>(l(),n("tr",{class:"black-row",key:s.id||d},[t("td",null,[u.value?V((l(),n("input",{key:1,"onUpdate:modelValue":r=>s.name=r,class:"form-control",readonly:""},null,8,Nt)),[[N,s.name]]):(l(),n("span",Vt,i(s.product?.name||s.name||"Unknown Product"),1))]),t("td",null,[u.value?V((l(),n("input",{key:1,"onUpdate:modelValue":r=>s.quantity=r,type:"number",class:"form-control",onInput:r=>Z(s)},null,40,Et)),[[N,s.quantity,void 0,{number:!0}]]):(l(),n("span",Tt,i(b(D)(s.quantity)),1))]),t("td",null,[u.value?V((l(),n("input",{key:1,"onUpdate:modelValue":r=>s.unit_price=r,type:"number",class:"form-control",onInput:r=>Z(s)},null,40,At)),[[N,s.unit_price,void 0,{number:!0}]]):(l(),n("span",Ut,i(s.unit_price),1))]),t("td",null,[u.value?V((l(),n("input",{key:1,"onUpdate:modelValue":r=>s.sub_total=r,class:"form-control",readonly:""},null,8,Mt)),[[N,s.sub_total]]):(l(),n("span",Lt,i(b(D)(s.sub_total)),1))]),t("td",null,[u.value?(l(),se(a,{key:1,modelValue:s.expiry,"onUpdate:modelValue":r=>s.expiry=r,enableTimePicker:!1,"min-date":new Date,teleport:!0,format:"yyyy-MM-dd",placeholder:"Select expiry date",class:H({"is-invalid":C.value[`items.${d}.expiry`]})},null,8,["modelValue","onUpdate:modelValue","min-date","class"])):(l(),n("span",Rt,i(b(M)(s.expiry_date)),1)),C.value[`items.${d}.expiry`]?(l(),n("small",zt,i(C.value[`items.${d}.expiry`][0]),1)):f("",!0)]),e[30]||(e[30]=t("br",null,null,-1)),u.value?(l(),n("td",jt,[t("button",{class:"p-2 rounded-full transition transform hover:bg-gray-100 hover:scale-110",onClick:r=>S.value.splice(d,1),title:"Delete"},[k(b(ze),{class:"w-4 h-4 text-red-500"})],8,qt)])):f("",!0)]))),128)),(u.value?S.value.length:g.value.items.length)===0?(l(),n("tr",Bt,[t("td",{colspan:u.value?6:5,class:"text-center text-muted py-3"}," No items found ",8,Gt)])):f("",!0)]),t("tfoot",Yt,[t("tr",null,[e[31]||(e[31]=t("td",{colspan:"3",class:"text-end fw-bold"}," Total: ",-1)),t("td",Ht,i(b(D)((u.value?S.value:g.value.items).reduce((s,d)=>s+parseFloat(d.sub_total||0),0))),1),e[32]||(e[32]=t("td",{colspan:"2"},null,-1))])])])]),u.value?(l(),n("div",Wt,[...e[33]||(e[33]=[t("i",{class:"bi bi-info-circle me-2"},null,-1),O(" Updating will mark this order as completed and create stock entries. ",-1)])])):f("",!0)])):f("",!0),u.value?(l(),n("div",Qt,[t("button",{type:"button",class:"btn btn-primary rounded-pill px-4 py-2",onClick:ve,disabled:L.value||S.value.length===0},[L.value?(l(),n("span",Xt,[...e[36]||(e[36]=[t("span",{class:"spinner-border spinner-border-sm me-2"},null,-1),O(" Updating... ",-1)])])):(l(),n("span",Jt,"Complete Order & Update Stock"))],8,Kt),e[37]||(e[37]=t("button",{type:"button",class:"btn btn-secondary rounded-pill px-4 py-2","data-bs-dismiss":"modal"}," Cancel ",-1))])):f("",!0)])])])])]),_:1})}}},ys=Ce(Zt,[["__scopeId","data-v-b7c7bd98"]]);export{ys as default};
