import{_ as Z,r,D as L,k as ee,j,g as u,o as m,b as t,a as x,x as E,y as D,f as V,d as O,i as N,F as C,v as te,t as v,V as ae,n as A,A as w,p as oe,m as s}from"./app-DgHj6V6q.js";import{E as se,a as le,X as ne,u as y,w as re}from"./xlsx-B5Xi98cQ.js";import{I as de}from"./importFile-C9EmJvbV.js";import{P as ie}from"./plus-BS0M9IQ8.js";import{P as ce}from"./pencil-DagjvPCE.js";const ue={class:"card border-0 shadow-lg rounded-4"},me={class:"card-body"},ge={class:"d-flex flex-wrap gap-2 justify-content-between align-items-center mb-3"},pe={class:"d-flex gap-2"},ve={class:"search-wrap"},fe={class:"dropdown"},be={class:"dropdown-menu dropdown-menu-end shadow rounded-4"},he={class:"table-responsive"},we={class:"table table-hover"},ye={class:"fw-semibold"},Te={class:"text-center"},xe={class:"d-inline-flex align-items-center gap-3"},Ce=["onClick"],Se={key:0},_e={colspan:"3",class:"text-center text-muted py-4"},ke={class:"modal fade",id:"modalTagForm",tabindex:"-1","aria-hidden":"true"},Fe={class:"modal-dialog modal-lg modal-dialog-centered"},Ee={class:"modal-content rounded-4"},De={class:"modal-header"},Ve={class:"modal-title"},Ne={class:"modal-body"},Ie={key:0},Pe={key:0,class:"text-danger"},$e={key:1},Le={key:0,class:"text-danger"},je={class:"col-md-2"},Oe=["disabled"],Ae={__name:"TagsTab",setup(Me){const M=r([{label:"Vegan",value:"Vegan"},{label:"Vegetarian",value:"Vegetarian"},{label:"Halal",value:"Halal"},{label:"Kosher",value:"Kosher"},{label:"Organic",value:"Organic"},{label:"Locally Sourced",value:"Locally Sourced"},{label:"Fairtrade",value:"Fairtrade"},{label:"Spicy",value:"Spicy"},{label:"Free-From Nuts",value:"Free-From Nuts"},{label:"Contains Soy",value:"Contains Soy"},{label:"Free-From Egg",value:"Free-From Egg"},{label:"Sugar-Free",value:"Sugar-Free"},{label:"Ethically Sourced",value:"Ethically Sourced"},{label:"Red Tractor Certified",value:"Red Tractor Certified"},{label:"Scottish Produce",value:"Scottish Produce"},{label:"Welsh Lamb",value:"Welsh Lamb"}]);r([]);const S=r([]),R=r(""),f=r(!1),_=r(null),g=r(""),b=r(""),I=()=>{g.value="",S.value=[],n.value={}},P=L(()=>{const a=b.value.trim().toLowerCase();return a?d.value.filter(e=>e.name.toLowerCase().includes(a)):d.value}),B=()=>{f.value=!1,S.value=[],R.value=""};L(()=>M.value.filter(a=>!d.value.some(e=>e.name.toLowerCase()===a.value.toLowerCase())));const z=a=>{f.value=!0,_.value=a,g.value=a.name},U=async a=>{try{await w.delete(`/tags/${a.id}`),d.value=d.value.filter(e=>e.id!==a.id),s.success("Tag deleted successfully")}catch{s.error("Delete failed ❌")}},T=r(!1),X=async()=>{const a=g.value.trim();if(!a){s.error("Please fill out the field, can't save an empty field."),n.value={customTag:["Please fill out the field, can't save an empty field"]};return}try{if(T.value=!0,f.value){const{data:e}=await w.put(`/tags/${_.value.id}`,{name:a}),o=d.value.findIndex(l=>l.id===_.value.id);o!==-1&&(d.value[o]=e),s.success("Tag updated successfully")}else{if(d.value.some(i=>i.name.toLowerCase()===a.toLowerCase())){const i=`Tag "${a}" already exists.`;s.error(i),n.value={customTag:[i]};return}const{data:o}=await w.post("/tags",{tags:[{name:a}]}),l=Array.isArray(o)?o[0]:o;d.value.push(l),s.success("Tag added successfully")}I(),H("modalTagForm"),await k()}catch(e){e.response?.data?.errors?(n.value={},Object.entries(e.response.data.errors).forEach(([o,l])=>{l.forEach(i=>s.error(i)),n.value={customTag:l}})):(s.error("Operation failed ❌"),console.error(e))}finally{T.value=!1}},H=a=>{const e=document.getElementById(a);if(!e)return;(window.bootstrap?.Modal.getInstance(e)||new window.bootstrap.Modal(e)).hide()},d=r([]),G=r(1),W=r(15),$=r(!1),n=r({}),k=async()=>{$.value=!0;try{const{data:a}=await w.get("/tags",{params:{q:b.value,page:G.value,per_page:W.value}});d.value=a?.data??a?.tags?.data??a??[],await oe(),window.feather?.replace()}catch(a){console.error("Failed to fetch tags",a)}finally{$.value=!1}},F=a=>{if(!d.value||d.value.length===0){s.error("No Tags data to download");return}const e=b.value.trim()?filtered.value:d.value;if(e.length===0){s.error("No Tags found to download");return}try{a==="pdf"?K(e):a==="excel"?Y(e):a==="csv"?q(e):s.error("Invalid download type")}catch(o){console.error("Download failed:",o),s.error(`Download failed: ${o.message}`)}},q=a=>{try{const e=["Name"],o=a.map(p=>[`"${p.name||""}"`]),l=[e.join(","),...o.map(p=>p.join(","))].join(`
`),i=new Blob([l],{type:"text/csv;charset=utf-8;"}),h=URL.createObjectURL(i),c=document.createElement("a");c.setAttribute("href",h),c.setAttribute("download",`tags_${new Date().toISOString().split("T")[0]}.csv`),document.body.appendChild(c),c.click(),document.body.removeChild(c),s.success("CSV downloaded successfully",{autoClose:2500})}catch(e){console.error("CSV generation error:",e),s.error(`CSV generation failed: ${e.message}`,{autoClose:5e3})}},K=a=>{try{const e=new se("p","mm","a4");e.setFont("helvetica","bold"),e.setFontSize(18),e.text("Tags Report",80,20),e.setFont("helvetica","normal"),e.setFontSize(10);const o=new Date().toLocaleString();e.text(`Generated on: ${o}`,14,30),e.text(`Total Tags: ${a.length}`,14,36);const l=["Name"],i=a.map(c=>[c.name||""]);le(e,{head:[l],body:i,startY:45,styles:{fontSize:10,cellPadding:3,halign:"left",valign:"middle",lineColor:[200,200,200],lineWidth:.1},headStyles:{fillColor:[41,128,185],textColor:255,fontStyle:"bold"},alternateRowStyles:{fillColor:[245,245,245]},margin:{left:14,right:14},didDrawPage:c=>{const p=e.internal.getNumberOfPages(),Q=e.internal.pageSize.height;e.setFontSize(8),e.text(`Page ${c.pageNumber} of ${p}`,14,Q-10)}});const h=`tags_${new Date().toISOString().split("T")[0]}.pdf`;e.save(h),s.success("PDF downloaded successfully",{autoClose:2500})}catch(e){console.error("PDF generation error:",e),s.error(`PDF generation failed: ${e.message}`,{autoClose:5e3})}},Y=a=>{try{if(typeof ne>"u")throw new Error("XLSX library is not loaded");const e=a.map(p=>({Name:p.name||""})),o=y.book_new(),l=y.json_to_sheet(e);l["!cols"]=[{wch:25}],y.book_append_sheet(o,l,"Tags");const i=[{Info:"Generated On",Value:new Date().toLocaleString()},{Info:"Total Records",Value:a.length},{Info:"Exported By",Value:"Tags Management System"}],h=y.json_to_sheet(i);y.book_append_sheet(o,h,"Report Info");const c=`tags_${new Date().toISOString().split("T")[0]}.xlsx`;re(o,c),s.success("Excel file downloaded successfully",{autoClose:2500})}catch(e){console.error("Excel generation error:",e),s.error(`Excel generation failed: ${e.message}`,{autoClose:5e3})}};ee(async()=>{await k(),window.feather?.replace()}),j(g,a=>{a&&n.value.customTag&&delete n.value.customTag}),j(S,a=>{a.length>0&&n.value.tags&&delete n.value.tags});const J=a=>{if(!a||a.length<=1){s.error("The file is empty",{autoClose:3e3});return}a[0];const o=a.slice(1).map(l=>({name:l[0]?.trim()||""}));w.post("/api/tags/import",{tags:o}).then(()=>{s.success("Tags imported successfully"),k()}).catch(l=>{l?.response?.status===422&&l.response.data?.errors?(n.value=l.response.data.errors,s.error("Validation failed — check for duplicates or missing data",{autoClose:3e3})):s.error("Import failed. Please try again.",{autoClose:3e3})})};return(a,e)=>(m(),u(C,null,[t("div",ue,[t("div",me,[t("div",ge,[e[10]||(e[10]=t("h4",{class:"mb-0"},"Tags",-1)),t("div",pe,[t("div",ve,[e[7]||(e[7]=t("i",{class:"bi bi-search"},null,-1)),E(t("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>b.value=o),class:"form-control search-input",placeholder:"Search"},null,512),[[D,b.value]])]),t("button",{"data-bs-toggle":"modal","data-bs-target":"#modalTagForm",onClick:e[1]||(e[1]=()=>{B(),I(),n.value={}}),class:"d-flex align-items-center gap-1 btn-sm px-4 py-2 rounded-pill btn btn-primary text-white"},[x(O(ie),{class:"w-4 h-4"}),e[8]||(e[8]=V(" Add Tag ",-1))]),x(de,{label:"Import",sampleHeaders:["Name"],sampleData:[["Vegan"],["Gluten-Free"],["Organic"]],onOnImport:J}),t("div",fe,[e[9]||(e[9]=t("button",{class:"btn btn-outline-secondary btn-sm rounded-pill py-2 px-4 dropdown-toggle","data-bs-toggle":"dropdown"}," Export ",-1)),t("ul",be,[t("li",null,[t("a",{class:"dropdown-item py-2",href:"javascript:;",onClick:e[2]||(e[2]=o=>F("pdf"))},"Export as PDF")]),t("li",null,[t("a",{class:"dropdown-item py-2",href:"javascript:;",onClick:e[3]||(e[3]=o=>F("excel"))},"Export as Excel")]),t("li",null,[t("a",{class:"dropdown-item py-2",href:"javascript:;",onClick:e[4]||(e[4]=o=>F("csv"))}," Export as CSV ")])])])])]),t("div",he,[t("table",we,[e[11]||(e[11]=t("thead",{class:"border-top small text-muted"},[t("tr",null,[t("th",null,"S. #"),t("th",null,"Tag Name"),t("th",{class:"text-center"},"Action")])],-1)),t("tbody",null,[(m(!0),u(C,null,te(P.value,(o,l)=>(m(),u("tr",{key:o.id},[t("td",null,v(l+1),1),t("td",ye,v(o.name),1),t("td",Te,[t("div",xe,[t("button",{"data-bs-toggle":"modal","data-bs-target":"#modalTagForm",onClick:()=>{z(o),n.value={}},title:"Edit",class:"p-2 rounded-full text-blue-600 hover:bg-blue-100"},[x(O(ce),{class:"w-4 h-4"})],8,Ce),x(ae,{title:"Confirm Delete",message:`Are you sure you want to delete ${o.name}?`,showDeleteButton:!0,onConfirm:()=>{U(o)},onCancel:()=>{}},null,8,["message","onConfirm"])])])]))),128)),P.value.length===0?(m(),u("tr",Se,[t("td",_e,v(b.value.trim()?"No tags found matching your search.":"No tags found."),1)])):N("",!0)])])])])]),t("div",ke,[t("div",Fe,[t("div",Ee,[t("div",De,[t("h5",Ve,v(f.value?"Edit Tag":"Add Tag"),1),e[12]||(e[12]=t("button",{class:"absolute top-2 right-2 p-2 rounded-full hover:bg-gray-100 transition transform hover:scale-110","data-bs-dismiss":"modal","aria-label":"Close",title:"Close"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})])],-1))]),t("div",Ne,[f.value?(m(),u("div",Ie,[e[13]||(e[13]=t("label",{class:"form-label"},"Tag Name",-1)),E(t("input",{"onUpdate:modelValue":e[5]||(e[5]=o=>g.value=o),class:A(["form-control",{"is-invalid":n.value.customTag}]),placeholder:"e.g., Vegan"},null,2),[[D,g.value]]),n.value.customTag?(m(),u("span",Pe,v(n.value.customTag[0]),1)):N("",!0)])):(m(),u("div",$e,[e[14]||(e[14]=t("label",{class:"form-label"},"Tag Name",-1)),E(t("input",{"onUpdate:modelValue":e[6]||(e[6]=o=>g.value=o),class:A(["form-control",{"is-invalid":n.value.customTag}]),placeholder:"Enter tag name"},null,2),[[D,g.value]]),n.value.customTag?(m(),u("span",Le,v(n.value.customTag[0]),1)):N("",!0)])),t("div",je,[t("button",{class:"btn btn-primary rounded-pill py-2 btn-sm w-100 mt-4",disabled:T.value,onClick:X},[T.value?(m(),u(C,{key:0},[e[15]||(e[15]=t("span",{class:"spinner-border spinner-border-sm me-2"},null,-1)),e[16]||(e[16]=V(" Saving... ",-1))],64)):(m(),u(C,{key:1},[V(v((f.value,"Save")),1)],64))],8,Oe)])])])])])],64))}},He=Z(Ae,[["__scopeId","data-v-5b1de2c7"]]);export{He as default};
