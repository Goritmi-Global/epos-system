import{_ as Z,r as b,o as V,c as tt,I as et,w as ot,a as st,b as d,d as lt,f as e,m as h,v as w,g as u,l as k,F as I,i as at,t as l,j as _,e as j,u as F,s as c}from"./app-BWJIgFUk.js";import{_ as nt}from"./Master-CIAemtMp.js";import{E as it,a as rt,X as dt,u as D,w as ct}from"./xlsx-BS8XIOXE.js";import{P as ut}from"./pencil-BJi1dG4D.js";import{E as mt}from"./eye-CO_nMJfp.js";import"./index-N5It5Rdt.js";import"./createLucideIcon-BtxAcjLS.js";import"./PasswordVerificationModal-C7K_1d78.js";import"./index-566Dsl26.js";import"./index-DrwUNMx0.js";import"./sun-DRYQ-wZ1.js";const pt={class:"page-wrapper"},gt={class:"card border-0 shadow-lg rounded-4"},yt={class:"card-body p-4"},vt={class:"d-flex align-items-center justify-content-between mb-3"},ft={class:"d-flex gap-2 align-items-center"},bt={class:"search-wrap"},ht={class:"dropdown"},wt={class:"dropdown-menu dropdown-menu-end shadow rounded-4 py-2"},_t={class:"table-responsive"},xt={class:"table table-hover align-middle"},kt={class:"fw-semibold text-capitalize"},Dt=["title"],St={class:"text-muted ms-2"},Ct={key:1,class:"text-muted"},Pt={class:"text-break"},Tt={key:1,class:"text-muted"},Lt={key:1,class:"text-muted"},Mt={class:"text-end"},Nt=["onClick"],$t=["onClick"],Et={key:0},Vt={class:"modal fade",id:"viewLogModal",tabindex:"-1","aria-hidden":"true"},It={class:"modal-dialog modal-lg modal-dialog-centered"},jt={class:"modal-content rounded-4 shadow-lg border-0"},Ft={class:"modal-header align-items-center"},qt={class:"d-flex align-items-center gap-2"},Ut={class:"d-flex flex-column"},Bt={class:"text-muted"},Ot={class:"modal-body p-4 bg-light"},Rt={key:0,class:"row g-4"},zt={class:"col-lg-12"},At={class:"card border-0 shadow-sm rounded-4 h-100"},Qt={class:"card-body"},Gt={class:"row g-3"},Xt={class:"col-md-6"},Yt={class:"fw-semibold"},Ht={class:"col-md-6"},Wt={class:"fw-semibold"},Jt={class:"col-md-6"},Kt={class:"fw-semibold"},Zt={class:"col-md-6"},te={class:"row g-3 text-center"},ee={class:"col-md-4"},oe={class:"p-3 bg-light rounded-3"},se={class:"fs-6 fw-semibold"},le={class:"col-md-4"},ae={class:"p-3 bg-light rounded-3"},ne={class:"fs-6 fw-semibold"},ie={class:"col-md-4"},re={class:"p-3 bg-light rounded-3"},de={class:"fs-6 fw-semibold"},ce={class:"row g-3"},ue={class:"col-md-6"},me={class:"fw-semibold"},pe={class:"col-md-6"},ge={class:"fw-semibold"},ye={class:"modal fade",id:"editLogModal",tabindex:"-1","aria-hidden":"true"},ve={class:"modal-dialog modal-lg modal-dialog-centered"},fe={class:"modal-content rounded-4"},be={class:"modal-body"},he={class:"row g-3"},we={class:"col-md-6 col-md-12"},_e={class:"col-md-6 col-md-12"},xe={key:0,class:"text-danger"},ke={class:"col-md-6 col-md-12"},De={key:0,class:"text-danger"},Se={class:"col-md-6 col-md-12"},Ce={class:"col-12 col-md-6"},Pe={class:"mt-4"},Te=["disabled","aria-busy"],Le={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},Me=864e5,Ne={__name:"ffirst index backup",setup($e){const f=b([]),S=b(""),M=async()=>{try{const{data:o}=await axios.get("stock_entries/stock-logs");f.value=o}catch(o){c.error("Failed to fetch logs",o)}};V(()=>{M()});const P=tt(()=>{const o=S.value.trim().toLowerCase();return o?f.value.filter(t=>[t.itemName,t.category,t.operationType,t.type,String(t.quantity),String(t.unitPrice),String(t.totalPrice),t.expiryDate??"",t.dateTime??""].join(" ").toLowerCase().includes(o)):f.value}),C=(o,t="GBP")=>new Intl.NumberFormat("en-GB",{style:"currency",currency:t}).format(o),T=o=>new Date(o).toLocaleString("en-GB",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0}),N=o=>new Date(o).toISOString().slice(0,10);V(()=>window.feather?.replace()),et(()=>window.feather?.replace());const i=b(null),m=b({}),q=o=>{i.value=o,new bootstrap.Modal(document.getElementById("viewLogModal")).show()},r=b({id:null,itemName:"",quantity:"",unitPrice:"",expiryDate:"",operationType:""});function U(o){r.value={...o},new bootstrap.Modal(document.getElementById("editLogModal")).show()}const y=b(!1),B=()=>{m.value={}};async function O(){if(!y.value){y.value=!0,m.value={};try{await axios.put(`stock_entries/stock-logs/${r.value.id}`,r.value),await M(),c.success("Stock log updated successfully");const o=bootstrap.Modal.getInstance(document.getElementById("editLogModal"));o&&o.hide()}catch(o){o?.response?.status===422&&o.response.data?.errors?(m.value=o.response.data.errors,c.error("Please fill in all required fields correctly.")):(c.error("Something went wrong. Please try again."),console.error(o))}finally{y.value=!1}}}const L=o=>{if(!f.value||f.value.length===0){c.error("No Allergies data to download");return}const t=S.value.trim()?P.value:f.value;if(t.length===0){c.error("No Logs Moment found to download");return}try{o==="pdf"?z(t):o==="excel"?A(t):o==="csv"?R(t):c.error("Invalid download type")}catch(s){console.error("Download failed:",s),c.error(`Download failed: ${s.message}`)}},R=o=>{try{const t=["Category","Supplier","Product","Quantity","Price","Value","Operation Type","Stock Type"],s=o.map(a=>[`"${a.category||""}"`,`"${a.supplier||""}"`,`"${a.itemName||""}"`,`"${a.quantity||""}"`,`"${a.unitPrice||""}"`,`"${a.totalPrice||""}"`,`"${a.operationType||""}"`,`"${a.type||""}"`]),p=[t.join(","),...s.map(a=>a.join(","))].join(`
`),v=new Blob([p],{type:"text/csv;charset=utf-8;"}),x=URL.createObjectURL(v),n=document.createElement("a");n.setAttribute("href",x),n.setAttribute("download",`logs_moment_${new Date().toISOString().split("T")[0]}.csv`),document.body.appendChild(n),n.click(),document.body.removeChild(n),c.success("CSV downloaded successfully")}catch(t){console.error("CSV generation error:",t),c.error(`CSV generation failed: ${t.message}`,{autoClose:5e3})}},z=o=>{try{const t=new it("p","mm","a4");t.setFontSize(20),t.setFont("helvetica","bold"),t.text("Logs Moment Report",70,20),t.setFontSize(10),t.setFont("helvetica","normal");const s=new Date().toLocaleString();t.text(`Generated on: ${s}`,70,28),t.text(`Total Logs: ${o.length}`,70,34);const p=["Category","Supplier","Product","Quantity","Value","Price","Operation Type","Stock Type"],v=o.map(n=>[n.category||"",n.supplier||"",n.itemName||"",n.quantity||"",n.unitPrice||"",n.totalPrice||"",n.operationType||"",n.type||""]);rt(t,{head:[p],body:v,startY:40,styles:{fontSize:8,cellPadding:2,halign:"left",lineColor:[0,0,0],lineWidth:.1},headStyles:{fillColor:[41,128,185],textColor:255,fontStyle:"bold"},alternateRowStyles:{fillColor:[240,240,240]},margin:{left:14,right:14},didDrawPage:n=>{const a=t.internal.getNumberOfPages(),K=t.internal.pageSize.height;t.setFontSize(8),t.text(`Page ${n.pageNumber} of ${a}`,n.settings.margin.left,K-10)}});const x=`logs_moment_${new Date().toISOString().split("T")[0]}.pdf`;t.save(x),c.success("PDF downloaded successfully")}catch(t){console.error("PDF generation error:",t),c.error(`PDF generation failed: ${t.message}`,{autoClose:5e3})}},A=o=>{try{if(typeof dt>"u")throw new Error("XLSX library is not loaded");const t=o.map(a=>({Category:a.category||"",Supplier:a.supplier||"",Product:a.itemName||"",Quantity:a.quantity||"",Price:a.unitPrice||"",Value:a.totalPrice||"","Operation Type":a.operationType||"","Stock Type":a.type||""})),s=D.book_new(),p=D.json_to_sheet(t);p["!cols"]=[{wch:20},{wch:20},{wch:25},{wch:10},{wch:15},{wch:15},{wch:20},{wch:20}],D.book_append_sheet(s,p,"Logs Moments");const v=[{Info:"Generated On",Value:new Date().toLocaleString()},{Info:"Total Records",Value:o.length},{Info:"Exported By",Value:"Logs Management System"}],x=D.json_to_sheet(v);D.book_append_sheet(s,x,"Report Info");const n=`logs_moment_${new Date().toISOString().split("T")[0]}.xlsx`;ct(s,n),c.success("Excel file downloaded successfully ",{autoClose:2500})}catch(t){console.error("Excel generation error:",t),c.error(`Excel generation failed: ${t.message}`,{autoClose:5e3})}},Q=o=>{if(!o)return null;if(typeof o=="string"){const s=o.match(/^\d{4}-\d{2}-\d{2}/);if(s)return new Date(s[0]+"T00:00:00")}const t=new Date(o);return isNaN(t)?null:new Date(t.getFullYear(),t.getMonth(),t.getDate())},g=o=>{const t=Q(o);if(!t)return null;const s=new Date,p=new Date(s.getFullYear(),s.getMonth(),s.getDate());return Math.ceil((t-p)/Me)},G=o=>{const t=g(o);return t===null?"bg-secondary":t<0||t<15?"bg-danger":t<30?"bg-warning text-dark":"bg-success"},$=o=>(o??"").toString().replace(/[_-]+/g," ").trim().replace(/\w\S*/g,t=>t[0].toUpperCase()+t.slice(1).toLowerCase()),X=o=>({inventory_stockin:"Inventory Stockin",inventory_stockout:"Inventory Stockout",purchase:"Purchase",adjustment:"Adjustment",return:"Return"})[o]??$(o),Y=o=>({stockin:"Stockin",stockout:"Stockout"})[o]??$(o),H=o=>{switch(o){case"inventory_stockin":case"purchase":return"text-success";case"inventory_stockout":return"text-danger";case"adjustment":return"text-warning";default:return"text-secondary"}},W=o=>o==="stockin"?"text-success":o==="stockout"?"text-danger":"text-secondary",E=o=>o===""||o===null||o===void 0?0:Number(o),J=o=>Math.round((o+Number.EPSILON)*100)/100;return ot(()=>[r.value.quantity,r.value.unitPrice],([o,t])=>{const s=E(o)*E(t);r.value.totalPrice=J(s)},{immediate:!0}),(o,t)=>(d(),st(nt,null,{default:lt(()=>[e("div",pt,[e("div",gt,[e("div",yt,[e("div",vt,[t[11]||(t[11]=e("h4",{class:"fw-semibold mb-0"},"Stock Moment Logs",-1)),e("div",ft,[e("div",bt,[t[9]||(t[9]=e("i",{class:"bi bi-search"},null,-1)),h(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>S.value=s),type:"text",class:"form-control search-input",placeholder:"Search"},null,512),[[w,S.value]])]),e("div",ht,[t[10]||(t[10]=e("button",{class:"btn btn-outline-secondary rounded-pill px-4 dropdown-toggle","data-bs-toggle":"dropdown"}," Download all ",-1)),e("ul",wt,[e("li",null,[e("a",{class:"dropdown-item py-2",href:"javascript:;",onClick:t[1]||(t[1]=s=>L("pdf"))},"Download as PDF")]),e("li",null,[e("a",{class:"dropdown-item py-2",href:"javascript:;",onClick:t[2]||(t[2]=s=>L("excel"))},"Download as Excel")]),e("li",null,[e("a",{class:"dropdown-item py-2",href:"javascript:;",onClick:t[3]||(t[3]=s=>L("csv"))}," Download as CSV ")])])])])]),e("div",_t,[e("table",xt,[t[13]||(t[13]=e("thead",{class:"small text-muted"},[e("tr",null,[e("th",null,"Item name"),e("th",null,"Total Price"),e("th",null,"Category"),e("th",null,"Unit Price"),e("th",null,"Date & Time"),e("th",null,"Expiry Date"),e("th",null,"Quantity"),e("th",null,"Operation Type"),e("th",null,"Type"),e("th",{class:"text-end"},"Action")])],-1)),e("tbody",null,[(d(!0),u(I,null,at(P.value,(s,p)=>(d(),u("tr",{key:s.id},[e("td",kt,l(s.itemName),1),e("td",null,l(C(s.totalPrice)),1),e("td",null,l(s.category.name),1),e("td",null,l(C(s.unitPrice)),1),e("td",null,l(T(s.dateTime)),1),e("td",null,[s.expiryDate?(d(),u(I,{key:0},[e("span",{class:_(["badge","rounded-pill",G(s.expiryDate)]),title:g(s.expiryDate)!==null?g(s.expiryDate)<0?Math.abs(g(s.expiryDate))+" day(s) ago":g(s.expiryDate)+" day(s) left":""},l(N(s.expiryDate)),11,Dt),e("small",St,l(g(s.expiryDate)<0?Math.abs(g(s.expiryDate))+" day(s) ago":g(s.expiryDate)+" day(s) left"),1)],64)):(d(),u("span",Ct,"—"))]),e("td",null,l(s.quantity),1),e("td",Pt,[s.operationType?(d(),u("span",{key:0,class:_(["fw-semibold",H(s.operationType)])},l(X(s.operationType)),3)):(d(),u("span",Tt,"—"))]),e("td",null,[s.type?(d(),u("span",{key:0,class:_(["fw-semibold",W(s.type)])},l(Y(s.type)),3)):(d(),u("span",Lt,"—"))]),e("td",Mt,[e("button",{class:"p-2 rounded-full text-blue-600 hover:bg-blue-100",onClick:v=>U(s),title:"Adjustment"},[j(F(ut),{class:"w-4 h-4"})],8,Nt),e("button",{class:"p-2 rounded-full text-gray-600 hover:bg-blue-100",onClick:v=>q(s),title:"Show"},[j(F(mt),{class:"w-4 h-4"})],8,$t)])]))),128)),P.value.length===0?(d(),u("tr",Et,[...t[12]||(t[12]=[e("td",{colspan:"10",class:"text-center text-muted py-4"}," No logs found. ",-1)])])):k("",!0)])])]),e("div",Vt,[e("div",It,[e("div",jt,[e("div",Ft,[e("div",qt,[t[15]||(t[15]=e("span",{class:"badge bg-primary rounded-circle p-2"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3 7.5L12 12l9-4.5M3 7.5V17a2 2 0 002 2h14a2 2 0 002-2V7.5M21 7.5L12 3 3 7.5"})])],-1)),e("div",Ut,[t[14]||(t[14]=e("h5",{class:"modal-title mb-0"}," View Stock Log ",-1)),e("small",Bt,"Item: "+l(i.value?.itemName??"—"),1)])]),t[16]||(t[16]=e("button",{class:"absolute top-2 right-2 p-2 rounded-full hover:bg-gray-100 transition transform hover:scale-110","data-bs-dismiss":"modal","aria-label":"Close",title:"Close"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-danger",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})])],-1))]),e("div",Ot,[i.value?(d(),u("div",Rt,[e("div",zt,[e("div",At,[e("div",Qt,[t[26]||(t[26]=e("h6",{class:"fw-semibold mb-3"}," Details ",-1)),e("div",Gt,[e("div",Xt,[t[17]||(t[17]=e("small",{class:"text-muted d-block"},"Category",-1)),e("div",Yt,l(i.value.category?.name??"—"),1)]),e("div",Ht,[t[18]||(t[18]=e("small",{class:"text-muted d-block"},"Operation",-1)),e("div",Wt,l(i.value.operationType??"—"),1)]),e("div",Jt,[t[19]||(t[19]=e("small",{class:"text-muted d-block"},"Quantity",-1)),e("div",Kt,l(i.value.quantity??"—"),1)]),e("div",Zt,[t[20]||(t[20]=e("small",{class:"text-muted d-block"},"Type",-1)),e("span",{class:_(["badge rounded-pill",i.value.type==="stockin"?"bg-success":"bg-danger"])},l(i.value.type??"—"),3)])]),t[27]||(t[27]=e("hr",{class:"my-4"},null,-1)),e("div",te,[e("div",ee,[e("div",oe,[t[21]||(t[21]=e("small",{class:"text-muted d-block"},"Unit Price",-1)),e("div",se,l(C(i.value.unitPrice??0)),1)])]),e("div",le,[e("div",ae,[t[22]||(t[22]=e("small",{class:"text-muted d-block"},"Total Price",-1)),e("div",ne,l(C(i.value.totalPrice??0)),1)])]),e("div",ie,[e("div",re,[t[23]||(t[23]=e("small",{class:"text-muted d-block"},"Date",-1)),e("div",de,l(T(i.value.dateTime)),1)])])]),t[28]||(t[28]=e("hr",{class:"my-4"},null,-1)),e("div",ce,[e("div",ue,[t[24]||(t[24]=e("small",{class:"text-muted d-block"},"Recorded On",-1)),e("div",me,l(T(i.value.dateTime)),1)]),e("div",pe,[t[25]||(t[25]=e("small",{class:"text-muted d-block"},"Expiry Date",-1)),e("div",ge,l(i.value.expiryDate?N(i.value.expiryDate):"—"),1)])])])])])])):k("",!0)])])])]),e("div",ye,[e("div",ve,[e("div",fe,[e("div",{class:"modal-header"},[t[30]||(t[30]=e("h5",{class:"modal-title fw-semibold"}," Edit Stock Log ",-1)),e("button",{class:"absolute top-2 right-2 p-2 rounded-full hover:bg-gray-100 transition transform hover:scale-110","data-bs-dismiss":"modal","aria-label":"Close",title:"Close",onClick:B},[...t[29]||(t[29]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("div",be,[e("div",he,[e("div",we,[t[31]||(t[31]=e("label",{class:"form-label"},"Item Name",-1)),h(e("input",{type:"text",class:"form-control","onUpdate:modelValue":t[4]||(t[4]=s=>r.value.itemName=s),disabled:""},null,512),[[w,r.value.itemName]])]),e("div",_e,[t[32]||(t[32]=e("label",{class:"form-label"},"Quantity",-1)),h(e("input",{type:"number",class:_(["form-control",{"is-invalid":m.value.quantity}]),"onUpdate:modelValue":t[5]||(t[5]=s=>r.value.quantity=s),required:""},null,2),[[w,r.value.quantity]]),m.value.quantity?(d(),u("small",xe,l(m.value.quantity[0]),1)):k("",!0)]),e("div",ke,[t[33]||(t[33]=e("label",{class:"form-label"},"Unit Price",-1)),h(e("input",{type:"number",class:_(["form-control",{"is-invalid":m.value.unitPrice}]),"onUpdate:modelValue":t[6]||(t[6]=s=>r.value.unitPrice=s),required:""},null,2),[[w,r.value.unitPrice]]),m.value.unitPrice?(d(),u("small",De,l(m.value.unitPrice[0]),1)):k("",!0)]),e("div",Se,[t[34]||(t[34]=e("label",{class:"form-label"},"Value",-1)),h(e("input",{type:"number",readonly:"",class:"form-control","onUpdate:modelValue":t[7]||(t[7]=s=>r.value.totalPrice=s)},null,512),[[w,r.value.totalPrice]])]),e("div",Ce,[t[35]||(t[35]=e("label",{class:"form-label"},"Expiry Date",-1)),h(e("input",{type:"date",class:"form-control","onUpdate:modelValue":t[8]||(t[8]=s=>o.expiryDateModel=s)},null,512),[[w,o.expiryDateModel]])]),e("div",Pe,[e("button",{class:"btn btn-primary rounded-pill px-4 d-inline-flex align-items-center gap-2",disabled:y.value,"aria-busy":y.value?"true":"false",onClick:O},[y.value?(d(),u("span",Le)):k("",!0),e("span",null,l(y.value?"Updating…":"Update"),1)],8,Te)])])])])])])])])])]),_:1}))}},Ae=Z(Ne,[["__scopeId","data-v-ed9dc145"]]);export{Ae as default};
