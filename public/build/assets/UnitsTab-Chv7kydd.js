import{_ as te,r as m,D as M,k as se,j as ae,g as i,o as d,b as t,a as P,x as U,y as T,f as y,d as O,i as C,F as D,v as R,t as g,V as oe,W as z,n as j,J as ne,A as k,p as le,m as n}from"./app-DgHj6V6q.js";import{E as re,a as ie,X as de,u as F,w as ue}from"./xlsx-B5Xi98cQ.js";import{I as ce}from"./importFile-C9EmJvbV.js";import{P as me}from"./plus-BS0M9IQ8.js";import{P as ve}from"./pencil-DagjvPCE.js";const fe={class:"card border-0 shadow-lg rounded-4"},pe={class:"card-body"},be={class:"d-flex flex-wrap gap-2 justify-content-between align-items-center mb-3"},ge={class:"d-flex gap-2"},he={class:"search-wrap"},ye={class:"dropdown"},we={class:"dropdown-menu dropdown-menu-end shadow rounded-4 py-2"},_e={class:"table-responsive"},xe={class:"table table-hover"},Ue={class:"fw-semibold"},Ce={class:"text-center"},ke={class:"d-inline-flex align-items-center gap-3"},Se=["onClick"],Ee={key:0},De={colspan:"3",class:"text-center text-muted py-4"},Fe={class:"modal fade",id:"modalUnitForm",tabindex:"-1","aria-hidden":"true"},Ne={class:"modal-dialog modal-lg modal-dialog-centered"},Pe={class:"modal-content rounded-4"},Ie={class:"modal-header"},$e={class:"modal-title"},Le={class:"modal-body"},Ve={class:"mb-3 d-flex gap-3 align-items-center"},Te={class:"form-check-label"},je={class:"form-check-label"},Ae={class:"text-muted d-block mt-1"},Be={key:0},Me={key:0,class:"text-danger"},Oe={key:1,class:"mt-3"},Re={key:0,class:"alert alert-warning"},ze=["value"],Xe={key:2,class:"text-danger"},qe={key:3,class:"text-danger"},He={class:"col-md-2 mt-4"},We=["disabled"],Ge={__name:"UnitsTab",setup(Je){const S=m(!1),I=m(null),c=m(""),v=m("base"),h=m(null),p=m(null),x=m(""),A=M(()=>r.value.filter(a=>!a.base_unit_id)),N=()=>{c.value="",l.value={},v.value="base",h.value=null,p.value=null},$=M(()=>{const a=x.value.trim().toLowerCase();return a?r.value.filter(e=>e.name.toLowerCase().includes(a)):r.value}),X=()=>{S.value=!1,c.value=""},q=a=>{S.value=!0,I.value=a,c.value=a.name,v.value=a.base_unit_id?"derived":"base",h.value=a.base_unit_id,p.value=a.conversion_factor},H=async a=>{try{l.value={},await k.delete(`/units/${a.id}`),r.value=r.value.filter(e=>e.id!==a.id),n.success("Unit deleted successfully")}catch(e){e.response&&e.response.data&&e.response.data.message?(l.value.delete=e.response.data.message,n.error(e.response.data.message)):(l.value.delete="An unexpected error occurred while deleting the unit.",n.error("Delete failed"))}},b=m(!1),W=async()=>{if(!b.value){if(!c.value.trim()){n.error("Please fill out the field can't save an empty field."),l.value={name:["Please fill out the field can't save an empty field"]};return}if(S.value){if(v.value==="derived"){if(!h.value){n.error("Please select a base unit"),l.value={base_unit_id:["Base unit is required for derived units"]};return}if(!p.value||p.value<=0){n.error("Please enter a valid conversion factor"),l.value={conversion_factor:["Conversion factor must be greater than 0"]};return}}try{b.value=!0;const a={name:c.value.trim(),base_unit_id:v.value==="derived"?Number(h.value):null,conversion_factor:v.value==="derived"?Number(p.value):null},{data:e}=await k.put(`/units/${I.value.id}`,a),s=r.value.findIndex(o=>o.id===I.value.id);s!==-1&&(r.value[s]=e),n.success("Unit updated successfully"),await E(),N(),L("modalUnitForm")}catch(a){a.response?.data?.errors?(l.value={},Object.entries(a.response.data.errors).forEach(([e,s])=>{s.forEach(f=>n.error(f));const o=e.includes(".")?"name":e;l.value[o]=s})):n.error("Update failed")}finally{b.value=!1}}else{if(r.value.some(e=>e.name.toLowerCase()===c.value.trim().toLowerCase())){n.error(`Unit "${c.value.trim()}" already exists. Please use a different name or edit the existing unit.`),l.value={name:[`Unit "${c.value.trim()}" already exists`]};return}if(v.value==="derived"){if(!h.value){n.error("Please select a base unit"),l.value={base_unit_id:["Base unit is required"]};return}if(!p.value||p.value<=0){n.error("Please enter a valid conversion factor"),l.value={conversion_factor:["Conversion factor must be greater than 0"]};return}const e={name:c.value.trim(),base_unit_id:h.value,conversion_factor:p.value};try{b.value=!0;const s=await k.post("/units",{units:[e]}),o=s.data?.units??s.data;Array.isArray(o)&&o.length&&(r.value=[...r.value,...o]),n.success("Derived unit added successfully"),N(),L("modalUnitForm"),await E()}catch(s){s.response?.data?.errors?(l.value={},Object.entries(s.response.data.errors).forEach(([o,f])=>{f.forEach(u=>n.error(u));const w=o.includes(".name")?"name":o.includes(".base_unit_id")?"base_unit_id":o.includes(".conversion_factor")?"conversion_factor":o;l.value[w]=f})):(console.error(s),n.error("Create failed"))}finally{b.value=!1}}else{const e={name:c.value.trim(),base_unit_id:null,conversion_factor:null};try{b.value=!0;const s=await k.post("/units",{units:[e]}),o=s.data?.units??s.data;Array.isArray(o)&&o.length&&(r.value=[...r.value,...o]),n.success("Unit added successfully"),N(),L("modalUnitForm"),await E()}catch(s){s.response?.data?.errors?Object.values(s.response.data.errors).forEach(o=>o.forEach(f=>n.error(f))):(console.error(s),n.error("Create failed"))}finally{b.value=!1}}}}},L=a=>{const e=document.getElementById(a);if(!e)return;(window.bootstrap?.Modal.getInstance(e)||new window.bootstrap.Modal(e)).hide()},r=m([]),G=m(1),J=m(15),B=m(!1),l=m({}),E=async()=>{B.value=!0;try{const{data:a}=await k.get("/units",{params:{q:x.value,page:G.value,per_page:J.value}});r.value=a?.data??a?.units?.data??a??[],await le(),window.feather?.replace()}catch(a){console.error("Failed to fetch units",a)}finally{B.value=!1}},V=a=>{if(!r.value||r.value.length===0){n.error("No Units data to download");return}const e=x.value.trim()?$.value:r.value;if(e.length===0){n.error("No Units found to download");return}try{a==="pdf"?K(e):a==="excel"?Q(e):a==="csv"?Y(e):n.error("Invalid download type")}catch(s){console.error("Download failed:",s),n.error(`Download failed: ${s.message}`)}},Y=a=>{try{const e=["Name"],s=a.map(_=>[`"${_.name||""}"`]),o=[e.join(","),...s.map(_=>_.join(","))].join(`
`),f=new Blob([o],{type:"text/csv;charset=utf-8;"}),w=URL.createObjectURL(f),u=document.createElement("a");u.setAttribute("href",w),u.setAttribute("download",`units_${new Date().toISOString().split("T")[0]}.csv`),document.body.appendChild(u),u.click(),document.body.removeChild(u),n.success("CSV downloaded successfully")}catch(e){console.error("CSV generation error:",e),n.error(`CSV generation failed: ${e.message}`,{autoClose:5e3})}},K=a=>{try{const e=new re("p","mm","a4");e.setFontSize(20),e.setFont("helvetica","bold"),e.text("Units Report",14,20),e.setFontSize(10),e.setFont("helvetica","normal");const s=new Date().toLocaleString();e.text(`Generated on: ${s}`,14,28),e.text(`Total Units: ${a.length}`,14,34);const o=["Name"],f=a.map(u=>[u.name||""]);ie(e,{head:[o],body:f,startY:40,styles:{fontSize:10,cellPadding:3,halign:"left",lineColor:[0,0,0],lineWidth:.1},headStyles:{fillColor:[41,128,185],textColor:255,fontStyle:"bold"},alternateRowStyles:{fillColor:[240,240,240]},margin:{left:14,right:14},didDrawPage:u=>{const _=e.internal.getNumberOfPages(),ee=e.internal.pageSize.height;e.setFontSize(8),e.text(`Page ${u.pageNumber} of ${_}`,u.settings.margin.left,ee-10)}});const w=`units_${new Date().toISOString().split("T")[0]}.pdf`;e.save(w),n.success("PDF downloaded successfully")}catch(e){console.error("PDF generation error:",e),n.error(`PDF generation failed: ${e.message}`,{autoClose:5e3})}},Q=a=>{try{if(typeof de>"u")throw new Error("XLSX library is not loaded");const e=a.map(_=>({Name:_.name||""})),s=F.book_new(),o=F.json_to_sheet(e);o["!cols"]=[{wch:25}],F.book_append_sheet(s,o,"Units");const f=[{Info:"Generated On",Value:new Date().toLocaleString()},{Info:"Total Units",Value:a.length},{Info:"Exported By",Value:"Units Management System"}],w=F.json_to_sheet(f);F.book_append_sheet(s,w,"Report Info");const u=`units_${new Date().toISOString().split("T")[0]}.xlsx`;ue(s,u),n.success("Excel file downloaded successfully",{autoClose:2500})}catch(e){console.error("Excel generation error:",e),n.error(`Excel generation failed: ${e.message}`,{autoClose:5e3})}};se(async()=>{await E(),window.feather?.replace()}),ae(c,a=>{a&&l.value.name&&delete l.value.name});const Z=a=>{if(console.log("Imported Data:",a),!a||a.length<=1){n.error("The file is empty",{autoClose:3e3});return}a[0];const e=a.slice(1);console.log(e);const s=e.map(o=>({name:o[0]||""}));k.post("/api/units/import",{units:s}).then(()=>{n.success("Units imported successfully"),E()}).catch(o=>{o?.response?.status===422&&o.response.data?.errors&&(l.value=o.response.data.errors,n.error("There may be some duplication in data",{autoClose:3e3}))})};return(a,e)=>(d(),i(D,null,[t("div",fe,[t("div",pe,[t("div",be,[e[13]||(e[13]=t("h4",{class:"mb-0"},"Units",-1)),t("div",ge,[t("div",he,[e[10]||(e[10]=t("i",{class:"bi bi-search"},null,-1)),U(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>x.value=s),class:"form-control search-input",placeholder:"Search"},null,512),[[T,x.value]])]),t("button",{"data-bs-toggle":"modal","data-bs-target":"#modalUnitForm",onClick:e[1]||(e[1]=()=>{X(),N(),l.value={}}),class:"d-flex align-items-center gap-1 px-4 btn-sm py-2 rounded-pill btn btn-primary text-white"},[P(O(me),{class:"w-4 h-4"}),e[11]||(e[11]=y(" Add Unit ",-1))]),P(ce,{label:"Import",sampleHeaders:["Name"],sampleData:[["Example Unit 1"],["Example Unit 2"]],onOnImport:Z}),t("div",ye,[e[12]||(e[12]=t("button",{class:"btn btn-outline-secondary btn-sm py-2 rounded-pill px-4 dropdown-toggle","data-bs-toggle":"dropdown"}," Export ",-1)),t("ul",we,[t("li",null,[t("a",{class:"dropdown-item py-2",href:"javascript:;",onClick:e[2]||(e[2]=s=>V("pdf"))},"Export as PDF")]),t("li",null,[t("a",{class:"dropdown-item py-2",href:"javascript:;",onClick:e[3]||(e[3]=s=>V("excel"))},"Export as Excel")]),t("li",null,[t("a",{class:"dropdown-item py-2",href:"javascript:;",onClick:e[4]||(e[4]=s=>V("csv"))}," Export as CSV ")])])])])]),t("div",_e,[t("table",xe,[e[14]||(e[14]=t("thead",{class:"border-top small text-muted"},[t("tr",null,[t("th",null,"S. #"),t("th",null,"Unit Name"),t("th",{class:"text-center"},"Action")])],-1)),t("tbody",null,[(d(!0),i(D,null,R($.value,(s,o)=>(d(),i("tr",{key:s.id},[t("td",null,g(o+1),1),t("td",Ue,g(s.name),1),t("td",Ce,[t("div",ke,[t("button",{"data-bs-toggle":"modal","data-bs-target":"#modalUnitForm",onClick:()=>{q(s),l.value={}},title:"Edit",class:"p-2 rounded-full text-blue-600 hover:bg-blue-100"},[P(O(ve),{class:"w-4 h-4"})],8,Se),P(oe,{title:"Confirm Delete",message:`Are you sure you want to delete ${s.name}?`,showDeleteButton:!0,onConfirm:()=>{H(s)},onCancel:()=>{}},null,8,["message","onConfirm"])])])]))),128)),$.value.length===0?(d(),i("tr",Ee,[t("td",De,g(x.value.trim()?"No units found matching your search.":"No units found."),1)])):C("",!0)])])])])]),t("div",Fe,[t("div",Ne,[t("div",Pe,[t("div",Ie,[t("h5",$e,g(S.value?"Edit Unit":"Add Unit(s)"),1),e[15]||(e[15]=t("button",{class:"absolute top-2 right-2 p-2 rounded-full hover:bg-gray-100 transition transform hover:scale-110","data-bs-dismiss":"modal","aria-label":"Close",title:"Close"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})])],-1))]),t("div",Le,[t("div",Ve,[t("label",Te,[U(t("input",{type:"radio",class:"form-check-input me-2",value:"base","onUpdate:modelValue":e[5]||(e[5]=s=>v.value=s)},null,512),[[z,v.value]]),e[16]||(e[16]=y(" Base Unit ",-1))]),t("label",je,[U(t("input",{type:"radio",class:"form-check-input me-2",value:"derived","onUpdate:modelValue":e[6]||(e[6]=s=>v.value=s)},null,512),[[z,v.value]]),e[17]||(e[17]=y(" Derived Unit ",-1))])]),t("div",null,[e[23]||(e[23]=t("label",{class:"form-label"},"Unit Name",-1)),U(t("input",{"onUpdate:modelValue":e[7]||(e[7]=s=>c.value=s),class:j(["form-control",{"is-invalid":l.value.name}]),placeholder:"e.g., Millilitre (ml)"},null,2),[[T,c.value]]),t("small",Ae,[v.value==="derived"?(d(),i("span",Be,` ⚠️ Enter a NEW unit name (e.g., "ml" if base is "L"). Don't use existing unit names. `)):C("",!0)]),l.value.name?(d(),i("div",Me,g(l.value.name[0]),1)):C("",!0),v.value==="derived"?(d(),i("div",Oe,[e[19]||(e[19]=t("div",{class:"alert alert-info"},[t("strong",null,"Example:"),y(' If you want to create "Millilitre (ml)" from "Litre (L)":'),t("br"),y(' • Select "Litre (L)" as base unit'),t("br"),y(" • Enter conversion: 0.001 (because 1 ml = 0.001 L) ")],-1)),e[20]||(e[20]=t("label",{class:"form-label"},"Base Unit",-1)),A.value.length===0?(d(),i("div",Re," No base units available. Please create base units first before creating derived units. ")):U((d(),i("select",{key:1,"onUpdate:modelValue":e[8]||(e[8]=s=>h.value=s),class:j(["form-select",{"is-invalid":l.value.base_unit_id}])},[e[18]||(e[18]=t("option",{value:null,disabled:""},"Select base unit",-1)),(d(!0),i(D,null,R(A.value,s=>(d(),i("option",{key:s.id,value:s.id},g(s.name),9,ze))),128))],2)),[[ne,h.value]]),l.value.base_unit_id?(d(),i("div",Xe,g(l.value.base_unit_id[0]),1)):C("",!0),e[21]||(e[21]=t("label",{class:"form-label mt-3"},"Conversion Factor",-1)),U(t("input",{type:"number",step:"any","onUpdate:modelValue":e[9]||(e[9]=s=>p.value=s),class:j(["form-control",{"is-invalid":l.value.conversion_factor}]),placeholder:"e.g., 0.001"},null,2),[[T,p.value,void 0,{number:!0}]]),e[22]||(e[22]=t("small",{class:"text-muted d-block mt-1"},"How many base units = 1 of this unit (e.g., 1 ml = 0.001 L)",-1)),l.value.conversion_factor?(d(),i("div",qe,g(l.value.conversion_factor[0]),1)):C("",!0)])):C("",!0)]),t("div",He,[t("button",{class:"btn btn-primary rounded-pill py-2 btn-sm w-100",disabled:b.value,onClick:W},[b.value?(d(),i(D,{key:0},[e[24]||(e[24]=t("span",{class:"spinner-border spinner-border-sm me-2"},null,-1)),e[25]||(e[25]=y("Saving... ",-1))],64)):(d(),i(D,{key:1},[y(g((S.value,"Save")),1)],64))],8,We)])])])])])],64))}},tt=te(Ge,[["__scopeId","data-v-b35bb033"]]);export{tt as default};
