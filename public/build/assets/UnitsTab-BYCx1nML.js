import{_ as ne,r as b,c as X,y as H,o as le,f as r,b as i,d as F,e as t,u as A,h as re,m as S,k as D,v as M,l as x,F as P,g as G,t as c,C as ie,T as de,Y as W,i as B,S as ue,p as E,n as ce,q as n}from"./app-TGxiLcAW.js";import{E as me,a as ve,X as pe,u as N,w as fe}from"./xlsx-CYRbBo-W.js";import{I as be}from"./importFile-CGLOOXXM.js";import{P as ge}from"./plus-B56yZx8O.js";import{P as he}from"./pencil-6CC6F6BG.js";import"./createLucideIcon-Bh-SXUX4.js";const ye={class:"card border-0 shadow-lg rounded-4"},_e={class:"card-body"},we={class:"d-flex flex-wrap gap-2 justify-content-between align-items-center mb-3"},xe={class:"d-flex gap-2"},ke={class:"search-wrap"},Ce={class:"dropdown"},Ue={class:"dropdown-menu dropdown-menu-end shadow rounded-4 py-2"},Se={class:"table-responsive"},Ee={class:"table table-hover"},Fe={key:0},De={class:"fw-semibold"},Pe={class:"fw-semibold"},Le={class:"fw-semibold"},$e={class:"text-center"},Ne={class:"d-inline-flex align-items-center gap-3"},Te=["onClick"],Ie={key:0},Ve={colspan:"5",class:"text-center text-muted py-4"},je={key:0,class:"mt-4 d-flex justify-content-between align-items-center"},Ae={class:"text-muted small"},Me={class:"modal fade",id:"modalUnitForm",tabindex:"-1","aria-hidden":"true"},Be={class:"modal-dialog modal-lg modal-dialog-centered"},Re={class:"modal-content rounded-4"},Oe={class:"modal-header"},qe={class:"modal-title"},ze={class:"modal-body"},Xe={class:"mb-3 d-flex gap-3 align-items-center"},He={class:"form-check-label"},Ge={class:"form-check-label"},We={class:"text-muted d-block mt-1"},Ye={key:0},Je={key:0,class:"text-danger"},Ke={key:1,class:"mt-3"},Qe={key:0,class:"alert alert-warning"},Ze=["value"],et={key:2,class:"text-danger"},tt={key:3,class:"text-danger"},at={class:"col-md-2 mt-4"},st=["disabled"],ot={__name:"UnitsTab",setup(nt){const L=b(!1),I=b(null),m=b(""),p=b("base"),w=b(null),g=b(null),k=b(""),R=X(()=>v.value.filter(s=>!s.base_unit_id)),T=()=>{m.value="",l.value={},p.value="base",w.value=null,g.value=null},O=X(()=>{const s=k.value.trim().toLowerCase();return s?v.value.filter(e=>e.name.toLowerCase().includes(s)):v.value}),Y=()=>{L.value=!1,m.value=""},J=s=>{L.value=!0,I.value=s,m.value=s.name,p.value=s.base_unit_id?"derived":"base",w.value=s.base_unit_id,g.value=s.conversion_factor},K=async s=>{try{l.value={},await E.delete(`/units/${s.id}`),v.value=v.value.filter(e=>e.id!==s.id),n.success("Unit deleted successfully")}catch(e){e.response&&e.response.data&&e.response.data.message?(l.value.delete=e.response.data.message,n.error(e.response.data.message)):(l.value.delete="An unexpected error occurred while deleting the unit.",n.error("Delete failed"))}},y=b(!1),Q=async()=>{if(!y.value){if(!m.value.trim()){n.error("Please fill out the field can't save an empty field."),l.value={name:["Please fill out the field can't save an empty field"]};return}if(L.value){if(p.value==="derived"){if(!w.value){n.error("Please select a base unit"),l.value={base_unit_id:["Base unit is required for derived units"]};return}if(!g.value||g.value<=0){n.error("Please enter a valid conversion factor"),l.value={conversion_factor:["Conversion factor must be greater than 0"]};return}}try{y.value=!0;const s={name:m.value.trim(),base_unit_id:p.value==="derived"?Number(w.value):null,conversion_factor:p.value==="derived"?Number(g.value):null},{data:e}=await E.put(`/units/${I.value.id}`,s),a=v.value.findIndex(o=>o.id===I.value.id);a!==-1&&(v.value[a]=e),n.success("Unit updated successfully"),await C(),T(),V("modalUnitForm")}catch(s){s.response?.data?.errors?(l.value={},Object.entries(s.response.data.errors).forEach(([e,a])=>{a.forEach(d=>n.error(d));const o=e.includes(".")?"name":e;l.value[o]=a})):n.error("Update failed")}finally{y.value=!1}}else{if(v.value.some(e=>e.name.toLowerCase()===m.value.trim().toLowerCase())){n.error(`Unit "${m.value.trim()}" already exists. Please use a different name or edit the existing unit.`),l.value={name:[`Unit "${m.value.trim()}" already exists`]};return}if(p.value==="derived"){if(!w.value){n.error("Please select a base unit"),l.value={base_unit_id:["Base unit is required"]};return}if(!g.value||g.value<=0){n.error("Please enter a valid conversion factor"),l.value={conversion_factor:["Conversion factor must be greater than 0"]};return}const e={name:m.value.trim(),base_unit_id:w.value,conversion_factor:g.value};try{y.value=!0;const a=await E.post("/units",{units:[e]}),o=a.data?.units??a.data;Array.isArray(o)&&o.length&&(v.value=[...v.value,...o]),n.success("Derived unit added successfully"),T(),V("modalUnitForm"),await C()}catch(a){a.response?.data?.errors?(l.value={},Object.entries(a.response.data.errors).forEach(([o,d])=>{d.forEach(u=>n.error(u));const f=o.includes(".name")?"name":o.includes(".base_unit_id")?"base_unit_id":o.includes(".conversion_factor")?"conversion_factor":o;l.value[f]=d})):(console.error(a),n.error("Create failed"))}finally{y.value=!1}}else{const e={name:m.value.trim(),base_unit_id:null,conversion_factor:null};try{y.value=!0;const a=await E.post("/units",{units:[e]}),o=a.data?.units??a.data;Array.isArray(o)&&o.length&&(v.value=[...v.value,...o]),n.success("Unit added successfully"),T(),V("modalUnitForm"),await C()}catch(a){a.response?.data?.errors?Object.values(a.response.data.errors).forEach(o=>o.forEach(d=>n.error(d))):(console.error(a),n.error("Create failed"))}finally{y.value=!1}}}}},V=s=>{const e=document.getElementById(s);if(!e)return;(window.bootstrap?.Modal.getInstance(e)||new window.bootstrap.Modal(e)).hide()},v=b([]),h=b({current_page:1,last_page:1,per_page:10,total:0,from:0,to:0,links:[]}),_=b(!1),l=b({}),C=async(s=null)=>{_.value=!0;try{const{data:e}=await E.get("/units",{params:{q:k.value,page:s||h.value.current_page,per_page:h.value.per_page}});v.value=e.data||[],h.value={current_page:e.current_page,last_page:e.last_page,per_page:e.per_page,total:e.total,from:e.from,to:e.to,links:e.links},await ce(),window.feather?.replace()}catch(e){console.error("Failed to fetch units",e),n.error("Failed to load units")}finally{_.value=!1}},Z=s=>{if(!s)return;const a=new URLSearchParams(s.split("?")[1]).get("page");a&&C(parseInt(a))};let q=null;H(k,()=>{clearTimeout(q),q=setTimeout(()=>{h.value.current_page=1,C(1)},500)});const ee=async()=>{try{_.value=!0;const s=await E.get("/units",{params:{q:k.value.trim(),per_page:1e4,page:1}});return console.log("ðŸ“¦ Export data received:",{total:s.data.total,items:s.data.data.length}),s.data.data||[]}catch(s){return console.error("âŒ Error fetching export data:",s),n.error("Failed to load data for export"),[]}finally{_.value=!1}},j=async s=>{try{_.value=!0,n.info("Preparing export data...",{autoClose:1500});const e=await ee();if(!e||e.length===0){n.error("No units found to download"),_.value=!1;return}console.log(`ðŸ“¥ Exporting ${e.length} units as ${s.toUpperCase()}`),s==="pdf"?ae(e):s==="excel"?se(e):s==="csv"?te(e):n.error("Invalid download type")}catch(e){console.error("Download failed:",e),n.error(`Download failed: ${e.message}`)}finally{_.value=!1}},te=s=>{try{const e=["Name"],a=s.map(U=>[($=>$==null?'""':($=String($).replace(/"/g,'""'),`"${$}"`))(U.name)]),o=[e.join(","),...a.map(U=>U.join(","))].join(`
`),d=new Blob([o],{type:"text/csv;charset=utf-8;"}),f=URL.createObjectURL(d),u=document.createElement("a");u.setAttribute("href",f),u.setAttribute("download",`units_${new Date().toISOString().split("T")[0]}.csv`),document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(f),n.success(`CSV downloaded successfully (${s.length} units)`,{autoClose:2500})}catch(e){console.error("CSV generation error:",e),n.error(`CSV generation failed: ${e.message}`,{autoClose:5e3})}},ae=s=>{try{const e=new me("p","mm","a4");e.setFontSize(20),e.setFont("helvetica","bold"),e.text("Units Report",14,20),e.setFontSize(10),e.setFont("helvetica","normal");const a=new Date().toLocaleString();e.text(`Generated on: ${a}`,14,28),e.text(`Total Units: ${s.length}`,14,34);const o=["Name"],d=s.map(u=>[u.name||""]);ve(e,{head:[o],body:d,startY:40,styles:{fontSize:10,cellPadding:3,halign:"left",lineColor:[0,0,0],lineWidth:.1},headStyles:{fillColor:[41,128,185],textColor:255,fontStyle:"bold"},alternateRowStyles:{fillColor:[240,240,240]},margin:{left:14,right:14},didDrawPage:u=>{const U=e.internal.getNumberOfPages(),z=e.internal.pageSize.height;e.setFontSize(8),e.text(`Page ${u.pageNumber} of ${U}`,u.settings.margin.left,z-10)}});const f=`units_${new Date().toISOString().split("T")[0]}.pdf`;e.save(f),n.success(`PDF downloaded successfully (${s.length} units)`,{autoClose:2500})}catch(e){console.error("PDF generation error:",e),n.error(`PDF generation failed: ${e.message}`,{autoClose:5e3})}},se=s=>{try{if(typeof pe>"u")throw new Error("XLSX library is not loaded");const e=s.map(U=>({Name:U.name||""})),a=N.book_new(),o=N.json_to_sheet(e);o["!cols"]=[{wch:25}],N.book_append_sheet(a,o,"Units");const d=[{Info:"Generated On",Value:new Date().toLocaleString()},{Info:"Total Units",Value:s.length},{Info:"Exported By",Value:"Units Management System"}],f=N.json_to_sheet(d);N.book_append_sheet(a,f,"Report Info");const u=`units_${new Date().toISOString().split("T")[0]}.xlsx`;fe(a,u),n.success(`Excel file downloaded successfully (${s.length} units)`,{autoClose:2500})}catch(e){console.error("Excel generation error:",e),n.error(`Excel generation failed: ${e.message}`,{autoClose:5e3})}};le(async()=>{await C(),window.feather?.replace()}),H(m,s=>{s&&l.value.name&&delete l.value.name});const oe=s=>{if(!s||s.length<=1){n.error("The file is empty",{autoClose:3e3});return}s[0];const a=s.slice(1).map(o=>({name:o[0]||""}));E.post("/api/units/import",{units:a}).then(()=>{n.success("Units imported successfully");const o=document.querySelector(".modal.show");if(o){const d=bootstrap.Modal.getInstance(o);d&&d.hide()}setTimeout(()=>{document.querySelectorAll(".modal-backdrop").forEach(f=>f.remove()),document.body.classList.remove("modal-open"),document.body.style.overflow="",document.body.style.paddingRight=""},100),C()}).catch(o=>{o?.response?.status===422&&o.response.data?.errors&&(l.value=o.response.data.errors,n.error("There may be some duplication in data",{autoClose:3e3})),setTimeout(()=>{document.querySelectorAll(".modal-backdrop").forEach(f=>f.remove()),document.body.classList.remove("modal-open"),document.body.style.overflow="",document.body.style.paddingRight=""},100)})};return(s,e)=>(i(),r(P,null,[F(A(re),{title:"Unit"}),t("div",ye,[t("div",_e,[t("div",we,[e[13]||(e[13]=t("h4",{class:"mb-0"},"Units",-1)),t("div",xe,[t("div",ke,[e[10]||(e[10]=t("i",{class:"bi bi-search"},null,-1)),D(t("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>k.value=a),class:"form-control search-input",placeholder:"Search"},null,512),[[M,k.value]])]),t("button",{"data-bs-toggle":"modal","data-bs-target":"#modalUnitForm",onClick:e[1]||(e[1]=()=>{Y(),T(),l.value={}}),class:"d-flex align-items-center gap-1 px-4 btn-sm py-2 rounded-pill btn btn-primary text-white"},[F(A(ge),{class:"w-4 h-4"}),e[11]||(e[11]=x(" Add Unit ",-1))]),F(be,{label:"Import",sampleHeaders:["Name"],sampleData:[["Example Unit 1"],["Example Unit 2"]],onOnImport:oe}),t("div",Ce,[e[12]||(e[12]=t("button",{class:"btn btn-outline-secondary btn-sm py-2 rounded-pill px-4 dropdown-toggle","data-bs-toggle":"dropdown"}," Export ",-1)),t("ul",Ue,[t("li",null,[t("a",{class:"dropdown-item py-2",href:"javascript:;",onClick:e[2]||(e[2]=a=>j("pdf"))},"Export as PDF")]),t("li",null,[t("a",{class:"dropdown-item py-2",href:"javascript:;",onClick:e[3]||(e[3]=a=>j("excel"))},"Export as Excel")]),t("li",null,[t("a",{class:"dropdown-item py-2",href:"javascript:;",onClick:e[4]||(e[4]=a=>j("csv"))}," Export as CSV ")])])])])]),t("div",Se,[t("table",Ee,[e[15]||(e[15]=t("thead",{class:"border-top small text-muted"},[t("tr",null,[t("th",null,"S. #"),t("th",null,"Unit Name"),t("th",null,"Derived From"),t("th",null,"Conversion Factor"),t("th",{class:"text-center"},"Action")])],-1)),t("tbody",null,[_.value?(i(),r("tr",Fe,[...e[14]||(e[14]=[t("td",{colspan:"5",class:"text-center py-5"},[t("div",{class:"spinner-border text-primary",role:"status"},[t("span",{class:"visually-hidden"},"Loading...")]),t("p",{class:"text-muted mt-2 mb-0"},"Loading units...")],-1)])])):(i(),r(P,{key:1},[(i(!0),r(P,null,G(O.value,(a,o)=>(i(),r("tr",{key:a.id},[t("td",null,c(h.value.from+o),1),t("td",De,c(a.name),1),t("td",Pe,c(a?.base_unit?.name),1),t("td",Le,c(a.base_unit_id?a.conversion_factor:"-"),1),t("td",$e,[t("div",Ne,[t("button",{"data-bs-toggle":"modal","data-bs-target":"#modalUnitForm",onClick:()=>{J(a),l.value={}},title:"Edit",class:"p-2 rounded-full text-blue-600 hover:bg-blue-100"},[F(A(he),{class:"w-4 h-4"})],8,Te),F(ie,{title:"Confirm Delete",message:`Are you sure you want to delete ${a.name}?`,showDeleteButton:!0,onConfirm:()=>{K(a)},onCancel:()=>{}},null,8,["message","onConfirm"])])])]))),128)),O.value.length===0?(i(),r("tr",Ie,[t("td",Ve,c(k.value.trim()?"No units found matching your search.":"No units found."),1)])):S("",!0)],64))])])]),!_.value&&h.value.last_page>1?(i(),r("div",je,[t("div",Ae," Showing "+c(h.value.from)+" to "+c(h.value.to)+" of "+c(h.value.total)+" entries ",1),F(de,{pagination:h.value.links,isApiDriven:!0,onPageChanged:Z},null,8,["pagination"])])):S("",!0)])]),t("div",Me,[t("div",Be,[t("div",Re,[t("div",Oe,[t("h5",qe,c(L.value?"Edit Unit":"Add Unit(s)"),1),e[16]||(e[16]=t("button",{class:"absolute top-2 right-2 p-2 rounded-full hover:bg-gray-100 transition transform hover:scale-110","data-bs-dismiss":"modal","aria-label":"Close",title:"Close"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})])],-1))]),t("div",ze,[t("div",Xe,[t("label",He,[D(t("input",{type:"radio",class:"form-check-input me-2",value:"base","onUpdate:modelValue":e[5]||(e[5]=a=>p.value=a)},null,512),[[W,p.value]]),e[17]||(e[17]=x(" Base Unit ",-1))]),t("label",Ge,[D(t("input",{type:"radio",class:"form-check-input me-2",value:"derived","onUpdate:modelValue":e[6]||(e[6]=a=>p.value=a)},null,512),[[W,p.value]]),e[18]||(e[18]=x(" Derived Unit ",-1))])]),t("div",null,[e[24]||(e[24]=t("label",{class:"form-label"},"Unit Name",-1)),D(t("input",{"onUpdate:modelValue":e[7]||(e[7]=a=>m.value=a),class:B(["form-control",{"is-invalid":l.value.name}]),placeholder:"e.g., Millilitre (ml)"},null,2),[[M,m.value]]),t("small",We,[p.value==="derived"?(i(),r("span",Ye,` âš ï¸ Enter a NEW unit name (e.g., "ml" if base is "L"). Don't use existing unit names. `)):S("",!0)]),l.value.name?(i(),r("div",Je,c(l.value.name[0]),1)):S("",!0),p.value==="derived"?(i(),r("div",Ke,[e[20]||(e[20]=t("div",{class:"alert alert-info"},[t("strong",null,"Example:"),x(' If you want to create "Millilitre (ml)" from "Litre (L)":'),t("br"),x(' â€¢ Select "Litre (L)" as base unit'),t("br"),x(" â€¢ Enter conversion: 0.001 (because 1 ml = 0.001 L) ")],-1)),e[21]||(e[21]=t("label",{class:"form-label"},"Base Unit",-1)),R.value.length===0?(i(),r("div",Qe," No base units available. Please create base units first before creating derived units. ")):D((i(),r("select",{key:1,"onUpdate:modelValue":e[8]||(e[8]=a=>w.value=a),class:B(["form-select",{"is-invalid":l.value.base_unit_id}])},[e[19]||(e[19]=t("option",{value:null,disabled:""},"Select base unit",-1)),(i(!0),r(P,null,G(R.value,a=>(i(),r("option",{key:a.id,value:a.id},c(a.name),9,Ze))),128))],2)),[[ue,w.value]]),l.value.base_unit_id?(i(),r("div",et,c(l.value.base_unit_id[0]),1)):S("",!0),e[22]||(e[22]=t("label",{class:"form-label mt-3"},"Conversion Factor",-1)),D(t("input",{type:"number",step:"any","onUpdate:modelValue":e[9]||(e[9]=a=>g.value=a),class:B(["form-control",{"is-invalid":l.value.conversion_factor}]),placeholder:"e.g., 0.001"},null,2),[[M,g.value,void 0,{number:!0}]]),e[23]||(e[23]=t("small",{class:"text-muted d-block mt-1"},"How many base units = 1 of this unit (e.g., 1 ml = 0.001 L)",-1)),l.value.conversion_factor?(i(),r("div",tt,c(l.value.conversion_factor[0]),1)):S("",!0)])):S("",!0)]),t("div",at,[t("button",{class:"btn btn-primary rounded-pill py-2 btn-sm w-100",disabled:y.value,onClick:Q},[y.value?(i(),r(P,{key:0},[e[25]||(e[25]=t("span",{class:"spinner-border spinner-border-sm me-2"},null,-1)),e[26]||(e[26]=x("Saving... ",-1))],64)):(i(),r(P,{key:1},[x(c((L.value,"Save")),1)],64))],8,st)])])])])])],64))}},mt=ne(ot,[["__scopeId","data-v-6e8762be"]]);export{mt as default};
