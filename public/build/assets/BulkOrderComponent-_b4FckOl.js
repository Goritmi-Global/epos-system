import{_ as Z,r as f,y as T,o as G,c as F,E as H,f as r,b as u,e,B as J,m as c,i as k,d as I,u as _,t as i,F as C,g as U,k as x,v as V,T as K,q as h}from"./app-DOXFdmcK.js";import{s as W}from"./index-BaVmu_QP.js";import{u as X}from"./useFormatters-DHGdNh2A.js";import"./index-CDnASbBX.js";import"./index-BAFW5Ix-.js";import"./index-BCh-HmGc.js";import"./index-zVQi_vx6.js";const Y={class:"modal fade",id:"bulkOrderModal",tabindex:"-1","aria-hidden":"true"},ee={class:"modal-dialog modal-xl modal-dialog-centered"},te={class:"modal-content rounded-4"},le={class:"modal-body"},ae={class:"nav nav-tabs mb-4",role:"tablist"},se={class:"nav-item",role:"presentation"},ne={class:"nav-item",role:"presentation"},oe={key:0},re={class:"mb-3"},ue={key:0,class:"text-danger"},ie={class:"table-responsive"},de={class:"table align-middle"},ce=["onUpdate:modelValue","onInput"],pe={key:0,class:"text-danger"},me=["onUpdate:modelValue","onInput"],ve={key:0,class:"text-danger"},ye={key:0,class:"text-danger"},be=["onClick"],he={class:"text-end fw-bold mt-3"},fe={key:1},_e={class:"table-responsive"},ge={class:"table align-middle"},ke=["onUpdate:modelValue"],xe=["value"],Pe={key:0,class:"text-danger d-block"},we=["onUpdate:modelValue","onInput"],qe={key:0,class:"text-danger"},Ve=["onUpdate:modelValue","onInput"],Se={key:0,class:"text-danger"},Ie={key:0,class:"text-danger"},Ce=["onClick"],Ue={class:"text-end fw-bold mt-3"},Ee={class:"modal-footer"},Me=["disabled"],Be={key:0},Oe={key:1},De=["disabled"],Ne={key:0},Te={key:1},Fe={__name:"BulkOrderComponent",props:{suppliers:{type:Array,default:()=>[]},items:{type:Array,default:()=>[]}},emits:["refresh-data"],setup(S,{emit:j}){const{formatCurrencySymbol:P,dateFmt:E}=X(),M=S,B=j,p=f("single"),g=f(null),w=f(!1),d=f({}),y=f([]),q=f(!1),b=f({}),m=f([]);T(()=>M.items,l=>{y.value=l.map(a=>({...a,qty:0,unitPrice:0,expiry:null,subtotal:0}))},{immediate:!0}),T(()=>M.items,l=>{m.value=l.map(a=>({...a,qty:0,unitPrice:0,expiry:null,subtotal:0,supplier_id:null}))},{immediate:!0}),G(()=>{feather.replace();const l=document.getElementById("bulkOrderModal");l&&(l.addEventListener("show.bs.modal",()=>{p.value="single"}),l.addEventListener("hide.bs.modal",()=>{p.value="single"}))});function O(l){const a=Number(l.qty)||0,o=Number(l.unitPrice)||0;l.subtotal=a*o}function D(l){l.qty<0&&(l.qty=0),O(l)}function N(l){l.unitPrice<0&&(l.unitPrice=0),O(l)}function A(l){y.value[l].qty=0,y.value[l].unitPrice=0,y.value[l].expiry=null,y.value[l].subtotal=0}function L(l){m.value[l].qty=0,m.value[l].unitPrice=0,m.value[l].expiry=null,m.value[l].subtotal=0,m.value[l].supplier_id=null}const $=F(()=>y.value.reduce((l,a)=>l+(Number(a.subtotal)||0),0)),z=F(()=>m.value.reduce((l,a)=>l+(Number(a.subtotal)||0),0));async function Q(){d.value={},g.value||(d.value.supplier="Please select a supplier");const l=new Date().toISOString().split("T")[0],a=[];if(y.value.forEach((t,n)=>{const s=t.qty||t.unitPrice||t.expiry,v={};s&&((!t.qty||t.qty<=0)&&(v.qty="Quantity is required"),(!t.unitPrice||t.unitPrice<=0)&&(v.unitPrice="Unit Price is required"),t.expiry?new Date(t.expiry)<new Date(l)&&(v.expiry="Expiry must be today or later"):v.expiry="Expiry date is required",Object.keys(v).length>0?d.value[n]=v:a.push({product_id:t.id,quantity:t.qty,unit_price:t.unitPrice,expiry:t.expiry}))}),!g.value){h.error("Please select a supplier");return}if(a.length===0){h.error("No valid items to submit");return}if(Object.keys(d.value).length>0){h.error("Please fix the highlighted errors");return}const o={supplier_id:g.value,purchase_date:l,status:"completed",items:a};w.value=!0;try{await axios.post("/purchase-orders",o),h.success("Bulk order created successfully!"),B("refresh-data"),g.value=null,y.value.forEach(n=>{n.qty=0,n.unitPrice=0,n.expiry=null,n.subtotal=0}),bootstrap.Modal.getInstance(document.getElementById("bulkOrderModal"))?.hide()}catch(t){console.error(t),h.error("Failed to save bulk order")}finally{w.value=!1}}async function R(){b.value={};const l=new Date().toISOString().split("T")[0],a={};if(m.value.forEach((o,t)=>{const n=o.qty||o.unitPrice||o.expiry,s={};if(n)if(o.supplier_id||(s.supplier_id="Supplier is required"),(!o.qty||o.qty<=0)&&(s.qty="Quantity is required"),(!o.unitPrice||o.unitPrice<=0)&&(s.unitPrice="Unit Price is required"),o.expiry?new Date(o.expiry)<new Date(l)&&(s.expiry="Expiry must be today or later"):s.expiry="Expiry date is required",Object.keys(s).length>0)b.value[t]=s;else{const v=o.supplier_id;a[v]||(a[v]=[]),a[v].push({product_id:o.id,quantity:o.qty,unit_price:o.unitPrice,expiry:o.expiry})}}),Object.keys(a).length===0){h.error("No valid items to submit");return}if(Object.keys(b.value).length>0){h.error("Please fix the highlighted errors");return}q.value=!0;try{for(const[t,n]of Object.entries(a)){const s={supplier_id:parseInt(t),purchase_date:l,status:"completed",items:n};await axios.post("/purchase-orders",s)}h.success("Multiple orders created successfully!"),B("refresh-data"),m.value.forEach(t=>{t.qty=0,t.unitPrice=0,t.expiry=null,t.subtotal=0,t.supplier_id=null}),bootstrap.Modal.getInstance(document.getElementById("bulkOrderModal"))?.hide(),setTimeout(()=>{document.querySelectorAll(".modal-backdrop").forEach(t=>t.remove()),document.body.classList.remove("modal-open"),document.body.style.removeProperty("overflow"),document.body.style.removeProperty("padding-right")},100)}catch(o){console.error(o),h.error("Failed to save multiple orders")}finally{q.value=!1}}return(l,a)=>{const o=H("VueDatePicker");return u(),r("div",Y,[e("div",ee,[e("div",te,[a[9]||(a[9]=J('<div class="modal-header" data-v-c06b2201><h5 class="modal-title fw-semibold" data-v-c06b2201>Bulk Purchase</h5><button class="absolute top-2 right-2 p-2 rounded-full hover:bg-gray-100 transition transform hover:scale-110" data-bs-dismiss="modal" aria-label="Close" title="Close" data-v-c06b2201><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" data-v-c06b2201><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" data-v-c06b2201></path></svg></button></div>',1)),e("div",le,[e("ul",ae,[e("li",se,[e("button",{class:k(["nav-link",{active:p.value==="single"}]),onClick:a[0]||(a[0]=t=>p.value="single"),type:"button",role:"tab"}," Single Purchase ",2)]),e("li",ne,[e("button",{class:k(["nav-link",{active:p.value==="multiple"}]),onClick:a[1]||(a[1]=t=>p.value="multiple"),type:"button",role:"tab"}," Multiple Purchase ",2)])]),p.value==="single"?(u(),r("div",oe,[e("div",re,[a[3]||(a[3]=e("label",{class:"form-label"},"Preferred Supplier",-1)),I(_(W),{modelValue:g.value,"onUpdate:modelValue":a[2]||(a[2]=t=>g.value=t),options:S.suppliers,optionLabel:"name",optionValue:"id",placeholder:"Select Supplier",class:k(["w-100",{"is-invalid":d.value.supplier}]),appendTo:"self",autoZIndex:!0,baseZIndex:2e3},null,8,["modelValue","options","class"]),d.value.supplier?(u(),r("small",ue,i(d.value.supplier),1)):c("",!0)]),e("div",ie,[e("table",de,[a[5]||(a[5]=e("thead",null,[e("tr",null,[e("th",null,"Name"),e("th",null,"Category"),e("th",null,"Unit"),e("th",null,"Qty"),e("th",null,"Unit Price"),e("th",null,"Expiry"),e("th",null,"Subtotal"),e("th")])],-1)),e("tbody",null,[(u(!0),r(C,null,U(y.value,(t,n)=>(u(),r("tr",{key:t.id},[e("td",null,i(t.name),1),e("td",null,i(t.category?.name||"-"),1),e("td",null,i(t.unit_name),1),e("td",null,[x(e("input",{type:"number",min:"0","onUpdate:modelValue":s=>t.qty=s,class:"form-control",onInput:s=>D(t)},null,40,ce),[[V,t.qty,void 0,{number:!0}]]),d.value[n]?.qty?(u(),r("small",pe,i(d.value[n].qty),1)):c("",!0)]),e("td",null,[x(e("input",{type:"number",min:"0","onUpdate:modelValue":s=>t.unitPrice=s,class:"form-control",onInput:s=>N(t)},null,40,me),[[V,t.unitPrice,void 0,{number:!0}]]),d.value[n]?.unitPrice?(u(),r("small",ve,i(d.value[n].unitPrice),1)):c("",!0)]),e("td",null,[I(o,{modelValue:t.expiry,"onUpdate:modelValue":s=>t.expiry=s,format:_(E),"min-date":new Date,enableTimePicker:!1,teleport:!1,placeholder:"Select date",class:k({"is-invalid":d.value[n]?.expiry})},null,8,["modelValue","onUpdate:modelValue","format","min-date","class"]),d.value[n]?.expiry?(u(),r("small",ye,i(d.value[n].expiry),1)):c("",!0)]),e("td",null,i(_(P)(t.subtotal.toFixed(2))),1),e("td",null,[e("button",{class:"btn btn-sm btn-outline-danger d-flex align-items-center justify-content-center",onClick:s=>A(n),title:"Clear",style:{width:"36px",height:"36px"}},[...a[4]||(a[4]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"},[e("path",{"fill-rule":"evenodd",d:"M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2v1z"}),e("path",{d:"M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466z"})],-1)])],8,be)])]))),128))])])]),e("div",he," Total: "+i(_(P)($.value.toFixed(2))),1)])):c("",!0),p.value==="multiple"?(u(),r("div",fe,[e("div",_e,[e("table",ge,[a[8]||(a[8]=e("thead",null,[e("tr",null,[e("th",null,"Name"),e("th",null,"Category"),e("th",null,"Unit"),e("th",null,"Supplier"),e("th",null,"Qty"),e("th",null,"Unit Price"),e("th",null,"Expiry"),e("th",null,"Subtotal"),e("th")])],-1)),e("tbody",null,[(u(!0),r(C,null,U(m.value,(t,n)=>(u(),r("tr",{key:t.id},[e("td",null,i(t.name),1),e("td",null,i(t.category?.name||"-"),1),e("td",null,i(t.unit_name),1),e("td",null,[x(e("select",{"onUpdate:modelValue":s=>t.supplier_id=s,class:k(["form-select w-100",{"is-invalid":b.value[n]?.supplier_id}])},[a[6]||(a[6]=e("option",{value:"",disabled:"",hidden:""},"Select Supplier",-1)),(u(!0),r(C,null,U(S.suppliers,s=>(u(),r("option",{key:s.id,value:s.id},i(s.name),9,xe))),128))],10,ke),[[K,t.supplier_id]]),b.value[n]?.supplier_id?(u(),r("small",Pe,i(b.value[n].supplier_id),1)):c("",!0)]),e("td",null,[x(e("input",{type:"number",min:"0","onUpdate:modelValue":s=>t.qty=s,class:"form-control",onInput:s=>D(t)},null,40,we),[[V,t.qty,void 0,{number:!0}]]),d.value[n]?.qty?(u(),r("small",qe,i(d.value[n].qty),1)):c("",!0)]),e("td",null,[x(e("input",{type:"number",min:"0","onUpdate:modelValue":s=>t.unitPrice=s,class:"form-control",onInput:s=>N(t)},null,40,Ve),[[V,t.unitPrice,void 0,{number:!0}]]),d.value[n]?.unitPrice?(u(),r("small",Se,i(d.value[n].unitPrice),1)):c("",!0)]),e("td",null,[I(o,{modelValue:t.expiry,"onUpdate:modelValue":s=>t.expiry=s,format:_(E),"min-date":new Date,enableTimePicker:!1,teleport:!1,placeholder:"Select date",class:k({"is-invalid":b.value[n]?.expiry})},null,8,["modelValue","onUpdate:modelValue","format","min-date","class"]),b.value[n]?.expiry?(u(),r("small",Ie,i(b.value[n].expiry),1)):c("",!0)]),e("td",null,i(_(P)(t.subtotal.toFixed(2))),1),e("td",null,[e("button",{class:"btn btn-sm btn-outline-danger d-flex align-items-center justify-content-center",onClick:s=>L(n),title:"Clear",style:{width:"36px",height:"36px"}},[...a[7]||(a[7]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"},[e("path",{"fill-rule":"evenodd",d:"M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2v1z"}),e("path",{d:"M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466z"})],-1)])],8,Ce)])]))),128))])])]),e("div",Ue," Total: "+i(_(P)(z.value.toFixed(2))),1)])):c("",!0)]),e("div",Ee,[p.value==="single"?(u(),r("button",{key:0,class:"btn btn-primary rounded-pill px-4 py-2",disabled:w.value,onClick:Q},[w.value?(u(),r("span",Oe,"Saving...")):(u(),r("span",Be,"Save"))],8,Me)):c("",!0),p.value==="multiple"?(u(),r("button",{key:1,class:"btn btn-primary rounded-pill px-4 py-2",disabled:q.value,onClick:R},[q.value?(u(),r("span",Te,"Saving...")):(u(),r("span",Ne,"Save"))],8,De)):c("",!0)])])])])}}},Ze=Z(Fe,[["__scopeId","data-v-c06b2201"]]);export{Ze as default};
