import{_ as Ae,a as te,b as d,w as re,f as u,m as g,e as t,t as n,V as We,c as I,r as f,o as Ye,n as Ce,y as Ie,p as A,I as Je,E as et,d as S,u as h,h as tt,F as D,g as Z,i as b,j as lt,k as x,v as w,l as ie,W as at,S as ot,X as st,q as y}from"./app-COfeKFco.js";import{_ as nt}from"./Master-BwcgCD_I.js";import{s as X}from"./index-D7y0DI42.js";import{s as Ve}from"./index-7CoI6SP2.js";import{E as it,a as rt,X as dt,u as G,w as ut}from"./xlsx-CQiPhMNw.js";import{F as ct}from"./FilterModal-ls1QlmOC.js";import{u as pt}from"./useFormatters-DekmLp3t.js";import{I as mt}from"./importFile-BBmPz4pU.js";import{P as vt}from"./package-CSKA1hnL.js";import{C as gt}from"./circle-x-BGL8IfYN.js";import{T as yt}from"./triangle-alert-DjEZsQmh.js";import{c as de}from"./createLucideIcon-BHjiP04p.js";import{P as ft}from"./plus-JqLDZRav.js";import{E as bt}from"./eye-CUsFDfYV.js";import{P as _t}from"./pencil-whvBZMvZ.js";import"./index-DWWqmOtC.js";import"./index-dUBskPjT.js";import"./index-DAUyLLvF.js";import"./sun-Dj9dN6fF.js";import"./index-B3ocb_Xi.js";import"./index-DLoIRGAb.js";import"./index-z6mHuQ8O.js";/**
 * @license lucide-vue-next v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kt=de("calendar-clock",[["path",{d:"M16 14v2.2l1.6 1",key:"fo4ql5"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M21 7.5V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h3.5",key:"1osxxc"}],["path",{d:"M3 10h5",key:"r794hk"}],["path",{d:"M8 2v4",key:"1cmpym"}],["circle",{cx:"16",cy:"16",r:"6",key:"qoo3c4"}]]);/**
 * @license lucide-vue-next v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ht=de("calendar-x-2",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M21 13V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h8",key:"3spt84"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"m17 22 5-5",key:"1k6ppv"}],["path",{d:"m17 17 5 5",key:"p7ous7"}]]);/**
 * @license lucide-vue-next v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xt=de("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]]),wt={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50"},St={class:"bg-white rounded-xl shadow-xl w-full max-w-md p-6 animate-drop-in relative"},Ct={class:"text-center text-lg font-medium text-gray-800 mb-2"},It={class:"text-center text-sm text-gray-500 mb-6"},Vt={__name:"StockOutConfirmationModal",props:{show:Boolean,title:String,message:String},emits:["confirm","close"],setup(O,{emit:N}){const q=N,V=()=>q("confirm"),W=()=>q("close");return(B,M)=>(d(),te(We,{name:"fade-slide"},{default:re(()=>[O.show?(d(),u("div",wt,[t("div",St,[t("button",{class:"absolute top-2 right-2 p-2 rounded-full hover:bg-gray-100 transition transform hover:scale-110",onClick:W,title:"Close"},[...M[0]||(M[0]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)])]),M[1]||(M[1]=t("div",{class:"flex justify-center mb-4"},[t("div",{class:"bg-gray-100 p-3 rounded-full"},[t("svg",{class:"w-8 h-8 text-danger",fill:"none",stroke:"currentColor","stroke-width":"2",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 9v2m0 4h.01M12 19a7 7 0 100-14 7 7 0 000 14z"})])])],-1)),t("h3",Ct,n(O.title),1),t("p",It,n(O.message),1),t("div",{class:"flex justify-center gap-3"},[t("button",{onClick:V,class:"btn btn-primary d-flex align-items-center gap-1 px-3 py-2 rounded-pill text-white"}," Yes, I'm sure "),t("button",{onClick:W,class:"btn btn-secondary d-flex align-items-center gap-1 px-3 py-2 rounded-pill text-white"}," Cancel ")])])])):g("",!0)]),_:1}))}},At=Ae(Vt,[["__scopeId","data-v-500efa34"]]),Mt={class:"page-wrapper"},$t={class:"row g-4"},Ft={class:"card border-0 shadow-sm rounded-4"},Ut={class:"card-body d-flex align-items-center justify-content-between"},Et={class:"fw-bold fs-4"},qt={class:"text-muted fs-6"},jt={class:"card border-0 shadow-lg rounded-4"},Dt={class:"card-body"},Nt={class:"d-flex flex-wrap gap-2 justify-content-between align-items-center mb-3"},Pt={class:"d-flex flex-wrap gap-2 align-items-center"},Tt={class:"search-wrap"},Lt={key:1,class:"form-control search-input",placeholder:"Search",disabled:"",type:"text"},Ot={class:"dropdown"},Bt={class:"dropdown-menu dropdown-menu-end shadow rounded-4 py-2"},Qt={class:"table-responsive"},Rt={class:"table table-striped"},Ht={key:0},Kt={key:1},zt={class:"fw-semibold"},Zt={class:"text-truncate",style:{"max-width":"260px"}},Xt={class:"text-center"},Gt={key:0,class:"badge bg-red-600 rounded-pill d-inline-block text-center",style:{"min-width":"100px"}},Wt={key:1,class:"badge bg-warning rounded-pill d-inline-block text-center",style:{"min-width":"100px"}},Yt={key:2,class:"badge bg-success rounded-pill d-inline-block text-center",style:{"min-width":"100px"}},Jt={class:"text-center"},el={class:"d-inline-flex align-items-center gap-3"},tl=["onClick"],ll=["onClick"],al=["onClick"],ol={key:0},sl={key:0,class:"mt-4 d-flex justify-content-between align-items-center"},nl={class:"text-muted small"},il={class:"modal fade",id:"addItemModal",tabindex:"-1","aria-hidden":"true"},rl={class:"modal-dialog modal-lg modal-dialog-centered",role:"document"},dl={class:"modal-content rounded-4"},ul={class:"modal-header"},cl={class:"modal-title fw-semibold"},pl={class:"modal-body"},ml={class:"row g-3"},vl={class:"col-md-6"},gl={key:0,class:"text-danger"},yl={class:"col-md-6"},fl={key:0,class:"text-danger"},bl={key:0,class:"col-md-6"},_l={key:0,class:"text-danger"},kl={class:"col-md-6"},hl={key:0,class:"text-danger"},xl={class:"col-md-6"},wl={key:0,class:"text-danger"},Sl={class:"col-md-6"},Cl={key:0,class:"text-danger"},Il={class:"col-md-6"},Vl={key:0,class:"text-danger"},Al={class:"col-12"},Ml={key:0,class:"text-danger"},$l={class:"row g-3"},Fl={class:"col-md-3"},Ul={key:0,class:"text-danger"},El={class:"col-md-3"},ql={key:0,class:"text-danger"},jl={class:"col-md-3"},Dl={key:0,class:"text-danger"},Nl={class:"col-md-3"},Pl={key:0,class:"text-danger"},Tl={class:"row g-4 mt-1"},Ll={class:"col-md-6"},Ol={key:0,class:"text-danger"},Bl={class:"col-md-6"},Ql={key:0,class:"text-danger"},Rl={class:"col-md-4"},Hl=["src"],Kl={key:1,class:"placeholder"},zl={key:0,class:"text-danger"},Zl={class:"mt-4"},Xl=["disabled"],Gl={class:"modal fade",id:"viewItemModal",tabindex:"-1","aria-hidden":"true"},Wl={class:"modal-dialog modal-lg modal-dialog-centered"},Yl={class:"modal-content border-0 shadow-lg rounded-4 overflow-hidden"},Jl={class:"modal-header bg-light"},ea={class:"d-flex align-items-center gap-2"},ta={key:0,class:"text-muted"},la={class:"modal-body"},aa={key:0,class:"row g-4"},oa={class:"col-12 col-md-7"},sa={class:"card border-0 shadow-sm rounded-4"},na={class:"card-body"},ia={class:"fw-semibold mb-3"},ra={class:"text-muted small mb-2"},da={class:"row g-3 small"},ua={class:"col-6"},ca={class:"fw-semibold text-muted"},pa={class:"col-6"},ma={class:"fw-semibold text-muted"},va={class:"col-6"},ga={class:"fw-semibold text-muted"},ya={class:"col-12"},fa={class:"fw-semibold text-muted"},ba={class:"col-12"},_a={class:"fw-semibold text-muted"},ka={class:"d-flex flex-wrap gap-2 mt-2"},ha={class:"badge rounded-pill bg-primary text-white"},xa={class:"badge rounded-pill bg-success text-white"},wa={class:"badge rounded-pill bg-warning text-white"},Sa={class:"badge rounded-pill bg-secondary text-white"},Ca={class:"d-flex flex-wrap gap-2 mt-2"},Ia={class:"d-flex flex-wrap gap-2 mt-2"},Va={class:"col-12 col-md-5"},Aa={class:"card border-0 shadow-sm rounded-4 h-100"},Ma={class:"card-body d-flex flex-column align-items-center justify-content-center"},$a={key:0,class:"w-100"},Fa=["src"],Ua={class:"card-footer bg-transparent small d-flex justify-content-between"},Ea={class:"badge bg-gray-500 rounded-pill text-white p-2"},qa={class:"card-footer bg-transparent small d-flex justify-content-between"},ja={class:"fw-semibold"},Da={class:"card-footer bg-transparent small d-flex justify-content-between"},Na={class:"fw-semibold"},Pa={class:"card border-0 shadow-lg rounded-4 overflow-hidden"},Ta={class:"table-responsive"},La={class:"table table-striped mb-0"},Oa={class:"fw-semibold"},Ba={class:"fw-semibold"},Qa={class:"text-muted"},Ra={class:"text-muted"},Ha={class:"text-muted"},Ka={class:"text-center"},za={key:0},Za={class:"fw-semibold text-muted w-50"},Xa={class:"modal fade",id:"stockInModal",tabindex:"-1","aria-hidden":"true"},Ga={class:"modal-dialog modal-lg modal-dialog-centered"},Wa={class:"modal-content rounded-4"},Ya={class:"modal-header"},Ja={class:"modal-title"},eo={class:"modal-body"},to={class:"row g-3"},lo={class:"col-md-6"},ao={key:0,class:"text-danger"},oo={class:"col-md-6"},so=["value"],no={key:0,class:"text-danger"},io={class:"col-md-6"},ro={key:0,class:"text-danger"},uo={class:"col-md-6"},co={class:"col-md-4"},po={key:0,class:"text-danger"},mo={class:"col-md-4"},vo={key:0,class:"text-danger"},go={class:"col-md-4"},yo={class:"col-md-12"},fo={key:0,class:"text-danger"},bo={class:"col-md-12"},_o={class:"mt-4"},ko=["disabled"],ho={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},xo={class:"modal fade",id:"stockOutModal",tabindex:"-1","aria-hidden":"true"},wo={class:"modal-dialog modal-lg modal-dialog-centered"},So={class:"modal-content rounded-4"},Co={class:"modal-header"},Io={class:"modal-title"},Vo={class:"modal-body"},Ao={class:"row g-3"},Mo={class:"col-md-6"},$o={class:"col-md-6"},Fo=["value"],Uo={key:0,class:"text-danger"},Eo={class:"col-md-6"},qo={class:"col-md-6"},jo={key:0,class:"text-danger"},Do={class:"col-md-12"},No={class:"mt-4 text-end"},Po=["disabled"],To={__name:"Index",props:{inventories:Array,allergies:Array,tags:Array,units:Array,suppliers:Array,categories:Array},setup(O){const{formatCurrencySymbol:N,dateFmt:q}=pt(),V=O,W=I(()=>V.categories.filter(a=>!a.parent_id)),B=I(()=>V.categories.filter(a=>a.parent_id===i.value.category_id)),M=f(!1),$=f({current_page:1,last_page:1,per_page:10,total:0,from:0,to:0,links:[]}),Q=f(V.inventories?.data||[]),R=I(()=>Q.value),U=async(a=null)=>{M.value=!0;try{const e=await A.get("inventory/api-inventories",{params:{q:E.value,page:a||$.value.current_page,per_page:$.value.per_page}});Q.value=e.data.data||[],$.value={current_page:e.data.current_page,last_page:e.data.last_page,per_page:e.data.per_page,total:e.data.total,from:e.data.from,to:e.data.to,links:e.data.links},M.value=!1}catch(e){console.error("❌ Fetch inventories error:",e),y.error("Failed to load inventories"),M.value=!1}},Me=a=>{if(!a)return;const o=new URLSearchParams(a.split("?")[1]).get("page");o&&U(parseInt(o))};Ye(async()=>{E.value="",ue.value=Date.now(),await Ce(),setTimeout(()=>{ce.value=!0;const a=document.getElementById(le);a&&(a.value="",E.value="")},100),U(),H()});const E=f(""),ue=f(Date.now()),le=`search-${Math.random().toString(36).substr(2,9)}`,ce=f(!1);f("");const C=f({sortBy:"",category:"",supplier:"",stockStatus:"",priceMin:null,priceMax:null,dateFrom:"",dateTo:""}),pe=I(()=>{let a=[...R.value];const e=E.value.trim().toLowerCase();return e&&(a=a.filter(o=>{console.log("data filter: ",o);const l=(o?.name||"").toLowerCase(),c=typeof o.category=="object"?(o?.category.name||"").toLowerCase():(o?.category||"").toString().toLowerCase(),_=typeof o.unit=="object"?(o?.unit?.name||"").toLowerCase():(o?.unit||"").toString().toLowerCase();return l.includes(e)||c.includes(e)||_.includes(e)})),C.value.category&&(a=a.filter(o=>(typeof o?.category=="object"?o?.category?.id:o?.category_id)==C.value.category)),C.value.supplier&&(a=a.filter(o=>(typeof o?.supplier=="object"?o?.supplier?.id:o?.supplier_id)==C.value.supplier)),C.value.stockStatus&&(a=a.filter(o=>{const l=o.availableStock||0,c=o.minAlert||5;switch(C.value.stockStatus){case"in_stock":return l>=c;case"low_stock":return l>0&&l<c;case"out_of_stock":return l<=0;case"expired":return o.status==="expired";case"near_expiry":return o.status==="near_expiry";default:return!0}})),(C.value.priceMin!==null||C.value.priceMax!==null)&&(a=a.filter(o=>{const l=o.price||o.stockValue||0,c=C.value.priceMin||0,_=C.value.priceMax||1/0;return l>=c&&l<=_})),a}),me=I(()=>{const a=[...pe.value];switch(C.value.sortBy){case"stock_desc":return a.sort((o,l)=>(l.stockValue||0)-(o.stockValue||0));case"stock_asc":return a.sort((o,l)=>(o.stockValue||0)-(l.stockValue||0));case"name_asc":return a.sort((o,l)=>(o.name||"").localeCompare(l.name||""));case"name_desc":return a.sort((o,l)=>(l.name||"").localeCompare(o.name||""));default:return a}});let ve=null;Ie(E,()=>{clearTimeout(ve),ve=setTimeout(()=>{$.value.current_page=1,U(1)},500)});const Y=I(()=>({sortOptions:[{value:"stock_desc",label:"Stock: High to Low"},{value:"stock_asc",label:"Stock: Low to High"},{value:"name_asc",label:"Name: A to Z"},{value:"name_desc",label:"Name: Z to A"}],categories:V.categories||[],suppliers:V.suppliers||[],stockStatusOptions:[{value:"in_stock",label:"In Stock"},{value:"low_stock",label:"Low Stock"},{value:"out_of_stock",label:"Out of Stock"},{value:"expired",label:"Expired"},{value:"near_expiry",label:"Near Expiry"}]}));I(()=>R.value.length);const ge=f([]),P=f({total_items:0,out_of_stock:0,low_stock:0,expired:0,near_expiry:0}),H=async()=>{try{const a=await A.get("/inventory/kpi-stats");P.value=a.data}catch(a){console.error("❌ Failed to fetch KPI stats:",a)}};I(()=>R.value.filter(a=>a.availableStock>0&&a.availableStock<(a.minAlert||5)).length),I(()=>R.value.filter(a=>a.availableStock<=0).length),I(()=>ge.value.filter(a=>{if(a.stock_type!=="stockin"||!a.expiry_date)return!1;const e=new Date(a.expiry_date),o=new Date;e.setHours(0,0,0,0),o.setHours(0,0,0,0);const l=e<o,c=(a.quantity||0)>(a.allocated_quantity||0);return l&&c}).length),I(()=>ge.value.filter(a=>{if(a.stock_type!=="stockin"||!a.expiry_date)return!1;const l=(new Date(a.expiry_date)-new Date)/(1e3*60*60*24),c=l>0&&l<=15,_=(a.quantity||0)>(a.allocated_quantity||0);return c&&_}).length);const $e=I(()=>[{label:"Total Items",value:P.value.total_items??0,icon:vt,iconBg:"bg-soft-success",iconColor:"text-success"},{label:"Out of Stock",value:P.value.out_of_stock??0,icon:gt,iconBg:"bg-soft-danger",iconColor:"text-danger"},{label:"Low Stock",value:P.value.low_stock??0,icon:yt,iconBg:"bg-soft-warning",iconColor:"text-warning"},{label:"Expired Stock",value:P.value.expired??0,icon:ht,iconBg:"bg-soft-danger",iconColor:"text-danger"},{label:"Near Expire Stock",value:P.value.near_expiry??0,icon:kt,iconBg:"bg-soft-info",iconColor:"text-info"}]);Je(()=>window.feather?.replace?.());const s=f({}),i=f({id:null,name:"",category_id:null,subcategory_id:null,unit_id:null,supplier_id:null,minAlert:null,sku:"",description:"",nutrition:{calories:0,fat:0,protein:0,carbs:0},allergies:[],tags:[],imageFile:null,imageUrl:null}),J=f(!1),Fe=async()=>{J.value=!0,s.value={};const a=new FormData;if(a.append("name",(i.value.name||"").trim()),i.value.category_id&&a.append("category_id",i.value.category_id),B.value.length&&i.value.subcategory_id&&a.append("subcategory_id",i.value.subcategory_id),i.value.unit_id&&a.append("unit_id",i.value.unit_id),i.value.minAlert!==null&&i.value.minAlert!==""&&a.append("minAlert",i.value.minAlert),i.value.supplier_id&&a.append("supplier_id",i.value.supplier_id),a.append("sku",i.value.sku||""),a.append("description",i.value.description||""),a.append("nutrition[calories]",i.value.nutrition.calories),a.append("nutrition[fat]",i.value.nutrition.fat),a.append("nutrition[protein]",i.value.nutrition.protein),a.append("nutrition[carbs]",i.value.nutrition.carbs),(i.value.allergies||[]).forEach((e,o)=>a.append(`allergies[${o}]`,e)),(i.value.tags||[]).forEach((e,o)=>a.append(`tags[${o}]`,e)),i.value.imageFile){const e=(i.value.imageFile.type?.split("/")?.[1]||"webp").replace("jpeg","jpg");a.append("image",i.value.imageFile,`image.${e}`)}try{i.value.id?(await A.post(`/inventory/${i.value.id}?_method=PUT`,a,{headers:{"Content-Type":"multipart/form-data"}}),y.success(" Inventory Item updated successfully")):(await A.post("/inventory",a,{headers:{"Content-Type":"multipart/form-data"}}),y.success(" Inventory Item created successfully")),ae(),await U();const e=document.getElementById("addItemModal");bootstrap.Modal.getInstance(e)?.hide()}catch(e){e?.response?.status===422&&e.response.data?.errors?(s.value=e.response.data.errors,y.error("Please fill in all required fields correctly.")):(console.error("❌ Error saving:",e.response?.data||e.message),y.error("Failed to save Inventory Item"))}finally{J.value=!1}};Ie(i,a=>{Object.keys(s.value).forEach(e=>{if(e.includes(".")){const[o,l]=e.split(".");a[o]&&a[o][l]!==""&&delete s.value[e]}else{const o=a[e];o!=null&&o!==""&&(!Array.isArray(o)||o.length>0)&&delete s.value[e]}})},{deep:!0});const Ue=a=>{const e=c=>c===""||c===null||c===void 0?null:Number(c);let o=null,l=null;if(a.category&&typeof a.category=="object"){const c=a.category;c.parent_id?(l=e(c.id),o=e(c.parent_id)):(o=e(c.id),l=null)}else o=e(a.category_id),l=e(a.subcategory_id);i.value={id:a.id,name:a.name??"",category_id:o,subcategory_id:l,unit_id:e(a.unit_id),supplier_id:e(a.supplier_id),minAlert:a.minAlert??0,sku:a.sku??"",description:a.description??"",nutrition:a.nutrition??{calories:0,protein:0,fat:0,carbs:0},allergies:a.allergy_ids??[],tags:a.tag_ids??[],imageFile:null,imageUrl:a.image_url??null},Ce(()=>{B.value.some(_=>_.id===i.value.subcategory_id)||(i.value.subcategory_id=null)})};function ae(){i.value={id:null,name:"",category_id:null,subcategory_id:null,unit_id:null,minAlert:"",supplier_id:null,sku:"",description:"",nutrition:{calories:"",fat:"",protein:"",carbs:""},allergies:[],tags:[],imageFile:null,imageUrl:null}}const k=f({}),Ee=async a=>{try{const e=await A.get(`/inventory/${a.id}`);k.value=e.data,await ze(a.id)}catch(e){console.error("Error fetching item:",e)}};function K(){const a=Number(p.value.quantity||0),e=Number(p.value.price||0);p.value.value=a*e}const p=f({product_id:null,name:"",category_id:null,supplier_id:null,available_quantity:0,quantity:0,price:0,value:0,expiry_date:"",description:"",operation_type:"purchase",stock_type:"stockin",purchase_date:new Date().toISOString().slice(0,10),user_id:1}),F=f(!1),z=f();function ye(){p.value.quantity=0,p.value.price=0,p.value.value=0,p.value.expiry_date="",p.value.description=""}const fe=()=>{s.value={}};async function qe(){console.log(p.value),F.value=!0,K();try{await A.post("/stock_entries",p.value),y.success(" Stock In saved successfully"),ye(),bootstrap.Modal.getInstance(document.getElementById("stockInModal"))?.hide(),await U(),await H()}catch(a){a?.response?.status===422&&a.response.data?.errors?(s.value=a.response.data.errors,y.error("Please fill in all required fields correctly.")):(y.error("Something went wrong. Please try again.",{autoClose:3e3}),console.error(a))}finally{F.value=!1}}const je=f(null),De=f(null);f(null);const T=f(!1),oe=f(null),Ne=a=>{oe.value=a,T.value=!0},Pe=()=>{if(T.value=!1,!oe.value){console.error("❌ No item selected for stock out"),y.error("No item selected");return}Te(oe.value)};async function Te(a){if(!a){console.error("❌ No item provided to confirmStockOut");return}try{console.log(" Attempting stock out for item:",a);const o=(await A.get(`/stock_entries/total/${a.id}`)).data||{},l=o.available||0;if(console.log(" Stock data received:",o),console.log(" Available quantity:",l),l<=0){y.warning(`No available stock for "${a.name}". Current stock: ${l}`,{autoClose:4e3}),T.value=!1;return}const c={product_id:a.id,name:a.name,category_id:a.category?.id,available_quantity:l,quantity:l,price:0,value:0,description:"Auto full stock-out",operation_type:"inventory_stockout",stock_type:"stockout",purchase_date:new Date().toISOString().slice(0,10),user_id:1};console.log(" Submitting stock out payload:",c),await A.post("/stock_entries",c),y.success(`Successfully stocked out ${l} units of "${a.name}"`,{autoClose:3e3}),await U(),await H()}catch(e){console.error("❌ Stock out error:",e),console.error("❌ Error response:",e.response?.data),e?.response?.data?.errors?.quantity?y.error(e.response.data.errors.quantity[0]):y.error("Stock out failed. Please try again.")}finally{T.value=!1}}async function Le(){if(F.value=!0,K(),p.value.quantity>p.value.available_quantity){s.value.quantity=["The quantity should not exceed the available quantity."],y.error("The quantity should not exceed the available quantity."),F.value=!1;return}else s.value.quantity=null;try{await A.post("/stock_entries",p.value),y.success("Stock Out saved successfully"),ye(),bootstrap.Modal.getInstance(document.getElementById("stockOutModal"))?.hide(),await U(),await H()}catch(a){a?.response?.status===422&&a.response.data?.errors?(s.value=a.response.data.errors,y.error("Please fill in all required fields correctly.")):(y.error("Something went wrong. Please try again.",{autoClose:3e3}),console.error(a))}finally{F.value=!1}}const se=a=>{if(!Q.value||Q.value.length===0){y.error("No Allergies data to download");return}const e=E.value.trim()?pe.value:Q.value;if(!e.length){y.error("No Inventory Item found to download");return}try{a==="pdf"?Be(e):a==="excel"?Qe(e):a==="csv"?Oe(e):y.error("Invalid download type")}catch(o){console.error("Download failed:",o),y.error(`Download failed: ${o.message}`)}},Oe=a=>{try{const e=["name","sku","category","min_alert","unit","preferred_supplier","min_stock_alert","available_stock","calories","fat","protein","carbs","allergies","tags"],o=a.map(r=>{console.log(a),console.log("data",a);let m="";return r.nutrition&&typeof r.nutrition=="object"?m=Object.entries(r.nutrition).map(([j,ne])=>`${j}: ${ne}`).join("; "):typeof r.nutrition=="string"&&(m=r.nutrition),[`"${r.name||""}"`,`"${r.sku||""}"`,`"${r.category.name||""}"`,`"${r.minAlert||""}"`,`"${r.unit_name||""}"`,`"${r.supplier_name||""}"`,`"${r.minAlert||""}"`,`"${r.availableStock||""}"`,`"${r.nutrition.calories}"`,`"${r.nutrition.protein}"`,`"${r.nutrition.fat}"`,`"${r.nutrition.carbs}"`,`"${Array.isArray(r.allergies)?r.allergies.join(", "):r.allergies||""}"`,`"${Array.isArray(r.tags)?r.tags.join(", "):r.tags||""}"`]}),l=[e.join(","),...o.map(r=>r.join(","))].join(`
`),c=new Blob([l],{type:"text/csv;charset=utf-8;"}),_=URL.createObjectURL(c),v=document.createElement("a");v.setAttribute("href",_),v.setAttribute("download",`inventory_items_${new Date().toISOString().split("T")[0]}.csv`),document.body.appendChild(v),v.click(),document.body.removeChild(v),y.success("CSV downloaded successfully ",{autoClose:2500})}catch(e){console.error("CSV generation error:",e),y.error(`CSV generation failed: ${e.message}`,{autoClose:5e3})}},Be=a=>{try{const e=new it("l","mm","a4");e.setFontSize(18),e.setFont("helvetica","bold"),e.text("Inventory Items Report",14,15),e.setFontSize(10),e.setFont("helvetica","normal");const o=new Date().toLocaleString();e.text(`Generated on: ${o}`,14,22),e.text(`Total Items: ${a.length}`,14,28);const l=["Name","SKU","Category","Min Alert","Unit","Preferred Supplier","Min Stock Alert","Available Stock","Calories","Fat","Protein","Carbs","Allergies","Tags"],c=a.map(v=>[v.name||"",v.sku||"",v.category?.name||"",v.minAlert||"",v.unit_name||"",v.supplier_name||"",v.minAlert||"",v.availableStock||"",v.nutrition?.calories||"",v.nutrition?.fat||"",v.nutrition?.protein||"",v.nutrition?.carbs||"",Array.isArray(v.allergies)?v.allergies.join(", "):v.allergies||"",Array.isArray(v.tags)?v.tags.join(", "):v.tags||""]);rt(e,{head:[l],body:c,startY:35,styles:{fontSize:8,cellPadding:2,halign:"left",lineColor:[0,0,0],lineWidth:.1},headStyles:{fillColor:[41,128,185],textColor:255,fontStyle:"bold"},alternateRowStyles:{fillColor:[245,245,245]},margin:{left:14,right:14},didDrawPage:v=>{const r=e.internal.getNumberOfPages(),m=e.internal.pageSize.height;e.setFontSize(8),e.text(`Page ${v.pageNumber} of ${r}`,v.settings.margin.left,m-10)}});const _=`inventory_items_${new Date().toISOString().split("T")[0]}.pdf`;e.save(_),y.success("PDF downloaded successfully",{autoClose:2500})}catch(e){console.error("PDF generation error:",e),y.error(`PDF generation failed: ${e.message}`,{autoClose:5e3})}},Qe=a=>{try{if(typeof dt>"u")throw new Error("XLSX library is not loaded");const e=a.map(r=>({Name:r.name||"",SKU:r.sku||"",Category:r.category?.name||"",Min_Alert:r.minAlert||"",Unit:r.unit_name||"",Preferred_Supplier:r.supplier_name||"",Min_Stock_Alert:r.minAlert||"",Available_Stock:r.availableStock||"",Calories:r.nutrition?.calories||"",Fat:r.nutrition?.fat||"",Protein:r.nutrition?.protein||"",Carbs:r.nutrition?.carbs||"",Allergies:Array.isArray(r.allergies)?r.allergies.join(", "):r.allergies||"",Tags:Array.isArray(r.tags)?r.tags.join(", "):r.tags||""})),o=G.book_new(),l=G.json_to_sheet(e);l["!cols"]=[{wch:25},{wch:15},{wch:20},{wch:12},{wch:15},{wch:25},{wch:15},{wch:18},{wch:10},{wch:10},{wch:10},{wch:10},{wch:25},{wch:25}],G.book_append_sheet(o,l,"Inventory Items");const c=[{Info:"Generated On",Value:new Date().toLocaleString()},{Info:"Total Records",Value:a.length},{Info:"Exported By",Value:"Inventory Management System"}],_=G.json_to_sheet(c);G.book_append_sheet(o,_,"Report Info");const v=`inventory_items_${new Date().toISOString().split("T")[0]}.xlsx`;ut(o,v),y.success("Excel file downloaded successfully",{autoClose:2500})}catch(e){console.error("Excel generation error:",e),y.error(`Excel generation failed: ${e.message}`,{autoClose:5e3})}},be=f(!1),Re=f(!1),_e=f(null);function He(a){_e.value=i.value.imageUrl,_e.value&&(Re.value=!0)}function Ke({file:a}){i.value.imageFile=a,i.value.imageUrl=URL.createObjectURL(a)}f("");const ke=f(0),he=f(0),xe=f(0),we=f(0),L=f([]);async function ze(a){try{const{data:e}=await A.get(`/stock_entries/by-item/${a}`),o=e?.data||{};console.log(o),L.value=o.records||[],ke.value=o.near_count??0,he.value=o.expired_count??0,xe.value=o.near_qty??0,we.value=o.expired_qty??0}catch(e){console.error(e),L.value=[],ke.value=he.value=0,xe.value=we.value=0}}console.log("stockedInItems",L.value);function Ze(a){return a==="expired"?"Expired":a==="near"?"Near Expire":"Active"}function Xe(a){return a==="expired"?"bg-danger":a==="near"?"bg-warning":"bg-success"}const ee=I(()=>{const a=L.value||[];let e=0,o=0,l=0,c=0,_=0;const v=new Date;v.setHours(0,0,0,0);for(const r of a){const m=parseFloat(r?.quantity??0);if(e+=m,o+=Number(r?.price??0),l+=Number(r?.value??0),!r?.expiry_date)c+=m;else{const Se=new Date(r.expiry_date);Se.setHours(0,0,0,0),Se>=v&&(c+=m)}const j=parseFloat(r?.allocated_quantity??0),ne=Math.max(0,m-j);(!r?.expiry_date||new Date(r.expiry_date)>=v)&&(_+=ne)}return{totalQty:Number(e.toFixed(2)),totalPrice:Number(o.toFixed(2)),totalValue:Number(l.toFixed(2)),notExpiredQty:Number(c.toFixed(2)),availableQty:Number(_.toFixed(2))}}),Ge=a=>{if(!a||a.length<=1){y.error("The imported file is empty.");return}const e=a[0];console.log("headers are ",e);const o=a.slice(1);console.log("rows data",o);const l=o.map(m=>({name:m[0]||"",sku:m[1]||"",description:m[2]||"",category:m[3]||"",min_alert:m[4]||"",unit:m[5]||"",preferred_supplier:m[6]||"",purchase_price:m[7]||"",stock:parseInt(m[8])||0,active:m[9]||1,calories:parseFloat(m[10])||0,fat:parseFloat(m[11])||0,protein:parseFloat(m[12])||0,carbs:parseFloat(m[13])||0,allergies:m[14]||"",tags:m[15]||""})),c=l.map(m=>m.name.trim().toLowerCase()),_=c.filter((m,j)=>c.indexOf(m)!==j);if(_.length>0){y.error(`Duplicate item names found in CSV: ${[...new Set(_)].join(", ")}`);return}const v=R.value.map(m=>m.name.trim().toLowerCase()),r=l.filter(m=>v.includes(m.name.trim().toLowerCase()));if(r.length>0){const m=r.map(j=>j.name).join(", ");y.error(`Items already exist in the table: ${m}`);return}A.post("/api/inventory/import",{items:l}).then(()=>{y.success("Items imported successfully"),U(),H()}).catch(m=>{console.error(m),y.error("Import failed")})};return(a,e)=>{const o=et("VueDatePicker");return d(),te(nt,null,{default:re(()=>[S(h(tt),{title:"inventory Item"}),t("div",Mt,[e[105]||(e[105]=t("h4",{class:"mb-3"},"Overall Inventory",-1)),t("div",$t,[(d(!0),u(D,null,Z($e.value,l=>(d(),u("div",{key:l.label,class:"col-md-6 col-xl-3"},[t("div",Ft,[t("div",Ut,[t("div",null,[t("div",Et,n(l.value),1),t("div",qt,n(l.label),1)]),t("div",{class:b(["icon-chip",l.iconBg])},[(d(),te(lt(l.icon),{class:b(l.iconColor),size:"26"},null,8,["class"]))],2)])])]))),128))]),t("div",jt,[t("div",Dt,[t("div",Nt,[e[45]||(e[45]=t("h4",{class:"mb-0"},"Stock",-1)),t("div",Pt,[t("div",Tt,[e[40]||(e[40]=t("i",{class:"bi bi-search"},null,-1)),e[41]||(e[41]=t("input",{type:"email",name:"email",autocomplete:"email",style:{position:"absolute",left:"-9999px",width:"1px",height:"1px"},tabindex:"-1","aria-hidden":"true"},null,-1)),ce.value?x((d(),u("input",{id:le,"onUpdate:modelValue":e[0]||(e[0]=l=>E.value=l),key:ue.value,class:"form-control search-input",placeholder:"Search",type:"search",autocomplete:"new-password",name:le,role:"presentation",onFocus:e[1]||(e[1]=(...l)=>a.handleFocus&&a.handleFocus(...l))},null,32)),[[w,E.value]]):(d(),u("input",Lt))]),S(ct,{modelValue:C.value,"onUpdate:modelValue":e[2]||(e[2]=l=>C.value=l),title:"Inventory Items","modal-id":"inventoryFilterModal","modal-size":"modal-lg",categories:Y.value.categories,suppliers:Y.value.suppliers,"sort-options":Y.value.sortOptions,"stock-status-options":Y.value.stockStatusOptions,"show-price-range":!0,"show-date-range":!1,onApply:a.handleFilterApply,onClear:a.handleFilterClear},{customFilters:re(({filters:l})=>[...e[42]||(e[42]=[])]),_:1},8,["modelValue","categories","suppliers","sort-options","stock-status-options","onApply","onClear"]),t("button",{"data-bs-toggle":"modal","data-bs-target":"#addItemModal",class:"d-flex align-items-center gap-1 px-4 py-2 btn-sm rounded-pill btn btn-primary text-white",onClick:e[3]||(e[3]=l=>{ae(),s.value={},z.value="Create"})},[S(h(ft),{class:"w-4 h-4"}),e[43]||(e[43]=ie(" Add Item ",-1))]),S(mt,{label:"Import",sampleHeaders:["name","sku","description","category","min_alert","unit","preferred_supplier","purchase_price","stock","active","calories","fat","protein","carbs","allergies","tags"],sampleData:[["Milk","SKU-001","Sample one Description","Dairy",5,"Kilogram (kg)","Fresh Fruits Co.",200,350,1,150,33,23,44,"Eggs","Fairtrade"],["Honey","SKU-002","Sample Two Description","Sweets",5,"Kilogram (kg)","Green Veggies Ltd.",159,100,1,150,33,23,44,"Eggs","Fairtrade"]],onOnImport:Ge}),t("div",Ot,[e[44]||(e[44]=t("button",{class:"btn btn-outline-secondary btn-sm py-2 rounded-pill px-4 dropdown-toggle","data-bs-toggle":"dropdown"}," Export ",-1)),t("ul",Bt,[t("li",null,[t("a",{class:"dropdown-item py-2",href:"javascript:;",onClick:e[4]||(e[4]=l=>se("pdf"))},"Export as PDF")]),t("li",null,[t("a",{class:"dropdown-item py-2",href:"javascript:;",onClick:e[5]||(e[5]=l=>se("excel"))},"Export as Excel")]),t("li",null,[t("a",{class:"dropdown-item py-2",href:"javascript:;",onClick:e[6]||(e[6]=l=>se("csv"))},"Export as CSV")])])])])]),t("div",Qt,[t("table",Rt,[e[48]||(e[48]=t("thead",{class:"border-top small text-muted"},[t("tr",null,[t("th",null,"S.#"),t("th",null,"Items"),t("th",null,"Image"),t("th",null,"Category"),t("th",null,"Unit"),t("th",null,"Available Stock"),t("th",null,"Stock Value"),t("th",{class:"text-center"},"Availability"),t("th",{class:"text-center"},"Action")])],-1)),M.value?(d(),u("tbody",Ht,[...e[46]||(e[46]=[t("tr",null,[t("td",{colspan:"10",class:"text-center py-5"},[t("div",{class:"spinner-border",role:"status","aria-label":"Loading"})])],-1)])])):(d(),u("tbody",Kt,[(d(!0),u(D,null,Z(me.value,(l,c)=>(d(),u("tr",{key:l.id},[t("td",null,n($.value.from+c),1),t("td",zt,n(l.name),1),t("td",null,[l.image_url?(d(),te(at,{key:0,file:l.image_url,alt:l.name,width:50,height:50,custom_class:"cursor-pointer"},null,8,["file","alt"])):g("",!0)]),t("td",Zt,n(l.category?.name),1),t("td",null,n(l.unit_name),1),t("td",null,n(l.availableStock?l.availableStock.toFixed(2):0),1),t("td",null,n(l.stockValue||0),1),t("td",Xt,[l.availableStock===0?(d(),u("span",Gt,"Out of stock")):l.availableStock<=l.minAlert?(d(),u("span",Wt,"Low-stock")):(d(),u("span",Yt,"In-stock"))]),t("td",Jt,[t("div",el,[t("button",{onClick:_=>Ne(l),title:"Stock Out",class:"p-2 rounded-full text-red-600 hover:bg-red-100"},[S(h(xt),{class:"w-4 h-4"})],8,tl),S(At,{show:T.value,title:"Confirm Stock Out",message:"Are you sure you want to stock out this item?",onConfirm:Pe,onClose:e[7]||(e[7]=_=>T.value=!1)},null,8,["show"]),t("button",{onClick:_=>Ee(l),"data-bs-toggle":"modal","data-bs-target":"#viewItemModal",title:"View Item",class:"p-2 rounded-full text-primary hover:bg-gray-100"},[S(h(bt),{class:"w-4 h-4"})],8,ll),t("button",{onClick:()=>{Ue(l),s.value={},z.value="Edit"},"data-bs-toggle":"modal","data-bs-target":"#addItemModal",title:"Edit",class:"p-2 rounded-full text-blue-600 hover:bg-blue-100"},[S(h(_t),{class:"w-4 h-4"})],8,al)])])]))),128)),me.value.length===0?(d(),u("tr",ol,[...e[47]||(e[47]=[t("td",{colspan:"10",class:"text-center text-muted py-4"}," No items found. ",-1)])])):g("",!0)]))])]),!M.value&&$.value.last_page>1?(d(),u("div",sl,[t("div",nl," Showing "+n($.value.from)+" to "+n($.value.to)+" of "+n($.value.total)+" entries ",1),S(ot,{pagination:$.value.links,isApiDriven:!0,onPageChanged:Me},null,8,["pagination"])])):g("",!0)])]),t("div",il,[t("div",rl,[t("div",dl,[t("div",ul,[t("h5",cl,n(z.value==="Edit"?"Edit Item":"Add New Item"),1),e[49]||(e[49]=t("button",{class:"absolute top-2 right-2 p-2 rounded-full hover:bg-gray-100 transition transform hover:scale-110","data-bs-dismiss":"modal","aria-label":"Close",title:"Close"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})])],-1))]),t("div",pl,[t("div",ml,[t("div",vl,[e[50]||(e[50]=t("label",{class:"form-label"},"Product Name",-1)),x(t("input",{"onUpdate:modelValue":e[8]||(e[8]=l=>i.value.name=l),type:"text",class:b(["form-control",{"is-invalid":s.value.name}]),placeholder:"e.g., Chicken Breast"},null,2),[[w,i.value.name]]),s.value.name?(d(),u("small",gl,n(s.value.name[0]),1)):g("",!0)]),t("div",yl,[e[51]||(e[51]=t("label",{class:"form-label"},"Category",-1)),S(h(X),{modelValue:i.value.category_id,"onUpdate:modelValue":[e[9]||(e[9]=l=>i.value.category_id=l),e[10]||(e[10]=l=>i.value.subcategory_id=null)],options:W.value,optionLabel:"name",optionValue:"id",placeholder:"Select Category",class:b(["w-100 select",{"is-invalid":s.value.category_id}]),appendTo:"self",autoZIndex:!0,baseZIndex:2e3},null,8,["modelValue","options","class"]),s.value.category_id?(d(),u("small",fl,n(s.value.category_id[0]),1)):g("",!0)]),B.value.length?(d(),u("div",bl,[e[52]||(e[52]=t("label",{class:"form-label"},"Subcategory",-1)),S(h(X),{modelValue:i.value.subcategory_id,"onUpdate:modelValue":e[11]||(e[11]=l=>i.value.subcategory_id=l),options:B.value,optionLabel:"name",optionValue:"id",placeholder:"Select Subcategory",class:b(["w-100 select",{"is-invalid":s.value.subcategory_id}]),appendTo:"self",autoZIndex:!0,baseZIndex:2e3},null,8,["modelValue","options","class"]),s.value.subcategory_id?(d(),u("small",_l,n(s.value.subcategory_id[0]),1)):g("",!0)])):g("",!0),t("div",kl,[e[53]||(e[53]=t("label",{class:"form-label d-block"},"Minimum Stock Alert Level",-1)),x(t("input",{"onUpdate:modelValue":e[12]||(e[12]=l=>i.value.minAlert=l),type:"number",min:"0",class:b(["form-control",{"is-invalid":s.value.minAlert}]),placeholder:"e.g., 5"},null,2),[[w,i.value.minAlert]]),s.value.minAlert?(d(),u("small",hl,n(s.value.minAlert[0]),1)):g("",!0)]),t("div",xl,[e[54]||(e[54]=t("label",{class:"form-label"},"Unit Type",-1)),S(h(X),{modelValue:i.value.unit_id,"onUpdate:modelValue":e[13]||(e[13]=l=>i.value.unit_id=l),options:V.units,optionLabel:"name",optionValue:"id",placeholder:"Select Unit",class:b(["w-100 select",{"is-invalid":s.value.unit_id}]),appendTo:"self",autoZIndex:!0,baseZIndex:2e3},null,8,["modelValue","options","class"]),s.value.unit_id?(d(),u("small",wl,n(s.value.unit_id[0]),1)):g("",!0)]),t("div",Sl,[e[55]||(e[55]=t("label",{class:"form-label"},"Preferred Supplier",-1)),S(h(X),{modelValue:i.value.supplier_id,"onUpdate:modelValue":e[14]||(e[14]=l=>i.value.supplier_id=l),options:V.suppliers,optionLabel:"name",optionValue:"id",placeholder:"Select Supplier",class:b(["w-100 select",{"is-invalid":s.value.supplier_id}]),appendTo:"self",autoZIndex:!0,baseZIndex:2e3},null,8,["modelValue","options","class"]),s.value.supplier_id?(d(),u("small",Cl,n(s.value.supplier_id[0]),1)):g("",!0)]),t("div",Il,[e[56]||(e[56]=t("label",{class:"form-label"},"SKU (Optional)",-1)),x(t("input",{"onUpdate:modelValue":e[15]||(e[15]=l=>i.value.sku=l),type:"text",class:b(["form-control",{"is-invalid":s.value.sku}]),placeholder:"Stock Keeping Unit"},null,2),[[w,i.value.sku]]),s.value.sku?(d(),u("small",Vl,n(s.value.sku[0]),1)):g("",!0)]),t("div",Al,[e[57]||(e[57]=t("label",{class:"form-label"},"Description",-1)),x(t("textarea",{"onUpdate:modelValue":e[16]||(e[16]=l=>i.value.description=l),rows:"4",class:b(["form-control",{"is-invalid":s.value.description}]),placeholder:"Notes about this product"},null,2),[[w,i.value.description]]),s.value.description?(d(),u("small",Ml,n(s.value.description[0]),1)):g("",!0)])]),e[67]||(e[67]=t("h6",{class:"mb-3"}," Nutrition Information (per unit) ",-1)),t("div",$l,[t("div",Fl,[e[58]||(e[58]=t("label",{class:"form-label"},"Calories",-1)),x(t("input",{"onUpdate:modelValue":e[17]||(e[17]=l=>i.value.nutrition.calories=l),type:"number",min:"0",class:b(["form-control",{"is-invalid":s.value["nutrition.calories"]}])},null,2),[[w,i.value.nutrition.calories]]),s.value["nutrition.calories"]?(d(),u("small",Ul,n(s.value["nutrition.calories"][0]),1)):g("",!0)]),t("div",El,[e[59]||(e[59]=t("label",{class:"form-label"},"Fat (g)",-1)),x(t("input",{"onUpdate:modelValue":e[18]||(e[18]=l=>i.value.nutrition.fat=l),type:"number",min:"0",class:b(["form-control",{"is-invalid":s.value["nutrition.fat"]}])},null,2),[[w,i.value.nutrition.fat]]),s.value["nutrition.fat"]?(d(),u("small",ql,n(s.value["nutrition.fat"][0]),1)):g("",!0)]),t("div",jl,[e[60]||(e[60]=t("label",{class:"form-label"},"Protein (g)",-1)),x(t("input",{"onUpdate:modelValue":e[19]||(e[19]=l=>i.value.nutrition.protein=l),type:"number",min:"0",class:b(["form-control",{"is-invalid":s.value["nutrition.protein"]}])},null,2),[[w,i.value.nutrition.protein]]),s.value["nutrition.protein"]?(d(),u("small",Dl,n(s.value["nutrition.protein"][0]),1)):g("",!0)]),t("div",Nl,[e[61]||(e[61]=t("label",{class:"form-label"},"Carbs (g)",-1)),x(t("input",{"onUpdate:modelValue":e[20]||(e[20]=l=>i.value.nutrition.carbs=l),type:"number",min:"0",class:b(["form-control",{"is-invalid":s.value["nutrition.carbs"]}])},null,2),[[w,i.value.nutrition.carbs]]),s.value["nutrition.carbs"]?(d(),u("small",Pl,n(s.value["nutrition.carbs"][0]),1)):g("",!0)])]),t("div",Tl,[t("div",Ll,[e[62]||(e[62]=t("label",{class:"form-label d-block"},"Allergies",-1)),S(h(Ve),{modelValue:i.value.allergies,"onUpdate:modelValue":e[21]||(e[21]=l=>i.value.allergies=l),options:V.allergies,optionLabel:"name",optionValue:"id",filter:"",placeholder:"Select Allergies",class:b(["w-full md:w-80 select",{"is-invalid":s.value.allergies}]),appendTo:"self",display:"chip"},null,8,["modelValue","options","class"]),s.value.allergies?(d(),u("small",Ol,n(s.value.allergies[0]),1)):g("",!0)]),t("div",Bl,[e[63]||(e[63]=t("label",{class:"form-label d-block"},"Tags (Halal, Haram, etc.)",-1)),S(h(Ve),{modelValue:i.value.tags,"onUpdate:modelValue":e[22]||(e[22]=l=>i.value.tags=l),options:V.tags,optionLabel:"name",optionValue:"id",filter:"",placeholder:"Select Tags",class:b(["w-full md:w-80 select",{"is-invalid":s.value.tags}]),appendTo:"self",display:"chip"},null,8,["modelValue","options","class"]),s.value.tags?(d(),u("small",Ql,n(s.value.tags[0]),1)):g("",!0)])]),t("div",Rl,[t("div",{class:b(["logo-card",{"is-invalid":s.value.image}])},[t("div",{class:"logo-frame",onClick:e[23]||(e[23]=l=>i.value.imageUrl&&He())},[i.value.imageUrl?(d(),u("img",{key:0,src:i.value.imageUrl,alt:"Image"},null,8,Hl)):(d(),u("div",Kl,[...e[64]||(e[64]=[t("i",{class:"bi bi-image"},null,-1)])]))]),e[65]||(e[65]=t("small",{class:"text-muted mt-2 d-block"},"Upload Image",-1)),S(st,{show:be.value,onClose:e[24]||(e[24]=l=>be.value=!1),onCropped:Ke},null,8,["show"])],2),s.value.image?(d(),u("small",zl,n(s.value.image[0]),1)):g("",!0)]),t("div",Zl,[t("button",{class:"btn btn-primary btn-sm rounded-pill px-5 py-2",disabled:J.value,onClick:Fe},[J.value?(d(),u(D,{key:0},[e[66]||(e[66]=t("span",{class:"spinner-border spinner-border-sm me-2"},null,-1)),ie(" "+n((z.value==="Edit","Saving...")),1)],64)):(d(),u(D,{key:1},[ie(n((z.value==="Edit","Save")),1)],64))],8,Xl),t("button",{class:"btn btn-secondary rounded-pill px-4 ms-2","data-bs-dismiss":"modal",onClick:ae}," Cancel ")])])])])]),t("div",Gl,[t("div",Wl,[t("div",Yl,[t("div",Jl,[t("div",ea,[e[69]||(e[69]=t("i",{class:"bi bi-box-seam text-primary fs-4"},null,-1)),t("div",null,[e[68]||(e[68]=t("h5",{class:"modal-title fw-semibold mb-0"}," View Inventory Item ",-1)),k.value?.sku?(d(),u("small",ta,"SKU: "+n(k.value.sku),1)):g("",!0)])]),e[70]||(e[70]=t("button",{class:"absolute top-2 right-2 p-2 rounded-full hover:bg-gray-100 transition transform hover:scale-110","data-bs-dismiss":"modal","aria-label":"Close",title:"Close"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})])],-1))]),t("div",la,[k.value?(d(),u("div",aa,[t("div",oa,[t("div",sa,[t("div",na,[t("h5",ia,n(k.value.name),1),t("p",ra," SKU: "+n(k.value.sku),1),t("div",da,[t("div",ua,[e[71]||(e[71]=t("div",{class:"text-muted"}," Category ",-1)),t("div",ca,n(k.value.category_name||"—"),1)]),t("div",pa,[e[72]||(e[72]=t("div",{class:"text-muted"}," Unit ",-1)),t("div",ma,n(k.value.unit_name),1)]),t("div",va,[e[73]||(e[73]=t("div",{class:"text-muted"}," Min Alert ",-1)),t("div",ga,n(k.value.minAlert),1)]),t("div",ya,[e[74]||(e[74]=t("div",{class:"text-muted"}," Supplier ",-1)),t("div",fa,n(k.value.supplier_name),1)]),t("div",ba,[e[75]||(e[75]=t("div",{class:"text-muted"}," Description ",-1)),t("div",_a,n(k.value.description||"—"),1)])]),e[76]||(e[76]=t("h6",{class:"fw-semibold"}," Nutrition (per 100g) ",-1)),t("div",ka,[t("span",ha,"Calories: "+n(k.value.nutrition?.calories??"—"),1),t("span",xa,"Protein: "+n(k.value.nutrition?.protein??"—"),1),t("span",wa,"Fat: "+n(k.value.nutrition?.fat??"—"),1),t("span",Sa,"Carbs: "+n(k.value.nutrition?.carbs??"—"),1)]),e[77]||(e[77]=t("hr",null,null,-1)),e[78]||(e[78]=t("h6",{class:"fw-semibold"},"Tags",-1)),t("div",Ca,[(d(!0),u(D,null,Z(k.value.tags,l=>(d(),u("span",{key:l,class:"badge rounded-pill bg-info text-white"},n(l),1))),128))]),e[79]||(e[79]=t("hr",null,null,-1)),e[80]||(e[80]=t("h6",{class:"fw-semibold"}," Allergies ",-1)),t("div",Ia,[(d(!0),u(D,null,Z(k.value.allergies,l=>(d(),u("span",{key:l,class:"badge rounded-pill bg-danger text-white"},n(l),1))),128))])])])]),t("div",Va,[t("div",Aa,[t("div",Ma,[k.value.image_url?(d(),u("div",$a,[t("img",{src:k.value.image_url,alt:"Item Image",class:"w-100 rounded-3",style:{"object-fit":"cover"}},null,8,Fa)])):g("",!0)]),t("div",Ua,[e[81]||(e[81]=t("span",{class:"text-muted"},"Stocked In",-1)),t("span",Ea,n(ee.value.availableQty),1)]),t("div",qa,[e[82]||(e[82]=t("span",{class:"text-muted"},"Updated On",-1)),t("span",ja,n(h(q)(k.value.updated_at)),1)]),t("div",Da,[e[83]||(e[83]=t("span",{class:"text-muted"},"Added By",-1)),t("span",Na,n(k.value.user),1)])])])])):g("",!0),t("div",Pa,[e[88]||(e[88]=t("div",{class:"card-header bg-white d-flex justify-content-between align-items-center"},[t("h5",{class:"mb-0"},"Stock History")],-1)),t("div",Ta,[t("table",La,[e[87]||(e[87]=t("thead",{class:"table-primary"},[t("tr",null,[t("th",{style:{width:"80px"}},"S.#"),t("th",null,"Qty"),t("th",null,"Price"),t("th",null,"Value"),t("th",null,"Description"),t("th",null,"Purchase Date"),t("th",null,"Expiry Date"),t("th",{class:"text-center"}," Status ")])],-1)),t("tbody",null,[(d(!0),u(D,null,Z(L.value,(l,c)=>(d(),u("tr",{key:l.id},[t("td",Oa,n(c+1),1),t("td",null,n(l.quantity),1),t("td",null,n(h(N)(l.price)),1),t("td",Ba,n(h(N)(l.value)),1),t("td",Qa,n(l.description||"—"),1),t("td",Ra,n(h(q)(l.purchase_date)),1),t("td",Ha,n(h(q)(l.expiry_date)),1),t("td",Ka,[t("span",{style:{"min-width":"100px"},class:b(["badge rounded-pill d-inline-block text-center",Xe(l.status)])},n(Ze(l.status)),3)])]))),128)),L.value.length?g("",!0):(d(),u("tr",za,[...e[84]||(e[84]=[t("td",{colspan:"9",class:"text-center text-muted py-4"}," No items found. ",-1)])]))]),t("tfoot",null,[t("tr",null,[e[85]||(e[85]=t("th",null,"Totals",-1)),t("th",null,n(ee.value.totalQty),1),t("th",null,n(h(N)(ee.value.totalPrice)),1),t("th",Za,n(h(N)(ee.value.totalValue)),1),e[86]||(e[86]=t("th",{colspan:"4"},null,-1))])])])])])])])])]),t("div",Xa,[t("div",Ga,[t("div",Wa,[t("div",Ya,[t("h5",Ja," Stock In: "+n(p.value.name),1),t("button",{class:"absolute top-2 right-2 p-2 rounded-full hover:bg-gray-100 transition transform hover:scale-110","data-bs-dismiss":"modal","aria-label":"Close",title:"Close",onClick:fe},[...e[89]||(e[89]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),t("div",eo,[t("div",to,[t("div",lo,[e[90]||(e[90]=t("label",{class:"form-label"},"Product Name",-1)),x(t("input",{type:"text","onUpdate:modelValue":e[25]||(e[25]=l=>p.value.name=l),class:b(["form-control",{"is-invalid":s.value.name}]),readonly:""},null,2),[[w,p.value.name]]),s.value.name?(d(),u("small",ao,n(s.value.name[0]),1)):g("",!0)]),t("div",oo,[e[91]||(e[91]=t("label",{class:"form-label"},"Category",-1)),t("input",{type:"text",value:De.value,class:"form-control",readonly:""},null,8,so),s.value.category_id?(d(),u("small",no,n(s.value.category_id[0]),1)):g("",!0)]),t("div",io,[e[92]||(e[92]=t("label",{class:"form-label"},"Supplier",-1)),S(h(X),{modelValue:p.value.supplier_id,"onUpdate:modelValue":e[26]||(e[26]=l=>p.value.supplier_id=l),options:V.suppliers,optionLabel:"name",optionValue:"id",placeholder:"Select Supplier",class:b(["w-100",{"is-invalid":s.value.supplier_id}]),appendTo:"self"},null,8,["modelValue","options","class"]),s.value.supplier_id?(d(),u("small",ro,n(s.value.supplier_id[0]),1)):g("",!0)]),t("div",uo,[e[93]||(e[93]=t("label",{class:"form-label"},"Available Quantity",-1)),x(t("input",{type:"number","onUpdate:modelValue":e[27]||(e[27]=l=>p.value.available_quantity=l),class:"form-control",readonly:""},null,512),[[w,p.value.available_quantity]])]),t("div",co,[e[94]||(e[94]=t("label",{class:"form-label"},"Quantity",-1)),x(t("input",{type:"number","onUpdate:modelValue":e[28]||(e[28]=l=>p.value.quantity=l),class:b(["form-control",{"is-invalid":s.value.quantity}]),min:"0",onInput:e[29]||(e[29]=l=>K())},null,34),[[w,p.value.quantity]]),s.value.quantity?(d(),u("small",po,n(s.value.quantity[0]),1)):g("",!0)]),t("div",mo,[e[95]||(e[95]=t("label",{class:"form-label"},"Price",-1)),x(t("input",{type:"number","onUpdate:modelValue":e[30]||(e[30]=l=>p.value.price=l),class:b(["form-control",{"is-invalid":s.value.price}]),min:"0",onInput:e[31]||(e[31]=l=>K())},null,34),[[w,p.value.price]]),s.value.price?(d(),u("small",vo,n(s.value.price[0]),1)):g("",!0)]),t("div",go,[e[96]||(e[96]=t("label",{class:"form-label"},"Value",-1)),x(t("input",{type:"text","onUpdate:modelValue":e[32]||(e[32]=l=>p.value.value=l),class:"form-control",readonly:""},null,512),[[w,p.value.value]])]),t("div",yo,[e[97]||(e[97]=t("label",{class:"form-label"},"Expiry Date",-1)),S(o,{modelValue:p.value.expiry_date,"onUpdate:modelValue":e[33]||(e[33]=l=>p.value.expiry_date=l),format:h(q),"min-date":new Date,class:b({"is-invalid":s.value.expiry_date}),enableTimePicker:!1,placeholder:"Select date"},null,8,["modelValue","format","min-date","class"]),s.value.expiry_date?(d(),u("small",fo,n(s.value.expiry_date[0]),1)):g("",!0)]),t("div",bo,[e[98]||(e[98]=t("label",{class:"form-label"},"Notes / Reason",-1)),x(t("textarea",{"onUpdate:modelValue":e[34]||(e[34]=l=>p.value.description=l),rows:"3",class:"form-control"},null,512),[[w,p.value.description]])])]),t("div",_o,[t("button",{class:"d-flex align-items-center justify-content-center gap-2 px-4 py-2 rounded-pill btn btn-primary text-white",disabled:F.value,onClick:qe},[F.value?(d(),u("span",ho)):g("",!0),t("span",null,n(F.value?"Saving...":"Stock In"),1)],8,ko)])])])])]),t("div",xo,[t("div",wo,[t("div",So,[t("div",Co,[t("h5",Io," Stock Out : "+n(p.value.name),1),t("button",{class:"absolute top-2 right-2 p-2 rounded-full hover:bg-gray-100 transition transform hover:scale-110","data-bs-dismiss":"modal","aria-label":"Close",title:"Close",onClick:fe},[...e[99]||(e[99]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),t("div",Vo,[t("div",Ao,[t("div",Mo,[e[100]||(e[100]=t("label",{class:"form-label"},"Product Name",-1)),x(t("input",{type:"text","onUpdate:modelValue":e[35]||(e[35]=l=>p.value.name=l),class:"form-control",readonly:""},null,512),[[w,p.value.name]])]),t("div",$o,[e[101]||(e[101]=t("label",{class:"form-label"},"Category",-1)),t("input",{type:"text",value:je.value,class:"form-control",readonly:""},null,8,Fo),s.value.category_id?(d(),u("small",Uo,n(s.value.category_id[0]),1)):g("",!0)]),t("div",Eo,[e[102]||(e[102]=t("label",{class:"form-label"},"Available Quantity",-1)),x(t("input",{type:"number","onUpdate:modelValue":e[36]||(e[36]=l=>p.value.available_quantity=l),class:"form-control",readonly:""},null,512),[[w,p.value.available_quantity]])]),t("div",qo,[e[103]||(e[103]=t("label",{class:"form-label"},"Quantity",-1)),x(t("input",{type:"number","onUpdate:modelValue":e[37]||(e[37]=l=>p.value.quantity=l),class:b(["form-control",{"is-invalid":s.value.quantity}]),min:"0",onInput:e[38]||(e[38]=l=>K())},null,34),[[w,p.value.quantity]]),s.value.quantity?(d(),u("small",jo,n(s.value.quantity[0]),1)):g("",!0)]),t("div",Do,[e[104]||(e[104]=t("label",{class:"form-label"},"Notes / Reason",-1)),x(t("textarea",{"onUpdate:modelValue":e[39]||(e[39]=l=>p.value.description=l),rows:"3",class:"form-control"},null,512),[[w,p.value.description]])])]),t("div",No,[t("button",{class:"d-flex align-items-center gap-1 px-4 py-2 rounded-pill btn btn-danger text-white",disabled:F.value,onClick:Le}," Stock Out ",8,Po)])])])])])])]),_:1})}}},rs=Ae(To,[["__scopeId","data-v-12c72247"]]);export{rs as default};
