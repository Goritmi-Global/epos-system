import{_ as Ze,r as v,S as oe,c as ve,w as qe,o as Ye,n as Ge,s as o,z as He,I as Ke,E as We,a as ne,b as d,d as k,e as b,f as t,u as f,h as Je,p as S,g as m,F as j,i as ie,j as h,k as Qe,t as r,l as x,m as I,v as T,C as fe,P as et,q as C}from"./app-BWJIgFUk.js";import{_ as tt}from"./Master-CIAemtMp.js";import{s as be}from"./index-CQSxWd0K.js";import{u as at}from"./useFormatters-D4QMfBkH.js";import{s as st,a as lt,b as ge,c as ot,d as ye}from"./index-QvHmelj9.js";import{E as nt,a as it,X as rt,u as O,w as dt}from"./xlsx-BS8XIOXE.js";import{I as ct}from"./importFile-D0INQ-rw.js";import{F as ut}from"./FilterModal-JVylnsp0.js";import{s as mt}from"./index-Dlg67k_X.js";import{P as pt}from"./percent-DBZ-q8xB.js";import{C as vt}from"./calendar-BGmki1VK.js";import{C as ft}from"./circle-x-CjlZLeFL.js";import{P as bt}from"./plus-CXHrIUTn.js";import{P as gt}from"./pencil-BJi1dG4D.js";import{T as yt}from"./trash-2-VIB_8OHE.js";import"./index-N5It5Rdt.js";import"./createLucideIcon-BtxAcjLS.js";import"./PasswordVerificationModal-C7K_1d78.js";import"./index-566Dsl26.js";import"./index-DrwUNMx0.js";import"./sun-DRYQ-wZ1.js";import"./index-CTSD38n0.js";import"./index-zt3OxlBu.js";import"./index-DTkP46Ub.js";import"./index-CmMDiWKC.js";const ht={class:"page-wrapper"},_t={class:"mt-3"},xt={class:"row g-3 mb-4"},Dt={class:"card border-0 shadow-sm rounded-4"},wt={class:"card-body d-flex align-items-center"},St={class:"mb-0 fw-bold"},kt={class:"text-muted mb-0 small"},Ct={class:"card border-0 shadow-lg rounded-4"},Mt={class:"card-body"},$t={class:"d-flex flex-wrap gap-2 justify-content-between align-items-center mb-3"},Ft={class:"d-flex flex-wrap gap-2 align-items-center"},It={class:"search-wrap"},Tt={key:1,class:"form-control search-input",placeholder:"Search discounts",disabled:"",type:"text"},Et={class:"table-responsive"},Pt={class:"table table-striped"},Vt={key:0},At={class:"fw-semibold"},Nt={class:"text-center"},Lt={class:"text-center"},Rt={class:"d-inline-flex align-items-center gap-3"},Bt=["onClick"],jt=["title"],Ot={title:"Delete",class:"p-2 rounded-full text-red-600 hover:bg-red-100"},Ut={key:1},zt={key:0,class:"mt-4 d-flex justify-content-between align-items-center"},Xt={class:"text-muted small"},Zt={class:"mt-3"},qt={class:"card border-0 shadow-sm rounded-4"},Yt={class:"card-body"},Gt={key:0,class:"text-center py-5"},Ht={key:1,class:"text-center py-5"},Kt={key:2,class:"row g-3"},Wt={class:"card border border-warning rounded-4 h-100"},Jt={class:"card-body"},Qt={class:"d-flex justify-content-between align-items-start mb-3"},ea={class:"fw-bold mb-1"},ta={class:"text-end"},aa={class:"h3 text-primary mb-0 fw-bold"},sa={class:"mb-3"},la={class:"d-flex align-items-center gap-2 mb-2"},oa={class:"text-muted"},na={class:"fw-semibold"},ia={class:"d-flex align-items-center gap-2 mb-2"},ra={class:"text-muted"},da={class:"mb-3"},ca=["onUpdate:modelValue"],ua={class:"d-flex gap-2"},ma=["onClick","disabled"],pa=["onClick","disabled"],va={class:"modal fade",id:"discountModal",tabindex:"-1","aria-hidden":"true"},fa={class:"modal-dialog modal-lg modal-dialog-centered"},ba={class:"modal-content rounded-4"},ga={class:"modal-header"},ya={class:"modal-title fw-semibold"},ha={class:"modal-body"},_a={class:"row g-3"},xa={class:"col-12"},Da={key:0,class:"text-danger"},wa={class:"col-md-6"},Sa={key:0,class:"text-danger"},ka={class:"col-md-6"},Ca={key:0,class:"text-danger"},Ma={class:"col-12"},$a={key:0,class:"text-danger"},Fa={class:"col-md-6"},Ia={key:0,class:"text-danger"},Ta={class:"col-md-6"},Ea={key:0,class:"text-danger"},Pa={class:"col-md-6"},Va={key:0,class:"text-danger"},Aa={class:"col-md-6"},Na={key:0,class:"text-danger"},La={class:"col-12"},Ra={key:0,class:"text-danger"},Ba={class:"mt-4"},ja=["disabled"],Oa={__name:"Index",setup(Ua){const{formatCurrencySymbol:E,dateFmt:_}=at(),P=v([]),V=v(null),U=v(!1),n=v({}),L=v([]),z=v(!1),X=oe({}),Z=oe({});oe({});const A=v(null),re=v(0),g=v({sortBy:"",stockStatus:"",category:"",priceMin:null,priceMax:null,dateFrom:null,dateTo:null}),N=v(1),W=v(10),J=v(0),q=v([]),D=v(!1),Q=v(null),Y=v({total:0,active:0,inactive:0,flat:0,percent:0}),he=[{label:"PDF",value:"pdf"},{label:"Excel",value:"excel"},{label:"CSV",value:"csv"}],_e=s=>{s.value&&(Re(s.value),Q.value=null)},xe=[{label:"Percentage",value:"percent"}],De=[{label:"Active",value:"active"},{label:"Deactive",value:"inactive"}],p=v({name:"",type:"percent",status:"active",start_date:"",end_date:"",min_purchase:0,max_discount:null,description:"",discount_amount:null}),F=v(""),de=v(Date.now()),ee=`search-${Math.random().toString(36).substr(2,9)}`,ce=v(!1);ve(()=>[{id:"flat",name:"Flat"},{id:"percent",name:"Percentage"}]);const G=v({sortBy:"",stockStatus:"",priceMin:null,priceMax:null,dateFrom:null,dateTo:null}),te=v(!1),we=s=>{g.value={...s},G.value={...s},N.value=1,te.value=!0,M(1)},Se=()=>{const s=document.getElementById("discountsFilterModal");if(!s)return;(bootstrap.Modal.getInstance(s)||new bootstrap.Modal(s)).hide()},ue=()=>{G.value={sortBy:"",stockStatus:"",category:"",priceMin:null,priceMax:null,dateFrom:null,dateTo:null},g.value={sortBy:"",stockStatus:"",category:"",priceMin:null,priceMax:null,dateFrom:null,dateTo:null},N.value=1,M(1),Se()},ke=ve(()=>[{label:"Total Discounts",value:Y.value.total,icon:pt,iconBg:"bg-light-primary",iconColor:"text-primary"},{label:"Active Discounts",value:Y.value.active,icon:vt,iconBg:"bg-light-success",iconColor:"text-success"},{label:"Inactive Discounts",value:Y.value.inactive,icon:ft,iconBg:"bg-light-danger",iconColor:"text-danger"}]),M=async(s=1)=>{D.value=!0;try{const e=await C.get("/api/discounts/all",{params:{page:s,per_page:W.value,q:F.value.trim()||null,status:g.value.stockStatus||null,category:g.value.category||null,sort_by:g.value.sortBy||null,price_min:g.value.priceMin||null,price_max:g.value.priceMax||null,date_from:g.value.dateFrom?_(g.value.dateFrom):null,date_to:g.value.dateTo?_(g.value.dateTo):null}});P.value=e.data.data||[],e.data.pagination&&(N.value=e.data.pagination.current_page,J.value=e.data.pagination.total,q.value=e.data.pagination.links)}catch(e){console.error("Failed to fetch discounts:",e),o.error("Failed to load discounts")}finally{D.value=!1}},R=async()=>{try{const s=await C.get("/api/discounts/global-stats");Y.value=s.data.data||{total:0,active:0,inactive:0,flat:0,percent:0}}catch(s){console.error("Failed to fetch global discount stats:",s)}},Ce=s=>{if(!s||D.value)return;const c=new URLSearchParams(s.split("?")[1]).get("page");c&&M(parseInt(c))},H=async(s=!1)=>{if(!(z.value&&!s)){s||(z.value=!0);try{const e=await C.get("/api/discount-approvals/pending");e.data.success&&(L.value=e.data.data)}catch(e){console.error("Error fetching pending requests:",e),s||o.error("Failed to load approval requests")}finally{s||(z.value=!1)}}},K=()=>{p.value={name:"",type:"percent",status:"active",start_date:"",end_date:"",min_purchase:0,max_discount:null,description:"",discount_amount:null},V.value=null,n.value={}},Me=s=>{V.value=s,p.value={name:s.name,type:s.type,status:s.status,start_date:s.start_date?new Date(s.start_date):null,end_date:s.end_date?new Date(s.end_date):null,min_purchase:s.min_purchase,max_discount:s.max_discount,description:s.description||"",discount_amount:s.discount_amount};const e=document.getElementById("discountModal");new bootstrap.Modal(e).show()},$e=async()=>{U.value=!0,n.value={};try{V.value?(await C.patch(`/discounts/${V.value.id}`,p.value),o.success("Discount updated successfully")):(await C.post("/discounts",p.value),o.success("Discount created successfully"));const s=document.getElementById("discountModal"),e=bootstrap.Modal.getInstance(s);e&&e.hide(),setTimeout(()=>{document.body.classList.remove("modal-open"),document.body.style.overflow="",document.body.style.paddingRight="",document.querySelectorAll(".modal-backdrop").forEach(a=>a.remove())},100),K(),await M(),R()}catch(s){if(console.error("❌ Error:",s.response?.data||s.message),s.response?.status===422&&s.response?.data?.errors){n.value=s.response.data.errors;const e=Object.values(s.response.data.errors).flat();o.error(e.join(`
`))}else{const e=s.response?.data?.message||"Failed to save discount";o.error(e)}}finally{U.value=!1}setTimeout(()=>{document.querySelectorAll(".modal-backdrop").forEach(e=>e.remove()),document.body.classList.remove("modal-open"),document.body.style.overflow="",document.body.style.paddingRight=""},100)},Fe=["Discount Name","Type","Discount Percent","Start Date","End Date","Min Purchase","Max Discount","Status","Description"],Ie=[["Summer Sale","flat","20","2025-06-01","2025-08-31","50","100","active","Summer discount on all items"],["Winter Sale","flat","10","2025-01-01","2025-12-31","30","","active","Flat 10 off on purchase"]];let me=null;qe(F,()=>{clearTimeout(me),me=setTimeout(()=>{N.value=1,M(1)},500)});const Te=s=>{const e=l=>{if(!l)return"";if(!isNaN(l)&&Number(l)>3e4){const se=Number(l),B=new Date((se-25569)*86400*1e3),le=B.getFullYear(),ze=String(B.getMonth()+1).padStart(2,"0"),Xe=String(B.getDate()).padStart(2,"0");return`${le}-${ze}-${Xe}`}if(typeof l=="string"&&/^\d{4}-\d{2}-\d{2}$/.test(l))return l;const $=new Date(l);if(!isNaN($.getTime())){const se=$.getFullYear(),B=String($.getMonth()+1).padStart(2,"0"),le=String($.getDate()).padStart(2,"0");return`${se}-${B}-${le}`}return""};if(!s||s.length<=1){o.error("The imported file is empty.");return}s[0];const a=s.slice(1).map(l=>({name:l[0]||"",type:l[1]||"percent",discount_amount:l[2]||"",start_date:e(l[3]),end_date:e(l[4]),min_purchase:l[5]||"0",max_discount:l[6]||null,status:l[7]||"active",description:l[8]||""})).filter(l=>l.name.trim());if(a.length===0){o.error("No valid discounts found in the file.");return}const y=a.map(l=>l.name.trim().toLowerCase()),w=y.filter((l,$)=>y.indexOf(l)!==$);if(w.length>0){o.error(`Duplicate discount names found: ${[...new Set(w)].join(", ")}`);return}const u=P.value.map(l=>l.name.trim().toLowerCase()),i=a.filter(l=>u.includes(l.name.trim().toLowerCase()));if(i.length>0){o.error(`Discounts already exist: ${i.map(l=>l.name).join(", ")}`);return}const ae=["flat","percent"];if(a.filter(l=>!ae.includes(l.type.toLowerCase())).length>0){o.error("Invalid type detected. Allowed: flat, percent");return}const Ue=["active","inactive"];if(a.filter(l=>!Ue.includes(l.status.toLowerCase())).length>0){o.error("Invalid status detected. Allowed: active, inactive");return}C.post("/api/discounts/import",{discounts:a}).then(()=>{o.success("Discounts imported successfully"),M(),R()}).catch(l=>{const $=l.response?.data?.message||"Import failed";o.error($)})},Ee=async s=>{const e=s.status==="active"?"inactive":"active";try{await C.patch(`/api/discounts/${s.id}/toggle-status`,{status:e}),s.status=e,o.success(`Discount status updated to ${e}`),re.value++,await R()}catch(c){console.error("Failed to update status:",c),o.error("Failed to update status")}},Pe=async s=>{try{await C.delete(`/discounts/${s.id}`),o.success("Discount deleted successfully"),await M(),R()}catch(e){console.error("Failed to delete discount:",e),o.error("Failed to delete discount")}},pe=async(s,e)=>{X[s]=!0;try{(await C.post(`/api/discount-approvals/${s}/respond`,{status:e,approval_note:Z[s]||null})).data.success&&(o.success(`Discount ${e} successfully!`),L.value=L.value.filter(a=>a.id!==s),delete Z[s])}catch(c){console.error("Error responding to request:",c),o.error(c.response?.data?.message||`Failed to ${e} discount`)}finally{X[s]=!1}},Ve=s=>s?new Date(s).toLocaleString("en-GB",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-",Ae=()=>{A.value&&clearInterval(A.value),A.value=setInterval(()=>{H(!0)},3e4)},Ne=()=>{A.value&&(clearInterval(A.value),A.value=null)};Ye(async()=>{F.value="",de.value=Date.now(),await Ge(),setTimeout(()=>{ce.value=!0;const c=document.getElementById(ee);c&&(c.value="",F.value="")},100),await M(),await H(),R(),Ae(),window.Echo&&window.Echo.channel("discount-approvals").listen(".approval.requested",c=>{H(!0),o.info("New discount approval request received!")});const s=document.getElementById("discountModal");s&&s.addEventListener("hidden.bs.modal",()=>{document.body.classList.remove("modal-open"),document.body.style.overflow="",document.querySelectorAll(".modal-backdrop").forEach(a=>a.remove())});const e=document.getElementById("discountsFilterModal");e&&e.addEventListener("hidden.bs.modal",()=>{te.value||ue(),te.value=!1})}),He(()=>{Ne()}),Ke(()=>window.feather?.replace());const Le=async()=>{try{return D.value=!0,(await C.get("/api/discounts/all",{params:{export:"all",q:F.value.trim()||null,status:g.value.stockStatus||null,category:g.value.category||null,sort_by:g.value.sortBy||null,price_min:g.value.priceMin||null,price_max:g.value.priceMax||null,date_from:g.value.dateFrom||null,date_to:g.value.dateTo||null}})).data.data||[]}catch(s){return console.error("❌ Error fetching export data:",s),o.error("Failed to load data for export"),[]}finally{D.value=!1}},Re=async s=>{if(!P.value||P.value.length===0){o.error("No Discounts data to download");return}try{D.value=!0;const e=await Le();if(!e.length){o.error("No discounts found to download"),D.value=!1;return}s==="pdf"?je(e):s==="excel"?Oe(e):s==="csv"?Be(e):o.error("Invalid download type")}catch(e){console.error("Download failed:",e),o.error(`Download failed: ${e.message}`)}finally{D.value=!1}},Be=s=>{try{const e=["ID","Discount Name","Type","Discount Percent","Start Date","End Date","Min Purchase","Max Discount","Status","Description"],c=s.map(i=>[`${i.id||""}`,`"${i.name||""}"`,`"${i.type||""}"`,`${i.discount_amount||""}`,`"${_(i.start_date)||""}"`,`"${_(i.end_date)||""}"`,`${i.min_purchase||""}`,`${i.max_discount||""}`,`"${i.status||""}"`,`"${i.description||""}"`]),a=[e.join(","),...c.map(i=>i.join(","))].join(`
`),y=new Blob([a],{type:"text/csv;charset=utf-8;"}),w=URL.createObjectURL(y),u=document.createElement("a");u.setAttribute("href",w),u.setAttribute("download",`Discounts_${new Date().toISOString().split("T")[0]}.csv`),document.body.appendChild(u),u.click(),document.body.removeChild(u),o.success("CSV downloaded successfully")}catch(e){console.error("CSV generation error:",e),o.error(`CSV generation failed: ${e.message}`)}},je=s=>{try{const e=new nt("l","mm","a4");e.setFontSize(18),e.setFont("helvetica","bold"),e.text("Discounts Report",14,20),e.setFontSize(10),e.setFont("helvetica","normal");const c=new Date().toLocaleString();e.text(`Generated on: ${c}`,14,28),e.text(`Total Discounts: ${s.length}`,14,34);const a=["ID","Name","Type","Amount","Start Date","End Date","Min Purchase","Max Discount","Status"],y=s.map(u=>[u.id||"",u.name||"",u.type==="flat"?"Flat":"Percent",u.type==="flat"?E(u.discount_amount):u.discount_amount+"%",_(u.start_date)||"",_(u.end_date)||"",E(u.min_purchase)||"",u.max_discount?E(u.max_discount):"N/A",u.status==="active"?"Active":"Inactive"]);it(e,{head:[a],body:y,startY:40,styles:{fontSize:8,cellPadding:2,halign:"left",lineColor:[0,0,0],lineWidth:.1},headStyles:{fillColor:[41,128,185],textColor:255,fontStyle:"bold"},alternateRowStyles:{fillColor:[245,245,245]},margin:{left:14,right:14},didDrawPage:u=>{const i=e.internal.getNumberOfPages(),ae=e.internal.pageSize.height;e.setFontSize(8),e.text(`Page ${u.pageNumber} of ${i}`,u.settings.margin.left,ae-10)}});const w=`Discounts_${new Date().toISOString().split("T")[0]}.pdf`;e.save(w),o.success("PDF downloaded successfully")}catch(e){console.error("PDF generation error:",e),o.error(`PDF generation failed: ${e.message}`)}},Oe=s=>{try{if(typeof rt>"u")throw new Error("XLSX library is not loaded");const e=s.map(i=>({ID:i.id||"","Discount Name":i.name||"",Type:i.type==="flat"?"Flat":"Percent","Discount Percent":i.type==="flat"?i.discount_amount:i.discount_amount+"%","Start Date":_(i.start_date)||"","End Date":_(i.end_date)||"","Min Purchase":i.min_purchase||"","Max Discount":i.max_discount||"",Status:i.status==="active"?"Active":"Inactive",Description:i.description||""})),c=O.book_new(),a=O.json_to_sheet(e);a["!cols"]=[{wch:8},{wch:25},{wch:12},{wch:15},{wch:15},{wch:15},{wch:15},{wch:15},{wch:12},{wch:30}],O.book_append_sheet(c,a,"Discounts");const y=[{Info:"Report",Value:"Discounts Export"},{Info:"Generated On",Value:new Date().toLocaleString()},{Info:"Total Records",Value:s.length},{Info:"Exported By",Value:"Inventory Management System"}],w=O.json_to_sheet(y);O.book_append_sheet(c,w,"Report Info");const u=`Discounts_${new Date().toISOString().split("T")[0]}.xlsx`;dt(c,u),o.success("Excel file downloaded successfully")}catch(e){console.error("Excel generation error:",e),o.error(`Excel generation failed: ${e.message}`)}};return(s,e)=>{const c=We("VueDatePicker");return d(),ne(tt,null,{default:k(()=>[b(f(Je),{title:"Discount Management"}),t("div",ht,[e[47]||(e[47]=t("h4",{class:"fw-semibold mb-3"},"Discount Management",-1)),b(f(st),{value:"0",class:"w-100"},{default:k(()=>[b(f(lt),null,{default:k(()=>[b(f(ge),{value:"0"},{default:k(()=>[...e[13]||(e[13]=[S("Discounts",-1)])]),_:1}),b(f(ge),{value:"1"},{default:k(()=>[...e[14]||(e[14]=[S("Discount Approvals",-1)])]),_:1})]),_:1}),b(f(ot),null,{default:k(()=>[b(f(ye),{value:"0"},{default:k(()=>[t("div",_t,[t("div",xt,[(d(!0),m(j,null,ie(ke.value,a=>(d(),m("div",{key:a.label,class:"col-md-6 col-xl-3"},[t("div",Dt,[t("div",wt,[t("div",{class:h([[a.iconBg,a.iconColor],"rounded-circle p-3 d-flex align-items-center justify-content-center me-3"]),style:{width:"56px",height:"56px"}},[(d(),ne(Qe(a.icon),{class:"w-6 h-6"}))],2),t("div",null,[t("h3",St,r(a.value),1),t("p",kt,r(a.label),1)])])])]))),128))]),t("div",Ct,[t("div",Mt,[t("div",$t,[e[18]||(e[18]=t("h5",{class:"mb-0 fw-semibold"},"Discounts",-1)),t("div",Ft,[t("div",It,[e[15]||(e[15]=t("i",{class:"bi bi-search"},null,-1)),e[16]||(e[16]=t("input",{type:"email",name:"email",autocomplete:"email",style:{position:"absolute",left:"-9999px",width:"1px",height:"1px"},tabindex:"-1","aria-hidden":"true"},null,-1)),ce.value?I((d(),m("input",{id:ee,"onUpdate:modelValue":e[0]||(e[0]=a=>F.value=a),key:de.value,class:"form-control search-input",placeholder:"Search discounts",type:"search",autocomplete:"new-password",name:ee,role:"presentation"})),[[T,F.value]]):(d(),m("input",Tt))]),b(ut,{modelValue:G.value,"onUpdate:modelValue":e[1]||(e[1]=a=>G.value=a),title:"Discounts",modalId:"discountsFilterModal",modalSize:"modal-lg",sortOptions:[{value:"name_asc",label:"Name: A to Z"},{value:"name_desc",label:"Name: Z to A"}],showStockStatus:!1,categoryLabel:"Discount Type",statusLabel:"Discount Status",showPriceRange:!0,priceRangeLabel:"Discount Percent Range",showDateRange:!0,onApply:we,onClear:ue},null,8,["modelValue"]),t("button",{"data-bs-toggle":"modal","data-bs-target":"#discountModal",onClick:K,class:"d-flex align-items-center gap-1 px-4 py-2 rounded-pill btn btn-primary text-white"},[b(f(bt),{class:"w-4 h-4"}),e[17]||(e[17]=S(" Add Discount ",-1))]),b(ct,{label:"Import Discounts",sampleHeaders:Fe,sampleData:Ie,onOnImport:Te}),b(f(mt),{modelValue:Q.value,"onUpdate:modelValue":e[2]||(e[2]=a=>Q.value=a),options:he,optionLabel:"label",optionValue:"value",placeholder:"Export",class:"export-dropdown",onChange:_e},null,8,["modelValue"])])]),t("div",Et,[t("table",Pt,[e[21]||(e[21]=t("thead",{class:"border-top small text-muted"},[t("tr",null,[t("th",null,"S.#"),t("th",null,"Name"),t("th",null,"Type"),t("th",null,"Discount (%)"),t("th",null,"Start Date"),t("th",null,"End Date"),t("th",null,"Min Purchase"),t("th",null,"Max Discount"),t("th",{class:"text-center"},"Status"),t("th",{class:"text-center"},"Action")])],-1)),t("tbody",null,[D.value?(d(),m("tr",Vt,[...e[19]||(e[19]=[t("td",{colspan:"10",class:"text-center py-4"},[t("div",{class:"spinner-border text-primary",role:"status"},[t("span",{class:"visually-hidden"},"Loading...")])],-1)])])):x("",!0),(d(!0),m(j,null,ie(P.value,(a,y)=>(d(),m("tr",{key:a.id},[t("td",null,r(y+1),1),t("td",At,r(a.name),1),t("td",null,[t("span",{class:h(a.type==="flat"?"badge bg-primary px-4 py-2 rounded-pill":"badge bg-warning px-4 py-2 rounded-pill")},r(a.type==="flat"?"Flat":"Percent"),3)]),t("td",null,r(a.type==="flat"?f(E)(a.discount_amount):a.discount_amount+"%"),1),t("td",null,r(f(_)(a.start_date)),1),t("td",null,r(f(_)(a.end_date)),1),t("td",null,r(f(E)(a.min_purchase)),1),t("td",null,r(a.max_discount?f(E)(a.max_discount):"N/A"),1),t("td",Nt,[t("span",{class:h(a.status==="active"?"badge bg-success px-4 py-2 rounded-pill":"badge bg-danger px-4 py-2 rounded-pill")},r(a.status==="active"?"Active":"Inactive"),3)]),t("td",Lt,[t("div",Rt,[t("button",{onClick:w=>Me(a),title:"Edit",class:"p-2 rounded-full text-blue-600 hover:bg-blue-100"},[b(f(gt),{class:"w-4 h-4"})],8,Bt),(d(),ne(fe,{key:`confirm-${a.id}-${re.value}`,title:"Confirm Status Change",message:`Are you sure you want to set ${a.name} to ${a.status==="active"?"Inactive":"Active"}?`,showStatusButton:!0,confirmText:"Yes, Change",cancelText:"Cancel",status:a.status,onConfirm:w=>Ee(a)},{trigger:k(()=>[t("button",{class:h(["relative inline-flex items-center w-8 h-4 rounded-full transition-colors duration-300 focus:outline-none",a.status==="active"?"bg-green-500 hover:bg-green-600":"bg-red-400 hover:bg-red-500"]),title:a.status==="active"?"Set Inactive":"Set Active"},[t("span",{class:h(["absolute left-0.5 top-0.5 w-3 h-3 bg-white rounded-full shadow transform transition-transform duration-300",a.status==="active"?"translate-x-4":"translate-x-0"])},null,2)],10,jt)]),_:2},1032,["message","status","onConfirm"])),b(fe,{title:"Confirm Delete",message:`Are you sure you want to delete ${a.name}? This action cannot be undone.`,confirmText:"Yes, Delete",cancelText:"Cancel",onConfirm:w=>Pe(a)},{trigger:k(()=>[t("button",Ot,[b(f(yt),{class:"w-4 h-4"})])]),_:1},8,["message","onConfirm"])])])]))),128)),!D.value&&P.value.length===0?(d(),m("tr",Ut,[...e[20]||(e[20]=[t("td",{colspan:"10",class:"text-center text-muted py-4"}," No discounts found. ",-1)])])):x("",!0)])])]),q.value&&q.value.length>0&&!D.value?(d(),m("div",zt,[t("div",Xt," Showing "+r((N.value-1)*W.value+1)+" to "+r(Math.min(N.value*W.value,J.value))+" of "+r(J.value)+" entries ",1),b(et,{pagination:q.value,isApiDriven:!0,onPageChanged:Ce},null,8,["pagination"])])):x("",!0)])])])]),_:1}),b(f(ye),{value:"1"},{default:k(()=>[t("div",Zt,[t("div",qt,[t("div",{class:"card-header bg-white border-0 d-flex justify-content-between align-items-center py-3"},[e[23]||(e[23]=t("h4",{class:"mb-0 fw-bold"},[t("i",{class:"bi bi-shield-check text-primary me-2"}),S(" Discount Approval Requests ")],-1)),t("button",{class:"btn btn-outline-primary btn-sm",onClick:H},[...e[22]||(e[22]=[t("i",{class:"bi bi-arrow-clockwise me-1"},null,-1),S(" Refresh ",-1)])])]),t("div",Yt,[z.value?(d(),m("div",Gt,[...e[24]||(e[24]=[t("div",{class:"spinner-border text-primary",role:"status"},[t("span",{class:"visually-hidden"},"Loading...")],-1),t("p",{class:"mt-3 text-muted"},"Loading approval requests...",-1)])])):L.value.length===0?(d(),m("div",Ht,[...e[25]||(e[25]=[t("i",{class:"bi bi-inbox",style:{"font-size":"4rem",opacity:"0.3"}},null,-1),t("p",{class:"mt-3 text-muted fw-semibold"},"No pending discount approval requests",-1)])])):(d(),m("div",Kt,[(d(!0),m(j,null,ie(L.value,a=>(d(),m("div",{key:a.id,class:"col-md-4"},[t("div",Wt,[t("div",Jt,[t("div",Qt,[t("div",null,[t("h5",ea,r(a.discount_name||a.discount.name),1),e[26]||(e[26]=t("span",{class:"badge bg-warning"},[t("i",{class:"bi bi-clock-history me-1"}),S(" Pending Approval ")],-1))]),t("div",ta,[t("div",aa,r(parseFloat(a.discount_percentage).toFixed(0))+"% ",1),e[27]||(e[27]=t("small",{class:"text-muted d-block"},"Discount Rate",-1))])]),t("div",sa,[t("div",la,[e[29]||(e[29]=t("i",{class:"bi bi-person-circle text-muted"},null,-1)),t("small",oa,[e[28]||(e[28]=S(" Requested by: ",-1)),t("span",na,r(a.requested_by.name),1)])]),t("div",ia,[e[30]||(e[30]=t("i",{class:"bi bi-clock text-muted"},null,-1)),t("small",ra,r(Ve(a.requested_at)),1)])]),t("div",da,[e[31]||(e[31]=t("label",{class:"form-label small fw-semibold"},"Response Note (Optional)",-1)),I(t("textarea",{"onUpdate:modelValue":y=>Z[a.id]=y,class:"form-control form-control-sm",rows:"2",placeholder:"Add a note for the cashier..."},null,8,ca),[[T,Z[a.id]]])]),t("div",ua,[t("button",{class:"btn btn-success flex-fill",onClick:y=>pe(a.id,"approved"),disabled:X[a.id]},[...e[32]||(e[32]=[t("i",{class:"bi bi-check-circle me-1"},null,-1),S(" Approve ",-1)])],8,ma),t("button",{class:"btn btn-danger flex-fill",onClick:y=>pe(a.id,"rejected"),disabled:X[a.id]},[...e[33]||(e[33]=[t("i",{class:"bi bi-x-circle me-1"},null,-1),S(" Reject ",-1)])],8,pa)])])])]))),128))]))])])])]),_:1})]),_:1})]),_:1}),t("div",va,[t("div",fa,[t("div",ba,[t("div",ga,[t("h5",ya,r(V.value?"Edit Discount":"Add New Discount"),1),t("button",{class:"absolute top-2 right-2 p-2 rounded-full hover:bg-gray-100 transition transform hover:scale-110",onClick:K,"data-bs-dismiss":"modal","aria-label":"Close",title:"Close"},[...e[34]||(e[34]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),t("div",ha,[t("div",_a,[t("div",xa,[e[35]||(e[35]=t("label",{class:"form-label"},"Discount Name *",-1)),I(t("input",{"onUpdate:modelValue":e[3]||(e[3]=a=>p.value.name=a),type:"text",class:h(["form-control",{"is-invalid":n.value.name}]),placeholder:"Enter discount name"},null,2),[[T,p.value.name]]),n.value.name?(d(),m("small",Da,r(n.value.name[0]),1)):x("",!0)]),t("div",wa,[e[36]||(e[36]=t("label",{class:"form-label"},"Discount Type *",-1)),b(f(be),{modelValue:p.value.type,"onUpdate:modelValue":e[4]||(e[4]=a=>p.value.type=a),options:xe,optionLabel:"label",appendTo:"self",autoZIndex:!0,baseZIndex:2e3,optionValue:"value",class:h(["form-select",{"is-invalid":n.value.type}])},null,8,["modelValue","class"]),n.value.type?(d(),m("small",Sa,r(n.value.type[0]),1)):x("",!0)]),t("div",ka,[e[37]||(e[37]=t("label",{class:"form-label"},"Status *",-1)),b(f(be),{modelValue:p.value.status,"onUpdate:modelValue":e[5]||(e[5]=a=>p.value.status=a),options:De,optionLabel:"label",optionValue:"value",class:h(["form-select",{"is-invalid":n.value.status}]),appendTo:"self",autoZIndex:!0,baseZIndex:2e3},null,8,["modelValue","class"]),n.value.status?(d(),m("small",Ca,r(n.value.status[0]),1)):x("",!0)]),t("div",Ma,[e[38]||(e[38]=t("label",{class:"form-label"},"Discount Percent *",-1)),I(t("input",{"onUpdate:modelValue":e[6]||(e[6]=a=>p.value.discount_amount=a),type:"number",class:h(["form-control",{"is-invalid":n.value.discount_amount}]),placeholder:"Enter discount amount"},null,2),[[T,p.value.discount_amount]]),n.value.discount_amount?(d(),m("small",$a,r(n.value.discount_amount[0]),1)):x("",!0)]),t("div",Fa,[e[39]||(e[39]=t("label",{class:"form-label"},"Start Date *",-1)),b(c,{modelValue:p.value.start_date,"onUpdate:modelValue":e[7]||(e[7]=a=>p.value.start_date=a),format:f(_),"min-date":new Date,enableTimePicker:!1,placeholder:"Select start date",class:h({"is-invalid":n.value.start_date})},null,8,["modelValue","format","min-date","class"]),n.value.start_date?(d(),m("small",Ia,r(n.value.start_date[0]),1)):x("",!0)]),t("div",Ta,[e[40]||(e[40]=t("label",{class:"form-label"},"End Date *",-1)),b(c,{modelValue:p.value.end_date,"onUpdate:modelValue":e[8]||(e[8]=a=>p.value.end_date=a),format:f(_),"min-date":new Date,enableTimePicker:!1,placeholder:"Select end date",class:h({"is-invalid":n.value.end_date})},null,8,["modelValue","format","min-date","class"]),n.value.end_date?(d(),m("small",Ea,r(n.value.end_date[0]),1)):x("",!0)]),t("div",Pa,[e[41]||(e[41]=t("label",{class:"form-label"},"Minimum Purchase Amount *",-1)),I(t("input",{"onUpdate:modelValue":e[9]||(e[9]=a=>p.value.min_purchase=a),type:"number",step:"0.01",class:h(["form-control",{"is-invalid":n.value.min_purchase}]),placeholder:"0.00"},null,2),[[T,p.value.min_purchase]]),n.value.min_purchase?(d(),m("small",Va,r(n.value.min_purchase[0]),1)):x("",!0)]),t("div",Aa,[e[42]||(e[42]=t("label",{class:"form-label"},"Maximum Discount (Optional)",-1)),I(t("input",{"onUpdate:modelValue":e[10]||(e[10]=a=>p.value.max_discount=a),type:"number",step:"0.01",class:h(["form-control",{"is-invalid":n.value.max_discount}]),placeholder:"0.00"},null,2),[[T,p.value.max_discount]]),n.value.max_discount?(d(),m("small",Na,r(n.value.max_discount[0]),1)):x("",!0)]),t("div",La,[e[43]||(e[43]=t("label",{class:"form-label"},"Description (Optional)",-1)),I(t("textarea",{"onUpdate:modelValue":e[11]||(e[11]=a=>p.value.description=a),class:h(["form-control",{"is-invalid":n.value.description}]),rows:"3",placeholder:"Enter discount description"},null,2),[[T,p.value.description]]),n.value.description?(d(),m("small",Ra,r(n.value.description[0]),1)):x("",!0)])]),e[46]||(e[46]=t("hr",{class:"my-4"},null,-1)),t("div",Ba,[t("button",{class:"btn btn-primary rounded-pill px-4",disabled:U.value,onClick:e[12]||(e[12]=a=>$e())},[U.value?(d(),m(j,{key:0},[e[44]||(e[44]=t("span",{class:"spinner-border spinner-border-sm me-2"},null,-1)),e[45]||(e[45]=S(" Saving... ",-1))],64)):(d(),m(j,{key:1},[S(r((V.value,"Save")),1)],64))],8,ja),t("button",{class:"btn btn-secondary rounded-pill px-4 ms-2","data-bs-dismiss":"modal",onClick:K}," Cancel ")])])])])])])]),_:1})}}},bs=Ze(Oa,[["__scopeId","data-v-ace3b4ee"]]);export{bs as default};
