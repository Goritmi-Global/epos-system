import{_ as oe,r as c,j as ne,D as I,k as E,I as de,p as ie,g as n,o as d,a as S,d as re,h as ce,w as K,b as e,i as x,x as N,f as C,F as p,v as b,t as i,J as B,K as P,n as ue,y as me,A as ve}from"./app-COVoaSpv.js";import{_ as pe}from"./Master-CU8Kbb5A.js";import{u as ye}from"./useFormatters-BC277QyT.js";import{F as be}from"./FilterModal-TUcCt8rr.js";import"./index-BQbxzkdq.js";import"./sun-DqfGktyu.js";const he={class:"page-wrapper"},_e={class:"d-flex flex-wrap gap-2 align-items-center justify-content-between mb-3"},ge={class:"d-flex flex-wrap gap-2"},xe={class:"col-md-4 mb-3"},we=["onUpdate:modelValue"],fe=["value"],ke={class:"col-md-4"},Te=["onUpdate:modelValue"],Me=["value"],Fe={class:"col-md-4"},Ie=["onUpdate:modelValue"],Ne=["value"],qe={key:0,class:"alert alert-warning border-0 rounded-4 shadow-sm"},De={class:"row g-3"},Ae={class:"col-6 col-lg-3"},Ve={class:"card border-0 shadow-sm rounded-4"},je={class:"card-body d-flex align-items-center justify-content-between"},Le={class:"mb-0 fw-bold"},Oe={class:"col-6 col-lg-3"},Se={class:"card border-0 shadow-sm rounded-4"},Ce={class:"card-body d-flex align-items-center justify-content-between"},Be={class:"mb-0 fw-bold"},Pe={class:"col-6 col-lg-3"},Ue={class:"card border-0 shadow-sm rounded-4"},$e={class:"card-body d-flex align-items-center justify-content-between"},Re={class:"mb-0 fw-bold"},ze={class:"col-6 col-lg-3"},He={class:"card border-0 shadow-sm rounded-4"},Qe={class:"card-body d-flex align-items-center justify-content-between"},Xe={class:"mb-0 fw-bold"},Ye={class:"row g-3"},Ee={class:"col-lg-8"},Ke={class:"card border-0 shadow-sm rounded-4 h-100"},Ze={class:"card-body"},Je={class:"chart"},Ge={viewBox:"0 0 840 280"},We=["y1","y2"],et=["d"],tt={key:0,x:"430",y:"140","text-anchor":"middle",class:"muted"},st={class:"col-lg-4"},lt={class:"card border-0 shadow-sm rounded-4 mb-3"},at={class:"card-body"},ot={class:"stack"},nt={class:"stack-row"},dt={class:"stack-val"},it={class:"progress thin"},rt={class:"stack mt-2"},ct={class:"stack-row"},ut={class:"stack-val"},mt={class:"progress thin"},vt={class:"card border-0 shadow-sm rounded-4"},pt={class:"card-body"},yt={class:"stack-row"},bt={class:"text-capitalize"},ht={class:"stack-val"},_t={class:"progress thin"},gt={key:0,class:"small text-muted"},xt={class:"card border-0 shadow-sm rounded-4 mt-3"},wt={class:"card-body"},ft={class:"d-flex flex-wrap gap-2 justify-content-between align-items-center mb-3"},kt={class:"search-wrap"},Tt={key:1,class:"form-control search-input",placeholder:"Search",disabled:"",type:"text"},Mt={class:"table-responsive"},Ft={class:"table table-hover align-middle"},It={class:"fw-semibold"},Nt={key:0},qt={key:1},Dt={__name:"Index",setup(At){ye();const Z=c("last30"),J=c("All"),G=c("All"),m=c({sortBy:"",range:"last30",orderType:"",paymentType:"",dateFrom:"",dateTo:""}),U=c(Date.now()),D=`search-${Math.random().toString(36).substr(2,9)}`,$=c(!1),w=c(!1),f=c(""),R=c(0),z=c(0),H=c(0),Q=c(0),k=c([]),v=c({dine:0,delivery:0,dinePct:0,deliveryPct:0}),A=c([]),V=c([]),W=c("");let X;ne(()=>[m.value.range,m.value.orderType,m.value.paymentType,m.value.dateFrom,m.value.dateTo],()=>{clearTimeout(X),X=setTimeout(async()=>{w.value=!0,f.value="";try{const{data:a}=await ve.get("/api/analytics",{params:{range:Z.value,orderType:J.value,payType:G.value}});R.value=a.revenue??0,z.value=a.ordersCount??0,H.value=a.aov??0,Q.value=a.itemsSold??0,k.value=a.salesSeries??[],v.value=a.ordersByType??{dine:0,delivery:0,dinePct:0,deliveryPct:0},A.value=a.paymentsMix??[],V.value=a.topItems??[]}catch(a){console.error(a),f.value="Failed to load analytics."}finally{w.value=!1}},180)},{immediate:!0});const T=I(()=>({sortOptions:[{value:"revenue_desc",label:"Revenue: High to Low"},{value:"revenue_asc",label:"Revenue: Low to High"},{value:"qty_desc",label:"Quantity: High to Low"},{value:"qty_asc",label:"Quantity: Low to High"},{value:"name_asc",label:"Item Name: A to Z"},{value:"name_desc",label:"Item Name: Z to A"}],rangeOptions:[{value:"today",label:"Today"},{value:"last7",label:"Last 7 Days"},{value:"last30",label:"Last 30 Days"},{value:"thisMonth",label:"This Month"},{value:"all",label:"All Time"}],orderTypeOptions:[{value:"dine",label:"Dine In"},{value:"delivery",label:"Delivery"}],paymentTypeOptions:[{value:"cash",label:"Cash"},{value:"card",label:"Card"},{value:"qr",label:"QR"},{value:"bank",label:"Bank"}]})),ee=a=>{console.log("Filters applied:",a)},te=()=>{console.log("Filters cleared")};function se(a,t,l,s={l:40,r:10,t:16,b:28}){if(!a?.length)return"";const r=a.map((o,u)=>u),y=a.map(o=>+o.total||0),h=0,j=Math.max(1,r.length-1),_=0,L=Math.max(1,...y),O=Math.max(1,t-s.l-s.r),g=Math.max(1,l-s.t-s.b),M=o=>s.l+(o-h)/(j-h)*O,F=o=>s.t+g-(o-_)/(L-_)*g;if(r.length===1){const o=M(0),u=F(y[0]);return`M${o},${u} L${o+.01},${u}`}return r.map((o,u)=>`${u?"L":"M"}${M(o)},${F(y[u])}`).join(" ")}function le(a,t,l,s={l:40,r:10,t:16,b:28}){if(!a?.length)return[];const r=a.map((o,u)=>u),y=a.map(o=>+o.total||0),h=0,j=Math.max(1,r.length-1),_=0,L=Math.max(1,...y),O=Math.max(1,t-s.l-s.r),g=Math.max(1,l-s.t-s.b),M=o=>s.l+(o-h)/(j-h)*O,F=o=>s.t+g-(o-_)/(L-_)*g;return r.map((o,u)=>({x:M(o),y:F(y[u])}))}const ae=I(()=>se(k.value,840,280));I(()=>le(k.value,840,280));const Y=I(()=>{const a=W.value.trim().toLowerCase();let t=a?(V.value||[]).filter(s=>(s.name||"").toLowerCase().includes(a)):V.value||[];switch(m.value.sortBy){case"revenue_desc":return t.sort((s,r)=>(Number(r.revenue)||0)-(Number(s.revenue)||0));case"revenue_asc":return t.sort((s,r)=>(Number(s.revenue)||0)-(Number(r.revenue)||0));case"qty_desc":return t.sort((s,r)=>(Number(r.qty)||0)-(Number(s.qty)||0));case"qty_asc":return t.sort((s,r)=>(Number(s.qty)||0)-(Number(r.qty)||0));case"name_asc":return t.sort((s,r)=>(s.name||"").localeCompare(r.name||""));case"name_desc":return t.sort((s,r)=>(r.name||"").localeCompare(s.name||""));default:return t}});return E(()=>window.feather?.replace()),de(()=>window.feather?.replace()),E(async()=>{q.value="",U.value=Date.now(),await ie(),setTimeout(()=>{$.value=!0;const a=document.getElementById(D);a&&(a.value="",q.value="")},100)}),(a,t)=>(d(),n(p,null,[S(re(ce),{title:"Analytics"}),S(pe,null,{default:K(()=>[e("div",he,[e("div",_e,[e("div",ge,[S(be,{modelValue:m.value,"onUpdate:modelValue":t[0]||(t[0]=l=>m.value=l),title:"Analytics","modal-id":"analyticsFilterModal","modal-size":"modal-lg","sort-options":T.value.sortOptions,"show-date-range":!0,onApply:ee,onClear:te},{customFilters:K(({filters:l})=>[e("div",xe,[t[3]||(t[3]=e("label",{class:"form-label fw-semibold text-dark"},[e("i",{class:"fas fa-calendar-alt me-2 text-muted"}),C("Date Range ")],-1)),N(e("select",{"onUpdate:modelValue":s=>l.range=s,class:"form-select"},[(d(!0),n(p,null,b(T.value.rangeOptions,s=>(d(),n("option",{key:s.value,value:s.value},i(s.label),9,fe))),128))],8,we),[[B,l.range]])]),e("div",ke,[t[5]||(t[5]=e("label",{class:"form-label fw-semibold text-dark"},[e("i",{class:"fas fa-concierge-bell me-2 text-muted"}),C("Order Type ")],-1)),N(e("select",{"onUpdate:modelValue":s=>l.orderType=s,class:"form-select"},[t[4]||(t[4]=e("option",{value:""},"All",-1)),(d(!0),n(p,null,b(T.value.orderTypeOptions,s=>(d(),n("option",{key:s.value,value:s.value},i(s.label),9,Me))),128))],8,Te),[[B,l.orderType]])]),e("div",Fe,[t[7]||(t[7]=e("label",{class:"form-label fw-semibold text-dark"},[e("i",{class:"fas fa-credit-card me-2 text-muted"}),C("Payment Type ")],-1)),N(e("select",{"onUpdate:modelValue":s=>l.paymentType=s,class:"form-select"},[t[6]||(t[6]=e("option",{value:""},"All",-1)),(d(!0),n(p,null,b(T.value.paymentTypeOptions,s=>(d(),n("option",{key:s.value,value:s.value},i(s.label),9,Ne))),128))],8,Ie),[[B,l.paymentType]])])]),_:1},8,["modelValue","sort-options"])]),t[8]||(t[8]=e("div",{class:"dropdown"},[e("button",{class:"btn btn-outline-secondary rounded-pill px-4 dropdown-toggle","data-bs-toggle":"dropdown"}," Download "),e("ul",{class:"dropdown-menu dropdown-menu-end shadow rounded-4 py-2"},[e("li",null,[e("a",{class:"dropdown-item py-2",href:"javascript:void(0)"},"Download as PDF")]),e("li",null,[e("a",{class:"dropdown-item py-2",href:"javascript:void(0)"},"Download as Excel")])])],-1))]),f.value?(d(),n("div",qe,i(f.value),1)):x("",!0),e("div",De,[e("div",Ae,[e("div",Ve,[e("div",je,[e("div",null,[e("h4",Le,i(R.value),1),t[9]||(t[9]=e("p",{class:"text-muted mb-0 small"},"Revenue",-1))]),t[10]||(t[10]=e("div",{class:"rounded-circle p-3 bg-success-subtle text-success d-flex align-items-center justify-content-center",style:{width:"56px",height:"56px"}},[e("i",{class:"bi bi-currency-pound fs-4"})],-1))])])]),e("div",Oe,[e("div",Se,[e("div",Ce,[e("div",null,[e("h4",Be,i(z.value),1),t[11]||(t[11]=e("p",{class:"text-muted mb-0 small"},"Orders",-1))]),t[12]||(t[12]=e("div",{class:"rounded-circle p-3 bg-primary-subtle text-primary d-flex align-items-center justify-content-center",style:{width:"56px",height:"56px"}},[e("i",{class:"bi bi-receipt fs-4"})],-1))])])]),e("div",Pe,[e("div",Ue,[e("div",$e,[e("div",null,[e("h4",Re,i(H.value),1),t[13]||(t[13]=e("p",{class:"text-muted mb-0 small"},"Avg. Order Value",-1))]),t[14]||(t[14]=e("div",{class:"rounded-circle p-3 bg-warning-subtle text-warning d-flex align-items-center justify-content-center",style:{width:"56px",height:"56px"}},[e("i",{class:"bi bi-graph-up fs-4"})],-1))])])]),e("div",ze,[e("div",He,[e("div",Qe,[e("div",null,[e("h4",Xe,i(Q.value),1),t[15]||(t[15]=e("p",{class:"text-muted mb-0 small"},"Items Sold",-1))]),t[16]||(t[16]=e("div",{class:"rounded-circle p-3 bg-danger-subtle text-danger d-flex align-items-center justify-content-center",style:{width:"56px",height:"56px"}},[e("i",{class:"bi bi-basket fs-4"})],-1))])])])]),e("div",Ye,[e("div",Ee,[e("div",Ke,[e("div",Ze,[t[19]||(t[19]=e("h6",{class:"fw-semibold mb-2"},"Sales Over Time",-1)),e("div",Je,[(d(),n("svg",Ge,[t[17]||(t[17]=e("line",{x1:"40",y1:"16",x2:"40",y2:"252",class:"axis"},null,-1)),t[18]||(t[18]=e("line",{x1:"40",y1:"252",x2:"830",y2:"252",class:"axis"},null,-1)),(d(),n(p,null,b(6,l=>e("g",{key:"g"+l},[e("line",{x1:40,x2:830,y1:252-l*36,y2:252-l*36,class:"grid"},null,8,We)])),64)),e("path",{d:ae.value,class:"line"},null,8,et),k.value.length?x("",!0):(d(),n("text",tt," No data "))]))])])])]),e("div",st,[e("div",lt,[e("div",at,[t[22]||(t[22]=e("h6",{class:"fw-semibold mb-3"},"Orders by Type",-1)),e("div",ot,[e("div",nt,[t[20]||(t[20]=e("span",null,"Dine In",-1)),e("span",dt,i(v.value.dine)+" ("+i(v.value.dinePct)+"%)",1)]),e("div",it,[e("div",{class:"progress-bar bg-success",style:P({width:v.value.dinePct+"%"})},null,4)])]),e("div",rt,[e("div",ct,[t[21]||(t[21]=e("span",null,"Delivery",-1)),e("span",ut,i(v.value.delivery)+" ("+i(v.value.deliveryPct)+"%)",1)]),e("div",mt,[e("div",{class:"progress-bar bg-primary",style:P({width:v.value.deliveryPct+"%"})},null,4)])])])]),e("div",vt,[e("div",pt,[t[23]||(t[23]=e("h6",{class:"fw-semibold mb-3"},"Payments Mix",-1)),(d(!0),n(p,null,b(A.value,l=>(d(),n("div",{key:l.method,class:"mb-2"},[e("div",yt,[e("span",bt,i(l.method),1),e("span",ht,i(l.count)+" ("+i(l.pct)+"%)",1)]),e("div",_t,[e("div",{class:ue(["progress-bar",{"bg-secondary":l.method==="cash","bg-info":l.method==="card","bg-warning":l.method==="qr","bg-dark":l.method==="bank"}]),style:P({width:l.pct+"%"})},null,6)])]))),128)),A.value.length?x("",!0):(d(),n("div",gt," No payment data. "))])])])]),e("div",xt,[e("div",wt,[e("div",ft,[t[26]||(t[26]=e("h6",{class:"fw-semibold mb-0"},"Top Items",-1)),e("div",kt,[t[24]||(t[24]=e("i",{class:"bi bi-search"},null,-1)),t[25]||(t[25]=e("input",{type:"email",name:"email",autocomplete:"email",style:{position:"absolute",left:"-9999px",width:"1px",height:"1px"},tabindex:"-1","aria-hidden":"true"},null,-1)),$.value?N((d(),n("input",{id:D,"onUpdate:modelValue":t[1]||(t[1]=l=>a.q=l),key:U.value,class:"form-control search-input",placeholder:"Search",type:"search",autocomplete:"new-password",name:D,role:"presentation",onFocus:t[2]||(t[2]=(...l)=>a.handleFocus&&a.handleFocus(...l))},null,32)),[[me,a.q]]):(d(),n("input",Tt))])]),e("div",Mt,[e("table",Ft,[t[29]||(t[29]=e("thead",{class:"small text-muted"},[e("tr",null,[e("th",{style:{width:"60px"}},"S.#"),e("th",null,"Item"),e("th",{style:{width:"140px"}},"Qty Sold"),e("th",{style:{width:"160px"}},"Revenue")])],-1)),e("tbody",null,[(d(!0),n(p,null,b(Y.value,(l,s)=>(d(),n("tr",{key:l.name},[e("td",null,i(s+1),1),e("td",It,i(l.name),1),e("td",null,i(l.qty),1),e("td",null,i(l.revenue),1)]))),128)),!w.value&&Y.value.length===0?(d(),n("tr",Nt,[...t[27]||(t[27]=[e("td",{colspan:"4",class:"text-center text-muted py-4"}," No items in this range. ",-1)])])):x("",!0),w.value?(d(),n("tr",qt,[...t[28]||(t[28]=[e("td",{colspan:"4",class:"text-center text-muted py-4"}," Loadingâ€¦ ",-1)])])):x("",!0)])])])])])])]),_:1})],64))}},Pt=oe(Dt,[["__scopeId","data-v-14f4064f"]]);export{Pt as default};
