import{r,c as R,w as G,o as H,I as J,g as a,b as n,f as t,l as p,F as q,i as T,t as l,u as g,j as I,e as k,P as K,m as w,v as x,q as C,s as _}from"./app-CYYlfszq.js";import{u as W}from"./useFormatters-RJKnQoSm.js";import{P as X}from"./pencil-C49dQH-z.js";import{E as Y}from"./eye-BWVg-PFm.js";import"./createLucideIcon-D217t_iT.js";const Z={class:"table-responsive"},tt={class:"table table-hover align-middle"},et={class:"fw-semibold text-capitalize"},st={class:"text-break"},ot={key:1,class:"text-muted"},lt={class:"text-end"},at=["onClick"],nt=["onClick"],dt={key:0},it={key:0,class:"mt-4 d-flex justify-content-between align-items-center"},rt={class:"text-muted small"},ut={class:"modal fade",id:"viewLogModal_out",tabindex:"-1","aria-hidden":"true"},ct={class:"modal-dialog modal-lg modal-dialog-centered"},mt={class:"modal-content rounded-4 shadow-lg border-0"},pt={class:"modal-header align-items-center"},gt={class:"d-flex align-items-center gap-2"},vt={class:"d-flex flex-column"},yt={class:"text-muted"},ht={class:"modal-body p-4 bg-light"},_t={key:0,class:"row g-4"},bt={class:"col-lg-12"},ft={class:"card border-0 shadow-sm rounded-4 h-100"},kt={class:"card-body"},wt={class:"row g-3"},xt={class:"col-md-6"},Ct={class:"fw-semibold"},St={class:"col-md-6"},Lt={class:"badge rounded-pill bg-danger"},Mt={class:"row g-3 text-center"},Pt={class:"col-md-12"},qt={class:"p-3 bg-light rounded-3"},Tt={class:"fs-6 fw-semibold"},It={class:"table-responsive"},Et={class:"table table-hover align-middle"},Nt={key:0},Vt={class:"modal fade",id:"editLogModal_out",tabindex:"-1","aria-hidden":"true"},jt={class:"modal-dialog modal-lg modal-dialog-centered"},At={class:"modal-content rounded-4"},Bt={class:"modal-body"},Dt={class:"row g-3"},Ut={class:"col-md-6 col-md-12"},Ft={class:"col-md-6 col-md-12"},Ot={key:0,class:"text-danger"},$t={class:"col-md-6 col-md-12"},Qt={class:"mt-4"},zt=["disabled","aria-busy"],Rt={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},Xt={__name:"StockOutLogs",props:{logs:{type:Array,default:()=>[]},q:{type:String,default:""}},emits:["updated"],setup(E,{emit:N}){const{formatCurrencySymbol:V,dateFmt:b}=W(),S=E,j=N,y=r(!1),d=r({current_page:1,last_page:1,per_page:10,total:0,from:0,to:0,links:[]}),L=r([]),h=async(s=null)=>{y.value=!0;try{const e=await C.get("stock_entries/api-stock-out-logs",{params:{q:S.q,page:s||d.value.current_page,per_page:d.value.per_page}});L.value=e.data.data||[],d.value={current_page:e.data.current_page,last_page:e.data.last_page,per_page:e.data.per_page,total:e.data.total,from:e.data.from,to:e.data.to,links:e.data.links},y.value=!1}catch(e){console.error("❌ Fetch stock out logs error:",e),_.error("Failed to load stock out logs"),y.value=!1}},A=s=>{if(!s)return;const o=new URLSearchParams(s.split("?")[1]).get("page");o&&h(parseInt(o))},M=R(()=>L.value),B=s=>(s??"").toString().replace(/[_-]+/g," ").trim().replace(/\w\S*/g,e=>e[0].toUpperCase()+e.slice(1).toLowerCase()),D=s=>({inventory_stockin:"Inventory Stockin",inventory_stockout:"Inventory Stockout",purchase:"Purchase",adjustment:"Adjustment",return:"Return"})[s]??B(s),U=s=>{switch(s){case"inventory_stockin":case"purchase":return"text-success";case"inventory_stockout":return"text-danger";case"adjustment":return"text-warning";default:return"text-secondary"}},u=r(null),v=r([]),m=r({}),i=r({id:null,itemName:"",quantity:"",totalPrice:"",operationType:"",type:"stockout"}),F=async s=>{try{const{data:e}=await C.get(`stock_entries/stock-logs/${s}/allocations`);v.value=e||[]}catch(e){v.value=[],console.error(e)}};let P=null;G(()=>S.q,()=>{clearTimeout(P),P=setTimeout(()=>{d.value.current_page=1,h(1)},500)});const O=async s=>{u.value=s,v.value=[],await F(s.id),new bootstrap.Modal(document.getElementById("viewLogModal_out")).show()};function $(s){i.value={...s},new bootstrap.Modal(document.getElementById("editLogModal_out")).show()}const c=r(!1),Q=()=>m.value={};async function z(){if(!c.value){c.value=!0,m.value={};try{await C.put(`stock_entries/stock-logs/${i.value.id}`,i.value),_.success("Stock log updated successfully"),await h(),j("updated");const s=bootstrap.Modal.getInstance(document.getElementById("editLogModal_out"));s&&s.hide()}catch(s){s?.response?.status===422&&s.response.data?.errors?(m.value=s.response.data.errors,_.error("Please fill in all required fields correctly.")):(_.error("Something went wrong. Please try again."),console.error(s))}finally{c.value=!1}}}return H(()=>{window.feather?.replace(),h()}),J(()=>window.feather?.replace()),(s,e)=>(n(),a("div",null,[t("div",Z,[t("table",tt,[e[4]||(e[4]=t("thead",{class:"small text-muted"},[t("tr",null,[t("th",null,"Item name"),t("th",null,"Quantity"),t("th",null,"Category"),t("th",null,"Date & Time"),t("th",null,"Operation Type"),t("th",{class:"text-end"},"Action")])],-1)),t("tbody",null,[(n(!0),a(q,null,T(M.value,o=>(n(),a("tr",{key:o.id},[t("td",et,l(o.itemName),1),t("td",null,l(o.quantity),1),t("td",null,l(o.category?.name||o.category),1),t("td",null,l(g(b)(o.dateTime)),1),t("td",st,[o.operationType?(n(),a("span",{key:0,class:I(["fw-semibold",U(o.operationType)])},l(D(o.operationType)),3)):(n(),a("span",ot,"—"))]),t("td",lt,[t("button",{class:"p-2 rounded-full text-blue-600 hover:bg-blue-100",onClick:f=>$(o),title:"Adjustment"},[k(g(X),{class:"w-4 h-4"})],8,at),t("button",{class:"p-2 rounded-full text-primary hover:bg-blue-100",onClick:f=>O(o),title:"Show"},[k(g(Y),{class:"w-4 h-4"})],8,nt)])]))),128)),M.value.length===0?(n(),a("tr",dt,[...e[3]||(e[3]=[t("td",{colspan:"10",class:"text-center text-muted py-4"}," No logs found. ",-1)])])):p("",!0)])])]),!y.value&&d.value.last_page>1?(n(),a("div",it,[t("div",rt," Showing "+l(d.value.from)+" to "+l(d.value.to)+" of "+l(d.value.total)+" entries ",1),k(K,{pagination:d.value.links,isApiDriven:!0,onPageChanged:A},null,8,["pagination"])])):p("",!0),t("div",ut,[t("div",ct,[t("div",mt,[t("div",pt,[t("div",gt,[e[6]||(e[6]=t("span",{class:"badge bg-primary rounded-circle p-2"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3 7.5L12 12l9-4.5M3 7.5V17a2 2 0 002 2h14a2 2 0 002-2V7.5M21 7.5L12 3 3 7.5"})])],-1)),t("div",vt,[e[5]||(e[5]=t("h5",{class:"modal-title mb-0"},"View Stock Log",-1)),t("small",yt,"Item: "+l(u.value?.itemName??"—"),1)])]),e[7]||(e[7]=t("button",{class:"absolute top-2 right-2 p-2 rounded-full hover:bg-gray-100 transition transform hover:scale-110","data-bs-dismiss":"modal","aria-label":"Close",title:"Close"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-danger",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})])],-1))]),t("div",ht,[u.value?(n(),a("div",_t,[t("div",bt,[t("div",ft,[t("div",kt,[e[13]||(e[13]=t("h6",{class:"fw-semibold mb-3"}," Details ",-1)),t("div",wt,[t("div",xt,[e[8]||(e[8]=t("small",{class:"text-muted d-block"},"Category",-1)),t("div",Ct,l(u.value.category?.name??u.value.category??"—"),1)]),t("div",St,[e[9]||(e[9]=t("small",{class:"text-muted d-block"},"Operation",-1)),t("span",Lt,l(u.value.operationType??"—"),1)])]),e[14]||(e[14]=t("hr",{class:"my-4"},null,-1)),t("div",Mt,[t("div",Pt,[t("div",qt,[e[10]||(e[10]=t("small",{class:"text-muted d-block"},"Date",-1)),t("div",Tt,l(g(b)(u.value.dateTime)),1)])])]),e[15]||(e[15]=t("hr",{class:"my-4"},null,-1)),e[16]||(e[16]=t("h6",{class:"fw-semibold mb-3"}," Stock-out Allocation ",-1)),t("div",It,[t("table",Et,[e[12]||(e[12]=t("thead",{class:"small text-muted"},[t("tr",null,[t("th",null,"#"),t("th",null,"Expiry Date"),t("th",null,"Unit Price"),t("th",null,"Allocated Qty")])],-1)),t("tbody",null,[(n(!0),a(q,null,T(v.value,(o,f)=>(n(),a("tr",{key:o.id},[t("td",null,l(f+1),1),t("td",null,l(g(b)(o.expiry_date?new Date(o.expiry_date).toISOString().slice(0,10):"—")),1),t("td",null,l(g(V)(o.unit_price??0)),1),t("td",null,l(o.quantity),1)]))),128)),v.value.length===0?(n(),a("tr",Nt,[...e[11]||(e[11]=[t("td",{colspan:"5",class:"text-center text-muted py-3"}," No allocation history. ",-1)])])):p("",!0)])])])])])])])):p("",!0)])])])]),t("div",Vt,[t("div",jt,[t("div",At,[t("div",{class:"modal-header"},[e[18]||(e[18]=t("h5",{class:"modal-title fw-semibold"},"Edit Stock Log",-1)),t("button",{class:"absolute top-2 right-2 p-2 rounded-full hover:bg-gray-100 transition transform hover:scale-110","data-bs-dismiss":"modal","aria-label":"Close",title:"Close",onClick:Q},[...e[17]||(e[17]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),t("div",Bt,[t("div",Dt,[t("div",Ut,[e[19]||(e[19]=t("label",{class:"form-label"},"Item Name",-1)),w(t("input",{type:"text",class:"form-control","onUpdate:modelValue":e[0]||(e[0]=o=>i.value.itemName=o),disabled:""},null,512),[[x,i.value.itemName]])]),t("div",Ft,[e[20]||(e[20]=t("label",{class:"form-label"},"Quantity",-1)),w(t("input",{type:"number",class:I(["form-control",{"is-invalid":m.value.quantity}]),"onUpdate:modelValue":e[1]||(e[1]=o=>i.value.quantity=o),required:""},null,2),[[x,i.value.quantity]]),m.value.quantity?(n(),a("small",Ot,l(m.value.quantity[0]),1)):p("",!0)]),t("div",$t,[e[21]||(e[21]=t("label",{class:"form-label"},"Value",-1)),w(t("input",{type:"number",readonly:"",class:"form-control","onUpdate:modelValue":e[2]||(e[2]=o=>i.value.totalPrice=o)},null,512),[[x,i.value.totalPrice]])]),t("div",Qt,[t("button",{class:"btn btn-primary rounded-pill px-4 d-inline-flex align-items-center gap-2",disabled:c.value,"aria-busy":c.value?"true":"false",onClick:z},[c.value?(n(),a("span",Rt)):p("",!0),t("span",null,l(c.value?"Saving…":"Save"),1)],8,zt)])])])])])])]))}};export{Xt as default};
