import{_ as se,A as oe,r as h,o as ae,n as le,c as H,E as ne,a as R,b as d,w as A,d as b,e as t,u as E,h as re,f as u,F as T,g as O,i as D,j as ie,t as f,k as U,v as z,l as N,m as I,C as de,p as x,q as l}from"./app-DrUr72II.js";import{_ as me}from"./Master-BeW6Lctk.js";import{E as ce,a as ue,X as pe,u as M,w as fe}from"./xlsx-7aOw9oZM.js";import{I as ve}from"./importFile-AWru9xi7.js";import{c as ge}from"./createLucideIcon-BENYThoS.js";import{P as he}from"./plus-CmrmLSaN.js";import{P as be}from"./pencil-Be4IWqC2.js";import{T as ye}from"./trash-2-O8vdyQKr.js";import"./index-BLyqyTLg.js";import"./index-DMd6VC55.js";import"./index-DfwVUbck.js";import"./sun-pxRjjhfX.js";/**
 * @license lucide-vue-next v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=ge("utensils",[["path",{d:"M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2",key:"cjf0a3"}],["path",{d:"M7 2v20",key:"1473qp"}],["path",{d:"M21 15V2a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7",key:"j28e5"}]]),we={class:"page-wrapper"},xe={class:"row g-3"},Me={class:"card border-0 shadow-sm rounded-4"},ke={class:"card-body d-flex align-items-center"},Ce={class:"mb-0 fw-bold"},Se={class:"text-muted mb-0 small"},Ee={class:"card border-0 shadow-lg rounded-4 mt-4"},Te={class:"card-body"},De={class:"d-flex flex-wrap gap-2 justify-content-between align-items-center mb-3"},Ie={class:"d-flex flex-wrap gap-2 align-items-center"},$e={class:"search-wrap"},Ve={key:1,class:"form-control search-input",placeholder:"Search",disabled:"",type:"text"},Fe={class:"dropdown"},Ne={class:"dropdown-menu dropdown-menu-end shadow rounded-4 py-2"},je={class:"table-responsive"},Le={class:"table table-striped"},Pe={class:"fw-semibold"},Be={class:"text-center"},He={class:"d-inline-flex align-items-center gap-3"},Re=["onClick"],Ae={title:"Delete",class:"p-2 rounded-full text-red-600 hover:bg-red-100"},Oe={key:0},Ue={class:"modal fade",id:"mealModal",tabindex:"-1","aria-hidden":"true"},ze={class:"modal-dialog modal-lg modal-dialog-centered"},qe={class:"modal-content rounded-4"},Xe={class:"modal-header"},Ge={class:"modal-title fw-semibold"},Ye={class:"modal-body"},Ke={class:"row g-3"},We={class:"col-12"},Ze={key:0,class:"text-danger"},Je={class:"col-md-6"},Qe={key:0,class:"text-danger"},et={class:"col-md-6"},tt={key:0,class:"text-danger"},st={class:"mt-4"},ot=["disabled"],at={__name:"Index",setup(lt){oe();const g=h([]),_=h(null),k=h(!1),m=h({}),C=async()=>{try{const s=await x.get("api/meals/all");g.value=s.data.data}catch(s){console.error("Failed to fetch meals:",s),l.error("Failed to load meals")}};ae(async()=>{y.value="",j.value=Date.now(),await le(),setTimeout(()=>{L.value=!0;const e=document.getElementById($);e&&(e.value="",y.value="")},100),C();const s=document.getElementById("mealModal");s&&s.addEventListener("hidden.bs.modal",()=>{document.body.classList.remove("modal-open"),document.body.style.overflow="",document.querySelectorAll(".modal-backdrop").forEach(a=>a.remove())})});const q=H(()=>[{label:"Total Meals",value:g.value.length,icon:_e,iconBg:"bg-light-primary",iconColor:"text-primary"}]),y=h(""),j=h(Date.now()),$=`search-${Math.random().toString(36).substr(2,9)}`,L=h(!1),X=s=>{s.target.value=y.value},V=H(()=>{const s=y.value.trim().toLowerCase();return s?g.value.filter(e=>e.name.toLowerCase().includes(s)):g.value}),p=h({name:"",start_time:"",end_time:""}),S=()=>{p.value={name:"",start_time:"",end_time:""},_.value=null,m.value={}},P=s=>{if(!s)return null;if(typeof s=="string"&&/^\d{2}:\d{2}$/.test(s))return s;const e=new Date(s),a=e.getHours().toString().padStart(2,"0"),o=e.getMinutes().toString().padStart(2,"0");return`${a}:${o}`},G=async()=>{k.value=!0,m.value={};const s={...p.value,start_time:P(p.value.start_time),end_time:P(p.value.end_time)};try{_.value?(await x.post(`/meals/${_.value.id}`,s),l.success("Meal updated successfully")):(await x.post("/meals",s),l.success("Meal created successfully"));const e=document.getElementById("mealModal"),a=bootstrap.Modal.getInstance(e);a&&a.hide(),setTimeout(()=>{document.body.classList.remove("modal-open"),document.body.style.overflow="",document.body.style.paddingRight="",document.querySelectorAll(".modal-backdrop").forEach(c=>c.remove())},100),S(),await C()}catch(e){if(console.error("❌ Error:",e.response?.data||e.message),e.response?.status===422&&e.response?.data?.errors){m.value=e.response.data.errors;const a=Object.values(e.response.data.errors).flat();l.error(a.join(`
`))}else{const a=e.response?.data?.message||"Failed to save meal";l.error(a)}}finally{k.value=!1}},Y=s=>{_.value=s,p.value={name:s.name,start_time:s.start_time,end_time:s.end_time};const e=document.getElementById("mealModal");new bootstrap.Modal(e).show()},K=async s=>{if(s?.id)try{await x.delete(`/meals/${s.id}`),l.success("Meal deleted successfully"),await C()}catch(e){console.error("❌ Delete error:",e.response?.data||e.message),l.error("Failed to delete meal")}},F=s=>{if(!g.value||g.value.length===0){l.error("No Meals data to download");return}const e=y.value.trim()?V.value:g.value;if(e.length===0){l.error("No Meals found to download");return}try{s==="pdf"?Z(e):s==="excel"?J(e):s==="csv"?W(e):l.error("Invalid download type")}catch(a){console.error("Download failed:",a),l.error(`Download failed: ${a.message}`)}},W=s=>{try{const e=["ID","Meal Name","Start Time","End Time"],a=s.map(i=>[`${i.id||""}`,`"${i.name||""}"`,`"${i.start_time||""}"`,`"${i.end_time||""}"`]),o=[e.join(","),...a.map(i=>i.join(","))].join(`
`),c=new Blob([o],{type:"text/csv;charset=utf-8;"}),v=URL.createObjectURL(c),r=document.createElement("a");r.setAttribute("href",v),r.setAttribute("download",`Meals_${new Date().toISOString().split("T")[0]}.csv`),document.body.appendChild(r),r.click(),document.body.removeChild(r),l.success("CSV downloaded successfully")}catch(e){console.error("CSV generation error:",e),l.error(`CSV generation failed: ${e.message}`,{autoClose:5e3})}},Z=s=>{try{const e=new ce("p","mm","a4");e.setFontSize(18),e.setFont("helvetica","bold"),e.text("Meals Report",14,20),e.setFontSize(10),e.setFont("helvetica","normal");const a=new Date().toLocaleString();e.text(`Generated on: ${a}`,14,28),e.text(`Total Meals: ${s.length}`,14,34);const o=["ID","Meal Name","Start Time","End Time"],c=s.map(r=>[r.id||"",r.name||"",r.start_time||"",r.end_time||""]);ue(e,{head:[o],body:c,startY:40,styles:{fontSize:9,cellPadding:2,halign:"left",lineColor:[0,0,0],lineWidth:.1},headStyles:{fillColor:[41,128,185],textColor:255,fontStyle:"bold"},alternateRowStyles:{fillColor:[245,245,245]},margin:{left:14,right:14},didDrawPage:r=>{const i=e.internal.getNumberOfPages(),B=e.internal.pageSize.height;e.setFontSize(8),e.text(`Page ${r.pageNumber} of ${i}`,r.settings.margin.left,B-10)}});const v=`Meals_${new Date().toISOString().split("T")[0]}.pdf`;e.save(v),l.success("PDF downloaded successfully")}catch(e){console.error("PDF generation error:",e),l.error(`PDF generation failed: ${e.message}`,{autoClose:5e3})}},J=s=>{try{if(typeof pe>"u")throw new Error("XLSX library is not loaded");const e=s.map(i=>({ID:i.id||"","Meal Name":i.name||"","Start Time":i.start_time||"","End Time":i.end_time||""})),a=M.book_new(),o=M.json_to_sheet(e);o["!cols"]=[{wch:8},{wch:25},{wch:15},{wch:15}],M.book_append_sheet(a,o,"Meals");const c=[{Info:"Report",Value:"Meals Export"},{Info:"Generated On",Value:new Date().toLocaleString()},{Info:"Total Records",Value:s.length},{Info:"Exported By",Value:"Inventory Management System"}],v=M.json_to_sheet(c);M.book_append_sheet(a,v,"Report Info");const r=`Meals_${new Date().toISOString().split("T")[0]}.xlsx`;fe(a,r),l.success("Excel file downloaded successfully",{autoClose:2500})}catch(e){console.error("Excel generation error:",e),l.error(`Excel generation failed: ${e.message}`,{autoClose:5e3})}},Q=["Meal Name","Start Time","End Time"],ee=[["Breakfast","06:00","10:00"],["Lunch","12:00","14:00"],["Dinner","18:00","21:00"]],te=s=>{if(!s||s.length<=1){l.error("The imported file is empty.");return}s[0];const a=s.slice(1).map(n=>({name:n[0]||"",start_time:n[1]||"",end_time:n[2]||""})).filter(n=>n.name.trim());if(a.length===0){l.error("No valid meals found in the file.");return}const o=a.map(n=>n.name.trim().toLowerCase()),c=o.filter((n,w)=>o.indexOf(n)!==w);if(c.length>0){l.error(`Duplicate meal names found in CSV: ${[...new Set(c)].join(", ")}`);return}const v=g.value.map(n=>n.name.trim().toLowerCase()),r=a.filter(n=>v.includes(n.name.trim().toLowerCase()));if(r.length>0){const n=r.map(w=>w.name).join(", ");l.error(`Meals already exist in the table: ${n}`);return}const i=/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/;if(a.filter(n=>!i.test(n.start_time)||!i.test(n.end_time)).length>0){l.error("Invalid time format. Times must be in HH:mm format (e.g., 09:30).");return}x.post("/api/meals/import",{meals:a}).then(()=>{l.success("Meals imported successfully"),C()}).catch(n=>{console.error("Import error:",n);const w=n.response?.data?.message||"Import failed";l.error(w)})};return(s,e)=>{const a=ne("VueDatePicker");return d(),R(me,null,{default:A(()=>[b(E(re),{title:"Meals"}),t("div",we,[e[22]||(e[22]=t("h4",{class:"fw-semibold mb-3"},"Meal Management",-1)),t("div",xe,[(d(!0),u(T,null,O(q.value,o=>(d(),u("div",{key:o.label,class:"col-md-6 col-xl-3"},[t("div",Me,[t("div",ke,[t("div",{class:D([[o.iconBg,o.iconColor],"rounded-circle p-3 d-flex align-items-center justify-content-center me-3"]),style:{width:"56px",height:"56px"}},[(d(),R(ie(o.icon),{class:"w-6 h-6"}))],2),t("div",null,[t("h3",Ce,f(o.value),1),t("p",Se,f(o.label),1)])])])]))),128))]),t("div",Ee,[t("div",Te,[t("div",De,[e[12]||(e[12]=t("h5",{class:"mb-0 fw-semibold"},"Meals",-1)),t("div",Ie,[t("div",$e,[e[8]||(e[8]=t("i",{class:"bi bi-search"},null,-1)),e[9]||(e[9]=t("input",{type:"email",name:"email",autocomplete:"email",style:{position:"absolute",left:"-9999px",width:"1px",height:"1px"},tabindex:"-1","aria-hidden":"true"},null,-1)),L.value?U((d(),u("input",{id:$,"onUpdate:modelValue":e[0]||(e[0]=o=>y.value=o),key:j.value,class:"form-control search-input",placeholder:"Search",type:"search",autocomplete:"new-password",name:$,role:"presentation",onFocus:X},null,32)),[[z,y.value]]):(d(),u("input",Ve))]),t("button",{"data-bs-toggle":"modal","data-bs-target":"#mealModal",onClick:S,class:"d-flex align-items-center gap-1 px-4 py-2 rounded-pill btn btn-primary text-white"},[b(E(he),{class:"w-4 h-4"}),e[10]||(e[10]=N(" Add Meal ",-1))]),b(ve,{label:"Import Meals",sampleHeaders:Q,sampleData:ee,onOnImport:te}),t("div",Fe,[e[11]||(e[11]=t("button",{class:"btn btn-outline-secondary rounded-pill py-2 btn-sm px-4 dropdown-toggle","data-bs-toggle":"dropdown"}," Export ",-1)),t("ul",Ne,[t("li",null,[t("a",{class:"dropdown-item py-2",href:"javascript:;",onClick:e[1]||(e[1]=o=>F("pdf"))},"Export as PDF")]),t("li",null,[t("a",{class:"dropdown-item py-2",href:"javascript:;",onClick:e[2]||(e[2]=o=>F("excel"))},"Export as Excel")]),t("li",null,[t("a",{class:"dropdown-item py-2",href:"javascript:;",onClick:e[3]||(e[3]=o=>F("csv"))}," Export as CSV ")])])])])]),t("div",je,[t("table",Le,[e[14]||(e[14]=t("thead",{class:"border-top small text-muted"},[t("tr",null,[t("th",null,"S.#"),t("th",null,"Name"),t("th",null,"Start Time"),t("th",null,"End Time"),t("th",{class:"text-center"},"Actions")])],-1)),t("tbody",null,[(d(!0),u(T,null,O(V.value,(o,c)=>(d(),u("tr",{key:o.id},[t("td",null,f(c+1),1),t("td",Pe,f(o.name),1),t("td",null,f(o.start_time),1),t("td",null,f(o.end_time),1),t("td",Be,[t("div",He,[t("button",{onClick:v=>Y(o),title:"Edit",class:"p-2 rounded-full text-blue-600 hover:bg-blue-100"},[b(E(be),{class:"w-4 h-4"})],8,Re),b(de,{title:"Confirm Delete",message:`Are you sure you want to delete ${o.name}?`,confirmText:"Yes, Delete",cancelText:"Cancel",onConfirm:v=>K(o)},{trigger:A(()=>[t("button",Ae,[b(E(ye),{class:"w-4 h-4"})])]),_:1},8,["message","onConfirm"])])])]))),128)),V.value.length===0?(d(),u("tr",Oe,[...e[13]||(e[13]=[t("td",{colspan:"5",class:"text-center text-muted py-4"}," No meals found. ",-1)])])):I("",!0)])])])])]),t("div",Ue,[t("div",ze,[t("div",qe,[t("div",Xe,[t("h5",Ge,f(_.value?"Edit Meal":"Add New Meal"),1),t("button",{class:"absolute top-2 right-2 p-2 rounded-full hover:bg-gray-100 transition transform hover:scale-110",onClick:S,"data-bs-dismiss":"modal","aria-label":"Close",title:"Close"},[...e[15]||(e[15]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),t("div",Ye,[t("div",Ke,[t("div",We,[e[16]||(e[16]=t("label",{class:"form-label"},"Meal Name",-1)),U(t("input",{"onUpdate:modelValue":e[4]||(e[4]=o=>p.value.name=o),type:"text",class:D(["form-control",{"is-invalid":m.value.name}]),placeholder:"Enter meal name"},null,2),[[z,p.value.name]]),m.value.name?(d(),u("small",Ze,f(m.value.name[0]),1)):I("",!0)]),t("div",Je,[e[17]||(e[17]=t("label",{class:"form-label"},"Start Time",-1)),b(a,{modelValue:p.value.start_time,"onUpdate:modelValue":e[5]||(e[5]=o=>p.value.start_time=o),"time-picker":"",format:"HH:mm","model-type":"HH:mm",placeholder:"Select start time",class:D({"is-invalid":m.value.start_time})},null,8,["modelValue","class"]),m.value.start_time?(d(),u("small",Qe,f(m.value.start_time[0]),1)):I("",!0)]),t("div",et,[e[18]||(e[18]=t("label",{class:"form-label"},"End Time",-1)),b(a,{modelValue:p.value.end_time,"onUpdate:modelValue":e[6]||(e[6]=o=>p.value.end_time=o),"time-picker":"",format:"HH:mm","model-type":"HH:mm",placeholder:"Select end time",class:D({"is-invalid":m.value.end_time})},null,8,["modelValue","class"]),m.value.end_time?(d(),u("small",tt,f(m.value.end_time[0]),1)):I("",!0)])]),e[21]||(e[21]=t("hr",{class:"my-4"},null,-1)),t("div",st,[t("button",{class:"btn btn-primary rounded-pill px-4",disabled:k.value,onClick:e[7]||(e[7]=o=>G())},[k.value?(d(),u(T,{key:0},[e[19]||(e[19]=t("span",{class:"spinner-border spinner-border-sm me-2"},null,-1)),e[20]||(e[20]=N(" Saving... ",-1))],64)):(d(),u(T,{key:1},[N(f(_.value?"Update":"Save"),1)],64))],8,ot),t("button",{class:"btn btn-secondary rounded-pill px-4 ms-2","data-bs-dismiss":"modal",onClick:S}," Cancel ")])])])])])])]),_:1})}}},bt=se(at,[["__scopeId","data-v-2bf113e1"]]);export{bt as default};
