import{_ as ve,r as p,w as be,a as ze,b as d,d as te,g as r,l as b,f as e,t as a,m as I,v as K,p as $,V as qe,o as me,n as Ue,c as Ge,e as M,u as y,h as Xe,F as A,i as H,T as pe,j as We,P as He,s as w}from"./app-BWJIgFUk.js";import{_ as Ke}from"./Master-CIAemtMp.js";import{u as Ye}from"./useFormatters-D4QMfBkH.js";import{F as Qe}from"./FilterModal-JVylnsp0.js";import{s as Ze}from"./index-Dlg67k_X.js";import{u as Je}from"./useModal-vDbn_8lj.js";import{E as et,a as tt,X as st,u as B,w as lt}from"./xlsx-BS8XIOXE.js";import{E as at}from"./eye-CO_nMJfp.js";import{C as ot}from"./circle-x-CjlZLeFL.js";import"./index-N5It5Rdt.js";import"./createLucideIcon-BtxAcjLS.js";import"./PasswordVerificationModal-C7K_1d78.js";import"./index-566Dsl26.js";import"./index-DrwUNMx0.js";import"./sun-DRYQ-wZ1.js";import"./index-CQSxWd0K.js";import"./index-CTSD38n0.js";import"./index-zt3OxlBu.js";import"./index-DTkP46Ub.js";const nt={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50"},dt={class:"bg-white rounded-xl shadow-xl w-full max-w-md p-6 animate-drop-in relative"},rt={class:"text-center text-lg font-medium text-gray-800 mb-2"},it={class:"bg-gray-50 rounded-lg p-4 mb-4 space-y-2"},ut={class:"flex justify-between text-sm"},ct={class:"font-medium text-gray-800"},mt={class:"flex justify-between text-sm"},pt={class:"font-medium text-gray-800"},vt={class:"flex justify-between text-sm"},bt={class:"font-medium text-gray-800"},yt={class:"mb-4"},ft={class:"flex justify-center gap-3"},gt=["disabled"],ht={key:0,class:"spinner-border spinner-border-sm",role:"status"},wt=["disabled"],_t={__name:"OrderCancellationModal",props:{show:{type:Boolean,default:!1},order:{type:Object,default:null},loading:{type:Boolean,default:!1}},emits:["confirm","cancel"],setup(C,{emit:Y}){const f=C,R=Y,S=p("");be(()=>f.show,u=>{u||(S.value="")});const P=()=>{R("confirm",S.value||"Cancelled by admin from orders page")},k=()=>{R("cancel")},O=u=>new Intl.NumberFormat("en-GB",{style:"currency",currency:"GBP"}).format(u||0);return(u,m)=>(d(),ze(qe,{name:"fade-slide"},{default:te(()=>[C.show?(d(),r("div",nt,[e("div",dt,[e("button",{class:"absolute top-2 right-2 p-2 rounded-full hover:bg-gray-100 transition transform hover:scale-110",onClick:k,"data-bs-dismiss":"modal","aria-label":"Close",title:"Close"},[...m[1]||(m[1]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)])]),m[6]||(m[6]=e("div",{class:"flex justify-center mb-4"},[e("div",{class:"bg-red-100 p-3 rounded-full"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-8 h-8 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})])])],-1)),e("h3",rt," Cancel Order #"+a(C.order?.id)+"? ",1),m[7]||(m[7]=e("p",{class:"text-center text-sm text-gray-500 mb-4"}," This action will cancel the order and cannot be undone. ",-1)),e("div",it,[e("div",ut,[m[2]||(m[2]=e("span",{class:"text-gray-600"},"Customer:",-1)),e("span",ct,a(C.order?.customer_name||"Walk In"),1)]),e("div",mt,[m[3]||(m[3]=e("span",{class:"text-gray-600"},"Total Amount:",-1)),e("span",pt,a(O(C.order?.total_amount)),1)]),e("div",vt,[m[4]||(m[4]=e("span",{class:"text-gray-600"},"Payment Type:",-1)),e("span",bt,a(C.order?.payment?.payment_type||"N/A"),1)])]),e("div",yt,[m[5]||(m[5]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Reason for Cancellation (Optional) ",-1)),I(e("textarea",{"onUpdate:modelValue":m[0]||(m[0]=D=>S.value=D),class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-1 focus:ring-white focus:border-transparent resize-none",rows:"3",placeholder:"Enter reason for cancelling this order..."},null,512),[[K,S.value]])]),e("div",ft,[e("button",{onClick:P,disabled:C.loading,class:"btn btn-danger d-flex align-items-center gap-2 px-4 py-2 rounded-pill text-white"},[C.loading?(d(),r("span",ht)):b("",!0),$(" "+a(C.loading?"Cancelling...":"Cancel Order"),1)],8,gt),e("button",{onClick:k,disabled:C.loading,class:"btn btn-secondary d-flex align-items-center gap-2 px-4 py-2 rounded-pill text-white"}," Keep Order ",8,wt)])])])):b("",!0)]),_:1}))}},xt=ve(_t,[["__scopeId","data-v-828b9886"]]),Ct={class:"page-wrapper"},kt={class:"row g-3"},$t={class:"col-md-6 col-xl-4"},Tt={class:"card border-0 shadow-sm rounded-4"},St={class:"card-body d-flex align-items-center justify-content-between"},Ot={class:"mb-0 fw-bold"},Dt={class:"col-md-6 col-xl-4"},Pt={class:"card border-0 shadow-sm rounded-4"},Ft={class:"card-body d-flex align-items-center justify-content-between"},Mt={class:"mb-0 fw-bold"},jt={class:"col-md-6 col-xl-4"},Nt={class:"card border-0 shadow-sm rounded-4"},At={class:"card-body d-flex align-items-center justify-content-between"},It={class:"mb-0 fw-bold"},Rt={class:"col-md-6 col-xl-3"},Et={class:"card border-0 shadow-sm rounded-4"},Lt={class:"card-body d-flex align-items-center justify-content-between"},Vt={class:"mb-0 fw-bold"},Bt={class:"card border-0 shadow-lg rounded-4 mt-0"},zt={class:"card-body"},qt={class:"d-flex flex-wrap gap-2 justify-content-between align-items-center mb-3"},Ut={class:"d-flex flex-wrap gap-2 align-items-center"},Gt={class:"search-wrap"},Xt={key:1,class:"form-control search-input",placeholder:"Search",disabled:"",type:"text"},Wt={class:"col-md-6"},Ht=["onUpdate:modelValue"],Kt=["value"],Yt={class:"col-md-6 mt-3"},Qt=["onUpdate:modelValue"],Zt=["value"],Jt={class:"table-responsive"},es={class:"table table-hover align-middle mb-0"},ts={key:0},ss=["onClick"],ls={style:{"font-size":"14px"}},as={class:"text-muted small"},os={class:"text-left"},ns={class:"d-flex gap-2 justify-content-center align-items-center"},ds=["onClick"],rs=["onClick","disabled"],is=["onClick","disabled"],us={key:0},cs={key:0,class:"mt-4 d-flex justify-content-between align-items-center"},ms={class:"text-muted small"},ps={class:"modal fade",id:"paymentDetailsModal",tabindex:"-1","aria-hidden":"true"},vs={class:"modal-dialog modal-md modal-dialog-centered"},bs={class:"modal-content border-0 shadow-lg rounded-4 overflow-hidden"},ys={class:"modal-body p-4"},fs={class:"payment-info"},gs={class:"row g-3"},hs={class:"col-6"},ws={class:"info-card"},_s={class:"value"},xs={class:"col-6"},Cs={class:"info-card"},ks={class:"value"},$s={key:0,class:"col-6"},Ts={class:"info-card"},Ss={class:"value"},Os={key:1,class:"col-6"},Ds={class:"info-card"},Ps={class:"value"},Fs={class:"col-6"},Ms={class:"info-card"},js={class:"value"},Ns={key:2,class:"col-6"},As={class:"info-card"},Is={class:"value text-capitalize"},Rs={key:3,class:"col-6"},Es={class:"info-card"},Ls={class:"value"},Vs={key:4,class:"col-6"},Bs={class:"info-card"},zs={class:"value"},qs={key:5,class:"col-6"},Us={class:"info-card"},Gs={class:"value"},Xs={class:"modal fade",id:"orderDetailsModal",tabindex:"-1","aria-hidden":"true"},Ws={class:"modal-dialog modal-lg modal-dialog-centered"},Hs={class:"modal-content rounded-4 shadow border-0"},Ks={class:"modal-header bg-white border-0 position-relative px-4 pt-4"},Ys={class:"d-flex align-items-center gap-3"},Qs={class:"d-flex flex-column"},Zs={class:"modal-title fw-bold mb-0"},Js={class:"text-muted"},el={class:"modal-body bg-light px-4 pb-4"},tl={key:0,class:"rounded-3 bg-white shadow-sm p-4"},sl={class:"mb-4"},ll={class:"row text-muted small"},al={class:"col-md-4 mb-2"},ol={class:"col-md-4 mb-2"},nl={class:"table-responsive"},dl={class:"table align-middle table-striped table-hover border rounded-3 overflow-hidden shadow-sm"},rl={class:"px-3"},il={class:"fw-semibold"},ul={class:"fw-bold text-success"},cl={key:0,class:"no-border"},ml={class:"text-success fw-semibold",colspan:"3"},pl={key:1,class:"no-border"},vl={class:"text-success fw-semibold",colspan:"3"},bl={key:2,class:"no-border"},yl={class:"text-success fw-semibold",colspan:"3"},fl={key:3,class:"no-border"},gl={class:"text-success fw-semibold",colspan:"3"},hl={key:4,class:"no-border"},wl={class:"text-success fw-semibold",colspan:"3"},_l={key:5,class:"no-border"},xl={class:"text-success fw-semibold",colspan:"3"},Cl={class:"border-top-thick"},kl={class:"fw-bold text-success"},$l={key:6},Tl={class:"modal-footer bg-white border-0 shadow-sm px-4 py-3"},Sl={class:"modal fade",id:"refundModal",tabindex:"-1","aria-hidden":"true"},Ol={class:"modal-dialog modal-dialog-centered"},Dl={class:"modal-content rounded-4 shadow border-0"},Pl={class:"modal-body"},Fl={class:"mb-3"},Ml={class:"bg-light p-3 rounded-3"},jl={class:"d-flex justify-content-between mb-2"},Nl={class:"fw-semibold"},Al={class:"d-flex justify-content-between mb-2"},Il={class:"fw-semibold"},Rl={class:"d-flex justify-content-between mb-2"},El={class:"fw-semibold"},Ll={class:"d-flex justify-content-between mb-2"},Vl={class:"fw-semibold text-capitalize"},Bl={key:0,class:"d-flex justify-content-between mb-2"},zl={class:"fw-semibold text-success"},ql={key:1,class:"d-flex justify-content-between"},Ul={class:"fw-semibold"},Gl={class:"mb-3"},Xl={class:"input-group"},Wl=["max"],Hl={class:"text-muted"},Kl={class:"mb-3"},Yl={class:"text-muted"},Ql={class:"modal-footer border-0"},Zl=["disabled"],Jl=["disabled"],ea={key:0},ta={key:1},sa={__name:"Order",setup(C){const{closeModal:Y}=Je(),{formatCurrencySymbol:f,dateFmt:R}=Ye(),S=p(null),P=p(null),k=p(0),O=p(""),u=p(null),m=p([]),D=p(!1),Q=p(null),ye=[{label:"PDF",value:"pdf"},{label:"Excel",value:"excel"},{label:"CSV",value:"csv"}],fe=l=>{l.value&&(Fe(l.value),Q.value=null)},E=p({total_orders:0,completed_orders:0,cancelled_orders:0,total_revenue:0}),L=async(l=null)=>{D.value=!0;try{const t={q:j.value,page:l||_.value.current_page,per_page:_.value.per_page,sort_by:g.value.sortBy||"",order_type:g.value.orderType||"",payment_type:g.value.paymentType||"",status:g.value.status||"",price_min:g.value.priceMin||"",price_max:g.value.priceMax||"",date_from:g.value.dateFrom||"",date_to:g.value.dateTo||""};Object.keys(t).forEach(o=>{(t[o]===void 0||t[o]==="")&&delete t[o]});const s=await axios.get("/api/orders/all",{params:t});m.value=s.data.data||[],s.data.stats&&(E.value=s.data.stats),_.value={current_page:s.data.current_page,last_page:s.data.last_page,per_page:s.data.per_page,total:s.data.total,from:s.data.from,to:s.data.to,links:s.data.links}}catch(t){console.error("Error fetching orders:",t),w.error("Failed to load orders")}finally{D.value=!1}},ge=l=>{if(!l)return;const s=new URLSearchParams(l.split("?")[1]).get("page");s&&L(parseInt(s))};me(async()=>{j.value="",se.value=Date.now(),await Ue(),setTimeout(()=>{le.value=!0;const l=document.getElementById(Z);l&&(l.value="",j.value="")},100),L()});const j=p(""),se=p(Date.now()),Z=`search-${Math.random().toString(36).substr(2,9)}`,le=p(!1),_=p({current_page:1,last_page:1,per_page:10,total:0,from:0,to:0,links:[]}),z=p({sortBy:"",orderType:"",paymentType:"",status:"",priceMin:null,priceMax:null,dateFrom:"",dateTo:""}),g=p({sortBy:"",orderType:"",paymentType:"",status:"",priceMin:null,priceMax:null,dateFrom:"",dateTo:""});p(["All","Dine In","Delivery","Takeaway"]),p(["All","Cash","Card","Split"]);const q=Ge(()=>({sortOptions:[{value:"date_desc",label:"Date: Newest First"},{value:"date_asc",label:"Date: Oldest First"},{value:"price_desc",label:"Price: High to Low"},{value:"price_asc",label:"Price: Low to High"},{value:"customer_asc",label:"Customer: A to Z"},{value:"customer_desc",label:"Customer: Z to A"}],orderTypeOptions:[{value:"Eat In",label:"Eat In"},{value:"Delivery",label:"Delivery"},{value:"Takeaway",label:"Takeaway"},{value:"Collection",label:"Collection"}],paymentTypeOptions:[{value:"Cash",label:"Cash"},{value:"Card",label:"Card"},{value:"Split",label:"Split"}],statusOptions:[{value:"paid",label:"Paid"},{value:"pending",label:"Pending"},{value:"cancelled",label:"Cancelled"}]})),he=l=>{g.value={...z.value},_.value.current_page=1,L(1)},we=()=>{z.value={sortBy:"",orderType:"",paymentType:"",status:"",priceMin:null,priceMax:null,dateFrom:"",dateTo:""},g.value={sortBy:"",orderType:"",paymentType:"",status:"",priceMin:null,priceMax:null,dateFrom:"",dateTo:""},_.value.current_page=1,_.value.per_page=10,L(1),Y("orderFilterModal")};function U(l){const t=new Date(l),s=t.getFullYear(),o=String(t.getMonth()+1).padStart(2,"0"),c=String(t.getDate()).padStart(2,"0");return`${s}-${o}-${c}`}function _e(l){const t=Date.now()-new Date(l).getTime(),s=Math.floor(t/6e4);if(s<60)return`${s} minute${s===1?"":"s"} ago`;const o=Math.floor(s/60);if(o<24)return`${o} hour${o===1?"":"s"} ago`;const c=Math.floor(o/24);return`${c} day${c===1?"":"s"} ago`}function J(l){const t=Number(l??0);return`£${Number.isInteger(t)?t.toFixed(0):t.toFixed(1)}`}const xe=p(!1),h=p(null),v=p(null);function Ce(l){h.value=l,xe.value=!0,new bootstrap.Modal(document.getElementById("paymentDetailsModal")).show()}const ke=l=>{v.value=l,new bootstrap.Modal(document.getElementById("orderDetailsModal")).show()};function $e(l){const t=x=>`£${Number(x??0).toFixed(2)}`,s=x=>(x??"").toString(),o=l?.payment??{},c=(o.payment_type??l?.payment_method??"Cash").toLowerCase(),T=o.cash_amount??l?.cash_amount??l?.cash_received??0,i=o.card_amount??l?.card_amount??0,n=o.brand??l?.card_brand??"",N=o.last_digits??l?.last4??l?.last_digits??"";let G="";if(c==="split")G=`Payment: Split (Cash: ${t(T)}, Card: ${t(i)})`;else if(c==="card"||c==="stripe"){const x=n?` (${n})`:"",W=N?` •••• ${N}`:"";G=`Payment: Card${x}${W}`}else G=`Payment: ${s(l?.payment_method)||"Cash"}`;const Ae=l?.id??"N/A",Ie=l?.type?.order_type??l?.order_type??"N/A",ie=l?.type?.table_number??l?.table_number??null,Re=l?.customer_name||"Walk In",V=l?.created_at?new Date(l.created_at):new Date,Ee=`${V.getFullYear()}-${String(V.getMonth()+1).padStart(2,"0")}-${String(V.getDate()).padStart(2,"0")} ${String(V.getHours()).padStart(2,"0")}:${String(V.getMinutes()).padStart(2,"0")}`,ue=Array.isArray(l?.items)?l.items:[],ce=l?.sub_total??ue.reduce((x,W)=>x+Number(W.price??0)*Number(W.quantity??0),0),Le=l?.total_amount??ce,Ve=ue.map(x=>`
    <div class="row">
      <span class="w-50 ellips">${s(x.title)}</span>
      <span class="w-20 right">x${Number(x.quantity??0)}</span>
      <span class="w-30 right">${t(x.price)}</span>
    </div>
  `).join(""),Be=`
<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Receipt</title>
<style>
  :root { --w: 58mm; }
  html, body { margin:0; padding:0; }
  body { width: var(--w); font-family: monospace; font-size: 12px; line-height: 1.3; color:#000; }
  .center { text-align:center; }
  .right { text-align:right; }
  .row { display:flex; justify-content:space-between; gap:4px; }
  .w-50 { width:50%; } .w-20 { width:20%; } .w-30 { width:30%; }
  .ellips { white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
  hr { border:0; border-top:1px dashed #000; margin:4px 0; }
  h3 { margin:0 0 2px 0; font-size: 14px; }
  small { font-size:11px; }
  .mt-4 { margin-top:4px; }
  .mb-4 { margin-bottom:4px; }
  .bold { font-weight:bold; }
  @page { size: var(--w) auto; margin: 3mm; }
  @media print { body { -webkit-print-color-adjust: exact; print-color-adjust: exact; } }
</style>
</head>
<body>
  <div class="center">
    <h3>Goritmi</h3>
    <small>Order #${Ae}</small><br/>
    <small>${Ee}</small>
  </div>

  <hr/>
  <div><small>Customer: ${s(Re)}</small></div>
  <div><small>Order Type: ${s(Ie)}${ie?` | Table: ${s(ie)}`:""}</small></div>
  <div><small>${G}</small></div>

  <hr/>
  <div class="row bold"><span class="w-50">Item</span><span class="w-20 right">Qty</span><span class="w-30 right">Price</span></div>
  ${Ve}
  <hr/>

  <div class="row"><span>Subtotal:</span><span class="right">${t(ce)}</span></div>
  ${Number(l?.tax??0)?`<div class="row"><span>Tax:</span><span class="right">${t(l.tax)}</span></div>`:""}
  ${Number(l?.service_charges??0)?`<div class="row"><span>Service:</span><span class="right">${t(l.service_charges)}</span></div>`:""}
  ${Number(l?.delivery_charges??0)?`<div class="row"><span>Delivery:</span><span class="right">${t(l.delivery_charges)}</span></div>`:""}

  <div class="row bold mt-4"><span>Total:</span><span class="right">${t(Le)}</span></div>

  ${c==="cash"||!c?`<div class="row"><span>Cash Received:</span><span class="right">${t(l?.cash_received??o?.amount_received??0)}</span></div>
       <div class="row"><span>Change:</span><span class="right">${t(l?.change??0)}</span></div>`:""}

  <hr/>
  <div class="center">
    <small>Abdara Road, Peshawar</small><br/>
    <small>info@goritmi.com</small><br/>
    <small>Thank you for your visit!</small>
  </div>

<script>
  async function ready() {
    try { if (document.fonts && document.fonts.ready) { await document.fonts.ready; } } catch(e){}
    window.focus();
    const mq = window.matchMedia && window.matchMedia('print');
    if (mq && mq.addEventListener) {
      mq.addEventListener('change', function(e){ if(!e.matches) setTimeout(function(){ window.close(); }, 300); });
    } else if (mq && mq.addListener) { // older browsers
      mq.addListener(function(mql){ if(!mql.matches) setTimeout(function(){ window.close(); }, 300); });
    }
    window.onafterprint = function(){ setTimeout(function(){ window.close(); }, 300); };
    setTimeout(function(){ window.print(); }, 200);
  }
  if (document.readyState === 'complete') ready();
  else window.addEventListener('load', ready);
<\/script>
</body>
</html>
`,X=window.open("","","width=420,height=640");if(!X){console.error("Popup blocked or failed to open"),alert("Please allow popups for this site to print receipts");return}X.document.open(),X.document.write(Be),X.document.close()}const ae=p([]),oe=p(!1);me(async()=>{oe.value=!0;try{const l=await axios.get("/api/printers");ae.value=l.data.data.filter(t=>t.is_connected===!0||t.status==="OK").map(t=>({label:`${t.name}`,value:t.name,driver:t.driver,port:t.port}))}catch(l){console.error("Failed to fetch printers:",l)}finally{oe.value=!1}});const Te=l=>{if(!l||!l.payment)return!1;const t=l.payment.payment_type?.toLowerCase(),s=l.status?.toLowerCase(),o=l.payment.refund_status?.toLowerCase();return(s==="paid"||s==="cancelled")&&(t==="card"||t==="split")&&(!o||o==="none")},Se=async l=>{if(!l)return;l.payment?.payment_type?.toLowerCase();const t=l.total_amount,s=l.payment?.card_amount||t;u.value=l,k.value=Number(s).toFixed(2),O.value="";const o=document.getElementById("refundModal");o&&new bootstrap.Modal(o).show()},Oe=async()=>{if(!u.value)return;const l=Number(k.value);if(l<=0){w.error("Refund amount must be greater than 0");return}const t=u.value.payment?.payment_type?.toLowerCase(),s=u.value.payment?.card_amount||u.value.total_amount;if(l>s){w.error(`Refund amount cannot exceed ${f(s)}`);return}P.value=u.value.id;try{const o=await axios.post(`/api/pos/orders/${u.value.id}/refund`,{amount:l,reason:O.value||"Refund requested by admin",payment_type:t});if(o.data.success){w.success(`Refund of ${f(l)} processed successfully`);const c=m.value.findIndex(i=>i.id===u.value.id);c!==-1&&(m.value[c]=o.data.order);const T=document.getElementById("refundModal");if(T){const i=bootstrap.Modal.getInstance(T);i&&i.hide()}u.value=null,k.value=0,O.value=""}}catch(o){console.error("Error processing refund:",o),w.error(o.response?.data?.message||"Failed to process refund")}finally{P.value=null}},ne=()=>{const l=document.getElementById("refundModal");if(l){const t=bootstrap.Modal.getInstance(l);t&&t.hide()}u.value=null,k.value=0,O.value=""},ee=p(!1),F=p(null),De=l=>{l&&(F.value=l,ee.value=!0)},de=()=>{ee.value=!1,F.value=null},Pe=async l=>{if(F.value){S.value=F.value.id;try{const t=await axios.post(`/api/pos/orders/${F.value.id}/cancel`,{reason:l});if(t.data.success){w.success("Order cancelled and stock restored successfully");const s=m.value.findIndex(o=>o.id===F.value.id);s!==-1&&(m.value[s]=t.data.order),de()}}catch(t){console.error("Error cancelling order:",t),w.error(t.response?.data?.message||"Failed to cancel order")}finally{S.value=null}}};let re=null;be(j,()=>{clearTimeout(re),re=setTimeout(()=>{_.value.current_page=1,L(1)},500)});const Fe=async l=>{if(!m.value||m.value.length===0){w.error("No orders data to download");return}try{D.value=!0;const t={q:j.value,sort_by:g.value.sortBy||"",order_type:g.value.orderType||"",payment_type:g.value.paymentType||"",status:g.value.status||"",price_min:g.value.priceMin||"",price_max:g.value.priceMax||"",date_from:g.value.dateFrom||"",date_to:g.value.dateTo||"",export:"all"};Object.keys(t).forEach(c=>{(t[c]===void 0||t[c]==="")&&delete t[c]});const o=(await axios.get("/api/orders/all",{params:t})).data.data||[];if(o.length===0){w.error("No orders found to download");return}l==="pdf"?je(o):l==="excel"?Ne(o):l==="csv"?Me(o):w.error("Invalid download type")}catch(t){console.error("Download failed:",t),w.error(`Download failed: ${t.message}`)}finally{D.value=!1}},Me=l=>{try{const t=["Order ID","Table No.","Order Type","Date","Customer","Payment Type","Sub Total","Promo Discount","Sales Discount","Approved Discount","Tax","Service Charges","Delivery Charges","Total Amount","Status","Promo Name"],s=l.map(n=>[`"${n.id||""}"`,`"${n.type?.table_number||"-"}"`,`"${n.type?.order_type||"-"}"`,`"${U(n.created_at)}"`,`"${n.customer_name||"-"}"`,`"${n.payment?.payment_type||"-"}"`,`"${n.sub_total||0}"`,`"${n.promo?.[0]?.discount_amount||0}"`,`"${n.sales_discount||0}"`,`"${n.approved_discounts||0}"`,`"${n.tax||0}"`,`"${n.service_charges||0}"`,`"${n.delivery_charges||0}"`,`"${n.total_amount||0}"`,`"${n.status||""}"`,`"${n.promo?.[0]?.promo_name||"-"}"`]),o=[t.join(","),...s.map(n=>n.join(","))].join(`
`),c=new Blob([o],{type:"text/csv;charset=utf-8;"}),T=URL.createObjectURL(c),i=document.createElement("a");i.setAttribute("href",T),i.setAttribute("download",`Orders_${new Date().toISOString().split("T")[0]}.csv`),document.body.appendChild(i),i.click(),document.body.removeChild(i),w.success("CSV downloaded successfully")}catch(t){console.error("CSV generation error:",t),w.error(`CSV generation failed: ${t.message}`,{autoClose:5e3})}},je=l=>{try{const t=new et("l","mm","a4");t.setFontSize(18),t.setFont("helvetica","bold"),t.text("Orders Report",14,20),t.setFontSize(10),t.setFont("helvetica","normal");const s=new Date().toLocaleString();t.text(`Generated on: ${s}`,14,28),t.text(`Total Orders: ${l.length}`,14,34);const o=["Order ID","Table","Type","Date","Customer","Payment","Sub Total","Promo Disc.","Sales Disc.","Total","Status"],c=l.map(i=>[i.id||"",i.type?.table_number||"-",i.type?.order_type||"-",U(i.created_at),i.customer_name||"-",i.payment?.payment_type||"-",`£${Number(i.sub_total||0).toFixed(2)}`,`£${Number(i.promo?.[0]?.discount_amount||0).toFixed(2)}`,`£${Number(i.sales_discount||0).toFixed(2)}`,`£${Number(i.total_amount||0).toFixed(2)}`,i.status||""]);tt(t,{head:[o],body:c,startY:40,styles:{fontSize:8,cellPadding:2,halign:"left",lineColor:[0,0,0],lineWidth:.1},headStyles:{fillColor:[41,128,185],textColor:255,fontStyle:"bold"},alternateRowStyles:{fillColor:[245,245,245]},margin:{left:14,right:14},didDrawPage:i=>{const n=t.internal.getNumberOfPages(),N=t.internal.pageSize.height;t.setFontSize(8),t.text(`Page ${i.pageNumber} of ${n}`,i.settings.margin.left,N-10)}});const T=`Orders_${new Date().toISOString().split("T")[0]}.pdf`;t.save(T),w.success("PDF downloaded successfully")}catch(t){console.error("PDF generation error:",t),w.error(`PDF generation failed: ${t.message}`,{autoClose:5e3})}},Ne=l=>{try{if(typeof st>"u")throw new Error("XLSX library is not loaded");const t=l.map(n=>({"Order ID":n.id||"","Table No.":n.type?.table_number||"-","Order Type":n.type?.order_type||"-",Date:U(n.created_at),Customer:n.customer_name||"-","Payment Type":n.payment?.payment_type||"-","Sub Total":Number(n.sub_total||0).toFixed(2),"Promo Discount":Number(n.promo?.[0]?.discount_amount||0).toFixed(2),"Sales Discount":Number(n.sales_discount||0).toFixed(2),"Approved Discount":Number(n.approved_discounts||0).toFixed(2),Tax:Number(n.tax||0).toFixed(2),"Service Charges":Number(n.service_charges||0).toFixed(2),"Delivery Charges":Number(n.delivery_charges||0).toFixed(2),"Total Amount":Number(n.total_amount||0).toFixed(2),Status:n.status||"","Promo Name":n.promo?.[0]?.promo_name||"-"})),s=B.book_new(),o=B.json_to_sheet(t);o["!cols"]=[{wch:10},{wch:10},{wch:12},{wch:12},{wch:20},{wch:12},{wch:12},{wch:15},{wch:15},{wch:17},{wch:10},{wch:15},{wch:16},{wch:13},{wch:10},{wch:20}],B.book_append_sheet(s,o,"Orders");const c=[{Info:"Generated On",Value:new Date().toLocaleString()},{Info:"Total Records",Value:l.length},{Info:"Total Revenue",Value:`£${l.reduce((n,N)=>n+Number(N.total_amount||0),0).toFixed(2)}`},{Info:"Exported By",Value:"Restaurant Management System"}],T=B.json_to_sheet(c);B.book_append_sheet(s,T,"Report Info");const i=`Orders_${new Date().toISOString().split("T")[0]}.xlsx`;lt(s,i),w.success("Excel file downloaded successfully",{autoClose:2500})}catch(t){console.error("Excel generation error:",t),w.error(`Excel generation failed: ${t.message}`,{autoClose:5e3})}};return(l,t)=>(d(),r(A,null,[M(y(Xe),{title:"Orders"}),M(Ke,null,{default:te(()=>[e("div",Ct,[t[75]||(t[75]=e("h4",{class:"fw-semibold mb-3"},"Overall Orders",-1)),e("div",kt,[e("div",$t,[e("div",Tt,[e("div",St,[e("div",null,[e("h3",Ot,a(E.value.total_orders),1),t[7]||(t[7]=e("p",{class:"text-muted mb-0 small"},"Total Orders",-1))]),t[8]||(t[8]=e("div",{class:"rounded-circle p-2 d-flex align-items-center justify-content-center text-primary",style:{width:"40px",height:"40px"}},[e("i",{class:"bi bi-list-task fs-4"})],-1))])])]),e("div",Dt,[e("div",Pt,[e("div",Ft,[e("div",null,[e("h3",Mt,a(E.value.completed_orders),1),t[9]||(t[9]=e("p",{class:"text-muted mb-0 small"},"Completed Orders",-1))]),t[10]||(t[10]=e("div",{class:"rounded-circle p-3 d-flex align-items-center justify-content-center text-success",style:{width:"40px",height:"40px"}},[e("i",{class:"bi bi-check2-circle fs-4"})],-1))])])]),e("div",jt,[e("div",Nt,[e("div",At,[e("div",null,[e("h3",It,a(E.value.cancelled_orders),1),t[11]||(t[11]=e("p",{class:"text-muted mb-0 small"},"Cancelled Orders",-1))]),t[12]||(t[12]=e("div",{class:"rounded-circle p-3 d-flex align-items-center justify-content-center text-warning",style:{width:"40px",height:"40px"}},[e("i",{class:"bi bi-hourglass-split fs-4"})],-1))])])]),e("div",Rt,[e("div",Et,[e("div",Lt,[e("div",null,[e("h3",Vt,a(y(f)(E.value.total_revenue)),1),t[13]||(t[13]=e("p",{class:"text-muted mb-0 small"},"Total Revenue",-1))]),t[14]||(t[14]=e("div",{class:"rounded-circle p-3 d-flex align-items-center justify-content-center text-info",style:{width:"40px",height:"40px"}},[e("i",{class:"bi bi-currency-pound fs-4"})],-1))])])])]),e("div",Bt,[e("div",zt,[e("div",qt,[t[21]||(t[21]=e("h5",{class:"mb-0 fw-semibold"},"Orders",-1)),e("div",Ut,[e("div",Gt,[t[15]||(t[15]=e("i",{class:"bi bi-search"},null,-1)),t[16]||(t[16]=e("input",{type:"email",name:"email",autocomplete:"email",style:{position:"absolute",left:"-9999px",width:"1px",height:"1px"},tabindex:"-1","aria-hidden":"true"},null,-1)),le.value?I((d(),r("input",{id:Z,"onUpdate:modelValue":t[0]||(t[0]=s=>j.value=s),key:se.value,class:"form-control search-input",placeholder:"Search",type:"search",autocomplete:"new-password",name:Z,role:"presentation",onFocus:t[1]||(t[1]=(...s)=>l.handleFocus&&l.handleFocus(...s))},null,32)),[[K,j.value]]):(d(),r("input",Xt))]),M(Qe,{modelValue:z.value,"onUpdate:modelValue":t[2]||(t[2]=s=>z.value=s),title:"Orders","modal-id":"orderFilterModal","modal-size":"modal-lg","sort-options":q.value.sortOptions,"status-options":q.value.statusOptions,"show-stock-status":!1,"show-price-range":!0,"show-date-range":!0,"price-label":"Total Amount Range",onApply:he,onClear:we},{customFilters:te(({filters:s})=>[e("div",Wt,[t[18]||(t[18]=e("label",{class:"form-label fw-semibold text-dark"},[e("i",{class:"fas fa-concierge-bell me-2 text-muted"}),$("Order Type ")],-1)),I(e("select",{"onUpdate:modelValue":o=>s.orderType=o,class:"form-select"},[t[17]||(t[17]=e("option",{value:""},"All",-1)),(d(!0),r(A,null,H(q.value.orderTypeOptions,o=>(d(),r("option",{key:o.value,value:o.value},a(o.label),9,Kt))),128))],8,Ht),[[pe,s.orderType]])]),e("div",Yt,[t[20]||(t[20]=e("label",{class:"form-label fw-semibold text-dark"},[e("i",{class:"fas fa-credit-card me-2 text-muted"}),$("Payment Type ")],-1)),I(e("select",{"onUpdate:modelValue":o=>s.paymentType=o,class:"form-select"},[t[19]||(t[19]=e("option",{value:""},"All",-1)),(d(!0),r(A,null,H(q.value.paymentTypeOptions,o=>(d(),r("option",{key:o.value,value:o.value},a(o.label),9,Zt))),128))],8,Qt),[[pe,s.paymentType]])])]),_:1},8,["modelValue","sort-options","status-options"]),M(y(Ze),{modelValue:Q.value,"onUpdate:modelValue":t[3]||(t[3]=s=>Q.value=s),options:ye,optionLabel:"label",optionValue:"value",placeholder:"Export",class:"export-dropdown",onChange:fe},null,8,["modelValue"])])]),e("div",Jt,[e("table",es,[t[25]||(t[25]=e("thead",{class:"border-top small text-muted"},[e("tr",null,[e("th",{style:{width:"70px"}},"S. #"),e("th",null,"Table No."),e("th",null,"Order Type"),e("th",null,"Date"),e("th",null,"Time"),e("th",null,"Customer"),e("th",null,"Payment Type"),e("th",null,"Total"),e("th",null,"Status"),e("th",null,"Source"),e("th",{class:"text-center"},"Actions")])],-1)),e("tbody",null,[D.value?(d(),r("tr",ts,[...t[22]||(t[22]=[e("td",{colspan:"11",class:"text-center py-5"},[e("div",{class:"d-flex flex-column align-items-center justify-content-center"},[e("div",{class:"spinner-border mb-3",role:"status",style:{color:"#1B1670",width:"3rem",height:"3rem","border-width":"0.3em"}},[e("span",{class:"visually-hidden"},"Loading...")]),e("div",{class:"fw-semibold text-muted"},"Loading orders...")])],-1)])])):(d(),r(A,{key:1},[(d(!0),r(A,null,H(m.value,(s,o)=>(d(),r("tr",{key:s.id},[e("td",null,a(o+1),1),e("td",null,a(s.type?.table_number??"-"),1),e("td",null,a(s.type?.order_type??"-"),1),e("td",null,a(y(R)(s.created_at)),1),e("td",null,a(_e(s.created_at)),1),e("td",null,a(s.customer_name??"-"),1),e("td",null,[e("span",{class:"cursor-pointer",onClick:c=>Ce(s.payment)},a(s.payment?.payment_type??"-"),9,ss)]),e("td",null,a(y(f)(s.total_amount)),1),e("td",ls,[e("span",{class:We(["badge px-4 py-2 rounded-pill",{"bg-danger":s?.status==="cancelled","bg-warning text-dark":s?.status==="refunded","bg-success":s?.status==="paid","bg-warning text-dark":s?.status==="pending","bg-info text-white":s?.status==="in_progress"}])},a(s?.status.charAt(0).toUpperCase()+s?.status.slice(1)),3)]),e("td",null,[e("span",as,a(s.source==="Pos System"?"POS System":s.source==="website"?"Website":"-"),1)]),e("td",os,[e("div",ns,[e("button",{onClick:c=>ke(s),title:"View Details",class:"p-2 rounded-full text-primary hover:bg-gray-100"},[M(y(at),{class:"w-4 h-4"})],8,ds),s.status!=="cancelled"&&s.status!=="refunded"?(d(),r("button",{key:0,onClick:c=>De(s),title:"Cancel Order",disabled:S.value===s.id,class:"p-2 rounded-full text-danger hover:bg-gray-100"},[M(y(ot),{class:"w-4 h-4"})],8,rs)):b("",!0),Te(s)?(d(),r("button",{key:1,onClick:c=>Se(s),title:"Refund Payment",disabled:P.value===s.id,class:"p-2 rounded-full text-warning hover:bg-gray-100"},[...t[23]||(t[23]=[e("i",{class:"bi bi-arrow-counterclockwise",style:{"font-size":"1rem"}},null,-1)])],8,is)):b("",!0)])])]))),128)),!D.value&&m.value.length===0?(d(),r("tr",us,[...t[24]||(t[24]=[e("td",{colspan:"11",class:"text-center text-muted py-4"},[e("div",{class:"d-flex flex-column align-items-center justify-content-center py-3"},[e("i",{class:"bi bi-inbox",style:{"font-size":"2rem",opacity:"0.5","margin-bottom":"0.5rem"}}),e("div",{class:"fw-semibold"},"No orders found"),e("div",{class:"small text-secondary mt-1"},"Try adjusting your filters or date range")])],-1)])])):b("",!0)],64))])])]),!D.value&&_.value.last_page>1?(d(),r("div",cs,[e("div",ms," Showing "+a(_.value.from)+" to "+a(_.value.to)+" of "+a(_.value.total)+" entries ",1),M(He,{pagination:_.value.links,isApiDriven:!0,onPageChanged:ge},null,8,["pagination"])])):b("",!0)])]),e("div",ps,[e("div",vs,[e("div",bs,[t[35]||(t[35]=e("div",{class:"modal-header border-0 text-black"},[e("h6",{class:"modal-title fw-semibold"},[e("i",{class:"bi bi-credit-card me-2"}),$(" Payment Details ")]),e("button",{class:"absolute top-2 right-2 p-2 rounded-full hover:bg-gray-100 transition transform hover:scale-110","data-bs-dismiss":"modal","aria-label":"Close",title:"Close"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-danger",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})])])],-1)),e("div",ys,[e("div",fs,[e("div",gs,[e("div",hs,[e("div",ws,[t[26]||(t[26]=e("span",{class:"label"},"Payment Type",-1)),e("span",_s,a(h.value?.payment_type??"-"),1)])]),e("div",xs,[e("div",Cs,[t[27]||(t[27]=e("span",{class:"label"},"Amount Received",-1)),e("span",ks,a(J(h.value?.amount_received)),1)])]),h.value?.payment_type==="Split"?(d(),r("div",$s,[e("div",Ts,[t[28]||(t[28]=e("span",{class:"label"},"Cash Amount",-1)),e("span",Ss,a(J(h.value?.cash_amount)),1)])])):b("",!0),h.value?.payment_type==="Split"?(d(),r("div",Os,[e("div",Ds,[t[29]||(t[29]=e("span",{class:"label"},"Card Amount",-1)),e("span",Ps,a(J(h.value?.card_amount)),1)])])):b("",!0),e("div",Fs,[e("div",Ms,[t[30]||(t[30]=e("span",{class:"label"},"Payment Date",-1)),e("span",js,a(U(h.value?.payment_date)),1)])]),h.value?.brand?(d(),r("div",Ns,[e("div",As,[t[31]||(t[31]=e("span",{class:"label"},"Card Brand",-1)),e("span",Is,a(h.value.brand),1)])])):b("",!0),h.value?.last_digits?(d(),r("div",Rs,[e("div",Es,[t[32]||(t[32]=e("span",{class:"label"},"Last 4 Digits",-1)),e("span",Ls,"**** **** **** "+a(h.value.last_digits),1)])])):b("",!0),h.value?.exp_month?(d(),r("div",Vs,[e("div",Bs,[t[33]||(t[33]=e("span",{class:"label"},"Expiry",-1)),e("span",zs,a(h.value.exp_month)+"/"+a(h.value.exp_year),1)])])):b("",!0),h.value?.currency_code?(d(),r("div",qs,[e("div",Us,[t[34]||(t[34]=e("span",{class:"label"},"Currency",-1)),e("span",Gs,a(h.value.currency_code),1)])])):b("",!0)])])])])])]),e("div",Xs,[e("div",Ws,[e("div",Hs,[e("div",Ks,[e("div",Ys,[t[36]||(t[36]=e("span",{class:"badge bg-gradient rounded-circle p-3 shadow-sm",style:{background:`linear-gradient(
                                            135deg,
                                            #4e73df,
                                            #224abe
                                        )`}},[e("i",{class:"bi bi-receipt fs-5 text-black"})],-1)),e("div",Qs,[e("h5",Zs," Order #"+a(v.value?.id),1),e("small",Js," Customer: "+a(v.value?.customer_name??"—"),1)])]),t[37]||(t[37]=e("button",{class:"absolute top-2 right-2 p-2 rounded-full hover:bg-gray-100 transition transform hover:scale-110","data-bs-dismiss":"modal","aria-label":"Close",title:"Close"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})])],-1))]),e("div",el,[v.value?(d(),r("div",tl,[e("div",sl,[t[40]||(t[40]=e("h6",{class:"fw-bold mb-3 text-primary"}," Order Details ",-1)),e("div",ll,[e("div",al,[t[38]||(t[38]=e("span",{class:"fw-semibold text-dark"},"Order Type:",-1)),$(" "+a(v.value?.type?.order_type??"—"),1)]),e("div",ol,[t[39]||(t[39]=e("span",{class:"fw-semibold text-dark"},"Date:",-1)),$(" "+a(y(R)(v.value?.created_at)),1)])])]),t[72]||(t[72]=e("h6",{class:"fw-bold mb-3 text-primary"}," Order Items ",-1)),e("div",nl,[e("table",dl,[t[71]||(t[71]=e("thead",{class:"bg-light text-muted small"},[e("tr",null,[e("th",{class:"px-3"},"#"),e("th",null,"Item"),e("th",null,"Qty"),e("th",null,"Actual Price"),e("th",null,"="),e("th",null,"Promo Name"),e("th",null,"Total Price")])],-1)),e("tbody",null,[(d(!0),r(A,null,H(v.value.items??[],(s,o)=>(d(),r("tr",{key:s.id},[e("td",rl,a(o+1),1),e("td",null,a(s.title),1),e("td",null,a(s.quantity),1),e("td",il,a(y(f)(s.price)),1),t[41]||(t[41]=e("td",null,null,-1)),e("td",null,a(v.value.promo[0]?.promo_name||"-"),1),e("td",ul,a(y(f)(s.price)),1)]))),128)),v.value.promo?(d(),r("tr",cl,[t[42]||(t[42]=e("td",null,null,-1)),t[43]||(t[43]=e("td",null,null,-1)),t[44]||(t[44]=e("td",null,null,-1)),t[45]||(t[45]=e("td",{colspan:"3",class:"text-end text-muted text-adjusting"},"Promo Discount",-1)),e("td",ml," -"+a(y(f)(v.value.promo[0]?.discount_amount??0)),1)])):b("",!0),v.value.tax?(d(),r("tr",pl,[t[46]||(t[46]=e("td",null,null,-1)),t[47]||(t[47]=e("td",null,null,-1)),t[48]||(t[48]=e("td",null,null,-1)),t[49]||(t[49]=e("td",{colspan:"3",class:"text-end text-muted text-adjusting"},"Tax",-1)),e("td",vl," +"+a(y(f)(v.value.tax??0)),1)])):b("",!0),v.value.service_charges?(d(),r("tr",bl,[t[50]||(t[50]=e("td",null,null,-1)),t[51]||(t[51]=e("td",null,null,-1)),t[52]||(t[52]=e("td",null,null,-1)),t[53]||(t[53]=e("td",{colspan:"3",class:"text-end text-muted text-adjusting"},"Service Charges",-1)),e("td",yl," +"+a(y(f)(v.value.service_charges??0)),1)])):b("",!0),v.value.delivery_charges?(d(),r("tr",fl,[t[54]||(t[54]=e("td",null,null,-1)),t[55]||(t[55]=e("td",null,null,-1)),t[56]||(t[56]=e("td",null,null,-1)),t[57]||(t[57]=e("td",{colspan:"3",class:"text-end text-muted text-adjusting"},"Delivery Charges",-1)),e("td",gl," +"+a(y(f)(v.value.delivery_charges??0)),1)])):b("",!0),v.value.sales_discount?(d(),r("tr",hl,[t[58]||(t[58]=e("td",null,null,-1)),t[59]||(t[59]=e("td",null,null,-1)),t[60]||(t[60]=e("td",null,null,-1)),t[61]||(t[61]=e("td",{colspan:"3",class:"text-end text-muted text-adjusting"},"Sales Discount",-1)),e("td",wl," +"+a(y(f)(v.value.sales_discount??0)),1)])):b("",!0),v.value.approved_discounts?(d(),r("tr",_l,[t[62]||(t[62]=e("td",null,null,-1)),t[63]||(t[63]=e("td",null,null,-1)),t[64]||(t[64]=e("td",null,null,-1)),t[65]||(t[65]=e("td",{colspan:"3",class:"text-end text-muted text-adjusting"},"Approved Discounts",-1)),e("td",xl," +"+a(y(f)(v.value.approved_discounts??0)),1)])):b("",!0),e("tr",Cl,[t[66]||(t[66]=e("td",null,null,-1)),t[67]||(t[67]=e("td",null,null,-1)),t[68]||(t[68]=e("td",null,null,-1)),t[69]||(t[69]=e("td",{colspan:"3",class:"text-end text-muted text-adjusting"},"Grand Total ",-1)),e("td",kl,a(y(f)(v.value.total_amount)),1)]),(v.value.items??[]).length===0?(d(),r("tr",$l,[...t[70]||(t[70]=[e("td",{colspan:"7",class:"text-center text-muted py-4"}," No items found ",-1)])])):b("",!0)])])])])):b("",!0)]),e("div",Tl,[t[74]||(t[74]=e("button",{class:"btn btn-secondary px-2 py-2","data-bs-dismiss":"modal"}," Close ",-1)),ae.value.length>0?(d(),r("button",{key:0,class:"btn btn-primary shadow-sm rounded-pill px-4 py-2",onClick:t[4]||(t[4]=s=>$e(v.value))},[...t[73]||(t[73]=[e("i",{class:"bi bi-printer me-1"},null,-1),$(" Print Receipt ",-1)])])):b("",!0)])])])])]),e("div",Sl,[e("div",Ol,[e("div",Dl,[e("div",{class:"modal-header border-0"},[t[77]||(t[77]=e("h5",{class:"modal-title fw-bold"},[e("i",{class:"bi bi-arrow-counterclockwise text-warning me-2"}),$(" Process Refund ")],-1)),e("button",{onClick:ne,class:"absolute top-2 right-2 p-2 rounded-full hover:bg-gray-100 transition transform hover:scale-110","data-bs-dismiss":"modal","aria-label":"Close",title:"Close"},[...t[76]||(t[76]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("div",Pl,[t[88]||(t[88]=e("div",{class:"alert alert-warning d-flex align-items-start gap-2"},[e("i",{class:"bi bi-exclamation-triangle-fill mt-1"}),e("div",null,[e("strong",null,"Important:"),$(" This will process a refund to the customer's card. This action cannot be undone. ")])],-1)),e("div",Fl,[t[84]||(t[84]=e("label",{class:"form-label fw-semibold"},"Order Details",-1)),e("div",Ml,[e("div",jl,[t[78]||(t[78]=e("span",{class:"text-muted"},"Order #:",-1)),e("span",Nl,a(u.value?.id),1)]),e("div",Al,[t[79]||(t[79]=e("span",{class:"text-muted"},"Customer:",-1)),e("span",Il,a(u.value?.customer_name||"Walk In"),1)]),e("div",Rl,[t[80]||(t[80]=e("span",{class:"text-muted"},"Total Amount:",-1)),e("span",El,a(y(f)(u.value?.total_amount)),1)]),e("div",Ll,[t[81]||(t[81]=e("span",{class:"text-muted"},"Payment Type:",-1)),e("span",Vl,a(u.value?.payment?.payment_type),1)]),u.value?.payment?.payment_type?.toLowerCase()==="split"?(d(),r("div",Bl,[t[82]||(t[82]=e("span",{class:"text-muted"},"Card Amount:",-1)),e("span",zl,a(y(f)(u.value?.payment?.card_amount)),1)])):b("",!0),u.value?.payment?.brand?(d(),r("div",ql,[t[83]||(t[83]=e("span",{class:"text-muted"},"Card:",-1)),e("span",Ul,a(u.value.payment.brand)+" •••• "+a(u.value.payment.last_digits),1)])):b("",!0)])]),e("div",Gl,[t[86]||(t[86]=e("label",{class:"form-label fw-semibold"},"Refund Amount",-1)),e("div",Xl,[t[85]||(t[85]=e("span",{class:"input-group-text"},"£",-1)),I(e("input",{"onUpdate:modelValue":t[5]||(t[5]=s=>k.value=s),type:"number",class:"form-control",max:u.value?.payment?.card_amount||u.value?.total_amount,step:"0.01",min:"0.01",required:""},null,8,Wl),[[K,k.value,void 0,{number:!0}]])]),e("small",Hl," Maximum: "+a(y(f)(u.value?.payment?.card_amount||u.value?.total_amount)),1)]),e("div",Kl,[t[87]||(t[87]=e("label",{class:"form-label fw-semibold"},"Refund Reason (Optional)",-1)),I(e("textarea",{"onUpdate:modelValue":t[6]||(t[6]=s=>O.value=s),class:"form-control",rows:"3",placeholder:"Enter reason for refund...",maxlength:"500"},null,512),[[K,O.value]]),e("small",Yl,a(O.value.length)+"/500 characters",1)])]),e("div",Ql,[e("button",{type:"button",class:"btn btn-secondary px-2 py-2",onClick:ne,disabled:P.value!==null}," Cancel ",8,Zl),e("button",{type:"button",class:"btn btn-primary px-2 py-2",onClick:Oe,disabled:P.value!==null||!k.value||k.value<=0},[P.value?(d(),r("span",ea,[...t[89]||(t[89]=[e("span",{class:"spinner-border spinner-border-sm me-2"},null,-1),$(" Processing... ",-1)])])):(d(),r("span",ta,[...t[90]||(t[90]=[e("i",{class:"bi bi-arrow-counterclockwise me-1"},null,-1),$(" Process Refund ",-1)])]))],8,Jl)])])])]),M(xt,{show:ee.value,order:F.value,loading:S.value===F.value?.id,onConfirm:Pe,onCancel:de},null,8,["show","order","loading"])]),_:1})],64))}},Ca=ve(sa,[["__scopeId","data-v-36acc91d"]]);export{Ca as default};
