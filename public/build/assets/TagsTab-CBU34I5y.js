import{_ as se,r as i,c as U,o as re,w as I,g as d,b as c,e as w,f as t,u as E,h as ne,l as V,m as N,v as $,p as O,F as S,i as ie,t as v,C as de,P as ce,j as B,q as T,n as ue,s}from"./app-BOMqQl54.js";import{E as me,a as ge,X as pe,u as k,w as ve}from"./xlsx-B5zBSq-K.js";import{I as fe}from"./importFile-CMYxOGMN.js";import{s as he}from"./index-4S-6UPku.js";import{P as be}from"./plus-CNzRMnjC.js";import{P as ye}from"./pencil-CxSQe3rB.js";import"./index-DUbsQ-HQ.js";import"./index-DsP-l9eT.js";import"./index-Vjw1Gq1q.js";import"./index-CWVsoM9N.js";import"./index-BkIqSWvw.js";import"./createLucideIcon-DvtweBtm.js";const we={class:"card border-0 shadow-lg rounded-4"},_e={class:"card-body"},xe={class:"d-flex flex-wrap gap-2 justify-content-between align-items-center mb-3"},Te={class:"d-flex gap-2"},Ce={class:"search-wrap"},Se={class:"table-responsive"},ke={class:"table table-hover"},Fe={key:0},Ee={class:"fw-semibold"},Ve={class:"text-center"},Le={class:"d-inline-flex align-items-center gap-3"},Pe=["onClick"],De={key:0},Ie={colspan:"3",class:"text-center text-muted py-4"},Ne={key:0,class:"mt-4 d-flex justify-content-between align-items-center"},$e={class:"text-muted small"},Oe={class:"modal fade",id:"modalTagForm",tabindex:"-1","aria-hidden":"true"},Re={class:"modal-dialog modal-lg modal-dialog-centered"},Ae={class:"modal-content rounded-4"},je={class:"modal-header"},Me={class:"modal-title"},Ue={class:"modal-body"},Be={key:0},qe={key:0,class:"text-danger"},ze={key:1},Xe={key:0,class:"text-danger"},He={class:"col-md-2"},Ge=["disabled"],We={__name:"TagsTab",setup(Ke){const q=i([{label:"Vegan",value:"Vegan"},{label:"Vegetarian",value:"Vegetarian"},{label:"Halal",value:"Halal"},{label:"Kosher",value:"Kosher"},{label:"Organic",value:"Organic"},{label:"Locally Sourced",value:"Locally Sourced"},{label:"Fairtrade",value:"Fairtrade"},{label:"Spicy",value:"Spicy"},{label:"Free-From Nuts",value:"Free-From Nuts"},{label:"Contains Soy",value:"Contains Soy"},{label:"Free-From Egg",value:"Free-From Egg"},{label:"Sugar-Free",value:"Sugar-Free"},{label:"Ethically Sourced",value:"Ethically Sourced"},{label:"Red Tractor Certified",value:"Red Tractor Certified"},{label:"Scottish Produce",value:"Scottish Produce"},{label:"Welsh Lamb",value:"Welsh Lamb"}]);i([]);const L=i([]),z=i(""),_=i(!1),P=i(null),h=i(""),b=i(""),D=i(null),X=[{label:"PDF",value:"pdf"},{label:"Excel",value:"excel"},{label:"CSV",value:"csv"}],H=a=>{a.value&&(ee(a.value),D.value=null)},R=()=>{h.value="",L.value=[],r.value={}},A=U(()=>{const a=b.value.trim().toLowerCase();return a?m.value.filter(e=>e.name.toLowerCase().includes(a)):m.value}),G=()=>{_.value=!1,L.value=[],z.value=""};U(()=>q.value.filter(a=>!m.value.some(e=>e.name.toLowerCase()===a.value.toLowerCase())));const W=a=>{_.value=!0,P.value=a,h.value=a.name},K=async a=>{try{await T.delete(`/tags/${a.id}`),m.value=m.value.filter(e=>e.id!==a.id),s.success("Tag deleted successfully"),await x()}catch(e){s.error("Delete failed"),console.error(e)}},F=i(!1),Y=async()=>{const a=h.value.trim();if(!a){s.error("Please fill out the field, can't save an empty field."),r.value={customTag:["Please fill out the field, can't save an empty field"]};return}try{if(F.value=!0,_.value){const{data:e}=await T.put(`/tags/${P.value.id}`,{name:a}),o=m.value.findIndex(l=>l.id===P.value.id);o!==-1&&(m.value[o]=e),s.success("Tag updated successfully")}else{if(m.value.some(n=>n.name.toLowerCase()===a.toLowerCase())){const n=`Tag "${a}" already exists.`;s.error(n),r.value={customTag:[n]};return}const{data:o}=await T.post("/tags",{tags:[{name:a}]}),l=Array.isArray(o)?o[0]:o;m.value.push(l),s.success("Tag added successfully")}R(),J("modalTagForm"),await x()}catch(e){e.response?.data?.errors?(r.value={},Object.entries(e.response.data.errors).forEach(([o,l])=>{l.forEach(n=>s.error(n)),r.value={customTag:l}})):(s.error("Operation failed âŒ"),console.error(e))}finally{F.value=!1}},J=a=>{const e=document.getElementById(a);if(!e)return;(window.bootstrap?.Modal.getInstance(e)||new window.bootstrap.Modal(e)).hide()},m=i([]),g=i({current_page:1,last_page:1,per_page:10,total:0,from:0,to:0,links:[]}),f=i(!1),r=i({}),x=async(a=null)=>{f.value=!0;try{const{data:e}=await T.get("/tags",{params:{q:b.value,page:a||g.value.current_page,per_page:g.value.per_page}});m.value=e.data||[],g.value={current_page:e.current_page,last_page:e.last_page,per_page:e.per_page,total:e.total,from:e.from,to:e.to,links:e.links},await ue(),window.feather?.replace()}catch(e){console.error("Failed to fetch tags",e),s.error("Failed to load tags")}finally{f.value=!1}},Q=a=>{if(!a)return;const o=new URLSearchParams(a.split("?")[1]).get("page");o&&x(parseInt(o))},Z=async()=>{try{f.value=!0;const a=await T.get("/tags",{params:{q:b.value.trim(),per_page:1e4,page:1}});return console.log("ðŸ“¦ Export data received:",{total:a.data.total,items:a.data.data.length}),a.data.data||[]}catch(a){return console.error("âŒ Error fetching export data:",a),s.error("Failed to load data for export"),[]}finally{f.value=!1}},ee=async a=>{try{f.value=!0,s.info("Preparing export data...",{autoClose:1500});const e=await Z();if(!e||e.length===0){s.error("No tags found to download"),f.value=!1;return}console.log(`ðŸ“¥ Exporting ${e.length} tags as ${a.toUpperCase()}`),a==="pdf"?te(e):a==="excel"?oe(e):a==="csv"?ae(e):s.error("Invalid download type")}catch(e){console.error("Download failed:",e),s.error(`Download failed: ${e.message}`)}finally{f.value=!1}},ae=a=>{try{const e=["Name"],o=a.map(y=>[(C=>C==null?'""':(C=String(C).replace(/"/g,'""'),`"${C}"`))(y.name)]),l=[e.join(","),...o.map(y=>y.join(","))].join(`
`),n=new Blob([l],{type:"text/csv;charset=utf-8;"}),p=URL.createObjectURL(n),u=document.createElement("a");u.setAttribute("href",p),u.setAttribute("download",`tags_${new Date().toISOString().split("T")[0]}.csv`),document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(p),s.success(`CSV downloaded successfully (${a.length} tags)`,{autoClose:2500})}catch(e){console.error("CSV generation error:",e),s.error(`CSV generation failed: ${e.message}`,{autoClose:5e3})}},te=a=>{try{const e=new me("p","mm","a4");e.setFont("helvetica","bold"),e.setFontSize(18),e.text("Tags Report",80,20),e.setFont("helvetica","normal"),e.setFontSize(10);const o=new Date().toLocaleString();e.text(`Generated on: ${o}`,14,30),e.text(`Total Tags: ${a.length}`,14,36);const l=["Name"],n=a.map(u=>[u.name||""]);ge(e,{head:[l],body:n,startY:45,styles:{fontSize:10,cellPadding:3,halign:"left",valign:"middle",lineColor:[200,200,200],lineWidth:.1},headStyles:{fillColor:[41,128,185],textColor:255,fontStyle:"bold"},alternateRowStyles:{fillColor:[245,245,245]},margin:{left:14,right:14},didDrawPage:u=>{const y=e.internal.getNumberOfPages(),M=e.internal.pageSize.height;e.setFontSize(8),e.text(`Page ${u.pageNumber} of ${y}`,14,M-10)}});const p=`tags_${new Date().toISOString().split("T")[0]}.pdf`;e.save(p),s.success(`PDF downloaded successfully (${a.length} tags)`,{autoClose:2500})}catch(e){console.error("PDF generation error:",e),s.error(`PDF generation failed: ${e.message}`,{autoClose:5e3})}},oe=a=>{try{if(typeof pe>"u")throw new Error("XLSX library is not loaded");const e=a.map(y=>({Name:y.name||""})),o=k.book_new(),l=k.json_to_sheet(e);l["!cols"]=[{wch:25}],k.book_append_sheet(o,l,"Tags");const n=[{Info:"Generated On",Value:new Date().toLocaleString()},{Info:"Total Records",Value:a.length},{Info:"Exported By",Value:"Tags Management System"}],p=k.json_to_sheet(n);k.book_append_sheet(o,p,"Report Info");const u=`tags_${new Date().toISOString().split("T")[0]}.xlsx`;ve(o,u),s.success(`Excel file downloaded successfully (${a.length} tags)`,{autoClose:2500})}catch(e){console.error("Excel generation error:",e),s.error(`Excel generation failed: ${e.message}`,{autoClose:5e3})}};re(async()=>{await x(),window.feather?.replace()}),I(h,a=>{a&&r.value.customTag&&delete r.value.customTag});let j=null;I(b,()=>{clearTimeout(j),j=setTimeout(()=>{g.value.current_page=1,x(1)},500)}),I(L,a=>{a.length>0&&r.value.tags&&delete r.value.tags});const le=a=>{if(!a||a.length<=1){s.error("The file is empty",{autoClose:3e3});return}a[0];const o=a.slice(1).map(l=>({name:l[0]?.trim()||""}));T.post("/api/tags/import",{tags:o}).then(()=>{s.success("Tags imported successfully");const l=document.querySelector(".modal.show");if(l){const n=bootstrap.Modal.getInstance(l);n&&n.hide()}setTimeout(()=>{document.querySelectorAll(".modal-backdrop").forEach(p=>p.remove()),document.body.classList.remove("modal-open"),document.body.style.overflow="",document.body.style.paddingRight=""},100),x()}).catch(l=>{l?.response?.status===422&&l.response.data?.errors?(r.value=l.response.data.errors,s.error("Validation failed â€” check for duplicates or missing data",{autoClose:3e3})):s.error("Import failed. Please try again.",{autoClose:3e3}),setTimeout(()=>{document.querySelectorAll(".modal-backdrop").forEach(p=>p.remove()),document.body.classList.remove("modal-open"),document.body.style.overflow="",document.body.style.paddingRight=""},300)})};return(a,e)=>(c(),d(S,null,[w(E(ne),{title:"Tag"}),t("div",we,[t("div",_e,[t("div",xe,[e[7]||(e[7]=t("h4",{class:"mb-0"},"Tags",-1)),t("div",Te,[t("div",Ce,[e[5]||(e[5]=t("i",{class:"bi bi-search"},null,-1)),N(t("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>b.value=o),class:"form-control search-input",placeholder:"Search"},null,512),[[$,b.value]])]),t("button",{"data-bs-toggle":"modal","data-bs-target":"#modalTagForm",onClick:e[1]||(e[1]=()=>{G(),R(),r.value={}}),class:"d-flex align-items-center gap-1 btn-sm px-4 py-2 rounded-pill btn btn-primary text-white"},[w(E(be),{class:"w-4 h-4"}),e[6]||(e[6]=O(" Add Tag ",-1))]),w(fe,{label:"Import",sampleHeaders:["Name"],sampleData:[["Vegan"],["Gluten-Free"],["Organic"]],onOnImport:le}),w(E(he),{modelValue:D.value,"onUpdate:modelValue":e[2]||(e[2]=o=>D.value=o),options:X,optionLabel:"label",optionValue:"value",placeholder:"Export",class:"export-dropdown",onChange:H},null,8,["modelValue"])])]),t("div",Se,[t("table",ke,[e[9]||(e[9]=t("thead",{class:"border-top small text-muted"},[t("tr",null,[t("th",null,"S. #"),t("th",null,"Tag Name"),t("th",{class:"text-center"},"Action")])],-1)),t("tbody",null,[f.value?(c(),d("tr",Fe,[...e[8]||(e[8]=[t("td",{colspan:"3",class:"text-center py-5"},[t("div",{class:"spinner-border text-primary",role:"status"},[t("span",{class:"visually-hidden"},"Loading...")]),t("p",{class:"text-muted mt-2 mb-0"},"Loading tags...")],-1)])])):(c(),d(S,{key:1},[(c(!0),d(S,null,ie(A.value,(o,l)=>(c(),d("tr",{key:o.id},[t("td",null,v(g.value.from+l),1),t("td",Ee,v(o.name),1),t("td",Ve,[t("div",Le,[t("button",{"data-bs-toggle":"modal","data-bs-target":"#modalTagForm",onClick:()=>{W(o),r.value={}},title:"Edit",class:"p-2 rounded-full text-blue-600 hover:bg-blue-100"},[w(E(ye),{class:"w-4 h-4"})],8,Pe),w(de,{title:"Confirm Delete",message:`Are you sure you want to delete ${o.name}?`,showDeleteButton:!0,onConfirm:()=>{K(o)},onCancel:()=>{}},null,8,["message","onConfirm"])])])]))),128)),A.value.length===0?(c(),d("tr",De,[t("td",Ie,v(b.value.trim()?"No tags found matching your search.":"No tags found."),1)])):V("",!0)],64))])])]),!f.value&&g.value.last_page>1?(c(),d("div",Ne,[t("div",$e," Showing "+v(g.value.from)+" to "+v(g.value.to)+" of "+v(g.value.total)+" entries ",1),w(ce,{pagination:g.value.links,isApiDriven:!0,onPageChanged:Q},null,8,["pagination"])])):V("",!0)])]),t("div",Oe,[t("div",Re,[t("div",Ae,[t("div",je,[t("h5",Me,v(_.value?"Edit Tag":"Add Tag"),1),e[10]||(e[10]=t("button",{class:"absolute top-2 right-2 p-2 rounded-full hover:bg-gray-100 transition transform hover:scale-110","data-bs-dismiss":"modal","aria-label":"Close",title:"Close"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})])],-1))]),t("div",Ue,[_.value?(c(),d("div",Be,[e[11]||(e[11]=t("label",{class:"form-label"},"Tag Name",-1)),N(t("input",{"onUpdate:modelValue":e[3]||(e[3]=o=>h.value=o),class:B(["form-control",{"is-invalid":r.value.customTag}]),placeholder:"e.g., Vegan"},null,2),[[$,h.value]]),r.value.customTag?(c(),d("span",qe,v(r.value.customTag[0]),1)):V("",!0)])):(c(),d("div",ze,[e[12]||(e[12]=t("label",{class:"form-label"},"Tag Name",-1)),N(t("input",{"onUpdate:modelValue":e[4]||(e[4]=o=>h.value=o),class:B(["form-control",{"is-invalid":r.value.customTag}]),placeholder:"Enter tag name"},null,2),[[$,h.value]]),r.value.customTag?(c(),d("span",Xe,v(r.value.customTag[0]),1)):V("",!0)])),t("div",He,[t("button",{class:"btn btn-primary rounded-pill py-2 btn-sm w-100 mt-4",disabled:F.value,onClick:Y},[F.value?(c(),d(S,{key:0},[e[13]||(e[13]=t("span",{class:"spinner-border spinner-border-sm me-2"},null,-1)),e[14]||(e[14]=O(" Saving... ",-1))],64)):(c(),d(S,{key:1},[O(v((_.value,"Save")),1)],64))],8,Ge)])])])])])],64))}},ia=se(We,[["__scopeId","data-v-33ea49ab"]]);export{ia as default};
