import{_ as oe,A as ae,r as I,c as y,w as L,g as n,l as m,b as d,f as e,p as k,t as i,j as P,F as W,i as le,u as f,m as q,Z as B,v as ne,e as Z,s as V}from"./app-DFa9wJfT.js";import de from"./StripePayment-Bqp5oTAI.js";import re from"./SplitPayment-W22hl5BL.js";import{u as ie}from"./useFormatters-B_Oq-Qyw.js";const ce={key:0,class:"modal fade show d-block",tabindex:"-1",style:{background:"rgba(0, 0, 0, 0.5)"}},ue={class:"modal-dialog modal-xl modal-dialog-centered"},me={class:"modal-content rounded-4 s border-0"},ve={class:"modal-header brand-gradient text-white py-3 position-sticky top-0 z-3"},pe={class:"modal-title fw-bold d-flex align-items-center gap-2 m-0"},ye={class:"modal-body p-3 p-md-4 body-scroll"},he={class:"row g-3"},be={class:"col-12 col-md-6 d-flex"},fe={class:"w-100 d-flex flex-column gap-3"},ge={class:"card border-0 brand-card h-100"},xe={class:"card-body"},ke={class:"d-flex justify-content-between align-items-center mb-3"},we={class:"row g-3"},Te={class:"col-12 col-sm-6"},Ce={class:"p-3 rounded-3 bg-light d-flex flex-column h-100"},Ie={class:"fw-semibold"},Pe={class:"col-12 col-sm-6"},Ne={class:"p-3 rounded-3 bg-light d-flex flex-column h-100"},Se={class:"fw-semibold"},De={class:"badge brand-badge px-3 py-2 service-badge"},Ae={key:0,class:"col-12 col-sm-6"},Re={class:"p-3 rounded-3 bg-light d-flex flex-column"},qe={class:"fw-semibold"},Oe={key:1,class:"col-12 col-sm-6"},Me={class:"p-3 rounded-3 bg-light d-flex flex-column"},Fe={class:"fw-semibold"},$e={key:2,class:"col-12 col-sm-6"},Le={class:"p-3 rounded-3 bg-light d-flex flex-column"},Be={class:"fw-semibold"},Ve={class:"table-responsive compact-table"},Ee={class:"table align-middle table-hover mb-0"},Ke={class:"table-light"},je={style:{width:"70px"}},ze=["checked"],Ue={key:1,class:"text-muted small"},_e=["checked","onChange"],Qe={key:1,class:"d-flex align-items-center justify-content-center gap-1 text-success px-3 py-1 rounded-pill",style:{"min-width":"70px","font-weight":"700"}},We={key:2,class:"text-center"},Ze={class:"d-flex align-items-center gap-2"},Ge={class:"fw-semibold"},He={key:0,class:"small text-muted"},Je={key:1,class:"small text-muted"},Xe={key:2,class:"small text-warning fw-semibold"},Ye={class:"text-center"},et={class:"text-end text-nowrap"},tt={class:"text-end fw-bold text-nowrap"},st={key:0,class:""},ot={class:"text-end text-success fw-bold"},at={key:1,class:"table-success"},lt={colspan:"5",class:"text-end fw-semibold"},nt={class:"text-end fw-bold text-primary"},dt={key:2},rt={colspan:"5",class:"text-end text-muted"},it={key:0},ct={class:"text-end text-success"},ut={class:"fw-bold border-top-0"},mt={colspan:"5",class:"text-end py-2"},vt={class:"text-end text-success fs-5 py-2"},pt={key:3,class:"border-top-0 bg-light-subtle"},yt={class:"text-end text-muted py-2 fw-bold",style:{"font-size":"0.85rem"}},ht={class:"col-12 col-md-6 d-flex"},bt={class:"w-100"},ft={class:"card border-0 brand-card h-100"},gt={class:"card-body d-flex flex-column"},xt={class:"segmented mt-1 mb-3",role:"tablist","aria-label":"Payment method"},kt={key:0,class:"pt-2 border-top"},wt={key:0,class:"text-danger"},Tt={class:"mt-2"},Ct={class:"d-flex gap-2 mt-3"},It=["disabled"],Pt={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},Nt={key:1,class:"bi bi-check2-circle"},St=["disabled"],Dt={key:1,class:"pt-3 border-top"},At={key:2,class:"pt-3 border-top"},Rt={__name:"ConfirmOrderModal",props:{show:Boolean,customer:String,deliveryLocation:String,phone:String,orderType:String,selectedTable:Object,orderItems:Array,grandTotal:Number,money:Function,cashReceived:Number,order_code:String,subTotal:Number,tax:Number,serviceCharges:Number,deliveryCharges:Number,note:[String,null],kitchenNote:[String,null],orderDate:String,orderTime:String,paymentMethod:String,change:Number,promoDiscount:{type:Number,default:0},promoId:{type:[Number,String,null],default:null},promoName:{type:[String,null],default:null},promoType:{type:[String,null],default:null},promoDiscountAmount:{type:Number,default:0},appliedPromos:{type:Array,default:()=>[]},approvedDiscounts:{type:Number,default:0},approvedDiscountDetails:{type:Array,default:()=>[]},isPartialPayment:{type:Boolean,default:!1},isPaymentOnly:{type:Boolean,default:!1},currentOrderId:{type:[Number,null],default:null}},emits:["close","confirm","update:cashReceived","pay-item","partial-payment","payment-success"],setup(s,{emit:G}){const H=ae(),{formatCurrencySymbol:g}=ie(),u=s,E=I(!1),C=I({}),l=I([]),r=I(u.isPartialPayment||!1),h=a=>{if(String(a.payment_status).toLowerCase()==="paid")return!0;const t=Number(a.unit_price||a.price)||0,o=Number(a.qty||a.quantity)||0,c=t*o;return(Number(a.amount_paid)||0)>=c-.01&&c>0},K=y(()=>{if(!Array.isArray(u.orderItems))return 0;const a=u.orderItems.reduce((t,o)=>{if(h(o)){const c=Number(o.unit_price||o.price)||0,p=Number(o.qty||o.quantity)||0;return t+c*p}return t+(Number(o.amount_paid)||0)},0);return parseFloat(a.toFixed(2))}),O=G,v=I("Cash"),b=y({get:()=>u.cashReceived,set:a=>O("update:cashReceived",a)}),N=y(()=>{if(v.value==="Cash"){const a=b.value-x.value;return parseFloat(a.toFixed(2))}return 0}),x=y(()=>{const a=Array.isArray(u.orderItems)?u.orderItems:[];let t=0;if(r.value)l.value.length>0&&(t=l.value.reduce((o,c)=>{const p=Number(c.unit_price||c.price)||0,M=Number(c.qty||c.quantity)||0,F=p*M,$=Number(c.amount_paid)||0,R=F-$;return o+(R>0?R:0)},0));else{const o=a.reduce((c,p)=>{if(h(p))return c;const M=Number(p.unit_price||p.price)||0,F=Number(p.qty||p.quantity)||0,$=M*F,R=Number(p.amount_paid)||0,Q=$-R;return c+(Q>0?Q:0)},0);t=Math.max(0,o-(u.promoDiscount||0))}return parseFloat(t.toFixed(2))});L(x,a=>{r.value&&(b.value=a)}),L(()=>u.orderItems,a=>{a&&Array.isArray(a)&&(l.value=l.value.filter(t=>{const o=a.find(c=>T(c)===T(t));return o&&!h(o)}))},{deep:!0}),L(r,a=>{a?l.value.length===0&&(b.value=0):(b.value=x.value,l.value=[])},{immediate:!0});const j=a=>{l.value=[],O("payment-success",a)},z=y(()=>Array.isArray(u.orderItems)?u.orderItems.reduce((a,t)=>a+(Number(t.unit_price||t.price)||0)*(Number(t.qty||t.quantity)||0),0):0),w=I(!1),T=a=>a.server_item_id?`server-${a.server_item_id}`:`${a.isDeal?"deal":"prod"}-${a.id}`,J=a=>{if(h(a))return;const t=T(a),o=l.value.findIndex(c=>T(c)===t);o>-1?l.value.splice(o,1):l.value.push(a)},U=a=>{const t=T(a);return l.value.some(o=>T(o)===t)},X=()=>{r.value=!0,l.value=[]},Y=()=>{r.value=!1,l.value=[]},S=y(()=>l.value.filter(a=>a.server_item_id).map(a=>a.server_item_id)),D=y(()=>l.value.filter(a=>!a.server_item_id&&!a.isDeal).map(a=>a.id)),A=y(()=>l.value.filter(a=>!a.server_item_id&&a.isDeal).map(a=>a.id)),ee=async()=>{E.value=!0,await _()},_=async()=>{C.value.cashReceived=null;const a=x.value;if(!u.cashReceived||u.cashReceived<=0){C.value.cashReceived="Enter a valid cash amount.",V.error("Enter a valid cash amount.");return}if(Math.round(u.cashReceived*100)/100<a){C.value.cashReceived="Cash received cannot be less than payment amount.",V.error("Cash received cannot be less than payment amount.");return}if(r.value&&l.value.length===0){V.error("Please select at least one item to pay for.");return}w.value||(w.value=!0,O("confirm",{paymentMethod:v.value,cashReceived:b.value,changeAmount:N.value,items:u.orderItems,autoPrintKot:E.value,existingOrderId:u.currentOrderId,isPartialPayment:r.value,selectedItems:l.value,selectedItemIds:S.value.concat(D.value).concat(A.value),paidItemIds:S.value,paidProductIds:D.value,paidDealIds:A.value,done:()=>{w.value=!1}}))},te=y(()=>u.orderItems),se=y(()=>u.orderType?u.orderType.replace(/_/g," ").replace(/\b\w/g,a=>a.toUpperCase()):"");return(a,t)=>s.show?(d(),n("div",ce,[e("div",ue,[e("div",me,[e("div",ve,[e("h5",pe,[t[9]||(t[9]=e("i",{class:"bi bi-receipt-cutoff"},null,-1)),k(" "+i(r.value?"Partial Payment":"Confirm Order"),1)]),e("button",{class:"absolute top-2 right-2 p-2 rounded-full hover:bg-gray-100 transition transform hover:scale-110",onClick:t[0]||(t[0]=o=>a.$emit("close")),"aria-label":"Close",title:"Close"},[...t[10]||(t[10]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("div",ye,[e("div",he,[e("div",be,[e("div",fe,[e("div",ge,[e("div",xe,[e("div",ke,[t[11]||(t[11]=e("h6",{class:"fw-bold brand-text m-0 d-flex align-items-center gap-2"},[e("i",{class:"bi bi-info-circle"}),k(" Order Summary ")],-1)),e("div",{class:"mode-toggle-container",onClick:t[1]||(t[1]=o=>{r.value=!r.value,r.value?X():Y()})},[e("div",{class:P(["mode-option",{active:!r.value}])},"Full Pay",2),e("div",{class:P(["mode-option",{active:r.value}])},"Partial ",2),e("div",{class:P(["mode-slider",{"slide-right":r.value}])},null,2)])]),e("div",we,[e("div",Te,[e("div",Ce,[t[12]||(t[12]=e("span",{class:"text-muted small"},"Customer",-1)),e("span",Ie,i(s.customer||"Walk In"),1)])]),e("div",Pe,[e("div",Ne,[t[13]||(t[13]=e("span",{class:"text-muted small"},"Service",-1)),e("span",Se,[e("span",De,i(se.value),1)])])]),s.orderType==="Dine_in"?(d(),n("div",Ae,[e("div",Re,[t[14]||(t[14]=e("span",{class:"text-muted small"},"Table No",-1)),e("span",qe,i(s.selectedTable?.name||"N/A"),1)])])):m("",!0),s.orderType==="Delivery"?(d(),n("div",Oe,[e("div",Me,[t[15]||(t[15]=e("span",{class:"text-muted small"},"Delivery Location",-1)),e("span",Fe,i(s.deliveryLocation||"N/A"),1)])])):m("",!0),s.orderType==="Delivery"?(d(),n("div",$e,[e("div",Le,[t[16]||(t[16]=e("span",{class:"text-muted small"},"Phone No",-1)),e("span",Be,i(s.phone||"N/A"),1)])])):m("",!0),e("div",Ve,[e("table",Ee,[e("thead",Ke,[e("tr",null,[e("th",je,[r.value?(d(),n("input",{key:0,type:"checkbox",class:"form-check-input",onChange:t[2]||(t[2]=o=>o.target.checked?l.value=s.orderItems.filter(c=>!h(c)):l.value=[]),checked:l.value.length>0&&l.value.length===s.orderItems.filter(o=>!h(o)).length},null,40,ze)):(d(),n("span",Ue,"Status"))]),t[17]||(t[17]=e("th",null,"#",-1)),t[18]||(t[18]=e("th",null,"Item",-1)),t[19]||(t[19]=e("th",{class:"text-center"},"Qty",-1)),t[20]||(t[20]=e("th",{class:"text-end"},"Price",-1)),t[21]||(t[21]=e("th",{class:"text-end"},"Total",-1))])]),e("tbody",null,[(d(!0),n(W,null,le(te.value,(o,c)=>(d(),n("tr",{key:T(o)||c,class:P({"table-primary shadow-sm":r.value&&U(o),"bg-success-subtle border-success-subtle transition-all duration-300":h(o)})},[e("td",null,[!h(o)&&r.value?(d(),n("input",{key:0,type:"checkbox",class:"form-check-input cursor-pointer",checked:U(o),onChange:p=>J(o)},null,40,_e)):h(o)?(d(),n("div",Qe,[...t[22]||(t[22]=[e("i",{class:"bi bi-check-circle-fill text-success"},null,-1),e("span",{style:{"font-size":"0.85rem",color:"#198754 !important"}},"Paid",-1)])])):(d(),n("div",We,[...t[23]||(t[23]=[e("i",{class:"bi bi-dash text-muted"},null,-1)])]))]),e("td",null,i(c+1),1),e("td",null,[e("div",Ze,[e("div",Ge,i(o.title),1)]),o.note?(d(),n("div",He," Note: "+i(o.note),1)):m("",!0),o.kitchen_note?(d(),n("div",Je," Kitchen Note: "+i(o.kitchen_note),1)):m("",!0),o.item_kitchen_note?(d(),n("div",Xe," Item Note: "+i(o.item_kitchen_note),1)):m("",!0)]),e("td",Ye,i(o.qty||o.quantity),1),e("td",et,i(f(g)(o.unit_price||o.price)),1),e("td",tt,i(f(g)((Number(o.unit_price||o.price)||0)*(Number(o.qty||o.quantity)||0))),1)],2))),128))]),e("tfoot",null,[K.value>0?(d(),n("tr",st,[t[24]||(t[24]=e("td",{colspan:"5",class:"text-end text-muted small fw-semibold"}," Already Paid ",-1)),e("td",ot," -"+i(f(g)(K.value)),1)])):m("",!0),r.value&&l.value.length>0?(d(),n("tr",at,[e("td",lt," Selected to Pay ("+i(l.value.length)+" items) ",1),e("td",nt,i(f(g)(x.value)),1)])):m("",!0),s.promoDiscount>0&&!r.value?(d(),n("tr",dt,[e("td",rt,[t[25]||(t[25]=k(" Promo ",-1)),s.promoName?(d(),n("span",it,"("+i(s.promoName)+")",1)):m("",!0)]),e("td",ct," -"+i(f(g)(s.promoDiscount)),1)])):m("",!0),e("tr",ut,[e("td",mt,i(r.value?"Amount to Pay":"Remaining Balance"),1),e("td",vt,i(f(g)(x.value)),1)]),r.value?(d(),n("tr",pt,[t[26]||(t[26]=e("td",{colspan:5,class:"text-end text-muted py-2 fw-semibold",style:{"font-size":"0.85rem"}},[e("i",{class:"bi bi-cart-check me-1"}),k(" Full Order Total ")],-1)),e("td",yt,i(f(g)(s.grandTotal-(s.promoDiscount||0))),1)])):m("",!0)])])])])])])])]),e("div",ht,[e("div",bt,[e("div",ft,[e("div",gt,[e("div",xt,[q(e("input",{class:"segmented-input",type:"radio",id:"paymentCash",name:"payMethod",value:"Cash","onUpdate:modelValue":t[3]||(t[3]=o=>v.value=o)},null,512),[[B,v.value]]),t[29]||(t[29]=e("label",{class:"segmented-label",for:"paymentCash"},[e("i",{class:"bi bi-cash-coin me-1"}),k(" Cash ")],-1)),f(H).props?.onboarding?.payment_methods?.card_enabled?(d(),n(W,{key:0},[q(e("input",{class:"segmented-input",type:"radio",id:"paymentCard",name:"payMethod",value:"Card","onUpdate:modelValue":t[4]||(t[4]=o=>v.value=o)},null,512),[[B,v.value]]),t[27]||(t[27]=e("label",{class:"segmented-label",for:"paymentCard"},[e("i",{class:"bi bi-credit-card-2-front me-1"}),k(" Card ")],-1)),q(e("input",{class:"segmented-input",type:"radio",id:"paymentSplit",name:"payMethod",value:"Split","onUpdate:modelValue":t[5]||(t[5]=o=>v.value=o)},null,512),[[B,v.value]]),t[28]||(t[28]=e("label",{class:"segmented-label",for:"paymentSplit"},[e("i",{class:"bi bi-columns-gap me-1"}),k(" Split ")],-1))],64)):m("",!0)]),v.value==="Cash"?(d(),n("div",kt,[t[31]||(t[31]=e("div",{class:"pay-header d-flex align-items-center gap-2 mb-3"},[e("i",{class:"bi bi-credit-card-2-front-fill"}),e("h6",{class:"m-0"},"Cash Received")],-1)),q(e("input",{type:"number","onUpdate:modelValue":t[6]||(t[6]=o=>b.value=o),class:P(["form-control rounded-3",{"is-invalid":C.value.cashReceived}])},null,2),[[ne,b.value,void 0,{number:!0}]]),C.value.cashReceived?(d(),n("small",wt,i(C.value.cashReceived),1)):m("",!0),e("div",Tt,[t[30]||(t[30]=e("strong",null,"Change:",-1)),e("span",{class:P(N.value<0?"text-danger fw-bold":"text-success fw-bold")},i(f(g)(N.value)),3)]),e("div",Ct,[e("button",{class:"btn btn-secondary btn-sm rounded-pill px-3 py-2",onClick:t[7]||(t[7]=o=>a.$emit("close"))}," Cancel "),e("button",{class:"btn btn-primary brand-btn rounded-pill btn-sm px-2 py-2 d-flex align-items-center gap-2",onClick:_,disabled:w.value||r.value&&l.value.length===0},[w.value?(d(),n("span",Pt)):(d(),n("i",Nt)),e("span",null,i(w.value?"Processing...":r.value?l.value.length>0?"Pay Selected":"Select Items":"Confirm"),1)],8,It),r.value?m("",!0):(d(),n("button",{key:0,class:"btn btn-primary rounded-pill btn-sm d-flex align-items-center justify-content-center text-nowrap",style:{"font-size":"0.75rem",padding:"6px 10px"},onClick:ee,disabled:w.value}," Order & Print ",8,St))])])):m("",!0),v.value==="Card"?(d(),n("div",Dt,[Z(de,{order_code:s.order_code,show:s.show,customer:s.customer,phone:s.phone,"delivery-location":s.deliveryLocation,orderType:s.orderType,selectedTable:s.selectedTable,orderItems:s.orderItems,grandTotal:x.value,money:s.money,cashReceived:b.value,subTotal:z.value,tax:s.tax??0,serviceCharges:s.serviceCharges??0,deliveryCharges:s.deliveryCharges??0,note:s.note,"kitchen-note":s.kitchenNote,orderDate:s.orderDate??new Date().toISOString().split("T")[0],orderTime:s.orderTime??new Date().toTimeString().split(" ")[0],"payment-method":v.value,change:N.value,"promo-discount":s.promoDiscount,"promo-id":s.promoId,"promo-name":s.promoName,"promo-type":s.promoType,"promo-discount-amount":s.promoDiscountAmount,"applied-promos":s.appliedPromos,"approved-discounts":s.approvedDiscounts,"approved-discount-details":s.approvedDiscountDetails,"current-order-id":s.currentOrderId,"is-partial-payment":r.value,"paid-item-ids":S.value,"paid-product-ids":D.value,"paid-deal-ids":A.value,"selected-item-ids":l.value.map(o=>o.server_item_id||o.id),onPaymentSuccess:j,onPaymentError:a.handleStripeError},null,8,["order_code","show","customer","phone","delivery-location","orderType","selectedTable","orderItems","grandTotal","money","cashReceived","subTotal","tax","serviceCharges","deliveryCharges","note","kitchen-note","orderDate","orderTime","payment-method","change","promo-discount","promo-id","promo-name","promo-type","promo-discount-amount","applied-promos","approved-discounts","approved-discount-details","current-order-id","is-partial-payment","paid-item-ids","paid-product-ids","paid-deal-ids","selected-item-ids","onPaymentError"])])):m("",!0),v.value==="Split"?(d(),n("div",At,[Z(re,{order_code:s.order_code,show:s.show,customer:s.customer,phone:s.phone,"delivery-location":s.deliveryLocation,orderType:s.orderType,selectedTable:s.selectedTable,orderItems:s.orderItems,grandTotal:x.value,money:s.money,cashReceived:b.value,subTotal:z.value,tax:s.tax??0,serviceCharges:s.serviceCharges??0,deliveryCharges:s.deliveryCharges??0,note:s.note,"kitchen-note":s.kitchenNote,orderDate:s.orderDate??new Date().toISOString().split("T")[0],orderTime:s.orderTime??new Date().toTimeString().split(" ")[0],"payment-method":v.value,change:N.value,"payment-type":"split","promo-discount":s.promoDiscount,"promo-id":s.promoId,"promo-name":s.promoName,"promo-type":s.promoType,"promo-discount-amount":s.promoDiscountAmount,"applied-promos":s.appliedPromos,"approved-discounts":s.approvedDiscounts,"approved-discount-details":s.approvedDiscountDetails,"current-order-id":s.currentOrderId,"is-partial-payment":r.value,"paid-item-ids":S.value,"paid-product-ids":D.value,"paid-deal-ids":A.value,"selected-item-ids":l.value.map(o=>o.server_item_id||o.id),onConfirm:t[8]||(t[8]=o=>a.$emit("confirm",o)),onPaymentSuccess:j},null,8,["order_code","show","customer","phone","delivery-location","orderType","selectedTable","orderItems","grandTotal","money","cashReceived","subTotal","tax","serviceCharges","deliveryCharges","note","kitchen-note","orderDate","orderTime","payment-method","change","promo-discount","promo-id","promo-name","promo-type","promo-discount-amount","applied-promos","approved-discounts","approved-discount-details","current-order-id","is-partial-payment","paid-item-ids","paid-product-ids","paid-deal-ids","selected-item-ids"])])):m("",!0),t[32]||(t[32]=e("div",{class:"mt-auto small text-muted pt-2"},[e("i",{class:"bi bi-shield-check me-1"}),k(" Secured checkout â€¢ Keep this window open until payment completes ")],-1))])])])])])])])])])):m("",!0)}},$t=oe(Rt,[["__scopeId","data-v-1adf33c0"]]);export{$t as default};
