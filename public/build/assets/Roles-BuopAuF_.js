import{_ as H,r,c as T,o as W,n as J,w as Q,g as n,b as i,f as t,l as g,p as V,F as _,i as A,t as m,e as Y,u as Z,m as x,v as $,j as ee,b5 as j,q as v,s as C}from"./app-V2s1lVwu.js";import{P as se}from"./pencil-Wnn9pGcO.js";import"./createLucideIcon-Coq8DOvK.js";const te={class:"card shadow-sm border-0 rounded-4"},le={class:"list-group list-group-flush"},oe={class:"d-flex flex-column"},ae={class:"fw-semibold"},ne={class:"text-muted"},ie=["onClick"],re={key:0,class:"list-group-item text-center text-muted"},de={key:0,class:"modal show d-block fade"},ue={class:"modal-dialog modal-dialog-end modal-xl"},ce={class:"modal-content rounded-4"},me={class:"modal-header"},ve={class:"modal-title"},pe={class:"modal-body"},fe={class:"mb-3"},be={key:0,class:"invalid-feedback d-block"},he={class:"mb-2 d-flex justify-content-between align-items-center"},ge={class:"input-group",style:{"max-width":"260px"}},ye={key:1,class:"form-control search-input",placeholder:"Search",disabled:"",type:"text"},we={class:"form-check mb-3"},ke={style:{color:"#1B2850"},class:"fw-bold border-bottom pb-1 mb-2"},_e={class:"row"},xe={class:"form-check"},Ce=["id","value"],Pe=["for"],Se={key:0,class:"text-danger"},Re={class:"modal-footer"},Le=["disabled"],Ae={key:0,class:"spinner-border spinner-border-sm me-1"},P="/roles",Ie="/permissions-list",Me={__name:"Roles",setup(qe){const p=r(!1),f=r(null),S=r([]),y=r([]),b=r({name:""}),c=r([]),w=r(!1),d=r({}),k=r(!1),I=r(Date.now()),R=`search-${Math.random().toString(36).substr(2,9)}`,M=r(!1),N=["allergies","analytics","categories","menu-categories","menu","inventory-categories","inventory","kots","notifications","orders","pos","profile","promos","purchase","suppliers","tags","settings","users","roles","permissions","stock","reference"],U=T(()=>{const s={};L.value.forEach(l=>{const o=l.name?.toLowerCase()||"",u=l.description?.toLowerCase()||"";let a="General";if(o.includes("menu-categories")||o.includes("menu.categories"))a="menu-categories";else if(o.includes("inventory-categories")||o.includes("inventory.categories"))a="inventory-categories";else if(o.includes("categories"))a="categories";else if(o.includes("menu"))a="menu";else if(o.includes("inventory"))a="inventory";else for(const h of N)if(o.includes(h)||u.includes(h)){a=h;break}s[a]||(s[a]=[]),s[a].push(l)});const e=c.value.map(l=>l.id);return Object.keys(s).forEach(l=>{s[l].sort((o,u)=>{const a=e.includes(o.id),h=e.includes(u.id);return a===h?0:a?-1:1})}),s}),B=s=>{const e={"menu-categories":"Menu Categories","inventory-categories":"Inventory Categories",pos:"POS (Point of Sale)",kots:"KOT (Kitchen Order Tickets)",api:"API"};return e[s.toLowerCase()]?e[s.toLowerCase()]:s.replace(/-/g," ").replace(/\b\w/g,l=>l.toUpperCase())};function F(){v.defaults.headers.common["X-Requested-With"]="XMLHttpRequest";const s=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content");s&&(v.defaults.headers.common["X-CSRF-TOKEN"]=s)}async function E(){const{data:s}=await v.get(P);S.value=s||[]}async function O(){const{data:s}=await v.get(Ie);y.value=s||[]}const D=r(""),L=T(()=>{const s=D.value.trim().toLowerCase();return s?y.value.filter(e=>(e.name||"").toLowerCase().includes(s)||(e.description||"").toLowerCase().includes(s)):y.value});function K(){f.value=null,b.value={name:""},c.value=[],d.value={},p.value=!0}async function X(s){f.value=s.id,b.value={name:s.name},d.value={};const{data:e}=await v.get(`${P}/${s.id}`),l=e.permission_ids||[];c.value=y.value.filter(o=>l.includes(o.id)),p.value=!0}async function z(){try{k.value=!0,d.value={};const s={name:b.value.name,permissions:c.value.map(e=>e.id)};f.value?(await v.put(`${P}/${f.value}`,s),C.success("Role updated successfully")):(await v.post(P,s),C.success("Role created successfully")),await E(),p.value=!1}catch(s){if(s?.response?.status===422){const e=s.response.data?.errors||{};d.value=e;const l=Object.values(e)?.[0]?.[0]??"Please fix the highlighted fields and try again.";C.error(l)}else console.error(s),C.error("Something went wrong. Please try again.")}finally{k.value=!1}}W(async()=>{I.value=Date.now(),await J(),setTimeout(()=>{M.value=!0;const s=document.getElementById(R);s&&(s.value="",q.value="")},100),F(),await Promise.all([E(),O()])});function G(){w.value?c.value=[...L.value]:c.value=[]}return Q(c,s=>{const e=L.value.map(o=>o.id),l=s.map(o=>o.id);w.value=e.length>0&&l.length===e.length&&e.every(o=>l.includes(o))}),(s,e)=>(i(),n(_,null,[t("div",te,[t("div",{class:"card-header d-flex justify-content-between align-items-center"},[e[8]||(e[8]=t("div",null,[t("h5",{class:"mb-0"},"List of Roles"),t("small",{class:"text-muted"},"These are all the roles that this system uses.")],-1)),t("button",{class:"btn btn-primary btn-sm rounded-pill px-3 py-2",onClick:K},[...e[7]||(e[7]=[t("i",{class:"bi bi-plus-lg me-1"},null,-1),V("Add Role ",-1)])])]),t("ul",le,[(i(!0),n(_,null,A(S.value,l=>(i(),n("li",{key:l.id,class:"list-group-item d-flex justify-content-between align-items-center"},[t("div",oe,[t("div",ae,m(l.name),1),t("small",ne,m(l.permissions?.length||0)+" permission(s) ",1)]),t("button",{class:"p-2 rounded-full text-blue-600 hover:bg-blue-100",onClick:o=>X(l)},[Y(Z(se),{class:"w-4 h-4"})],8,ie)]))),128)),S.value.length===0?(i(),n("li",re," No roles ")):g("",!0)])]),p.value?(i(),n("div",de,[t("div",ue,[t("div",ce,[t("div",me,[t("h6",ve,m(f.value?"Edit Role":"Create Role"),1),t("button",{class:"absolute top-2 right-2 p-2 rounded-full hover:bg-gray-100 transition transform hover:scale-110",onClick:e[0]||(e[0]=l=>p.value=!1),"data-bs-dismiss":"modal","aria-label":"Close",title:"Close"},[...e[9]||(e[9]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),t("div",pe,[t("div",fe,[e[10]||(e[10]=t("label",{class:"form-label"},"Role Name",-1)),x(t("input",{"onUpdate:modelValue":e[1]||(e[1]=l=>b.value.name=l),class:ee(["form-control",{"is-invalid":d.value.name,"bg-danger bg-opacity-10":d.value.name}]),placeholder:"Admin"},null,2),[[$,b.value.name]]),d.value.name?(i(),n("div",be,m(d.value.name[0]),1)):g("",!0)]),t("div",he,[e[12]||(e[12]=t("label",{class:"form-label mb-0"},"Permissions",-1)),t("div",ge,[e[11]||(e[11]=t("input",{type:"email",name:"email",autocomplete:"email",style:{position:"absolute",left:"-9999px",width:"1px",height:"1px"},tabindex:"-1","aria-hidden":"true"},null,-1)),M.value?x((i(),n("input",{id:R,"onUpdate:modelValue":e[2]||(e[2]=l=>s.q=l),key:I.value,class:"form-control search-input",placeholder:"Search",type:"search",autocomplete:"new-password",name:R,role:"presentation",onFocus:e[3]||(e[3]=(...l)=>s.handleFocus&&s.handleFocus(...l))},null,32)),[[$,s.q]]):(i(),n("input",ye))])]),t("div",we,[x(t("input",{class:"form-check-input",type:"checkbox",id:"select-all","onUpdate:modelValue":e[4]||(e[4]=l=>w.value=l),onChange:G},null,544),[[j,w.value]]),e[13]||(e[13]=t("label",{class:"form-check-label fw-bold",for:"select-all"}," Select All Permissions ",-1))]),(i(!0),n(_,null,A(U.value,(l,o)=>(i(),n("div",{key:o,class:"mb-3"},[t("h6",ke,m(B(o)),1),t("div",_e,[(i(!0),n(_,null,A(l,u=>(i(),n("div",{key:u.id,class:"col-md-3 col-sm-6 mb-2"},[t("div",xe,[x(t("input",{class:"form-check-input",type:"checkbox",id:"perm-"+u.id,"onUpdate:modelValue":e[5]||(e[5]=a=>c.value=a),value:u},null,8,Ce),[[j,c.value]]),t("label",{class:"form-check-label",for:"perm-"+u.id},m(u.description||u.name),9,Pe)])]))),128))])]))),128)),d.value.permissions?(i(),n("small",Se,m(d.value.permissions[0]),1)):g("",!0)]),t("div",Re,[t("button",{class:"btn btn-primary rounded-pill px-2 py-2",disabled:k.value,onClick:z},[k.value?(i(),n("span",Ae)):g("",!0),e[14]||(e[14]=V(" Save ",-1))],8,Le),t("button",{class:"btn btn-secondary rounded-pill px-2 py-2",onClick:e[6]||(e[6]=l=>p.value=!1)}," Cancel ")])])])])):g("",!0)],64))}},$e=H(Me,[["__scopeId","data-v-76734784"]]);export{$e as default};
