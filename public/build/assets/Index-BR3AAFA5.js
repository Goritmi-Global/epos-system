import{_ as D,r as m,o as E,n as L,c as F,a as h,b as g,w as I,d as V,e as n,u as N,h as j,k as q,f as k,v as O,i as x,p as M,q as s}from"./app-DrUr72II.js";import{_ as R}from"./Master-BeW6Lctk.js";import{E as B,a as z,X as U,u as f,w as X}from"./xlsx-7aOw9oZM.js";import A from"./StockInLogs-D8u7HSVX.js";import Q from"./StockOutLogs-DnR2hE7C.js";import"./index-BLyqyTLg.js";import"./createLucideIcon-BENYThoS.js";import"./index-DMd6VC55.js";import"./index-DfwVUbck.js";import"./sun-pxRjjhfX.js";import"./useFormatters-DMzlbhVl.js";import"./pencil-Be4IWqC2.js";import"./eye-ByYm4Jhk.js";const G={class:"page-wrapper"},H={class:"card border-0 shadow-lg rounded-4"},K={class:"card-body p-4"},W={class:"d-flex align-items-center justify-content-between mb-3"},Y={class:"d-flex gap-2 align-items-center"},J={class:"search-wrap"},Z={key:1,class:"form-control search-input",placeholder:"Search",disabled:"",type:"text"},ee={class:"dropdown"},te={class:"dropdown-menu dropdown-menu-end shadow rounded-4 py-2"},oe={class:"tabs-underline mb-2"},ne={__name:"Index",setup(ae){const l=m([]),i=m(""),b=m(Date.now()),y=`search-${Math.random().toString(36).substr(2,9)}`,S=m(!1),d=m("stockin"),w=async()=>{try{const{data:t}=await M.get("stock_entries/stock-logs");l.value=t}catch(t){s.error("Failed to fetch logs",t)}};E(async()=>{i.value="",b.value=Date.now(),await L(),setTimeout(()=>{S.value=!0;const t=document.getElementById(y);t&&(t.value="",i.value="")},100),w()});const _=F(()=>{const t=i.value.trim().toLowerCase();return t?l.value.filter(e=>[e.itemName,e.category?.name||e.category||"",e.operationType,e.type,String(e.quantity),String(e.unitPrice),String(e.totalPrice),e.expiryDate??"",e.dateTime??""].join(" ").toLowerCase().includes(t)):l.value}),v=t=>{if(!l.value||l.value.length===0){s.error("No Allergies data to download");return}const e=i.value.trim()?_.value:l.value;if(e.length===0){s.error("No Logs Moment found to download");return}try{t==="pdf"?$(e):t==="excel"?P(e):t==="csv"?C(e):s.error("Invalid download type")}catch(r){console.error("Download failed:",r),s.error(`Download failed: ${r.message}`)}},C=t=>{try{const e=["Category","Supplier","Product","Quantity","Price","Value","Operation Type","Stock Type"],r=t.map(o=>[`"${(o.category?.name||o.category||"").toString().replace(/"/g,'""')}"`,`"${(o.supplier||"").toString().replace(/"/g,'""')}"`,`"${(o.itemName||"").toString().replace(/"/g,'""')}"`,`"${o.quantity??""}"`,`"${o.unitPrice??""}"`,`"${o.totalPrice??""}"`,`"${(o.operationType||"").toString().replace(/"/g,'""')}"`,`"${(o.type||"").toString().replace(/"/g,'""')}"`]),c=[e.join(","),...r.map(o=>o.join(","))].join(`
`),u=new Blob([c],{type:"text/csv;charset=utf-8;"}),p=URL.createObjectURL(u),a=document.createElement("a");a.setAttribute("href",p),a.setAttribute("download",`logs_moment_${new Date().toISOString().split("T")[0]}.csv`),document.body.appendChild(a),a.click(),document.body.removeChild(a),s.success("CSV downloaded successfully")}catch(e){console.error("CSV generation error:",e),s.error(`CSV generation failed: ${e.message}`,{autoClose:5e3})}},$=t=>{try{const e=new B("p","mm","a4");e.setFontSize(20),e.setFont("helvetica","bold"),e.text("Logs Moment Report",70,20),e.setFontSize(10),e.setFont("helvetica","normal");const r=new Date().toLocaleString();e.text(`Generated on: ${r}`,70,28),e.text(`Total Logs: ${t.length}`,70,34);const c=["Category","Supplier","Product","Quantity","Value","Price","Operation Type","Stock Type"],u=t.map(a=>[a.category?.name||a.category||"",a.supplier||"",a.itemName||"",a.quantity??"",a.unitPrice??"",a.totalPrice??"",a.operationType||"",a.type||""]);z(e,{head:[c],body:u,startY:40,styles:{fontSize:8,cellPadding:2,halign:"left",lineColor:[0,0,0],lineWidth:.1},headStyles:{fillColor:[41,128,185],textColor:255,fontStyle:"bold"},alternateRowStyles:{fillColor:[240,240,240]},margin:{left:14,right:14},didDrawPage:a=>{const o=e.internal.getNumberOfPages(),T=e.internal.pageSize.height;e.setFontSize(8),e.text(`Page ${a.pageNumber} of ${o}`,a.settings.margin.left,T-10)}});const p=`logs_moment_${new Date().toISOString().split("T")[0]}.pdf`;e.save(p),s.success("PDF downloaded successfully")}catch(e){console.error("PDF generation error:",e),s.error(`PDF generation failed: ${e.message}`,{autoClose:5e3})}},P=t=>{try{if(typeof U>"u")throw new Error("XLSX library is not loaded");const e=t.map(o=>({Category:o.category?.name||o.category||"",Supplier:o.supplier||"",Product:o.itemName||"",Quantity:o.quantity??"",Price:o.unitPrice??"",Value:o.totalPrice??"","Operation Type":o.operationType||"","Stock Type":o.type||""})),r=f.book_new(),c=f.json_to_sheet(e);c["!cols"]=[{wch:20},{wch:20},{wch:25},{wch:10},{wch:15},{wch:15},{wch:20},{wch:20}],f.book_append_sheet(r,c,"Logs Moments");const u=[{Info:"Generated On",Value:new Date().toLocaleString()},{Info:"Total Records",Value:t.length},{Info:"Exported By",Value:"Logs Management System"}],p=f.json_to_sheet(u);f.book_append_sheet(r,p,"Report Info");const a=`logs_moment_${new Date().toISOString().split("T")[0]}.xlsx`;X(r,a),s.success("Excel file downloaded successfully ",{autoClose:2500})}catch(e){console.error("Excel generation error:",e),s.error(`Excel generation failed: ${e.message}`,{autoClose:5e3})}};return(t,e)=>(g(),h(R,null,{default:I(()=>[V(N(j),{title:"Stock Logs"}),n("div",G,[n("div",H,[n("div",K,[n("div",W,[e[10]||(e[10]=n("h4",{class:"mb-0"},"Stock Moment Logs",-1)),n("div",Y,[n("div",J,[e[7]||(e[7]=n("i",{class:"bi bi-search"},null,-1)),e[8]||(e[8]=n("input",{type:"email",name:"email",autocomplete:"email",style:{position:"absolute",left:"-9999px",width:"1px",height:"1px"},tabindex:"-1","aria-hidden":"true"},null,-1)),S.value?q((g(),k("input",{id:y,"onUpdate:modelValue":e[0]||(e[0]=r=>i.value=r),key:b.value,class:"form-control search-input",placeholder:"Search",type:"search",autocomplete:"new-password",name:y,role:"presentation",onFocus:e[1]||(e[1]=(...r)=>t.handleFocus&&t.handleFocus(...r))},null,32)),[[O,i.value]]):(g(),k("input",Z))]),n("div",ee,[e[9]||(e[9]=n("button",{class:"btn btn-outline-secondary rounded-pill px-4 dropdown-toggle","data-bs-toggle":"dropdown"}," Export ",-1)),n("ul",te,[n("li",null,[n("a",{class:"dropdown-item py-2",href:"javascript:;",onClick:e[2]||(e[2]=r=>v("pdf"))}," Export as PDF ")]),n("li",null,[n("a",{class:"dropdown-item py-2",href:"javascript:;",onClick:e[3]||(e[3]=r=>v("excel"))}," Export as Excel ")]),n("li",null,[n("a",{class:"dropdown-item py-2",href:"javascript:;",onClick:e[4]||(e[4]=r=>v("csv"))}," Export as CSV ")])])])])]),n("div",oe,[n("button",{class:x(["tab-link fw-semibold",{active:d.value==="stockin"}]),onClick:e[5]||(e[5]=r=>d.value="stockin")}," Stock In ",2),n("button",{class:x(["tab-link fw-semibold",{active:d.value==="stockout"}]),onClick:e[6]||(e[6]=r=>d.value="stockout")}," Stock Out ",2)]),e[11]||(e[11]=n("div",{class:"border-bottom mb-3"},null,-1)),d.value==="stockin"?(g(),h(A,{key:0,logs:l.value,q:i.value,onUpdated:w},null,8,["logs","q"])):(g(),h(Q,{key:1,logs:l.value,q:i.value,onUpdated:w},null,8,["logs","q"]))])])])]),_:1}))}},ve=D(ne,[["__scopeId","data-v-1f32d74b"]]);export{ve as default};
