import{_ as se,A as ae,r as g,o as oe,n as le,c as B,E as ne,a as R,b as d,w as O,d as h,e as t,u as D,h as re,f as c,F as T,g as U,i as I,j as ie,t as p,k as A,v as z,l as N,m as E,C as de,p as x,q as l}from"./app-0e2Q59ss.js";import{_ as me}from"./Master-CsWhx78Y.js";import{E as ce,a as ue,X as pe,u as M,w as fe}from"./xlsx-C4phmbes.js";import{I as ve}from"./importFile-BPKukVxV.js";import{c as ge}from"./createLucideIcon-CXN2vx4G.js";import{P as he}from"./plus-BcDS-ny5.js";import{P as be}from"./pencil-ByNDZqw3.js";import{T as _e}from"./trash-2-DAWbBRSS.js";import"./index-YGNmCTvi.js";import"./index-C6cyPD58.js";import"./index-CCvZmP4b.js";import"./sun-DcuhbaMx.js";/**
 * @license lucide-vue-next v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=ge("utensils",[["path",{d:"M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2",key:"cjf0a3"}],["path",{d:"M7 2v20",key:"1473qp"}],["path",{d:"M21 15V2a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7",key:"j28e5"}]]),ye={class:"page-wrapper"},xe={class:"row g-3"},Me={class:"card border-0 shadow-sm rounded-4"},Ce={class:"card-body d-flex align-items-center"},Se={class:"mb-0 fw-bold"},ke={class:"text-muted mb-0 small"},De={class:"card border-0 shadow-lg rounded-4 mt-4"},Te={class:"card-body"},Ie={class:"d-flex flex-wrap gap-2 justify-content-between align-items-center mb-3"},Ee={class:"d-flex flex-wrap gap-2 align-items-center"},$e={class:"search-wrap"},Ve={key:1,class:"form-control search-input",placeholder:"Search",disabled:"",type:"text"},Fe={class:"dropdown"},Ne={class:"dropdown-menu dropdown-menu-end shadow rounded-4 py-2"},je={class:"table-responsive"},Le={class:"table table-striped"},Pe={class:"fw-semibold"},He={class:"text-center"},Be={class:"d-inline-flex align-items-center gap-3"},Re=["onClick"],Oe={title:"Delete",class:"p-2 rounded-full text-red-600 hover:bg-red-100"},Ue={key:0},Ae={class:"modal fade",id:"mealModal",tabindex:"-1","aria-hidden":"true"},ze={class:"modal-dialog modal-lg modal-dialog-centered"},Xe={class:"modal-content rounded-4"},qe={class:"modal-header"},Ge={class:"modal-title fw-semibold"},Ye={class:"modal-body"},Ke={class:"row g-3"},We={class:"col-12"},Ze={key:0,class:"text-danger"},Je={class:"col-md-6"},Qe={key:0,class:"text-danger"},et={class:"col-md-6"},tt={key:0,class:"text-danger"},st={class:"mt-4"},at=["disabled"],ot={__name:"Index",setup(lt){ae();const v=g([]),w=g(null),C=g(!1),m=g({}),S=async()=>{try{const s=await x.get("api/meals/all");v.value=s.data.data}catch(s){console.error("Failed to fetch meals:",s),l.error("Failed to load meals")}};oe(async()=>{b.value="",j.value=Date.now(),await le(),setTimeout(()=>{L.value=!0;const s=document.getElementById($);s&&(s.value="",b.value="")},100),S()});const X=B(()=>[{label:"Total Meals",value:v.value.length,icon:we,iconBg:"bg-light-primary",iconColor:"text-primary"}]),b=g(""),j=g(Date.now()),$=`search-${Math.random().toString(36).substr(2,9)}`,L=g(!1),q=s=>{s.target.value=b.value},V=B(()=>{const s=b.value.trim().toLowerCase();return s?v.value.filter(e=>e.name.toLowerCase().includes(s)):v.value}),u=g({name:"",start_time:"",end_time:""}),k=()=>{u.value={name:"",start_time:"",end_time:""},w.value=null,m.value={}},P=s=>{if(!s)return null;if(typeof s=="string"&&/^\d{2}:\d{2}$/.test(s))return s;const e=new Date(s),o=e.getHours().toString().padStart(2,"0"),a=e.getMinutes().toString().padStart(2,"0");return`${o}:${a}`},G=async()=>{C.value=!0,m.value={};const s={...u.value,start_time:P(u.value.start_time),end_time:P(u.value.end_time)};try{w.value?(await x.post(`/meals/${w.value.id}`,s),l.success("Meal updated successfully")):(await x.post("/meals",s),l.success("Meal created successfully")),bootstrap.Modal.getInstance(document.getElementById("mealModal"))?.hide(),k(),await S()}catch(e){if(console.error("❌ Error:",e.response?.data||e.message),e.response?.status===422&&e.response?.data?.errors){m.value=e.response.data.errors;const o=Object.values(e.response.data.errors).flat();l.error(o.join(`
`))}else{const o=e.response?.data?.message||"Failed to save meal";l.error(o)}}finally{C.value=!1}},Y=s=>{w.value=s,u.value={name:s.name,start_time:s.start_time,end_time:s.end_time};const e=document.getElementById("mealModal");new bootstrap.Modal(e).show()},K=async s=>{if(s?.id)try{await x.delete(`/meals/${s.id}`),l.success("Meal deleted successfully"),await S()}catch(e){console.error("❌ Delete error:",e.response?.data||e.message),l.error("Failed to delete meal")}},F=s=>{if(!v.value||v.value.length===0){l.error("No Meals data to download");return}const e=b.value.trim()?V.value:v.value;if(e.length===0){l.error("No Meals found to download");return}try{s==="pdf"?Z(e):s==="excel"?J(e):s==="csv"?W(e):l.error("Invalid download type")}catch(o){console.error("Download failed:",o),l.error(`Download failed: ${o.message}`)}},W=s=>{try{const e=["ID","Meal Name","Start Time","End Time"],o=s.map(i=>[`${i.id||""}`,`"${i.name||""}"`,`"${i.start_time||""}"`,`"${i.end_time||""}"`]),a=[e.join(","),...o.map(i=>i.join(","))].join(`
`),f=new Blob([a],{type:"text/csv;charset=utf-8;"}),_=URL.createObjectURL(f),r=document.createElement("a");r.setAttribute("href",_),r.setAttribute("download",`Meals_${new Date().toISOString().split("T")[0]}.csv`),document.body.appendChild(r),r.click(),document.body.removeChild(r),l.success("CSV downloaded successfully")}catch(e){console.error("CSV generation error:",e),l.error(`CSV generation failed: ${e.message}`,{autoClose:5e3})}},Z=s=>{try{const e=new ce("p","mm","a4");e.setFontSize(18),e.setFont("helvetica","bold"),e.text("Meals Report",14,20),e.setFontSize(10),e.setFont("helvetica","normal");const o=new Date().toLocaleString();e.text(`Generated on: ${o}`,14,28),e.text(`Total Meals: ${s.length}`,14,34);const a=["ID","Meal Name","Start Time","End Time"],f=s.map(r=>[r.id||"",r.name||"",r.start_time||"",r.end_time||""]);ue(e,{head:[a],body:f,startY:40,styles:{fontSize:9,cellPadding:2,halign:"left",lineColor:[0,0,0],lineWidth:.1},headStyles:{fillColor:[41,128,185],textColor:255,fontStyle:"bold"},alternateRowStyles:{fillColor:[245,245,245]},margin:{left:14,right:14},didDrawPage:r=>{const i=e.internal.getNumberOfPages(),H=e.internal.pageSize.height;e.setFontSize(8),e.text(`Page ${r.pageNumber} of ${i}`,r.settings.margin.left,H-10)}});const _=`Meals_${new Date().toISOString().split("T")[0]}.pdf`;e.save(_),l.success("PDF downloaded successfully")}catch(e){console.error("PDF generation error:",e),l.error(`PDF generation failed: ${e.message}`,{autoClose:5e3})}},J=s=>{try{if(typeof pe>"u")throw new Error("XLSX library is not loaded");const e=s.map(i=>({ID:i.id||"","Meal Name":i.name||"","Start Time":i.start_time||"","End Time":i.end_time||""})),o=M.book_new(),a=M.json_to_sheet(e);a["!cols"]=[{wch:8},{wch:25},{wch:15},{wch:15}],M.book_append_sheet(o,a,"Meals");const f=[{Info:"Report",Value:"Meals Export"},{Info:"Generated On",Value:new Date().toLocaleString()},{Info:"Total Records",Value:s.length},{Info:"Exported By",Value:"Inventory Management System"}],_=M.json_to_sheet(f);M.book_append_sheet(o,_,"Report Info");const r=`Meals_${new Date().toISOString().split("T")[0]}.xlsx`;fe(o,r),l.success("Excel file downloaded successfully",{autoClose:2500})}catch(e){console.error("Excel generation error:",e),l.error(`Excel generation failed: ${e.message}`,{autoClose:5e3})}},Q=["Meal Name","Start Time","End Time"],ee=[["Breakfast","06:00","10:00"],["Lunch","12:00","14:00"],["Dinner","18:00","21:00"]],te=s=>{if(!s||s.length<=1){l.error("The imported file is empty.");return}s[0];const o=s.slice(1).map(n=>({name:n[0]||"",start_time:n[1]||"",end_time:n[2]||""})).filter(n=>n.name.trim());if(o.length===0){l.error("No valid meals found in the file.");return}const a=o.map(n=>n.name.trim().toLowerCase()),f=a.filter((n,y)=>a.indexOf(n)!==y);if(f.length>0){l.error(`Duplicate meal names found in CSV: ${[...new Set(f)].join(", ")}`);return}const _=v.value.map(n=>n.name.trim().toLowerCase()),r=o.filter(n=>_.includes(n.name.trim().toLowerCase()));if(r.length>0){const n=r.map(y=>y.name).join(", ");l.error(`Meals already exist in the table: ${n}`);return}const i=/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/;if(o.filter(n=>!i.test(n.start_time)||!i.test(n.end_time)).length>0){l.error("Invalid time format. Times must be in HH:mm format (e.g., 09:30).");return}x.post("/api/meals/import",{meals:o}).then(()=>{l.success("Meals imported successfully"),S()}).catch(n=>{console.error("Import error:",n);const y=n.response?.data?.message||"Import failed";l.error(y)})};return(s,e)=>{const o=ne("VueDatePicker");return d(),R(me,null,{default:O(()=>[h(D(re),{title:"Meals"}),t("div",ye,[e[22]||(e[22]=t("h4",{class:"fw-semibold mb-3"},"Meal Management",-1)),t("div",xe,[(d(!0),c(T,null,U(X.value,a=>(d(),c("div",{key:a.label,class:"col-md-6 col-xl-3"},[t("div",Me,[t("div",Ce,[t("div",{class:I([[a.iconBg,a.iconColor],"rounded-circle p-3 d-flex align-items-center justify-content-center me-3"]),style:{width:"56px",height:"56px"}},[(d(),R(ie(a.icon),{class:"w-6 h-6"}))],2),t("div",null,[t("h3",Se,p(a.value),1),t("p",ke,p(a.label),1)])])])]))),128))]),t("div",De,[t("div",Te,[t("div",Ie,[e[12]||(e[12]=t("h5",{class:"mb-0 fw-semibold"},"Meals",-1)),t("div",Ee,[t("div",$e,[e[8]||(e[8]=t("i",{class:"bi bi-search"},null,-1)),e[9]||(e[9]=t("input",{type:"email",name:"email",autocomplete:"email",style:{position:"absolute",left:"-9999px",width:"1px",height:"1px"},tabindex:"-1","aria-hidden":"true"},null,-1)),L.value?A((d(),c("input",{id:$,"onUpdate:modelValue":e[0]||(e[0]=a=>b.value=a),key:j.value,class:"form-control search-input",placeholder:"Search",type:"search",autocomplete:"new-password",name:$,role:"presentation",onFocus:q},null,32)),[[z,b.value]]):(d(),c("input",Ve))]),t("button",{"data-bs-toggle":"modal","data-bs-target":"#mealModal",onClick:k,class:"d-flex align-items-center gap-1 px-4 py-2 rounded-pill btn btn-primary text-white"},[h(D(he),{class:"w-4 h-4"}),e[10]||(e[10]=N(" Add Meal ",-1))]),h(ve,{label:"Import Meals",sampleHeaders:Q,sampleData:ee,onOnImport:te}),t("div",Fe,[e[11]||(e[11]=t("button",{class:"btn btn-outline-secondary rounded-pill py-2 btn-sm px-4 dropdown-toggle","data-bs-toggle":"dropdown"}," Export ",-1)),t("ul",Ne,[t("li",null,[t("a",{class:"dropdown-item py-2",href:"javascript:;",onClick:e[1]||(e[1]=a=>F("pdf"))},"Export as PDF")]),t("li",null,[t("a",{class:"dropdown-item py-2",href:"javascript:;",onClick:e[2]||(e[2]=a=>F("excel"))},"Export as Excel")]),t("li",null,[t("a",{class:"dropdown-item py-2",href:"javascript:;",onClick:e[3]||(e[3]=a=>F("csv"))}," Export as CSV ")])])])])]),t("div",je,[t("table",Le,[e[14]||(e[14]=t("thead",{class:"border-top small text-muted"},[t("tr",null,[t("th",null,"Id"),t("th",null,"Name"),t("th",null,"Start Time"),t("th",null,"End Time"),t("th",{class:"text-center"},"Actions")])],-1)),t("tbody",null,[(d(!0),c(T,null,U(V.value,a=>(d(),c("tr",{key:a.id},[t("td",null,p(a.id),1),t("td",Pe,p(a.name),1),t("td",null,p(a.start_time),1),t("td",null,p(a.end_time),1),t("td",He,[t("div",Be,[t("button",{onClick:f=>Y(a),title:"Edit",class:"p-2 rounded-full text-blue-600 hover:bg-blue-100"},[h(D(be),{class:"w-4 h-4"})],8,Re),h(de,{title:"Confirm Delete",message:`Are you sure you want to delete ${a.name}?`,confirmText:"Yes, Delete",cancelText:"Cancel",onConfirm:f=>K(a)},{trigger:O(()=>[t("button",Oe,[h(D(_e),{class:"w-4 h-4"})])]),_:1},8,["message","onConfirm"])])])]))),128)),V.value.length===0?(d(),c("tr",Ue,[...e[13]||(e[13]=[t("td",{colspan:"5",class:"text-center text-muted py-4"}," No meals found. ",-1)])])):E("",!0)])])])])]),t("div",Ae,[t("div",ze,[t("div",Xe,[t("div",qe,[t("h5",Ge,p(w.value?"Edit Meal":"Add New Meal"),1),t("button",{class:"absolute top-2 right-2 p-2 rounded-full hover:bg-gray-100 transition transform hover:scale-110",onClick:k,"data-bs-dismiss":"modal","aria-label":"Close",title:"Close"},[...e[15]||(e[15]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),t("div",Ye,[t("div",Ke,[t("div",We,[e[16]||(e[16]=t("label",{class:"form-label"},"Meal Name",-1)),A(t("input",{"onUpdate:modelValue":e[4]||(e[4]=a=>u.value.name=a),type:"text",class:I(["form-control",{"is-invalid":m.value.name}]),placeholder:"Enter meal name"},null,2),[[z,u.value.name]]),m.value.name?(d(),c("small",Ze,p(m.value.name[0]),1)):E("",!0)]),t("div",Je,[e[17]||(e[17]=t("label",{class:"form-label"},"Start Time",-1)),h(o,{modelValue:u.value.start_time,"onUpdate:modelValue":e[5]||(e[5]=a=>u.value.start_time=a),"time-picker":"",format:"HH:mm","model-type":"HH:mm",placeholder:"Select start time",class:I({"is-invalid":m.value.start_time})},null,8,["modelValue","class"]),m.value.start_time?(d(),c("small",Qe,p(m.value.start_time[0]),1)):E("",!0)]),t("div",et,[e[18]||(e[18]=t("label",{class:"form-label"},"End Time",-1)),h(o,{modelValue:u.value.end_time,"onUpdate:modelValue":e[6]||(e[6]=a=>u.value.end_time=a),"time-picker":"",format:"HH:mm","model-type":"HH:mm",placeholder:"Select end time",class:I({"is-invalid":m.value.end_time})},null,8,["modelValue","class"]),m.value.end_time?(d(),c("small",tt,p(m.value.end_time[0]),1)):E("",!0)])]),e[21]||(e[21]=t("hr",{class:"my-4"},null,-1)),t("div",st,[t("button",{class:"btn btn-primary rounded-pill px-4",disabled:C.value,onClick:e[7]||(e[7]=a=>G())},[C.value?(d(),c(T,{key:0},[e[19]||(e[19]=t("span",{class:"spinner-border spinner-border-sm me-2"},null,-1)),e[20]||(e[20]=N(" Saving... ",-1))],64)):(d(),c(T,{key:1},[N(p(w.value?"Update":"Save"),1)],64))],8,at),t("button",{class:"btn btn-secondary rounded-pill px-4 ms-2","data-bs-dismiss":"modal",onClick:k}," Cancel ")])])])])])])]),_:1})}}},bt=se(ot,[["__scopeId","data-v-52caf244"]]);export{bt as default};
