import{_ as Ue,r as v,S as ae,c as me,w as ze,o as Xe,n as Ze,s as o,z as qe,I as Ye,E as Ge,a as le,b as d,d as k,e as g,f as t,u as f,h as He,p as S,g as m,F as B,i as oe,j as y,k as Ke,t as r,l as x,m as I,v as P,C as pe,P as We,q as $}from"./app-DwNPAkRi.js";import{_ as Je}from"./Master--p-90JeK.js";import{s as ve}from"./index-DDUWCXCg.js";import{u as Qe}from"./useFormatters-BrM-tJ83.js";import{s as et,a as tt,b as fe,c as st,d as ge}from"./index-BxhM9l6k.js";import{E as at,a as lt,X as ot,u as j,w as nt}from"./xlsx-A8KY7rFH.js";import{I as it}from"./importFile-CA_NMKY3.js";import{F as rt}from"./FilterModal-CcH5bko2.js";import{s as dt}from"./index-CKZidvl4.js";import{P as ut}from"./percent-CShvYaBQ.js";import{C as ct}from"./calendar-BkMCjCY6.js";import{C as mt}from"./circle-x-Cggs2UsA.js";import{P as pt}from"./plus-C2ryka42.js";import{P as vt}from"./pencil-Zp6s5WUr.js";import{T as ft}from"./trash-2-K3zJWZJD.js";import"./index-SM1eeh2q.js";import"./createLucideIcon-IoE8C8vO.js";import"./index-BsWRXlA_.js";import"./index-DDHekjA2.js";import"./sun-5Jk0idAQ.js";import"./index-qTzoPHZe.js";import"./index-BOSxYtLC.js";import"./index-DKYWs9Z5.js";import"./index-CVvDoA1i.js";const gt={class:"page-wrapper"},bt={class:"mt-3"},ht={class:"row g-3 mb-4"},yt={class:"card border-0 shadow-sm rounded-4"},_t={class:"card-body d-flex align-items-center"},xt={class:"mb-0 fw-bold"},Dt={class:"text-muted mb-0 small"},wt={class:"card border-0 shadow-lg rounded-4"},St={class:"card-body"},kt={class:"d-flex flex-wrap gap-2 justify-content-between align-items-center mb-3"},Ct={class:"d-flex flex-wrap gap-2 align-items-center"},$t={class:"search-wrap"},Mt={key:1,class:"form-control search-input",placeholder:"Search discounts",disabled:"",type:"text"},Ft={class:"table-responsive"},Tt={class:"table table-striped"},It={key:0},Pt={class:"fw-semibold"},Et={class:"text-center"},Vt={class:"text-center"},At={class:"d-inline-flex align-items-center gap-3"},Nt=["onClick"],Lt=["title"],Rt={title:"Delete",class:"p-2 rounded-full text-red-600 hover:bg-red-100"},Bt={key:1},jt={key:0,class:"mt-4 d-flex justify-content-between align-items-center"},Ot={class:"text-muted small"},Ut={class:"mt-3"},zt={class:"card border-0 shadow-sm rounded-4"},Xt={class:"card-body"},Zt={key:0,class:"text-center py-5"},qt={key:1,class:"text-center py-5"},Yt={key:2,class:"row g-3"},Gt={class:"card border border-warning rounded-4 h-100"},Ht={class:"card-body"},Kt={class:"d-flex justify-content-between align-items-start mb-3"},Wt={class:"fw-bold mb-1"},Jt={class:"text-end"},Qt={class:"h3 text-primary mb-0 fw-bold"},es={class:"mb-3"},ts={class:"d-flex align-items-center gap-2 mb-2"},ss={class:"text-muted"},as={class:"fw-semibold"},ls={class:"d-flex align-items-center gap-2 mb-2"},os={class:"text-muted"},ns={class:"mb-3"},is=["onUpdate:modelValue"],rs={class:"d-flex gap-2"},ds=["onClick","disabled"],us=["onClick","disabled"],cs={class:"modal fade",id:"discountModal",tabindex:"-1","aria-hidden":"true"},ms={class:"modal-dialog modal-lg modal-dialog-centered"},ps={class:"modal-content rounded-4"},vs={class:"modal-header"},fs={class:"modal-title fw-semibold"},gs={class:"modal-body"},bs={class:"row g-3"},hs={class:"col-12"},ys={key:0,class:"text-danger"},_s={class:"col-md-6"},xs={key:0,class:"text-danger"},Ds={class:"col-md-6"},ws={key:0,class:"text-danger"},Ss={class:"col-12"},ks={key:0,class:"text-danger"},Cs={class:"col-md-6"},$s={key:0,class:"text-danger"},Ms={class:"col-md-6"},Fs={key:0,class:"text-danger"},Ts={class:"col-md-6"},Is={key:0,class:"text-danger"},Ps={class:"col-md-6"},Es={key:0,class:"text-danger"},Vs={class:"col-12"},As={key:0,class:"text-danger"},Ns={class:"mt-4"},Ls=["disabled"],Rs={__name:"Index",setup(Bs){const{formatCurrencySymbol:E,dateFmt:_}=Qe(),C=v([]),V=v(null),O=v(!1),n=v({}),L=v([]),U=v(!1),z=ae({}),X=ae({});ae({});const A=v(null),ne=v(0),b=v({sortBy:"",stockStatus:"",category:"",priceMin:null,priceMax:null,dateFrom:null,dateTo:null}),N=v(1),H=v(10),K=v(0),Z=v([]),D=v(!1),W=v(null),be=[{label:"PDF",value:"pdf"},{label:"Excel",value:"excel"},{label:"CSV",value:"csv"}],he=a=>{a.value&&(Ae(a.value),W.value=null)},ye=[{label:"Percentage",value:"percent"}],_e=[{label:"Active",value:"active"},{label:"Deactive",value:"inactive"}],p=v({name:"",type:"percent",status:"active",start_date:"",end_date:"",min_purchase:0,max_discount:null,description:"",discount_amount:null}),F=v(""),ie=v(Date.now()),J=`search-${Math.random().toString(36).substr(2,9)}`,re=v(!1);me(()=>[{id:"flat",name:"Flat"},{id:"percent",name:"Percentage"}]);const q=v({sortBy:"",stockStatus:"",priceMin:null,priceMax:null,dateFrom:null,dateTo:null}),Q=v(!1),xe=a=>{b.value={...a},q.value={...a},N.value=1,Q.value=!0,T(1)},de=()=>{q.value={sortBy:"",stockStatus:"",category:"",priceMin:null,priceMax:null,dateFrom:null,dateTo:null},b.value={sortBy:"",stockStatus:"",category:"",priceMin:null,priceMax:null,dateFrom:null,dateTo:null},N.value=1},De=me(()=>[{label:"Total Discounts",value:C.value.length,icon:ut,iconBg:"bg-light-primary",iconColor:"text-primary"},{label:"Active Discounts",value:C.value.filter(a=>a.status==="active").length,icon:ct,iconBg:"bg-light-success",iconColor:"text-success"},{label:"Inactive Discounts",value:C.value.filter(a=>a.status==="inactive").length,icon:mt,iconBg:"bg-light-danger",iconColor:"text-danger"}]),T=async(a=1)=>{D.value=!0;try{const e=await $.get("/api/discounts/all",{params:{page:a,per_page:H.value,q:F.value.trim()||null,status:b.value.stockStatus||null,category:b.value.category||null,sort_by:b.value.sortBy||null,price_min:b.value.priceMin||null,price_max:b.value.priceMax||null,date_from:b.value.dateFrom?_(b.value.dateFrom):null,date_to:b.value.dateTo?_(b.value.dateTo):null}});C.value=e.data.data||[],e.data.pagination&&(N.value=e.data.pagination.current_page,K.value=e.data.pagination.total,Z.value=e.data.pagination.links)}catch(e){console.error("Failed to fetch discounts:",e),o.error("Failed to load discounts")}finally{D.value=!1}},we=a=>{if(!a||D.value)return;const u=new URLSearchParams(a.split("?")[1]).get("page");u&&T(parseInt(u))},Y=async(a=!1)=>{if(!(U.value&&!a)){a||(U.value=!0);try{const e=await $.get("/api/discount-approvals/pending");e.data.success&&(L.value=e.data.data)}catch(e){console.error("Error fetching pending requests:",e),a||o.error("Failed to load approval requests")}finally{a||(U.value=!1)}}},G=()=>{p.value={name:"",type:"percent",status:"active",start_date:"",end_date:"",min_purchase:0,max_discount:null,description:"",discount_amount:null},V.value=null,n.value={}},Se=a=>{V.value=a,p.value={name:a.name,type:a.type,status:a.status,start_date:a.start_date?new Date(a.start_date):null,end_date:a.end_date?new Date(a.end_date):null,min_purchase:a.min_purchase,max_discount:a.max_discount,description:a.description||"",discount_amount:a.discount_amount};const e=document.getElementById("discountModal");new bootstrap.Modal(e).show()},ke=async()=>{O.value=!0,n.value={};try{V.value?(await $.patch(`/discounts/${V.value.id}`,p.value),o.success("Discount updated successfully")):(await $.post("/discounts",p.value),o.success("Discount created successfully"));const a=document.getElementById("discountModal"),e=bootstrap.Modal.getInstance(a);e&&e.hide(),setTimeout(()=>{document.body.classList.remove("modal-open"),document.body.style.overflow="",document.body.style.paddingRight="",document.querySelectorAll(".modal-backdrop").forEach(s=>s.remove())},100),G(),await T()}catch(a){if(console.error("❌ Error:",a.response?.data||a.message),a.response?.status===422&&a.response?.data?.errors){n.value=a.response.data.errors;const e=Object.values(a.response.data.errors).flat();o.error(e.join(`
`))}else{const e=a.response?.data?.message||"Failed to save discount";o.error(e)}}finally{O.value=!1}setTimeout(()=>{document.querySelectorAll(".modal-backdrop").forEach(e=>e.remove()),document.body.classList.remove("modal-open"),document.body.style.overflow="",document.body.style.paddingRight=""},100)},Ce=["Discount Name","Type","Discount Percent","Start Date","End Date","Min Purchase","Max Discount","Status","Description"],$e=[["Summer Sale","flat","20","2025-06-01","2025-08-31","50","100","active","Summer discount on all items"],["Winter Sale","flat","10","2025-01-01","2025-12-31","30","","active","Flat 10 off on purchase"]];let ue=null;ze(F,()=>{clearTimeout(ue),ue=setTimeout(()=>{N.value=1,T(1)},500)});const Me=a=>{const e=l=>{if(!l)return"";if(!isNaN(l)&&Number(l)>3e4){const te=Number(l),R=new Date((te-25569)*86400*1e3),se=R.getFullYear(),je=String(R.getMonth()+1).padStart(2,"0"),Oe=String(R.getDate()).padStart(2,"0");return`${se}-${je}-${Oe}`}if(typeof l=="string"&&/^\d{4}-\d{2}-\d{2}$/.test(l))return l;const M=new Date(l);if(!isNaN(M.getTime())){const te=M.getFullYear(),R=String(M.getMonth()+1).padStart(2,"0"),se=String(M.getDate()).padStart(2,"0");return`${te}-${R}-${se}`}return""};if(!a||a.length<=1){o.error("The imported file is empty.");return}a[0];const s=a.slice(1).map(l=>({name:l[0]||"",type:l[1]||"percent",discount_amount:l[2]||"",start_date:e(l[3]),end_date:e(l[4]),min_purchase:l[5]||"0",max_discount:l[6]||null,status:l[7]||"active",description:l[8]||""})).filter(l=>l.name.trim());if(s.length===0){o.error("No valid discounts found in the file.");return}const h=s.map(l=>l.name.trim().toLowerCase()),w=h.filter((l,M)=>h.indexOf(l)!==M);if(w.length>0){o.error(`Duplicate discount names found: ${[...new Set(w)].join(", ")}`);return}const c=C.value.map(l=>l.name.trim().toLowerCase()),i=s.filter(l=>c.includes(l.name.trim().toLowerCase()));if(i.length>0){o.error(`Discounts already exist: ${i.map(l=>l.name).join(", ")}`);return}const ee=["flat","percent"];if(s.filter(l=>!ee.includes(l.type.toLowerCase())).length>0){o.error("Invalid type detected. Allowed: flat, percent");return}const Be=["active","inactive"];if(s.filter(l=>!Be.includes(l.status.toLowerCase())).length>0){o.error("Invalid status detected. Allowed: active, inactive");return}$.post("/api/discounts/import",{discounts:s}).then(()=>{o.success("Discounts imported successfully"),T()}).catch(l=>{const M=l.response?.data?.message||"Import failed";o.error(M)})},Fe=async a=>{const e=a.status==="active"?"inactive":"active";try{await $.patch(`/api/discounts/${a.id}/toggle-status`,{status:e}),a.status=e,o.success(`Discount status updated to ${e}`),ne.value++}catch(u){console.error("Failed to update status:",u),o.error("Failed to update status")}},Te=async a=>{try{await $.delete(`/discounts/${a.id}`),o.success("Discount deleted successfully"),await T()}catch(e){console.error("Failed to delete discount:",e),o.error("Failed to delete discount")}},ce=async(a,e)=>{z[a]=!0;try{(await $.post(`/api/discount-approvals/${a}/respond`,{status:e,approval_note:X[a]||null})).data.success&&(o.success(`Discount ${e} successfully!`),L.value=L.value.filter(s=>s.id!==a),delete X[a])}catch(u){console.error("Error responding to request:",u),o.error(u.response?.data?.message||`Failed to ${e} discount`)}finally{z[a]=!1}},Ie=a=>a?new Date(a).toLocaleString("en-GB",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-",Pe=()=>{A.value&&clearInterval(A.value),A.value=setInterval(()=>{Y(!0)},3e4)},Ee=()=>{A.value&&(clearInterval(A.value),A.value=null)};Xe(async()=>{F.value="",ie.value=Date.now(),await Ze(),setTimeout(()=>{re.value=!0;const u=document.getElementById(J);u&&(u.value="",F.value="")},100),await T(),await Y(),Pe(),window.Echo&&window.Echo.channel("discount-approvals").listen(".approval.requested",u=>{Y(!0),o.info("New discount approval request received!")});const a=document.getElementById("discountModal");a&&a.addEventListener("hidden.bs.modal",()=>{document.body.classList.remove("modal-open"),document.body.style.overflow="",document.querySelectorAll(".modal-backdrop").forEach(s=>s.remove())});const e=document.getElementById("discountsFilterModal");e&&e.addEventListener("hidden.bs.modal",()=>{Q.value||de(),Q.value=!1})}),qe(()=>{Ee()}),Ye(()=>window.feather?.replace());const Ve=async()=>{try{return D.value=!0,(await $.get("/api/discounts/all",{params:{export:"all",q:F.value.trim()||null,status:b.value.stockStatus||null,category:b.value.category||null,sort_by:b.value.sortBy||null,price_min:b.value.priceMin||null,price_max:b.value.priceMax||null,date_from:b.value.dateFrom||null,date_to:b.value.dateTo||null}})).data.data||[]}catch(a){return console.error("❌ Error fetching export data:",a),o.error("Failed to load data for export"),[]}finally{D.value=!1}},Ae=async a=>{if(!C.value||C.value.length===0){o.error("No Discounts data to download");return}try{D.value=!0;const e=await Ve();if(!e.length){o.error("No discounts found to download"),D.value=!1;return}a==="pdf"?Le(e):a==="excel"?Re(e):a==="csv"?Ne(e):o.error("Invalid download type")}catch(e){console.error("Download failed:",e),o.error(`Download failed: ${e.message}`)}finally{D.value=!1}},Ne=a=>{try{const e=["ID","Discount Name","Type","Discount Percent","Start Date","End Date","Min Purchase","Max Discount","Status","Description"],u=a.map(i=>[`${i.id||""}`,`"${i.name||""}"`,`"${i.type||""}"`,`${i.discount_amount||""}`,`"${_(i.start_date)||""}"`,`"${_(i.end_date)||""}"`,`${i.min_purchase||""}`,`${i.max_discount||""}`,`"${i.status||""}"`,`"${i.description||""}"`]),s=[e.join(","),...u.map(i=>i.join(","))].join(`
`),h=new Blob([s],{type:"text/csv;charset=utf-8;"}),w=URL.createObjectURL(h),c=document.createElement("a");c.setAttribute("href",w),c.setAttribute("download",`Discounts_${new Date().toISOString().split("T")[0]}.csv`),document.body.appendChild(c),c.click(),document.body.removeChild(c),o.success("CSV downloaded successfully")}catch(e){console.error("CSV generation error:",e),o.error(`CSV generation failed: ${e.message}`)}},Le=a=>{try{const e=new at("l","mm","a4");e.setFontSize(18),e.setFont("helvetica","bold"),e.text("Discounts Report",14,20),e.setFontSize(10),e.setFont("helvetica","normal");const u=new Date().toLocaleString();e.text(`Generated on: ${u}`,14,28),e.text(`Total Discounts: ${a.length}`,14,34);const s=["ID","Name","Type","Amount","Start Date","End Date","Min Purchase","Max Discount","Status"],h=a.map(c=>[c.id||"",c.name||"",c.type==="flat"?"Flat":"Percent",c.type==="flat"?E(c.discount_amount):c.discount_amount+"%",_(c.start_date)||"",_(c.end_date)||"",E(c.min_purchase)||"",c.max_discount?E(c.max_discount):"N/A",c.status==="active"?"Active":"Inactive"]);lt(e,{head:[s],body:h,startY:40,styles:{fontSize:8,cellPadding:2,halign:"left",lineColor:[0,0,0],lineWidth:.1},headStyles:{fillColor:[41,128,185],textColor:255,fontStyle:"bold"},alternateRowStyles:{fillColor:[245,245,245]},margin:{left:14,right:14},didDrawPage:c=>{const i=e.internal.getNumberOfPages(),ee=e.internal.pageSize.height;e.setFontSize(8),e.text(`Page ${c.pageNumber} of ${i}`,c.settings.margin.left,ee-10)}});const w=`Discounts_${new Date().toISOString().split("T")[0]}.pdf`;e.save(w),o.success("PDF downloaded successfully")}catch(e){console.error("PDF generation error:",e),o.error(`PDF generation failed: ${e.message}`)}},Re=a=>{try{if(typeof ot>"u")throw new Error("XLSX library is not loaded");const e=a.map(i=>({ID:i.id||"","Discount Name":i.name||"",Type:i.type==="flat"?"Flat":"Percent","Discount Percent":i.type==="flat"?i.discount_amount:i.discount_amount+"%","Start Date":_(i.start_date)||"","End Date":_(i.end_date)||"","Min Purchase":i.min_purchase||"","Max Discount":i.max_discount||"",Status:i.status==="active"?"Active":"Inactive",Description:i.description||""})),u=j.book_new(),s=j.json_to_sheet(e);s["!cols"]=[{wch:8},{wch:25},{wch:12},{wch:15},{wch:15},{wch:15},{wch:15},{wch:15},{wch:12},{wch:30}],j.book_append_sheet(u,s,"Discounts");const h=[{Info:"Report",Value:"Discounts Export"},{Info:"Generated On",Value:new Date().toLocaleString()},{Info:"Total Records",Value:a.length},{Info:"Exported By",Value:"Inventory Management System"}],w=j.json_to_sheet(h);j.book_append_sheet(u,w,"Report Info");const c=`Discounts_${new Date().toISOString().split("T")[0]}.xlsx`;nt(u,c),o.success("Excel file downloaded successfully")}catch(e){console.error("Excel generation error:",e),o.error(`Excel generation failed: ${e.message}`)}};return(a,e)=>{const u=Ge("VueDatePicker");return d(),le(Je,null,{default:k(()=>[g(f(He),{title:"Discount Management"}),t("div",gt,[e[47]||(e[47]=t("h4",{class:"fw-semibold mb-3"},"Discount Management",-1)),g(f(et),{value:"0",class:"w-100"},{default:k(()=>[g(f(tt),null,{default:k(()=>[g(f(fe),{value:"0"},{default:k(()=>[...e[13]||(e[13]=[S("Discounts",-1)])]),_:1}),g(f(fe),{value:"1"},{default:k(()=>[...e[14]||(e[14]=[S("Discount Approvals",-1)])]),_:1})]),_:1}),g(f(st),null,{default:k(()=>[g(f(ge),{value:"0"},{default:k(()=>[t("div",bt,[t("div",ht,[(d(!0),m(B,null,oe(De.value,s=>(d(),m("div",{key:s.label,class:"col-md-6 col-xl-3"},[t("div",yt,[t("div",_t,[t("div",{class:y([[s.iconBg,s.iconColor],"rounded-circle p-3 d-flex align-items-center justify-content-center me-3"]),style:{width:"56px",height:"56px"}},[(d(),le(Ke(s.icon),{class:"w-6 h-6"}))],2),t("div",null,[t("h3",xt,r(s.value),1),t("p",Dt,r(s.label),1)])])])]))),128))]),t("div",wt,[t("div",St,[t("div",kt,[e[18]||(e[18]=t("h5",{class:"mb-0 fw-semibold"},"Discounts",-1)),t("div",Ct,[t("div",$t,[e[15]||(e[15]=t("i",{class:"bi bi-search"},null,-1)),e[16]||(e[16]=t("input",{type:"email",name:"email",autocomplete:"email",style:{position:"absolute",left:"-9999px",width:"1px",height:"1px"},tabindex:"-1","aria-hidden":"true"},null,-1)),re.value?I((d(),m("input",{id:J,"onUpdate:modelValue":e[0]||(e[0]=s=>F.value=s),key:ie.value,class:"form-control search-input",placeholder:"Search discounts",type:"search",autocomplete:"new-password",name:J,role:"presentation"})),[[P,F.value]]):(d(),m("input",Mt))]),g(rt,{modelValue:q.value,"onUpdate:modelValue":e[1]||(e[1]=s=>q.value=s),title:"Discounts",modalId:"discountsFilterModal",modalSize:"modal-lg",sortOptions:[{value:"name_asc",label:"Name: A to Z"},{value:"name_desc",label:"Name: Z to A"}],showStockStatus:!1,categoryLabel:"Discount Type",statusLabel:"Discount Status",showPriceRange:!0,priceRangeLabel:"Discount Percent Range",showDateRange:!0,onApply:xe,onClear:de},null,8,["modelValue"]),t("button",{"data-bs-toggle":"modal","data-bs-target":"#discountModal",onClick:G,class:"d-flex align-items-center gap-1 px-4 py-2 rounded-pill btn btn-primary text-white"},[g(f(pt),{class:"w-4 h-4"}),e[17]||(e[17]=S(" Add Discount ",-1))]),g(it,{label:"Import Discounts",sampleHeaders:Ce,sampleData:$e,onOnImport:Me}),g(f(dt),{modelValue:W.value,"onUpdate:modelValue":e[2]||(e[2]=s=>W.value=s),options:be,optionLabel:"label",optionValue:"value",placeholder:"Export",class:"export-dropdown",onChange:he},null,8,["modelValue"])])]),t("div",Ft,[t("table",Tt,[e[21]||(e[21]=t("thead",{class:"border-top small text-muted"},[t("tr",null,[t("th",null,"S.#"),t("th",null,"Name"),t("th",null,"Type"),t("th",null,"Discount (%)"),t("th",null,"Start Date"),t("th",null,"End Date"),t("th",null,"Min Purchase"),t("th",null,"Max Discount"),t("th",{class:"text-center"},"Status"),t("th",{class:"text-center"},"Action")])],-1)),t("tbody",null,[D.value?(d(),m("tr",It,[...e[19]||(e[19]=[t("td",{colspan:"10",class:"text-center py-4"},[t("div",{class:"spinner-border text-primary",role:"status"},[t("span",{class:"visually-hidden"},"Loading...")])],-1)])])):x("",!0),(d(!0),m(B,null,oe(C.value,(s,h)=>(d(),m("tr",{key:s.id},[t("td",null,r(h+1),1),t("td",Pt,r(s.name),1),t("td",null,[t("span",{class:y(s.type==="flat"?"badge bg-primary px-4 py-2 rounded-pill":"badge bg-warning px-4 py-2 rounded-pill")},r(s.type==="flat"?"Flat":"Percent"),3)]),t("td",null,r(s.type==="flat"?f(E)(s.discount_amount):s.discount_amount+"%"),1),t("td",null,r(f(_)(s.start_date)),1),t("td",null,r(f(_)(s.end_date)),1),t("td",null,r(f(E)(s.min_purchase)),1),t("td",null,r(s.max_discount?f(E)(s.max_discount):"N/A"),1),t("td",Et,[t("span",{class:y(s.status==="active"?"badge bg-success px-4 py-2 rounded-pill":"badge bg-danger px-4 py-2 rounded-pill")},r(s.status==="active"?"Active":"Inactive"),3)]),t("td",Vt,[t("div",At,[t("button",{onClick:w=>Se(s),title:"Edit",class:"p-2 rounded-full text-blue-600 hover:bg-blue-100"},[g(f(vt),{class:"w-4 h-4"})],8,Nt),(d(),le(pe,{key:`confirm-${s.id}-${ne.value}`,title:"Confirm Status Change",message:`Are you sure you want to set ${s.name} to ${s.status==="active"?"Inactive":"Active"}?`,showStatusButton:!0,confirmText:"Yes, Change",cancelText:"Cancel",status:s.status,onConfirm:w=>Fe(s)},{trigger:k(()=>[t("button",{class:y(["relative inline-flex items-center w-8 h-4 rounded-full transition-colors duration-300 focus:outline-none",s.status==="active"?"bg-green-500 hover:bg-green-600":"bg-red-400 hover:bg-red-500"]),title:s.status==="active"?"Set Inactive":"Set Active"},[t("span",{class:y(["absolute left-0.5 top-0.5 w-3 h-3 bg-white rounded-full shadow transform transition-transform duration-300",s.status==="active"?"translate-x-4":"translate-x-0"])},null,2)],10,Lt)]),_:2},1032,["message","status","onConfirm"])),g(pe,{title:"Confirm Delete",message:`Are you sure you want to delete ${s.name}? This action cannot be undone.`,confirmText:"Yes, Delete",cancelText:"Cancel",onConfirm:w=>Te(s)},{trigger:k(()=>[t("button",Rt,[g(f(ft),{class:"w-4 h-4"})])]),_:1},8,["message","onConfirm"])])])]))),128)),!D.value&&C.value.length===0?(d(),m("tr",Bt,[...e[20]||(e[20]=[t("td",{colspan:"10",class:"text-center text-muted py-4"}," No discounts found. ",-1)])])):x("",!0)])])]),Z.value&&Z.value.length>0&&!D.value?(d(),m("div",jt,[t("div",Ot," Showing "+r((N.value-1)*H.value+1)+" to "+r(Math.min(N.value*H.value,K.value))+" of "+r(K.value)+" entries ",1),g(We,{pagination:Z.value,isApiDriven:!0,onPageChanged:we},null,8,["pagination"])])):x("",!0)])])])]),_:1}),g(f(ge),{value:"1"},{default:k(()=>[t("div",Ut,[t("div",zt,[t("div",{class:"card-header bg-white border-0 d-flex justify-content-between align-items-center py-3"},[e[23]||(e[23]=t("h4",{class:"mb-0 fw-bold"},[t("i",{class:"bi bi-shield-check text-primary me-2"}),S(" Discount Approval Requests ")],-1)),t("button",{class:"btn btn-outline-primary btn-sm",onClick:Y},[...e[22]||(e[22]=[t("i",{class:"bi bi-arrow-clockwise me-1"},null,-1),S(" Refresh ",-1)])])]),t("div",Xt,[U.value?(d(),m("div",Zt,[...e[24]||(e[24]=[t("div",{class:"spinner-border text-primary",role:"status"},[t("span",{class:"visually-hidden"},"Loading...")],-1),t("p",{class:"mt-3 text-muted"},"Loading approval requests...",-1)])])):L.value.length===0?(d(),m("div",qt,[...e[25]||(e[25]=[t("i",{class:"bi bi-inbox",style:{"font-size":"4rem",opacity:"0.3"}},null,-1),t("p",{class:"mt-3 text-muted fw-semibold"},"No pending discount approval requests",-1)])])):(d(),m("div",Yt,[(d(!0),m(B,null,oe(L.value,s=>(d(),m("div",{key:s.id,class:"col-md-4"},[t("div",Gt,[t("div",Ht,[t("div",Kt,[t("div",null,[t("h5",Wt,r(s.discount_name||s.discount.name),1),e[26]||(e[26]=t("span",{class:"badge bg-warning"},[t("i",{class:"bi bi-clock-history me-1"}),S(" Pending Approval ")],-1))]),t("div",Jt,[t("div",Qt,r(parseFloat(s.discount_percentage).toFixed(0))+"% ",1),e[27]||(e[27]=t("small",{class:"text-muted d-block"},"Discount Rate",-1))])]),t("div",es,[t("div",ts,[e[29]||(e[29]=t("i",{class:"bi bi-person-circle text-muted"},null,-1)),t("small",ss,[e[28]||(e[28]=S(" Requested by: ",-1)),t("span",as,r(s.requested_by.name),1)])]),t("div",ls,[e[30]||(e[30]=t("i",{class:"bi bi-clock text-muted"},null,-1)),t("small",os,r(Ie(s.requested_at)),1)])]),t("div",ns,[e[31]||(e[31]=t("label",{class:"form-label small fw-semibold"},"Response Note (Optional)",-1)),I(t("textarea",{"onUpdate:modelValue":h=>X[s.id]=h,class:"form-control form-control-sm",rows:"2",placeholder:"Add a note for the cashier..."},null,8,is),[[P,X[s.id]]])]),t("div",rs,[t("button",{class:"btn btn-success flex-fill",onClick:h=>ce(s.id,"approved"),disabled:z[s.id]},[...e[32]||(e[32]=[t("i",{class:"bi bi-check-circle me-1"},null,-1),S(" Approve ",-1)])],8,ds),t("button",{class:"btn btn-danger flex-fill",onClick:h=>ce(s.id,"rejected"),disabled:z[s.id]},[...e[33]||(e[33]=[t("i",{class:"bi bi-x-circle me-1"},null,-1),S(" Reject ",-1)])],8,us)])])])]))),128))]))])])])]),_:1})]),_:1})]),_:1}),t("div",cs,[t("div",ms,[t("div",ps,[t("div",vs,[t("h5",fs,r(V.value?"Edit Discount":"Add New Discount"),1),t("button",{class:"absolute top-2 right-2 p-2 rounded-full hover:bg-gray-100 transition transform hover:scale-110",onClick:G,"data-bs-dismiss":"modal","aria-label":"Close",title:"Close"},[...e[34]||(e[34]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),t("div",gs,[t("div",bs,[t("div",hs,[e[35]||(e[35]=t("label",{class:"form-label"},"Discount Name *",-1)),I(t("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>p.value.name=s),type:"text",class:y(["form-control",{"is-invalid":n.value.name}]),placeholder:"Enter discount name"},null,2),[[P,p.value.name]]),n.value.name?(d(),m("small",ys,r(n.value.name[0]),1)):x("",!0)]),t("div",_s,[e[36]||(e[36]=t("label",{class:"form-label"},"Discount Type *",-1)),g(f(ve),{modelValue:p.value.type,"onUpdate:modelValue":e[4]||(e[4]=s=>p.value.type=s),options:ye,optionLabel:"label",appendTo:"self",autoZIndex:!0,baseZIndex:2e3,optionValue:"value",class:y(["form-select",{"is-invalid":n.value.type}])},null,8,["modelValue","class"]),n.value.type?(d(),m("small",xs,r(n.value.type[0]),1)):x("",!0)]),t("div",Ds,[e[37]||(e[37]=t("label",{class:"form-label"},"Status *",-1)),g(f(ve),{modelValue:p.value.status,"onUpdate:modelValue":e[5]||(e[5]=s=>p.value.status=s),options:_e,optionLabel:"label",optionValue:"value",class:y(["form-select",{"is-invalid":n.value.status}]),appendTo:"self",autoZIndex:!0,baseZIndex:2e3},null,8,["modelValue","class"]),n.value.status?(d(),m("small",ws,r(n.value.status[0]),1)):x("",!0)]),t("div",Ss,[e[38]||(e[38]=t("label",{class:"form-label"},"Discount Percent *",-1)),I(t("input",{"onUpdate:modelValue":e[6]||(e[6]=s=>p.value.discount_amount=s),type:"number",class:y(["form-control",{"is-invalid":n.value.discount_amount}]),placeholder:"Enter discount amount"},null,2),[[P,p.value.discount_amount]]),n.value.discount_amount?(d(),m("small",ks,r(n.value.discount_amount[0]),1)):x("",!0)]),t("div",Cs,[e[39]||(e[39]=t("label",{class:"form-label"},"Start Date *",-1)),g(u,{modelValue:p.value.start_date,"onUpdate:modelValue":e[7]||(e[7]=s=>p.value.start_date=s),format:f(_),"min-date":new Date,enableTimePicker:!1,placeholder:"Select start date",class:y({"is-invalid":n.value.start_date})},null,8,["modelValue","format","min-date","class"]),n.value.start_date?(d(),m("small",$s,r(n.value.start_date[0]),1)):x("",!0)]),t("div",Ms,[e[40]||(e[40]=t("label",{class:"form-label"},"End Date *",-1)),g(u,{modelValue:p.value.end_date,"onUpdate:modelValue":e[8]||(e[8]=s=>p.value.end_date=s),format:f(_),"min-date":new Date,enableTimePicker:!1,placeholder:"Select end date",class:y({"is-invalid":n.value.end_date})},null,8,["modelValue","format","min-date","class"]),n.value.end_date?(d(),m("small",Fs,r(n.value.end_date[0]),1)):x("",!0)]),t("div",Ts,[e[41]||(e[41]=t("label",{class:"form-label"},"Minimum Purchase Amount *",-1)),I(t("input",{"onUpdate:modelValue":e[9]||(e[9]=s=>p.value.min_purchase=s),type:"number",step:"0.01",class:y(["form-control",{"is-invalid":n.value.min_purchase}]),placeholder:"0.00"},null,2),[[P,p.value.min_purchase]]),n.value.min_purchase?(d(),m("small",Is,r(n.value.min_purchase[0]),1)):x("",!0)]),t("div",Ps,[e[42]||(e[42]=t("label",{class:"form-label"},"Maximum Discount (Optional)",-1)),I(t("input",{"onUpdate:modelValue":e[10]||(e[10]=s=>p.value.max_discount=s),type:"number",step:"0.01",class:y(["form-control",{"is-invalid":n.value.max_discount}]),placeholder:"0.00"},null,2),[[P,p.value.max_discount]]),n.value.max_discount?(d(),m("small",Es,r(n.value.max_discount[0]),1)):x("",!0)]),t("div",Vs,[e[43]||(e[43]=t("label",{class:"form-label"},"Description (Optional)",-1)),I(t("textarea",{"onUpdate:modelValue":e[11]||(e[11]=s=>p.value.description=s),class:y(["form-control",{"is-invalid":n.value.description}]),rows:"3",placeholder:"Enter discount description"},null,2),[[P,p.value.description]]),n.value.description?(d(),m("small",As,r(n.value.description[0]),1)):x("",!0)])]),e[46]||(e[46]=t("hr",{class:"my-4"},null,-1)),t("div",Ns,[t("button",{class:"btn btn-primary rounded-pill px-4",disabled:O.value,onClick:e[12]||(e[12]=s=>ke())},[O.value?(d(),m(B,{key:0},[e[44]||(e[44]=t("span",{class:"spinner-border spinner-border-sm me-2"},null,-1)),e[45]||(e[45]=S(" Saving... ",-1))],64)):(d(),m(B,{key:1},[S(r((V.value,"Save")),1)],64))],8,Ls),t("button",{class:"btn btn-secondary rounded-pill px-4 ms-2","data-bs-dismiss":"modal",onClick:G}," Cancel ")])])])])])])]),_:1})}}},ma=Ue(Rs,[["__scopeId","data-v-aaea4a2a"]]);export{ma as default};
