import{_ as xe,r as h,c as $,o as te,n as we,y as ke,I as Se,E as Ce,a as se,b as l,w as Pe,d as C,e as t,u as b,h as Fe,f as n,m as y,l as O,k as T,v as V,F as H,g as oe,t as r,i as W,S as De,p as P,q as g}from"./app-D-YzN2ok.js";import{_ as Ie}from"./Master-B28PiV-m.js";import{E as ae,a as le,u as N,w as $e}from"./xlsx-2kOoNY3L.js";import Oe from"./PurchaseComponent-Ds6pG0gZ.js";import Te from"./OrderComponent-Br77Z1fa.js";import{u as Ve}from"./useFormatters-D-TQAFLH.js";import Ne from"./BulkOrderComponent-Ca7_q2IS.js";import{E as Ee}from"./eye-wTOBuO9v.js";import{T as Ue}from"./trash-2-C2xTAE8l.js";import"./index-FBFJ_l7P.js";import"./createLucideIcon-B1iVNSJd.js";import"./index-JeGzdq1B.js";import"./index-hYTvP8Gd.js";import"./sun-CAhJqo6U.js";import"./index-C1Mw7Q2u.js";import"./index-guDPXv2p.js";import"./index-BdxHpibr.js";const Ae={class:"page-wrapper"},Me={class:"card border-0 shadow-lg rounded-4"},je={class:"card-body p-4"},ze={class:"d-flex align-items-center justify-content-between mb-3"},Be={class:"d-flex align-items-center gap-2"},Re={class:"position-relative"},qe={key:0,class:"help-popover shadow-lg rounded-3 p-3 bg-white border position-absolute",style:{width:"300px",right:"0","z-index":"999"}},Le={class:"d-flex gap-2 align-items-center"},Ge={class:"search-wrap me-1"},Ye={key:1,class:"form-control search-input",placeholder:"Search",disabled:"",type:"text"},He={class:"dropdown"},We={class:"dropdown-menu dropdown-menu-end shadow rounded-4 py-2"},Qe={class:"table-responsive"},Ke={class:"table table-striped"},Xe={key:0},Je={class:"text-nowrap"},Ze={class:"small text-muted"},et={class:"text-start"},tt={class:"text-end"},st={class:"d-flex gap-2 justify-content-end"},ot=["onClick"],at=["onClick","disabled"],lt={key:0},nt={colspan:"6",class:"text-center text-muted py-4"},rt={key:0,class:"mt-4 d-flex justify-content-between align-items-center"},it={class:"text-muted small"},dt={class:"modal fade",id:"orderDetailsModal",tabindex:"-1","aria-hidden":"true"},ut={class:"modal-dialog modal-xl modal-dialog-centered"},ct={class:"modal-content rounded-4 shadow-lg border-0"},pt={class:"modal-header align-items-center"},mt={class:"d-flex align-items-center gap-2"},vt={class:"d-flex flex-column"},ht={class:"modal-title mb-0"},gt={class:"text-muted"},bt={key:0,class:"modal-body p-4 bg-light"},yt={class:"row g-3"},ft={class:"col-md-6"},_t={class:"fw-semibold"},xt={class:"col-md-6"},wt={class:"col-md-6"},kt={class:"fw-semibold"},St={class:"fw-semibold mb-3"},Ct={class:"table-responsive"},Pt={class:"table table-bordered align-middle"},Ft={class:"table-light"},Dt={key:0},It={key:0},$t=["onUpdate:modelValue"],Ot={key:0},Tt=["onUpdate:modelValue","onInput"],Vt={key:0},Nt=["onUpdate:modelValue","onInput"],Et={key:0},Ut=["onUpdate:modelValue"],At={key:0},Mt={key:2,class:"text-danger"},jt={key:0},zt=["onClick"],Bt={key:0},Rt=["colspan"],qt={class:"footer"},Lt={class:"fw-bold"},Gt={key:0,class:"alert alert-info mt-3"},Yt={key:1,class:"modal-footer"},Ht=["disabled"],Wt={key:0},Qt={key:1},Kt={__name:"Index",setup(Xt){const{formatCurrencySymbol:F,dateFmt:z}=Ve(),B=(o,e="GBP")=>new Intl.NumberFormat("en-GB",{style:"currency",currency:e}).format(Number(o||0)),x=h(""),Q=h(Date.now()),R=`search-${Math.random().toString(36).substr(2,9)}`,K=h(!1),D=o=>new Date(o).toLocaleString("en-GB",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0}),q=o=>Math.round((Number(o)||0)*100)/100,E=h(!1),U=h([]),ne=async()=>{const o=await P.get("/api/suppliers/pluck");U.value=o.data},L=h([]),G=h(""),re=async()=>{try{const o=await P.get("/inventory/api-inventories");L.value=o.data.data}catch(o){console.error("Error fetching inventory:",o)}},A=$(()=>{const o=G.value.trim().toLowerCase();return o?L.value.filter(e=>[e.name,e.category??"",e.subcategory??"",String(e.stock??"")].join(" ").toLowerCase().includes(o)):L.value});console.log("p_filteredInv",A);const X=$(()=>{const o=G.value.trim().toLowerCase();return o?I.value.filter(e=>[e.supplier??"",e.status??"",String(e.total??""),D(e.purchasedAt)??""].join(" ").toLowerCase().includes(o)):I.value});te(async()=>{x.value="",Q.value=Date.now(),await we(),setTimeout(()=>{K.value=!0;const o=document.getElementById(R);o&&(o.value="",x.value="")},100),re(),ne()});const M=h(!1),m=h({data:[],current_page:1,last_page:1,per_page:10,total:0,from:0,to:0,links:[]}),I=$(()=>m.value.data||[]),ie=$(()=>({current_page:m.value.current_page,last_page:m.value.last_page,per_page:m.value.per_page,total:m.value.total}));$(()=>m.value.links||[]);const _=async(o=null)=>{M.value=!0;try{const{data:e}=await P.get("/api/purchase-orders/fetch-orders",{params:{q:x.value,page:o||m.value.current_page,per_page:m.value.per_page}});m.value={data:e.data||[],current_page:e.current_page,last_page:e.last_page,per_page:e.per_page,total:e.total,from:e.from,to:e.to,links:e.links}}catch(e){console.error("Failed to fetch purchase orders:",e),g.error("Failed to load purchase orders")}finally{M.value=!1}},de=o=>{if(!o)return;const a=new URLSearchParams(o.split("?")[1]).get("page");a&&_(parseInt(a))},v=h(null),w=h([]),u=h(!1),k=h({}),ue=()=>{k.value={}},j=h(!1);h(!1);let J=null;ke(x,()=>{clearTimeout(J),J=setTimeout(()=>{m.value.current_page=1,_(1)},500)});async function ce(o){try{const e=await P.get(`/purchase-orders/${o.id}`);v.value=e.data,console.log("selectedOrder.value",v.value),o.status==="pending"?(u.value=!0,w.value=v.value.items.map(s=>({id:s.id,product_id:s.product_id,name:s.product?.name||"Unknown",quantity:s.quantity,unit_price:s.unit_price,expiry:s.expiry||"",sub_total:s.sub_total}))):u.value=!1,new bootstrap.Modal(document.getElementById("orderDetailsModal")).show()}catch(e){console.error(e),g.error("Failed to load order details")}}async function pe(){if(v.value){j.value=!0;try{const o={status:"completed",items:w.value.map(a=>({purchase_id:v.value.id,product_id:a.product_id,qty:a.quantity,unit_price:a.unit_price,expiry:a.expiry||null}))};await P.put(`/purchase-orders/${v.value.id}`,o),bootstrap.Modal.getInstance(document.getElementById("orderDetailsModal"))?.hide(),k.value={},await _(),await _(ie.value.current_page),g.success("Order updated successfully and stock entries created!")}catch(o){if(o.response?.status===422&&o.response?.data?.errors){k.value=o.response.data.errors;const e=Object.values(k.value).flat().join(`
`);g.error(e)}else console.error("Error updating order:",o),g.error("Failed to update order")}finally{j.value=!1}}}function Z(o){const e=parseFloat(o.quantity)||0,a=parseFloat(o.unit_price)||0;o.sub_total=(e*a).toFixed(2)}const Y=o=>{switch(o){case"pdf":ve(I.value);break;case"excel":he(I.value);break;case"csv":me(I.value);break;default:g.error("Invalid export type")}},me=o=>{try{const e=["S.No","Supplier Name","Purchase Date","Status","Total Value"],a=o.map((p,S)=>[S+1,`"${p.supplier||""}"`,`"${D(p.purchasedAt)||""}"`,`"${p.status||""}"`,`"${q(p.total)||0}"`]),s=[e.join(","),...a.map(p=>p.join(","))].join(`
`),d=new Blob([s],{type:"text/csv;charset=utf-8;"}),i=URL.createObjectURL(d),c=document.createElement("a");c.href=i,c.download=`purchase_orders_${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(c),c.click(),document.body.removeChild(c),g.success("CSV downloaded successfully",{autoClose:2500})}catch(e){console.error("CSV generation error:",e),g.error(`CSV generation failed: ${e.message}`)}},ve=o=>{try{const e=new ae("p","mm","a4");e.setFontSize(18),e.setFont("helvetica","bold"),e.text("Purchase Orders Report",60,20),e.setFontSize(10),e.setFont("helvetica","normal");const a=new Date().toLocaleString();e.text(`Generated on: ${a}`,14,28),e.text(`Total Records: ${o.length}`,14,33);const s=["S.No","Supplier Name","Purchase Date","Status","Total Value"],d=o.map((c,p)=>[p+1,c.supplier||"",D(c.purchasedAt)||"",c.status||"",q(c.total)||0]);le(e,{head:[s],body:d,startY:40,styles:{fontSize:9,cellPadding:2,lineWidth:.1,halign:"left"},headStyles:{fillColor:[41,128,185],textColor:255,fontStyle:"bold"},alternateRowStyles:{fillColor:[240,240,240]},margin:{left:14,right:14},didDrawPage:c=>{const p=e.internal.getNumberOfPages(),S=e.internal.pageSize.height;e.setFontSize(8),e.text(`Page ${c.pageNumber} of ${p}`,c.settings.margin.left,S-10)}});const i=`purchase_orders_${new Date().toISOString().split("T")[0]}.pdf`;e.save(i),g.success("PDF downloaded successfully",{autoClose:2500})}catch(e){console.error("PDF generation error:",e),g.error(`PDF generation failed: ${e.message}`)}},he=o=>{try{const e=o.map((p,S)=>({"S.No":S+1,"Supplier Name":p.supplier||"","Purchase Date":D(p.purchasedAt)||"",Status:p.status||"","Total Value":q(p.total)||0})),a=N.book_new(),s=N.json_to_sheet(e);s["!cols"]=[{wch:8},{wch:25},{wch:25},{wch:15},{wch:15}],N.book_append_sheet(a,s,"Purchase Orders");const d=[{Info:"Generated On",Value:new Date().toLocaleString()},{Info:"Total Records",Value:o.length},{Info:"Exported By",Value:"Purchase Order System"}],i=N.json_to_sheet(d);N.book_append_sheet(a,i,"Report Info");const c=`purchase_orders_${new Date().toISOString().split("T")[0]}.xlsx`;$e(a,c),g.success("Excel file downloaded successfully",{autoClose:2500})}catch(e){console.error("Excel generation error:",e),g.error(`Excel generation failed: ${e.message}`)}};te(()=>{_(1)}),Se(()=>window.feather?.replace?.());const ge=async o=>{try{const a=(await P.get(`/purchase-orders/${o.id}`)).data,s=new ae("p","mm","a4");s.setFontSize(24),s.setFont("helvetica","bold"),s.setTextColor(41,128,185),s.text("INVOICE",14,20),s.setFontSize(10),s.setFont("helvetica","normal"),s.setTextColor(0,0,0);const d=140;s.text(`Invoice #: ${a.id}`,d,20),s.text(`Date: ${D(a.purchasedAt||a.purchase_date)}`,d,26),s.text(`Status: ${a.status?.toUpperCase()||"PENDING"}`,d,32),s.setFontSize(12),s.setFont("helvetica","bold"),s.text("FROM (Your Company):",14,45),s.setFontSize(10),s.setFont("helvetica","normal"),s.text("Your Company Name",14,52),s.text("123 Business Street",14,58),s.text("City, Country",14,64),s.text("contact@company.com",14,70),s.setFontSize(12),s.setFont("helvetica","bold"),s.text("TO (Supplier):",100,45),s.setFontSize(10),s.setFont("helvetica","normal");const i=a.supplier?.name||a.supplier||"N/A";s.text(i,100,52),s.text("Supplier Details",100,58),s.text("Contact: "+(a.supplier?.contact||"N/A"),100,64),s.text("Email: "+(a.supplier?.email||"N/A"),100,70),s.setDrawColor(41,128,185),s.setLineWidth(.5),s.line(14,78,196,78);const c=["Item","Quantity","Unit Price","Subtotal"],p=a.items.map(f=>[f.product?.name||f.name||"Unknown Product",f.quantity,B(f.unit_price),B(f.sub_total||f.quantity*f.unit_price)]);le(s,{head:[c],body:p,startY:85,styles:{fontSize:10,cellPadding:3,lineWidth:.1,halign:"left"},headStyles:{fillColor:[41,128,185],textColor:255,fontStyle:"bold",halign:"center"},alternateRowStyles:{fillColor:[245,245,245]},margin:{left:14,right:14},columnStyles:{1:{halign:"center"},2:{halign:"right"},3:{halign:"right"}}});const S=s.lastAutoTable.finalY||150;s.setFontSize(11),s.setFont("helvetica","bold");const be=a.items.reduce((f,_e)=>f+(parseFloat(_e.sub_total)||0),0);s.text(`Total Amount: ${B(be)}`,140,S+15),s.setFontSize(9),s.setFont("helvetica","normal"),s.setTextColor(128,128,128);const ee=s.internal.pageSize.height,ye=s.internal.getNumberOfPages();s.text(`Page 1 of ${ye}`,14,ee-10),s.text("Thank you for your business!",100,ee-10);const fe=`invoice_${a.id}_${new Date().toISOString().split("T")[0]}.pdf`;s.save(fe),g.success("Invoice downloaded successfully",{autoClose:2500})}catch(e){console.error("Invoice generation error:",e),g.error(`Invoice generation failed: ${e.message}`)}};return(o,e)=>{const a=Ce("VueDatePicker");return l(),se(Ie,null,{default:Pe(()=>[C(b(Fe),{title:"Purchase Order"}),t("div",Ae,[t("div",Me,[t("div",je,[t("div",ze,[t("div",Be,[e[14]||(e[14]=t("h3",{class:"fw-semibold mb-0"},"Purchase Order",-1)),t("div",Re,[t("button",{class:"btn btn-link p-0 ms-2",onClick:e[0]||(e[0]=s=>E.value=!E.value),title:"Help"},[...e[8]||(e[8]=[t("i",{class:"bi bi-question-circle fs-5"},null,-1)])]),E.value?(l(),n("div",qe,[t("button",{onClick:e[1]||(e[1]=s=>E.value=!1),class:"btn btn-sm btn-light border-0 position-absolute top-0 end-0 mt-1 me-1 text-secondary",title:"Close"},[...e[9]||(e[9]=[t("i",{class:"bi bi-x-lg"},null,-1)])]),e[10]||(e[10]=t("h6",{class:"fw-semibold mb-3"},"Purchase Order Help",-1)),e[11]||(e[11]=t("p",{class:"mb-2 small text-muted"}," This screen allows you to view, manage, and update all purchase orders. ",-1)),e[12]||(e[12]=t("p",{class:"mb-1 small"},[t("strong",null,"Add Purchase:"),O(" Create a purchase and stock-in immediately. ")],-1)),e[13]||(e[13]=t("p",{class:"small mb-0"},[t("strong",null,"Add Order:"),O(" Create a purchase order for later delivery. ")],-1))])):y("",!0)])]),t("div",Le,[t("div",Ge,[e[15]||(e[15]=t("i",{class:"bi bi-search"},null,-1)),e[16]||(e[16]=t("input",{type:"email",name:"email",autocomplete:"email",style:{position:"absolute",left:"-9999px",width:"1px",height:"1px"},tabindex:"-1","aria-hidden":"true"},null,-1)),K.value?T((l(),n("input",{id:R,"onUpdate:modelValue":e[2]||(e[2]=s=>x.value=s),key:Q.value,class:"form-control search-input",placeholder:"Search",type:"search",autocomplete:"new-password",name:R,role:"presentation",onFocus:e[3]||(e[3]=(...s)=>o.handleFocus&&o.handleFocus(...s))},null,32)),[[V,x.value]]):(l(),n("input",Ye))]),e[18]||(e[18]=t("button",{class:"btn btn-primary btn-sm py-2 rounded-pill px-4","data-bs-toggle":"modal","data-bs-target":"#bulkOrderModal"}," Bulk Purchase ",-1)),C(Ne,{suppliers:U.value,items:A.value,onRefreshData:_},null,8,["suppliers","items"]),C(Oe,{suppliers:U.value,items:A.value,onRefreshData:_,"onUpdate:search":e[4]||(e[4]=s=>G.value=s)},null,8,["suppliers","items"]),e[19]||(e[19]=t("button",{class:"btn btn-primary btn-sm py-2 rounded-pill px-4 py-2","data-bs-toggle":"modal","data-bs-target":"#addOrderModal"}," Order ",-1)),C(Te,{suppliers:U.value,items:A.value,onRefreshData:_},null,8,["suppliers","items"]),t("div",He,[e[17]||(e[17]=t("button",{class:"btn btn-outline-secondary btn-sm rounded-pill py-2 px-4 dropdown-toggle","data-bs-toggle":"dropdown"}," Export ",-1)),t("ul",We,[t("li",null,[t("a",{class:"dropdown-item py-2",href:"javascript:;",onClick:e[5]||(e[5]=s=>Y("pdf"))},"Export as PDF")]),t("li",null,[t("a",{class:"dropdown-item py-2",href:"javascript:;",onClick:e[6]||(e[6]=s=>Y("excel"))},"Export as Excel")]),t("li",null,[t("a",{class:"dropdown-item py-2",href:"javascript:;",onClick:e[7]||(e[7]=s=>Y("csv"))}," Export as CSV ")])])])])]),t("div",Qe,[t("table",Ke,[e[22]||(e[22]=t("thead",{class:"small text-muted"},[t("tr",null,[t("th",{style:{width:"80px"}},"S. #"),t("th",null,"Supplier Name"),t("th",null,"Purchase date"),t("th",{class:"text-start"},"Status"),t("th",null,"Total value"),t("th",{class:"text-end"},"Action")])],-1)),t("tbody",null,[M.value?(l(),n("tr",Xe,[...e[20]||(e[20]=[t("td",{colspan:"6",class:"text-center py-5"},[t("div",{class:"spinner-border text-primary",role:"status"},[t("span",{class:"visually-hidden"},"Loading...")]),t("p",{class:"text-muted mt-2 mb-0"},"Loading purchase orders...")],-1)])])):(l(),n(H,{key:1},[(l(!0),n(H,null,oe(X.value,(s,d)=>(l(),n("tr",{key:s.id},[t("td",null,r(m.value.from+d),1),t("td",null,r(s.supplier),1),t("td",Je,[O(r(s.purchasedAt)+" ",1),t("div",Ze,r(b(z)(s.purchasedAt).split(",")[1]?.trim()),1)]),t("td",et,[t("span",{class:W(["badge rounded-pill",s.status==="pending"?"bg-warning text-dark":s.status==="completed"?"bg-success":"bg-secondary"])},r(s.status),3)]),t("td",null,r(b(F)(s.total)),1),t("td",tt,[t("div",st,[t("button",{class:"p-2 rounded-pill text-primary hover:bg-gray-100 btn",onClick:i=>ce(s),title:"View Item"},[C(b(Ee),{class:"w-4 h-4"})],8,ot),t("button",{class:"p-2 rounded-pill text-success hover:bg-gray-100 btn",onClick:i=>ge(s),disabled:M.value,title:"Print Invoice"},[...e[21]||(e[21]=[t("i",{class:"bi bi-printer fs-5"},null,-1)])],8,at)])])]))),128)),X.value.length===0?(l(),n("tr",lt,[t("td",nt,r(x.value.trim()?"No purchase orders found matching your search.":"No purchase orders found."),1)])):y("",!0)],64))])])]),m.value.last_page>1?(l(),n("div",rt,[t("div",it," Showing "+r(m.value.from)+" to "+r(m.value.to)+" of "+r(m.value.total)+" entries ",1),C(De,{pagination:m.value.links,isApiDriven:!0,onPageChanged:de},null,8,["pagination"])])):y("",!0)])]),t("div",dt,[t("div",ut,[t("div",ct,[t("div",pt,[t("div",mt,[e[23]||(e[23]=t("span",{class:"badge bg-success rounded-circle p-2"},[t("i",{class:"bi bi-basket"})],-1)),t("div",vt,[t("h5",ht,r(u.value?"Edit Purchase Order":"Purchase Details"),1),t("small",gt," Supplier: "+r(v.value?.supplier?.name??"â€”"),1)])]),t("button",{onClick:ue,class:"absolute top-2 right-2 p-2 rounded-full hover:bg-gray-100 transition transform hover:scale-110","data-bs-dismiss":"modal","aria-label":"Close",title:"Close"},[...e[24]||(e[24]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),v.value?(l(),n("div",bt,[e[37]||(e[37]=t("h6",{class:"fw-semibold mb-3"},"Order Summary",-1)),t("div",yt,[t("div",ft,[e[25]||(e[25]=t("small",{class:"text-muted d-block"},"Purchase Date",-1)),t("div",_t,r(b(z)(v.value.purchase_date).split(",")[0]),1)]),t("div",xt,[e[26]||(e[26]=t("small",{class:"text-muted d-block"},"Status",-1)),t("span",{class:W(["badge rounded-pill",v.value.status==="completed"?"bg-success":"bg-warning"])},r(v.value.status),3)]),t("div",wt,[e[27]||(e[27]=t("small",{class:"text-muted d-block"},"Total Amount",-1)),t("div",kt,r(b(F)(v.value.total_amount)),1)])]),e[38]||(e[38]=t("hr",{class:"my-4"},null,-1)),t("h6",St,r(u.value?"Edit Items":"Purchased Items"),1),t("div",Ct,[t("table",Pt,[t("thead",Ft,[t("tr",null,[e[28]||(e[28]=t("th",null,"Product",-1)),e[29]||(e[29]=t("th",null,"Qty",-1)),e[30]||(e[30]=t("th",null,"Unit Price",-1)),e[31]||(e[31]=t("th",null,"Subtotal",-1)),e[32]||(e[32]=t("th",null,"Expiry",-1)),u.value?(l(),n("th",Dt,"Action")):y("",!0)])]),t("tbody",null,[(l(!0),n(H,null,oe(u.value?w.value:v.value.items,(s,d)=>(l(),n("tr",{class:"black-row",key:s.id||d},[t("td",null,[u.value?T((l(),n("input",{key:1,"onUpdate:modelValue":i=>s.name=i,class:"form-control",readonly:""},null,8,$t)),[[V,s.name]]):(l(),n("span",It,r(s.product?.name||s.name||"Unknown Product"),1))]),t("td",null,[u.value?T((l(),n("input",{key:1,"onUpdate:modelValue":i=>s.quantity=i,type:"number",class:"form-control",onInput:i=>Z(s)},null,40,Tt)),[[V,s.quantity,void 0,{number:!0}]]):(l(),n("span",Ot,r(b(F)(s.quantity)),1))]),t("td",null,[u.value?T((l(),n("input",{key:1,"onUpdate:modelValue":i=>s.unit_price=i,type:"number",class:"form-control",onInput:i=>Z(s)},null,40,Nt)),[[V,s.unit_price,void 0,{number:!0}]]):(l(),n("span",Vt,r(s.unit_price),1))]),t("td",null,[u.value?T((l(),n("input",{key:1,"onUpdate:modelValue":i=>s.sub_total=i,class:"form-control",readonly:""},null,8,Ut)),[[V,s.sub_total]]):(l(),n("span",Et,r(b(F)(s.sub_total)),1))]),t("td",null,[u.value?(l(),se(a,{key:1,modelValue:s.expiry,"onUpdate:modelValue":i=>s.expiry=i,enableTimePicker:!1,"min-date":new Date,teleport:!0,format:"yyyy-MM-dd",placeholder:"Select expiry date",class:W({"is-invalid":k.value[`items.${d}.expiry`]})},null,8,["modelValue","onUpdate:modelValue","min-date","class"])):(l(),n("span",At,r(b(z)(s.expiry_date)),1)),k.value[`items.${d}.expiry`]?(l(),n("small",Mt,r(k.value[`items.${d}.expiry`][0]),1)):y("",!0)]),e[33]||(e[33]=t("br",null,null,-1)),u.value?(l(),n("td",jt,[t("button",{class:"p-2 rounded-full transition transform hover:bg-gray-100 hover:scale-110",onClick:i=>w.value.splice(d,1),title:"Delete"},[C(b(Ue),{class:"w-4 h-4 text-red-500"})],8,zt)])):y("",!0)]))),128)),(u.value?w.value.length:v.value.items.length)===0?(l(),n("tr",Bt,[t("td",{colspan:u.value?6:5,class:"text-center text-muted py-3"}," No items found ",8,Rt)])):y("",!0)]),t("tfoot",qt,[t("tr",null,[e[34]||(e[34]=t("td",{colspan:"3",class:"text-end fw-bold"}," Total: ",-1)),t("td",Lt,r(b(F)((u.value?w.value:v.value.items).reduce((s,d)=>s+parseFloat(d.sub_total||0),0))),1),e[35]||(e[35]=t("td",{colspan:"2"},null,-1))])])])]),u.value?(l(),n("div",Gt,[...e[36]||(e[36]=[t("i",{class:"bi bi-info-circle me-2"},null,-1),O(" Updating will mark this order as completed and create stock entries. ",-1)])])):y("",!0)])):y("",!0),u.value?(l(),n("div",Yt,[t("button",{type:"button",class:"btn btn-primary rounded-pill px-4 py-2",onClick:pe,disabled:j.value||w.value.length===0},[j.value?(l(),n("span",Wt,[...e[39]||(e[39]=[t("span",{class:"spinner-border spinner-border-sm me-2"},null,-1),O(" Updating... ",-1)])])):(l(),n("span",Qt,"Complete Order & Update Stock"))],8,Ht),e[40]||(e[40]=t("button",{type:"button",class:"btn btn-secondary rounded-pill px-4 py-2","data-bs-dismiss":"modal"}," Cancel ",-1))])):y("",!0)])])])])]),_:1})}}},hs=xe(Kt,[["__scopeId","data-v-b98ec549"]]);export{hs as default};
