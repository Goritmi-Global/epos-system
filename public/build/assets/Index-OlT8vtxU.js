import{_ as Je,c as Q,r as f,w as re,o as We,n as Qe,I as et,E as tt,a as ie,b as o,d as M,e as p,f as t,u as m,h as at,p as V,g as l,F as N,i as de,j as b,k as st,t as n,l as y,m as j,v as U,C as ot,P as lt,q as C,s as r}from"./app-DaLeCts1.js";import{_ as nt}from"./Master-DuhaOEEB.js";import{s as be}from"./index-DYfGe8Oe.js";import{u as rt}from"./useFormatters-CV7VkEY5.js";import{s as ue}from"./index-BOgJEDvY.js";import{E as it,a as dt,X as ut,u as z,w as ct}from"./xlsx-BF__UE7s.js";import{I as mt}from"./importFile-BoLSCsQS.js";import{s as pt,a as vt,b as he,c as ft,d as ce}from"./index-DQoj6caG.js";import{F as gt}from"./FilterModal-BOiFGb_a.js";import{s as bt}from"./index-C3ArBVsv.js";import{u as ht}from"./useModal-vDbn_8lj.js";import{c as _t}from"./createLucideIcon-CAz739UJ.js";import{C as yt}from"./circle-check-big-C0IkBA7v.js";import{D as xt}from"./dollar-sign-CnM53rq5.js";import{P as St}from"./percent--V17YhHl.js";import{P as _e}from"./plus-DYuGD7ly.js";import{P as ye}from"./pencil-vcOGrbjZ.js";import"./index-CDxwSSA8.js";import"./PasswordVerificationModal-VEkP2aPT.js";import"./index-CMXme-QG.js";import"./index-CoRwG8jP.js";import"./sun-BWgmNid9.js";import"./index-7poBRJqv.js";import"./index-BvBoXUhG.js";import"./index-BpEtzHas.js";/**
 * @license lucide-vue-next v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wt=_t("tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]),Pt={class:"page-wrapper"},kt={class:"mt-3"},Dt={class:"row g-3"},Mt={class:"card border-0 shadow-sm rounded-4"},Ct={class:"card-body d-flex align-items-center"},Ft={class:"mb-0 fw-bold"},It={class:"text-muted mb-0 small"},Vt={class:"card border-0 shadow-lg rounded-4 mt-0"},$t={class:"card-body"},Tt={class:"d-flex flex-wrap gap-2 justify-content-between align-items-center mb-3"},Et={class:"d-flex flex-wrap gap-2 align-items-center"},Nt={class:"search-wrap"},At={key:1,class:"form-control search-input",placeholder:"Search",disabled:"",type:"text"},Lt={class:"table-responsive"},Bt={class:"table table-striped"},jt={key:0},Ut={class:"fw-semibold"},Ot={class:"text-center"},Rt={class:"text-center"},Zt={class:"d-inline-flex align-items-center gap-3"},zt=["onClick"],qt=["title"],Xt={key:1},Ht={key:0,class:"mt-4 d-flex justify-content-between align-items-center"},Yt={class:"text-muted small"},Gt={class:"modal fade",id:"promoModal",tabindex:"-1","aria-hidden":"true"},Kt={class:"modal-dialog modal-lg modal-dialog-centered"},Jt={class:"modal-content rounded-4"},Wt={class:"modal-header"},Qt={class:"modal-title fw-semibold"},ea={class:"modal-body"},ta={class:"row g-3"},aa={class:"col-12"},sa={key:0,class:"text-danger"},oa={class:"col-md-6"},la={key:0,class:"text-danger"},na={class:"col-md-6"},ra={key:0,class:"text-danger"},ia={class:"col-12"},da={key:0,class:"text-danger"},ua={class:"col-md-6"},ca={key:0,class:"text-danger"},ma={class:"col-md-6"},pa={key:0,class:"text-danger"},va={class:"col-md-6"},fa={key:0,class:"text-danger"},ga={class:"col-md-6"},ba={key:0,class:"text-danger"},ha={class:"col-12"},_a={key:0,class:"text-danger"},ya={class:"mt-4"},xa=["disabled"],Sa={class:"mt-3"},wa={class:"card border-0 shadow-lg rounded-4 mt-0"},Pa={class:"card-body"},ka={class:"d-flex flex-wrap gap-2 justify-content-between align-items-center mb-3"},Da={class:"d-flex flex-wrap gap-2 align-items-center"},Ma={class:"table-responsive"},Ca={class:"table table-striped"},Fa={key:0},Ia={key:1,class:"text-muted"},Va={key:0},$a={key:1,class:"text-muted"},Ta={key:0},Ea={key:1,class:"text-muted"},Na={class:"text-center"},Aa=["onClick"],La={key:0},Ba={class:"modal fade",id:"promoScopeModal",tabindex:"-1","aria-hidden":"true"},ja={class:"modal-dialog modal-lg modal-dialog-centered"},Ua={class:"modal-content rounded-4"},Oa={class:"modal-header"},Ra={class:"modal-title fw-semibold"},Za={class:"modal-body"},za={class:"row g-3"},qa={class:"col-12"},Xa={key:0,class:"text-danger"},Ha={class:"col-md-6"},Ya={key:0,class:"text-danger"},Ga={class:"col-md-6"},Ka={key:0,class:"text-danger"},Ja={class:"mt-4 text-end"},Wa=["disabled"],Qa={__name:"Index",props:{meals:{type:Array,required:!0}},setup(xe){const{closeModal:Se}=ht(),{formatCurrencySymbol:q,dateFmt:D}=rt(),X=xe,we=Q(()=>X.meals||[]),Pe=Q(()=>{if(!X.meals||!Array.isArray(X.meals))return[];const s=X.meals.flatMap(a=>(a.menu_items||[]).map(S=>({...S,meal_name:a.name}))),e=[],u=new Set;for(const a of s)u.has(a.id)||(u.add(a.id),e.push(a));return e}),$=f([]),A=f(null),I=f(!1),i=f({}),me=f(0),ee=f([]),O=f(null),w=f({}),te=f(null),ke=[{label:"PDF",value:"pdf"},{label:"Excel",value:"excel"},{label:"CSV",value:"csv"}],R=f({total:0,active:0,inactive:0,flat:0,percent:0}),H=async()=>{try{const s=await C.get("/api/promos/global-stats");R.value=s.data.data||{total:0,active:0,inactive:0,flat:0,percent:0}}catch(s){console.error("Failed to fetch global promo stats:",s)}},De=s=>{s.value&&(ze(s.value),te.value=null)},Me=[{label:"Flat Amount",value:"flat"},{label:"Percentage",value:"percent"}],Ce=[{label:"Active",value:"active"},{label:"Deactive",value:"inactive"}],x=f({promo_id:null,meals:[],menu_items:[]});re(()=>x.value.meals,s=>{},{deep:!0}),re(()=>x.value.menu_items,s=>{},{deep:!0});const Fe=["Promo Name","Type","Discount Amount","Start Date","End Date","Min Purchase","Max Discount","Status","Description"],Ie=[["Summer Sale","percent","20","2025-06-01","2025-08-31","50","100","active","Summer discount"],["Flat Discount","flat","10","2025-01-01","2025-12-31","30","","active","Flat 10 off"]],Ve=s=>{if(!s||s.length<=1){r.error("The imported file is empty.");return}s[0];const u=s.slice(1).map(d=>{const F=P=>{if(!P)return"";if(!isNaN(P)&&Number(P)>3e4){const le=Number(P),Z=new Date((le-25569)*86400*1e3),ne=Z.getFullYear(),Ge=String(Z.getMonth()+1).padStart(2,"0"),Ke=String(Z.getDate()).padStart(2,"0");return`${ne}-${Ge}-${Ke}`}if(typeof P=="string"&&/^\d{4}-\d{2}-\d{2}$/.test(P))return P;const W=new Date(P);if(!isNaN(W.getTime())){const le=W.getFullYear(),Z=String(W.getMonth()+1).padStart(2,"0"),ne=String(W.getDate()).padStart(2,"0");return`${le}-${Z}-${ne}`}return""};return{name:d[0]||"",type:d[1]||"percent",discount_amount:d[2]||"",start_date:F(d[3]),end_date:F(d[4]),min_purchase:d[5]||"0",max_discount:d[6]||null,status:d[7]||"active",description:d[8]||""}}).filter(d=>d.name.trim());if(u.length===0){r.error("No valid promos found in the file.");return}const a=u.map(d=>d.name.trim().toLowerCase()),S=a.filter((d,F)=>a.indexOf(d)!==F);if(S.length>0){r.error(`Duplicate promo names found in CSV: ${[...new Set(S)].join(", ")}`);return}const _=$.value.map(d=>d.name.trim().toLowerCase()),v=u.filter(d=>_.includes(d.name.trim().toLowerCase()));if(v.length>0){const d=v.map(F=>F.name).join(", ");r.error(`Promos already exist in the table: ${d}`);return}const c=["flat","percent"];if(u.filter(d=>!c.includes(d.type.toLowerCase())).length>0){r.error("Invalid type found. Type must be either 'flat' or 'percent'.");return}const Ye=["active","inactive"];if(u.filter(d=>!Ye.includes(d.status.toLowerCase())).length>0){r.error("Invalid status found. Status must be either 'active' or 'inactive'.");return}C.post("/api/promos/import",{promos:u}).then(()=>{r.success("Promos imported successfully"),T(),H()}).catch(d=>{console.error("Import error:",d);const F=d.response?.data?.message||"Import failed",P=d.response?.data?.errors||[];P.length>0?(console.error("Detailed errors:",P),r.error(`${F}: ${P.join(", ")}`)):r.error(F)})},T=async(s=1)=>{k.value=!0;try{const e=await C.get("/api/promos/all",{params:{page:s,per_page:se.value,q:E.value.trim()||null,status:h.value.stockStatus||null,category:h.value.category||null,sort_by:h.value.sortBy||null,price_min:h.value.priceMin||null,price_max:h.value.priceMax||null,date_from:h.value.dateFrom||null,date_to:h.value.dateTo||null}});$.value=e.data.data||[],e.data.pagination&&(L.value=e.data.pagination.current_page,oe.value=e.data.pagination.total,G.value=e.data.pagination.links)}catch(e){console.error("Failed to fetch promos:",e),r.error("Failed to load promos")}finally{k.value=!1}},$e=s=>{if(!s||k.value)return;const u=new URLSearchParams(s.split("?")[1]).get("page");u&&T(parseInt(u))},pe=async()=>{try{const s=await C.get("/promo-scopes");ee.value=s.data.data||[]}catch(s){console.error("Failed to fetch promo scopes:",s),r.error("Failed to load promo scopes")}};We(async()=>{E.value="",ve.value=Date.now(),await Qe(),setTimeout(()=>{fe.value=!0;const s=document.getElementById(ae);s&&(s.value="",E.value="")},100),await T(),await pe(),H()});const Te=Q(()=>[{label:"Total Promos",value:R.value.total,icon:wt,iconBg:"bg-light-primary",iconColor:"text-primary"},{label:"Active Promos",value:R.value.active,icon:yt,iconBg:"bg-light-success",iconColor:"text-success"},{label:"Flat Discount",value:R.value.flat,icon:xt,iconBg:"bg-light-warning",iconColor:"text-warning"},{label:"Percentage",value:R.value.percent,icon:St,iconBg:"bg-light-danger",iconColor:"text-danger"}]),E=f(""),ve=f(Date.now()),ae=`search-${Math.random().toString(36).substr(2,9)}`,fe=f(!1),Y=f({sortBy:"",stockStatus:"",priceMin:null,priceMax:null,dateFrom:null,dateTo:null}),h=f({sortBy:"",stockStatus:"",category:"",priceMin:null,priceMax:null,dateFrom:null,dateTo:null}),L=f(1),se=f(10),oe=f(0),G=f([]),k=f(!1),Ee=Q(()=>[{id:"flat",name:"Flat"},{id:"percent",name:"Percentage"}]),Ne=f(!1),Ae=s=>{h.value={...s},Y.value={...s},L.value=1,Ne.value=!0,T(1)},Le=()=>{Y.value={sortBy:"",stockStatus:"",category:"",priceMin:null,priceMax:null,dateFrom:null,dateTo:null},h.value={sortBy:"",stockStatus:"",category:"",priceMin:null,priceMax:null,dateFrom:null,dateTo:null},L.value=1,T(1),Se("promosFilterModal")},g=f({name:"",type:"percent",status:"active",start_date:"",end_date:"",min_purchase:0,max_discount:null,description:"",discount_amount:null}),K=()=>{g.value={name:"",type:"percent",status:"active",start_date:"",end_date:"",min_purchase:0,max_discount:null,description:"",discount_amount:null},A.value=null,i.value={}},J=()=>{x.value={promo_id:null,meals:[],menu_items:[]},O.value=null,w.value={}},Be=async()=>{I.value=!0,i.value={};try{A.value?(await C.post(`/promos/${A.value.id}`,g.value),r.success("Promo updated successfully")):(await C.post("/promos",g.value),r.success("Promo created successfully")),bootstrap.Modal.getInstance(document.getElementById("promoModal"))?.hide(),K(),await T(),H()}catch(s){if(console.error("❌ Error:",s.response?.data||s.message),s.response?.status===422&&s.response?.data?.errors){i.value=s.response.data.errors;const e=Object.values(s.response.data.errors).flat();r.error(e.join(`
`))}else{const e=s.response?.data?.message||"Failed to save promo";r.error(e)}}finally{I.value=!1}};let ge=null;re(E,()=>{clearTimeout(ge),ge=setTimeout(()=>{L.value=1,T(1)},500)});const je=async()=>{I.value=!0,w.value={},console.log("Submitting promo scope:",x.value);try{const s={promos:x.value.promos||[],meals:x.value.meals||[],menu_items:x.value.menu_items||[]};console.log("Payload:",s),O.value?(await C.put(`/promo-scopes/${O.value.id}`,s),r.success("Promo scope updated successfully")):(await C.post("/promo-scopes",s),r.success("Promo scope created successfully")),bootstrap.Modal.getInstance(document.getElementById("promoScopeModal"))?.hide(),J(),await pe()}catch(s){if(console.error("❌ Error:",s.response?.data||s.message),s.response?.status===422&&s.response?.data?.errors)w.value=s.response.data.errors,Object.values(s.response.data.errors).flat(),r.error("Please filled all the required fields.");else{const e=s.response?.data?.message||"Failed to save promo scope";r.error(e)}}finally{I.value=!1}},Ue=s=>{A.value=s,g.value={name:s.name,type:s.type,status:s.status,start_date:s.start_date?new Date(s.start_date):null,end_date:s.end_date?new Date(s.end_date):null,min_purchase:s.min_purchase,max_discount:s.max_discount,description:s.description||"",discount_amount:s.discount_amount};const e=document.getElementById("promoModal");new bootstrap.Modal(e).show()},Oe=s=>{O.value=s,x.value={promos:s.promos?s.promos.map(a=>a.id):[],meals:s.meals?s.meals.map(a=>a.id):[],menu_items:s.menu_items?s.menu_items.map(a=>a.id):[]};const e=document.getElementById("promoScopeModal");new bootstrap.Modal(e).show()},Re=async s=>{const e=s.status==="active"?"inactive":"active";try{await C.patch(`/api/promos/${s.id}/toggle-status`,{status:e}),s.status=e,r.success(`Promo status updated to ${e}`),me.value++,await H()}catch(u){console.error("Failed to update status:",u),r.error("Failed to update status")}};et(()=>window.feather?.replace());const Ze=async()=>{try{return k.value=!0,(await C.get("/api/promos/all",{params:{export:"all",q:E.value.trim()||null,status:h.value.stockStatus||null,category:h.value.category||null,sort_by:h.value.sortBy||null,price_min:h.value.priceMin||null,price_max:h.value.priceMax||null,date_from:h.value.dateFrom||null,date_to:h.value.dateTo||null}})).data.data||[]}catch(s){return console.error("❌ Error fetching export data:",s),r.error("Failed to load data for export"),[]}finally{k.value=!1}},ze=async s=>{if(!$.value||$.value.length===0){r.error("No Promos data to download");return}try{k.value=!0;const e=await Ze();if(!e.length){r.error("No promos found to download"),k.value=!1;return}s==="pdf"?Xe(e):s==="excel"?He(e):s==="csv"?qe(e):r.error("Invalid download type")}catch(e){console.error("Download failed:",e),r.error(`Download failed: ${e.message}`)}finally{k.value=!1}},qe=s=>{try{const e=["S.#","Promo Name","Type","Discount Amount","Start Date","End Date","Min Purchase","Max Discount","Status","Description"],u=s.map((c,B)=>[`${B+1}`,`"${c.name||""}"`,`"${c.type||""}"`,`${c.discount_amount||""}`,`"${D(c.start_date)||""}"`,`"${D(c.end_date)||""}"`,`${c.min_purchase||""}`,`${c.max_discount||""}`,`"${c.status||""}"`,`"${c.description||""}"`]),a=[e.join(","),...u.map(c=>c.join(","))].join(`
`),S=new Blob([a],{type:"text/csv;charset=utf-8;"}),_=URL.createObjectURL(S),v=document.createElement("a");v.setAttribute("href",_),v.setAttribute("download",`Promos_${new Date().toISOString().split("T")[0]}.csv`),document.body.appendChild(v),v.click(),document.body.removeChild(v),r.success("CSV downloaded successfully")}catch(e){console.error("CSV generation error:",e),r.error(`CSV generation failed: ${e.message}`)}},Xe=s=>{try{const e=new it("l","mm","a4");e.setFontSize(18),e.setFont("helvetica","bold"),e.text("Promos Report",14,20),e.setFontSize(10),e.setFont("helvetica","normal");const u=new Date().toLocaleString();e.text(`Generated on: ${u}`,14,28),e.text(`Total Promos: ${s.length}`,14,34);const a=["S.#","Name","Type","Discount","Start Date","End Date","Min Purchase","Max Discount","Status"],S=s.map((v,c)=>[c+1,v.name||"",v.type==="flat"?"Flat":"Percent",v.discount_amount||"",D(v.start_date)||"",D(v.end_date)||"",q(v.min_purchase)||"",v.max_discount?q(v.max_discount):"N/A",v.status==="active"?"Active":"Inactive"]);dt(e,{head:[a],body:S,startY:40,styles:{fontSize:8,cellPadding:2,halign:"left",lineColor:[0,0,0],lineWidth:.1},headStyles:{fillColor:[41,128,185],textColor:255,fontStyle:"bold"},alternateRowStyles:{fillColor:[245,245,245]},margin:{left:14,right:14},didDrawPage:v=>{const c=e.internal.getNumberOfPages(),B=e.internal.pageSize.height;e.setFontSize(8),e.text(`Page ${v.pageNumber} of ${c}`,v.settings.margin.left,B-10)}});const _=`Promos_${new Date().toISOString().split("T")[0]}.pdf`;e.save(_),r.success("PDF downloaded successfully")}catch(e){console.error("PDF generation error:",e),r.error(`PDF generation failed: ${e.message}`)}},He=s=>{try{if(typeof ut>"u")throw new Error("XLSX library is not loaded");const e=s.map((c,B)=>({"S.#":B+1,"Promo Name":c.name||"",Type:c.type==="flat"?"Flat":"Percent","Discount Amount":c.discount_amount||"","Start Date":D(c.start_date)||"","End Date":D(c.end_date)||"","Min Purchase":c.min_purchase||"","Max Discount":c.max_discount||"",Status:c.status==="active"?"Active":"Inactive",Description:c.description||""})),u=z.book_new(),a=z.json_to_sheet(e);a["!cols"]=[{wch:8},{wch:25},{wch:12},{wch:15},{wch:15},{wch:15},{wch:15},{wch:15},{wch:12},{wch:30}],z.book_append_sheet(u,a,"Promos");const S=[{Info:"Report",Value:"Promos Export"},{Info:"Generated On",Value:new Date().toLocaleString()},{Info:"Total Records",Value:s.length},{Info:"Exported By",Value:"Inventory Management System"}],_=z.json_to_sheet(S);z.book_append_sheet(u,_,"Report Info");const v=`Promos_${new Date().toISOString().split("T")[0]}.xlsx`;ct(u,v),r.success("Excel file downloaded successfully")}catch(e){console.error("Excel generation error:",e),r.error(`Excel generation failed: ${e.message}`)}};return(s,e)=>{const u=tt("VueDatePicker");return o(),ie(nt,null,{default:M(()=>[p(m(at),{title:"Promo"}),t("div",Pt,[e[50]||(e[50]=t("h4",{class:"fw-semibold mb-3"},"Promo Management",-1)),p(m(pt),{value:"0",class:"w-100"},{default:M(()=>[p(m(vt),null,{default:M(()=>[p(m(he),{value:"0"},{default:M(()=>[...e[17]||(e[17]=[V("Promos",-1)])]),_:1}),p(m(he),{value:"1"},{default:M(()=>[...e[18]||(e[18]=[V("Promo Scope",-1)])]),_:1})]),_:1}),p(m(ft),null,{default:M(()=>[p(m(ce),{value:"0"},{default:M(()=>[p(m(ce),{value:"0"},{default:M(()=>[t("div",kt,[t("div",Dt,[(o(!0),l(N,null,de(Te.value,a=>(o(),l("div",{key:a.label,class:"col-md-6 col-xl-3"},[t("div",Mt,[t("div",Ct,[t("div",{class:b([[a.iconBg,a.iconColor],"rounded-circle p-3 d-flex align-items-center justify-content-center me-3"]),style:{width:"56px",height:"56px"}},[(o(),ie(st(a.icon),{class:"w-6 h-6"}))],2),t("div",null,[t("h3",Ft,n(a.value),1),t("p",It,n(a.label),1)])])])]))),128))]),t("div",Vt,[t("div",$t,[t("div",Tt,[e[22]||(e[22]=t("h5",{class:"mb-0 fw-semibold"},"Promos",-1)),t("div",Et,[t("div",Nt,[e[19]||(e[19]=t("i",{class:"bi bi-search"},null,-1)),e[20]||(e[20]=t("input",{type:"email",name:"email",autocomplete:"email",style:{position:"absolute",left:"-9999px",width:"1px",height:"1px"},tabindex:"-1","aria-hidden":"true"},null,-1)),fe.value?j((o(),l("input",{id:ae,"onUpdate:modelValue":e[0]||(e[0]=a=>E.value=a),key:ve.value,class:"form-control search-input",placeholder:"Search",type:"search",autocomplete:"new-password",name:ae,role:"presentation",onFocus:e[1]||(e[1]=(...a)=>s.handleFocus&&s.handleFocus(...a))},null,32)),[[U,E.value]]):(o(),l("input",At))]),p(gt,{modelValue:Y.value,"onUpdate:modelValue":e[2]||(e[2]=a=>Y.value=a),title:"Promos",modalId:"promosFilterModal",modalSize:"modal-lg",sortOptions:[{value:"name_asc",label:"Name: A to Z"},{value:"name_desc",label:"Name: Z to A"}],categories:Ee.value,categoryLabel:"Promo Type",statusLabel:"Promo Status",showPriceRange:!0,"show-stock-status":!1,priceRangeLabel:"Discount Amount Range",showDateRange:!0,onApply:Ae,onClear:Le},null,8,["modelValue","categories"]),t("button",{"data-bs-toggle":"modal","data-bs-target":"#promoModal",onClick:K,class:"d-flex align-items-center gap-1 px-4 py-2 rounded-pill btn btn-primary text-white"},[p(m(_e),{class:"w-4 h-4"}),e[21]||(e[21]=V(" Add Promo ",-1))]),p(mt,{label:"Import Promos",sampleHeaders:Fe,sampleData:Ie,onOnImport:Ve}),p(m(bt),{modelValue:te.value,"onUpdate:modelValue":e[3]||(e[3]=a=>te.value=a),options:ke,optionLabel:"label",optionValue:"value",placeholder:"Export",class:"export-dropdown",onChange:De},null,8,["modelValue"])])]),t("div",Lt,[t("table",Bt,[e[25]||(e[25]=t("thead",{class:"border-top small text-muted"},[t("tr",null,[t("th",null,"S.#"),t("th",null,"Name"),t("th",null,"Type"),t("th",null,"Start Date"),t("th",null,"End Date"),t("th",null,"Min Purchase"),t("th",null,"Max Discount"),t("th",{class:"text-center"},"Status"),t("th",{class:"text-center"},"Action")])],-1)),t("tbody",null,[k.value?(o(),l("tr",jt,[...e[23]||(e[23]=[t("td",{colspan:"9",class:"text-center py-4"},[t("div",{class:"spinner-border text-primary",role:"status"},[t("span",{class:"visually-hidden"},"Loading...")])],-1)])])):y("",!0),(o(!0),l(N,null,de($.value,(a,S)=>(o(),l("tr",{key:a.id},[t("td",null,n(S+1),1),t("td",Ut,n(a.name),1),t("td",null,[t("span",{class:b(a.type==="flat"?"badge bg-primary px-4 py-2 rounded-pill":"badge bg-warning px-4 py-2 rounded-pill")},n(a.type==="flat"?"Flat":"Percent"),3)]),t("td",null,n(m(D)(a.start_date)),1),t("td",null,n(m(D)(a.end_date)),1),t("td",null,n(m(q)(a.min_purchase)),1),t("td",null,n(a.max_discount?m(q)(a.max_discount):"N/A"),1),t("td",Ot,[t("span",{class:b(a.status==="active"?"badge bg-success px-4 py-2 rounded-pill":"badge bg-danger px-4 py-2 rounded-pill")},n(a.status==="active"?"Active":"Inactive"),3)]),t("td",Rt,[t("div",Zt,[t("button",{onClick:_=>Ue(a),title:"Edit",class:"p-2 rounded-full text-blue-600 hover:bg-blue-100"},[p(m(ye),{class:"w-4 h-4"})],8,zt),(o(),ie(ot,{key:`confirm-${a.id}-${me.value}`,title:"Confirm Status Change",message:`Are you sure you want to set ${a.name} to ${a.status==="active"?"Inactive":"Active"}?`,showStatusButton:!0,confirmText:"Yes, Change",cancelText:"Cancel",status:a.status,onConfirm:_=>Re(a)},{trigger:M(()=>[t("button",{class:b(["relative inline-flex items-center w-8 h-4 rounded-full transition-colors duration-300 focus:outline-none",a.status==="active"?"bg-green-500 hover:bg-green-600":"bg-red-400 hover:bg-red-500"]),title:a.status==="active"?"Set Inactive":"Set Active"},[t("span",{class:b(["absolute left-0.5 top-0.5 w-3 h-3 bg-white rounded-full shadow transform transition-transform duration-300",a.status==="active"?"translate-x-4":"translate-x-0"])},null,2)],10,qt)]),_:2},1032,["message","status","onConfirm"]))])])]))),128)),!k.value&&$.value.length===0?(o(),l("tr",Xt,[...e[24]||(e[24]=[t("td",{colspan:"9",class:"text-center text-muted py-4"}," No promos found. ",-1)])])):y("",!0)])])]),G.value&&G.value.length>0&&!k.value?(o(),l("div",Ht,[t("div",Yt," Showing "+n((L.value-1)*se.value+1)+" to "+n(Math.min(L.value*se.value,oe.value))+" of "+n(oe.value)+" entries ",1),p(lt,{pagination:G.value,isApiDriven:!0,onPageChanged:$e},null,8,["pagination"])])):y("",!0)])]),t("div",Gt,[t("div",Kt,[t("div",Jt,[t("div",Wt,[t("h5",Qt,n(A.value?"Edit Promo":"Add New Promo"),1),t("button",{class:"absolute top-2 right-2 p-2 rounded-full hover:bg-gray-100 transition transform hover:scale-110",onClick:K,"data-bs-dismiss":"modal","aria-label":"Close",title:"Close"},[...e[26]||(e[26]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),t("div",ea,[t("div",ta,[t("div",aa,[e[27]||(e[27]=t("label",{class:"form-label"},"Promo Name",-1)),j(t("input",{"onUpdate:modelValue":e[4]||(e[4]=a=>g.value.name=a),type:"text",class:b(["form-control",{"is-invalid":i.value.name}]),placeholder:"Enter promo name"},null,2),[[U,g.value.name]]),i.value.name?(o(),l("small",sa,n(i.value.name[0]),1)):y("",!0)]),t("div",oa,[e[28]||(e[28]=t("label",{class:"form-label"},"Discount Type",-1)),p(m(be),{modelValue:g.value.type,"onUpdate:modelValue":e[5]||(e[5]=a=>g.value.type=a),options:Me,optionLabel:"label",appendTo:"self",autoZIndex:!0,baseZIndex:2e3,optionValue:"value",class:b(["form-select",{"is-invalid":i.value.type}])},null,8,["modelValue","class"]),i.value.type?(o(),l("small",la,n(i.value.type[0]),1)):y("",!0)]),t("div",na,[e[29]||(e[29]=t("label",{class:"form-label"},"Status",-1)),p(m(be),{modelValue:g.value.status,"onUpdate:modelValue":e[6]||(e[6]=a=>g.value.status=a),options:Ce,optionLabel:"label",optionValue:"value",class:b(["form-select",{"is-invalid":i.value.status}]),appendTo:"self",autoZIndex:!0,baseZIndex:2e3},null,8,["modelValue","class"]),i.value.status?(o(),l("small",ra,n(i.value.status[0]),1)):y("",!0)]),t("div",ia,[e[30]||(e[30]=t("label",{class:"form-label"},"Discount Amount",-1)),j(t("input",{"onUpdate:modelValue":e[7]||(e[7]=a=>g.value.discount_amount=a),type:"number",class:b(["form-control",{"is-invalid":i.value.discount_amount}]),placeholder:"Enter discount amount"},null,2),[[U,g.value.discount_amount]]),i.value.discount_amount?(o(),l("small",da,n(i.value.discount_amount[0]),1)):y("",!0)]),t("div",ua,[e[31]||(e[31]=t("label",{class:"form-label"},"Start Date",-1)),p(u,{modelValue:g.value.start_date,"onUpdate:modelValue":e[8]||(e[8]=a=>g.value.start_date=a),format:m(D),"min-date":new Date,enableTimePicker:!1,placeholder:"Select Start date",class:b({"is-invalid":i.value.start_date})},null,8,["modelValue","format","min-date","class"]),i.value.start_date?(o(),l("small",ca,n(i.value.start_date[0]),1)):y("",!0)]),t("div",ma,[e[32]||(e[32]=t("label",{class:"form-label"},"End Date",-1)),p(u,{modelValue:g.value.end_date,"onUpdate:modelValue":e[9]||(e[9]=a=>g.value.end_date=a),format:m(D),"min-date":new Date,enableTimePicker:!1,placeholder:"Select End date",class:b({"is-invalid":i.value.end_date})},null,8,["modelValue","format","min-date","class"]),i.value.end_date?(o(),l("small",pa,n(i.value.end_date[0]),1)):y("",!0)]),t("div",va,[e[33]||(e[33]=t("label",{class:"form-label"},"Minimum Purchase Amount",-1)),j(t("input",{"onUpdate:modelValue":e[10]||(e[10]=a=>g.value.min_purchase=a),type:"number",step:"0.01",class:b(["form-control",{"is-invalid":i.value.min_purchase}]),placeholder:"0.00"},null,2),[[U,g.value.min_purchase]]),i.value.min_purchase?(o(),l("small",fa,n(i.value.min_purchase[0]),1)):y("",!0)]),t("div",ga,[e[34]||(e[34]=t("label",{class:"form-label"},"Maximum Discount",-1)),j(t("input",{"onUpdate:modelValue":e[11]||(e[11]=a=>g.value.max_discount=a),type:"number",step:"0.01",class:b(["form-control",{"is-invalid":i.value.max_discount}]),placeholder:"0.00"},null,2),[[U,g.value.max_discount]]),i.value.max_discount?(o(),l("small",ba,n(i.value.max_discount[0]),1)):y("",!0)]),t("div",ha,[e[35]||(e[35]=t("label",{class:"form-label"},"Description (Optional)",-1)),j(t("textarea",{"onUpdate:modelValue":e[12]||(e[12]=a=>g.value.description=a),class:b(["form-control",{"is-invalid":i.value.description}]),rows:"3",placeholder:"Enter promo description"},null,2),[[U,g.value.description]]),i.value.description?(o(),l("small",_a,n(i.value.description[0]),1)):y("",!0)])]),e[38]||(e[38]=t("hr",{class:"my-4"},null,-1)),t("div",ya,[t("button",{class:"btn btn-primary rounded-pill px-4",disabled:I.value,onClick:e[13]||(e[13]=a=>Be())},[I.value?(o(),l(N,{key:0},[e[36]||(e[36]=t("span",{class:"spinner-border spinner-border-sm me-2"},null,-1)),e[37]||(e[37]=V(" Saving... ",-1))],64)):(o(),l(N,{key:1},[V(n((A.value,"Save")),1)],64))],8,xa),t("button",{class:"btn btn-secondary rounded-pill px-4 ms-2","data-bs-dismiss":"modal",onClick:K}," Cancel ")])])])])])])]),_:1})]),_:1}),p(m(ce),{value:"1"},{default:M(()=>[t("div",Sa,[t("div",wa,[t("div",Pa,[t("div",ka,[e[40]||(e[40]=t("h5",{class:"mb-0 fw-semibold"},"Promo Scope",-1)),t("div",Da,[t("button",{"data-bs-toggle":"modal","data-bs-target":"#promoScopeModal",onClick:J,class:"d-flex align-items-center gap-1 px-4 py-2 rounded-pill btn btn-primary text-white"},[p(m(_e),{class:"w-4 h-4"}),e[39]||(e[39]=V(" Add Promo Scope ",-1))])])]),t("div",Ma,[t("table",Ca,[e[42]||(e[42]=t("thead",{class:"border-top small text-muted"},[t("tr",null,[t("th",null,"S.#"),t("th",null,"Promo Name"),t("th",null,"Meals"),t("th",null,"Menu Items"),t("th",{class:"text-center"},"Action")])],-1)),t("tbody",null,[(o(!0),l(N,null,de(ee.value,(a,S)=>(o(),l("tr",{key:a.id},[t("td",null,n(S+1),1),t("td",null,[a.promos&&a.promos.length>0?(o(),l("span",Fa,n(a.promos.map(_=>_.name).join(", ")),1)):(o(),l("span",Ia,"N/A"))]),t("td",null,[a.meals&&a.meals.length>0?(o(),l("span",Va,n(a.meals.map(_=>_.name).join(", ")),1)):(o(),l("span",$a,"None"))]),t("td",null,[a.menu_items&&a.menu_items.length>0?(o(),l("span",Ta,n(a.menu_items.map(_=>_.name).join(", ")),1)):(o(),l("span",Ea,"None"))]),t("td",Na,[t("button",{onClick:_=>Oe(a),title:"Edit",class:"p-2 rounded-full text-blue-600 hover:bg-blue-100"},[p(m(ye),{class:"w-4 h-4"})],8,Aa)])]))),128)),ee.value.length===0?(o(),l("tr",La,[...e[41]||(e[41]=[t("td",{colspan:"5",class:"text-center text-muted py-4"}," No promo scopes found. ",-1)])])):y("",!0)])])])])]),t("div",Ba,[t("div",ja,[t("div",Ua,[t("div",Oa,[t("h5",Ra,n(O.value?"Edit Promo Scope":"Add New Promo Scope"),1),t("button",{class:"absolute top-2 right-2 p-2 rounded-full hover:bg-gray-100 transition transform hover:scale-110","data-bs-dismiss":"modal","aria-label":"Close",title:"Close",onClick:J},[...e[43]||(e[43]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),t("div",Za,[t("div",za,[t("div",qa,[e[44]||(e[44]=t("label",{class:"form-label"},"Select Promos *",-1)),p(m(ue),{modelValue:x.value.promos,"onUpdate:modelValue":e[14]||(e[14]=a=>x.value.promos=a),options:$.value,optionLabel:"name",optionValue:"id",placeholder:"Select promos",class:b(["w-100",{"is-invalid":w.value.promos}]),display:"chip",appendTo:"self",autoZIndex:!0,baseZIndex:2e3,filter:!0},null,8,["modelValue","options","class"]),w.value.promos?(o(),l("small",Xa,n(w.value.promos[0]),1)):y("",!0)]),t("div",Ha,[e[45]||(e[45]=t("label",{class:"form-label"},"Select Meals",-1)),p(m(ue),{modelValue:x.value.meals,"onUpdate:modelValue":e[15]||(e[15]=a=>x.value.meals=a),options:we.value,optionLabel:"name",optionValue:"id",placeholder:"Select meals",class:b(["w-100",{"is-invalid":w.value.meals}]),display:"chip",appendTo:"self",autoZIndex:!0,baseZIndex:2e3,filter:!0},null,8,["modelValue","options","class"]),w.value.meals?(o(),l("small",Ya,n(w.value.meals[0]),1)):y("",!0)]),t("div",Ga,[e[46]||(e[46]=t("label",{class:"form-label"},"Select Menu Items",-1)),p(m(ue),{modelValue:x.value.menu_items,"onUpdate:modelValue":e[16]||(e[16]=a=>x.value.menu_items=a),options:Pe.value,optionLabel:"name",optionValue:"id",placeholder:"Select menu items",class:b(["w-100",{"is-invalid":w.value.menu_items}]),display:"chip",appendTo:"self",autoZIndex:!0,baseZIndex:2e3,filter:!0},null,8,["modelValue","options","class"]),w.value.menu_items?(o(),l("small",Ka,n(w.value.menu_items[0]),1)):y("",!0)])]),e[49]||(e[49]=t("hr",{class:"my-4"},null,-1)),t("div",Ja,[t("button",{class:"btn btn-secondary rounded-pill px-4 me-2","data-bs-dismiss":"modal",onClick:J}," Cancel "),t("button",{class:"btn btn-primary rounded-pill px-4",disabled:I.value,onClick:je},[I.value?(o(),l(N,{key:0},[e[47]||(e[47]=t("span",{class:"spinner-border spinner-border-sm me-2"},null,-1)),e[48]||(e[48]=V(" Saving... ",-1))],64)):(o(),l(N,{key:1},[V(" Save ")],64))],8,Wa)])])])])])])]),_:1})]),_:1})]),_:1})])]),_:1})}}},Ds=Je(Qa,[["__scopeId","data-v-3c900e1f"]]);export{Ds as default};
