import{_ as ce,A as pe,c as G,r as v,o as me,n as N,y as W,f as n,b as i,d as x,e as t,u as B,h as ve,m as _,k as S,v as k,l as C,F as T,g as H,t as m,C as fe,T as he,i as V,p as P,q as r}from"./app-DrUr72II.js";import{E as ge,a as be,X as ye,u as D,w as _e}from"./xlsx-7aOw9oZM.js";import{I as we}from"./importFile-AWru9xi7.js";import{P as xe}from"./plus-CmrmLSaN.js";import{P as Se}from"./pencil-Be4IWqC2.js";import"./createLucideIcon-BENYThoS.js";const ke={class:"card border-0 shadow-lg rounded-4"},Ce={class:"card-body"},Pe={class:"d-flex flex-wrap gap-2 justify-content-between align-items-center mb-3"},Ee={class:"d-flex flex-wrap gap-2 align-items-center"},De={class:"search-wrap"},Ie={key:1,class:"form-control search-input",placeholder:"Search",disabled:"",type:"text"},Ae={class:"dropdown"},$e={class:"dropdown-menu dropdown-menu-end shadow rounded-4 py-2"},Fe={class:"table-responsive"},Te={class:"table table-hover align-middle"},Ve={key:0},Me={class:"fw-semibold"},Le={class:"text-break",style:{"max-width":"240px"}},Ue={class:"text-truncate",style:{"max-width":"260px"}},Ne={class:"text-center"},Be={class:"d-inline-flex align-items-center gap-3"},je=["onClick"],Re={key:0},qe={colspan:"7",class:"text-center text-muted py-4"},Oe={key:0,class:"mt-4 d-flex justify-content-between align-items-center"},Ke={class:"text-muted small"},ze={class:"modal fade",id:"modalAddSupplier",tabindex:"-1","aria-labelledby":"modalAddSupplier","aria-hidden":"true"},Xe={class:"modal-dialog modal-lg modal-dialog-centered",role:"document"},Ge={class:"modal-content rounded-4"},We={class:"modal-header"},He={class:"modal-title fw-semibold"},Ye={class:"modal-body"},Je={class:"row g-3"},Qe={class:"col-lg-6"},Ze={key:0,class:"text-danger"},et={class:"col-lg-6"},tt={key:0,class:"text-danger"},lt={class:"col-lg-6"},ot={class:"input-group"},st={key:0,class:"text-danger d-block mt-1"},at={key:1,class:"text-danger d-block mt-1"},rt={key:2,class:"text-success d-block mt-1"},nt={class:"col-lg-6"},it={class:"col-lg-12"},dt={key:0,class:"text-danger"},ut={class:"col-md-2"},ct=["disabled"],pt={key:0,class:"spinner-border spinner-border-sm me-2"},mt=["disabled"],vt={key:0,class:"spinner-border spinner-border-sm me-2"},I="+44",ft={__name:"SuppliersTab",setup(ht){const Y=pe();G(()=>Y.props.onboarding.language_and_location?.country_id??"PK");const E=v([]),g=v({current_page:1,last_page:1,per_page:10,total:0,from:0,to:0,links:[]});v(1),v(15);const w=async(l=null)=>{d.value=!0;try{const{data:e}=await P.get("/suppliers",{params:{q:b.value,page:l||g.value.current_page,per_page:g.value.per_page}});E.value=e.data||[],g.value={current_page:e.current_page,last_page:e.last_page,per_page:e.per_page,total:e.total,from:e.from,to:e.to,links:e.links},await N(),window.feather?.replace()}catch(e){console.error("Failed to fetch suppliers",e),r.error("Failed to load suppliers")}finally{d.value=!1}},J=l=>{if(!l)return;const o=new URLSearchParams(l.split("?")[1]).get("page");o&&w(parseInt(o))},b=v(""),j=v(Date.now()),M=`search-${Math.random().toString(36).substr(2,9)}`,R=v(!1);me(async()=>{b.value="",j.value=Date.now(),await N(),setTimeout(()=>{R.value=!0;const l=document.getElementById(M);l&&(l.value="",b.value="")},100),await w()});const Q=l=>{l.target.value="",b.value=""},q=G(()=>{const l=b.value.trim().toLowerCase();if(!l)return E.value;const e=l.replace(/\D/g,"");return E.value.filter(o=>{const a=[o.name,o.email,o.address,o.preferred_items].some(p=>(p||"").toLowerCase().includes(l)),f=(o.phone||"").replace(/\D/g,""),h=(o.contact||"").replace(/\D/g,""),c=e&&(f.includes(e)||h.includes(e));return a||c})}),Z=async()=>{try{d.value=!0;const l=await P.get("/suppliers",{params:{q:b.value.trim(),per_page:1e4,page:1}});return console.log("ðŸ“¦ Export data received:",{total:l.data.total,items:l.data.data.length}),l.data.data||[]}catch(l){return console.error("âŒ Error fetching export data:",l),r.error("Failed to load data for export"),[]}finally{d.value=!1}},L=async l=>{try{d.value=!0,r.info("Preparing export data...",{autoClose:1500});const e=await Z();if(!e||e.length===0){r.error("No suppliers found to download"),d.value=!1;return}console.log(`ðŸ“¥ Exporting ${e.length} suppliers as ${l.toUpperCase()}`),l==="pdf"?te(e):l==="excel"?le(e):l==="csv"?ee(e):r.error("Invalid download type")}catch(e){console.error("Download failed:",e),r.error(`Download failed: ${e.message}`)}finally{d.value=!1}},ee=l=>{try{const e=["Name","Email","Phone","Address","Preferred Items"],o=l.map(p=>[`"${p.name||""}"`,`"${p.email||""}"`,`"${p.contact||""}"`,`"${p.address||""}"`,`"${p.preferred_items||""}"`]),a=[e.join(","),...o.map(p=>p.join(","))].join(`
`),f=new Blob([a],{type:"text/csv;charset=utf-8;"}),h=URL.createObjectURL(f),c=document.createElement("a");c.setAttribute("href",h),c.setAttribute("download",`suppliers_${new Date().toISOString().split("T")[0]}.csv`),document.body.appendChild(c),c.click(),document.body.removeChild(c),r.success("CSV downloaded successfully .",{autoClose:2500})}catch(e){console.error("CSV generation error:",e),r.error(`CSV generation failed: ${e.message}`,{autoClose:5e3})}},te=l=>{try{const e=new ge("p","mm","a4");e.setFont("helvetica","bold"),e.setFontSize(18),e.text("Suppliers Report",70,20),e.setFont("helvetica","normal"),e.setFontSize(10);const o=new Date().toLocaleString();e.text(`Generated on: ${o}`,14,30),e.text(`Total Suppliers: ${l.length}`,14,36);const a=["Name","Email","Phone","Address","Preferred Items"],f=l.map(c=>[c.name||"",c.email||"",c.contact||"",c.address||"",c.preferred_items||""]);be(e,{head:[a],body:f,startY:45,styles:{fontSize:9,cellPadding:3,halign:"left",valign:"middle",lineColor:[200,200,200],lineWidth:.1},headStyles:{fillColor:[41,128,185],textColor:255,fontStyle:"bold"},alternateRowStyles:{fillColor:[245,245,245]},margin:{left:14,right:14},didDrawPage:c=>{const p=e.internal.getNumberOfPages(),ue=e.internal.pageSize.height;e.setFontSize(8),e.text(`Page ${c.pageNumber} of ${p}`,14,ue-10)}});const h=`suppliers_${new Date().toISOString().split("T")[0]}.pdf`;e.save(h),r.success("PDF downloaded successfully.",{autoClose:2500})}catch(e){console.error("PDF generation error:",e),r.error(`PDF generation failed: ${e.message}`,{autoClose:5e3})}},le=l=>{try{if(typeof ye>"u")throw new Error("XLSX library is not loaded");const e=l.map(p=>({Name:p.name||"",Email:p.email||"",Phone:p.contact||"",Address:p.address||"","Preferred Items":p.preferred_items||""})),o=D.book_new(),a=D.json_to_sheet(e);a["!cols"]=[{wch:20},{wch:25},{wch:18},{wch:30},{wch:25}],D.book_append_sheet(o,a,"Suppliers");const f=[{Info:"Generated On",Value:new Date().toLocaleString()},{Info:"Total Records",Value:l.length},{Info:"Exported By",Value:"Supplier Management System"}],h=D.json_to_sheet(f);D.book_append_sheet(o,h,"Report Info");const c=`suppliers_${new Date().toISOString().split("T")[0]}.xlsx`;_e(o,c),r.success("Excel file downloaded successfully.",{autoClose:2500})}catch(e){console.error("Excel generation error:",e),r.error(`Excel generation failed: ${e.message}`,{autoClose:5e3})}},s=v({name:"",email:"",phone_country:"GB",phone_code:I,phone_local:"",phone:"",address:"",preferred_items:""}),y=v(""),A=v(!1),O=v([]),K=()=>{y.value="",O.value=[],A.value=!1;const l=String(s.value.phone_local||"").trim();if(!l)return y.value="Phone number is required",!1;let e=l.replace(/\D+/g,"");if(e.length!==10)return y.value="UK mobile number must be exactly 10 digits",!1;if(!e.startsWith("7"))return y.value="UK mobile numbers must start with 7",!1;if(!/^7[0-9]{9}$/.test(e))return y.value="Invalid UK mobile number format",!1;const a=e.substring(1,3);return["11","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99"].includes(a)?(A.value=!0,!0):(y.value="Invalid UK mobile operator code",!1)};function oe(){const l=String(s.value.phone_local||"").replace(/\D+/g,"");s.value.phone=I+l}W(()=>s.value.phone_local,l=>{oe(),K()});let z=null;W(b,()=>{clearTimeout(z),z=setTimeout(()=>{g.value.current_page=1,w(1)},500)});const d=v(!1),u=v({}),X=l=>{const e=document.getElementById(l);if(!e)return;(window.bootstrap?.Modal.getInstance(e)||new window.bootstrap.Modal(e)).hide()},U=()=>{s.value={name:"",email:"",phone:"",address:"",preferred_items:""},u.value={},F.value=null},se=()=>{d.value=!0,u.value={};const l={name:s.value.name,email:s.value.email,contact:s.value.phone||null,address:s.value.address||null,preferred_items:s.value.preferred_items||null};P.post("/suppliers",l).then(e=>{w(),r.success("Supplier added successfully.",{autoClose:1500}),U(),X("modalAddSupplier")}).catch(e=>{e?.response?.status===422&&e.response.data?.errors?(u.value=e.response.data.errors,r.error("Please fill in all required fields correctly.")):(r.error("Something went wrong. Please try again.",{autoClose:3e3}),console.error(e))}).finally(()=>{d.value=!1})},ae=l=>{const e=document.getElementById(l);if(!e)return;new window.bootstrap.Modal(e).show()},$=v(),F=v(null),re=l=>{$.value="Edit",F.value=l,s.value={name:l.name||"",email:l.email||"",phone_country:"GB",phone_code:I,phone_local:l.phone?l.phone.replace(I,"").trim():l.contact?l.contact.replace(I,"").trim():"",phone:l.phone||l.contact||"",address:l.address||"",preferred_items:l.preferred_items??l.preferred_items??""},ae("modalAddSupplier")},ne=()=>{if(!F.value)return;d.value=!0,u.value={};const l={id:F.value.id,name:s.value.name,email:s.value.email,contact:s.value.phone||null,address:s.value.address||null,preferred_items:s.value.preferred_items||null};P.post("/suppliers/update",l).then(e=>(w(),r.success("Supplier updated successfully .",{autoClose:500}),U(),X("modalAddSupplier"),N())).catch(e=>{e?.response?.status===422&&e.response.data?.errors?(u.value=e.response.data.errors,r.error("Validation failed. Please check the fields.",{autoClose:3e3})):(r.error("Update failed. Please try again.",{autoClose:3e3}),console.error(e))}).finally(()=>{d.value=!1})},ie=l=>{d.value=!0,P.delete(`/suppliers/${l}`).then(()=>{E.value=E.value.filter(e=>e.id!==l),r.success("Supplier deleted successfully.")}).catch(e=>{r.error("Delete failed. Please try again.",{autoClose:3e3}),console.error(e)}).finally(()=>{d.value=!1})},de=l=>{if(!l||l.length<=1){r.error("The file is empty",{autoClose:3e3});return}l[0];const o=l.slice(1).map(a=>({name:a[0]||"",email:a[1]||"",contact:a[2]||"",address:a[3]||"",preferred_items:a[4]||""}));P.post("/api/suppliers/import",{suppliers:o}).then(()=>{r.success("Suppliers imported successfully");const a=document.querySelector(".modal.show");if(a){const f=bootstrap.Modal.getInstance(a);f&&f.hide()}setTimeout(()=>{document.querySelectorAll(".modal-backdrop").forEach(h=>h.remove()),document.body.classList.remove("modal-open"),document.body.style.overflow="",document.body.style.paddingRight=""},100),w()}).catch(a=>{a?.response?.status===422&&a.response.data?.errors&&(u.value=a.response.data.errors,r.error("There may be some duplication in data",{autoClose:3e3})),setTimeout(()=>{document.querySelectorAll(".modal-backdrop").forEach(h=>h.remove()),document.body.classList.remove("modal-open"),document.body.style.overflow="",document.body.style.paddingRight=""},100)})};return(l,e)=>(i(),n(T,null,[x(B(ve),{title:"Supplier"}),t("div",ke,[t("div",Ce,[t("div",Pe,[e[16]||(e[16]=t("h4",{class:"mb-0"},"Suppliers",-1)),t("div",Ee,[t("div",De,[e[12]||(e[12]=t("i",{class:"bi bi-search"},null,-1)),e[13]||(e[13]=t("input",{type:"email",name:"email",autocomplete:"email",style:{position:"absolute",left:"-9999px",width:"1px",height:"1px"},tabindex:"-1","aria-hidden":"true"},null,-1)),R.value?S((i(),n("input",{id:M,"onUpdate:modelValue":e[0]||(e[0]=o=>b.value=o),key:j.value,class:"form-control search-input",placeholder:"Search",type:"search",autocomplete:"new-password",name:M,role:"presentation",onFocus:Q},null,32)),[[k,b.value]]):(i(),n("input",Ie))]),t("button",{"data-bs-toggle":"modal","data-bs-target":"#modalAddSupplier",onClick:e[1]||(e[1]=()=>{U(),u.value={},$.value="Add"}),class:"d-flex align-items-center gap-1 px-4 btn-sm py-2 rounded-pill btn-sm btn btn-primary text-white"},[x(B(xe),{class:"w-4 h-4"}),e[14]||(e[14]=C(" Add Supplier ",-1))]),x(we,{label:"Import",sampleHeaders:["Name","Email","Phone","Address","Preferred Items"],sampleData:[["Ali Khan","ali@example.com","+44 3721232321","Lahore","Steel"],["Ahmed Raza","ahmed@example.com","+44 5676576576","Karachi","Cement"]],onOnImport:de}),t("div",Ae,[e[15]||(e[15]=t("button",{class:"btn btn-outline-secondary btn-sm rounded-pill py-2 px-4 dropdown-toggle","data-bs-toggle":"dropdown"}," Export ",-1)),t("ul",$e,[t("li",null,[t("a",{class:"dropdown-item py-2",href:"javascript:;",onClick:e[2]||(e[2]=o=>L("pdf"))}," Export as PDF ")]),t("li",null,[t("a",{class:"dropdown-item py-2",href:"javascript:;",onClick:e[3]||(e[3]=o=>L("excel"))}," Export as Excel ")]),t("li",null,[t("a",{class:"dropdown-item py-2",href:"javascript:;",onClick:e[4]||(e[4]=o=>L("csv"))}," Export as CSV ")])])])])]),t("div",Fe,[t("table",Te,[e[18]||(e[18]=t("thead",{class:"border-top small text-muted"},[t("tr",null,[t("th",null,"S. #"),t("th",null,"Supplier name"),t("th",null,"Contact"),t("th",null,"Email"),t("th",null,"Address"),t("th",null,"Items Linked"),t("th",{class:"text-center"},"Action")])],-1)),t("tbody",null,[d.value?(i(),n("tr",Ve,[...e[17]||(e[17]=[t("td",{colspan:"7",class:"text-center py-5"},[t("div",{class:"spinner-border text-primary",role:"status"},[t("span",{class:"visually-hidden"},"Loading...")]),t("p",{class:"text-muted mt-2 mb-0"},"Loading suppliers...")],-1)])])):(i(),n(T,{key:1},[(i(!0),n(T,null,H(q.value,(o,a)=>(i(),n("tr",{key:o.id},[t("td",null,m(g.value.from+a),1),t("td",Me,m(o.name),1),t("td",null,m(o.contact),1),t("td",Le,m(o.email),1),t("td",Ue,m(o.address),1),t("td",null,m(o.preferred_items),1),t("td",Ne,[t("div",Be,[t("button",{onClick:()=>{re(o),u.value={}},title:"Edit",class:"p-2 rounded-full text-blue-600 hover:bg-blue-100"},[x(B(Se),{class:"w-4 h-4"})],8,je),x(fe,{title:"Confirm Delete",message:`Are you sure you want to delete ${o.name}?`,showDeleteButton:!0,onConfirm:()=>ie(o.id),onCancel:()=>{}},null,8,["message","onConfirm"])])])]))),128)),q.value.length===0?(i(),n("tr",Re,[t("td",qe,m(b.value.trim()?"No suppliers found matching your search.":"No suppliers found."),1)])):_("",!0)],64))])])]),!d.value&&g.value.last_page>1?(i(),n("div",Oe,[t("div",Ke," Showing "+m(g.value.from)+" to "+m(g.value.to)+" of "+m(g.value.total)+" entries ",1),x(he,{pagination:g.value.links,isApiDriven:!0,onPageChanged:J},null,8,["pagination"])])):_("",!0)])]),t("div",ze,[t("div",Xe,[t("div",Ge,[t("div",We,[t("h5",He,m($.value==="Add"?"Add Supplier":"Edit Supplier"),1),e[19]||(e[19]=t("button",{class:"absolute top-2 right-2 p-2 rounded-full hover:bg-gray-100 transition transform hover:scale-110","data-bs-dismiss":"modal","aria-label":"Close",title:"Close"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})])],-1))]),t("div",Ye,[t("div",Je,[t("div",Qe,[e[20]||(e[20]=t("label",{class:"form-label"},"Name",-1)),S(t("input",{class:V(["form-control",{"is-invalid":u.value.name}]),"onUpdate:modelValue":e[5]||(e[5]=o=>s.value.name=o)},null,2),[[k,s.value.name]]),u.value.name?(i(),n("small",Ze,m(u.value.name[0]),1)):_("",!0)]),t("div",et,[e[21]||(e[21]=t("label",{class:"form-label"},"Email",-1)),S(t("input",{class:V(["form-control",{"is-invalid":u.value.email}]),"onUpdate:modelValue":e[6]||(e[6]=o=>s.value.email=o)},null,2),[[k,s.value.email]]),u.value.email?(i(),n("small",tt,m(u.value.email[0]),1)):_("",!0)]),t("div",lt,[e[26]||(e[26]=t("label",{class:"form-label"},"Phone*",-1)),t("div",ot,[e[22]||(e[22]=t("span",{class:"input-group-text p-0"},[t("input",{type:"text",class:"form-control text-center border-0 country-code bg-light fw-semibold",value:"+44",readonly:"",style:{width:"70px"}})],-1)),S(t("input",{class:V(["form-control phone-input",{"is-invalid":y.value,"is-valid":A.value&&s.value.phone_local}]),inputmode:"numeric",placeholder:"7311865859","onUpdate:modelValue":e[7]||(e[7]=o=>s.value.phone_local=o),onBlur:K,maxlength:"10"},null,34),[[k,s.value.phone_local]])]),y.value?(i(),n("small",st,[e[23]||(e[23]=t("i",{class:"bi bi-exclamation-circle me-1"},null,-1)),C(m(y.value),1)])):u.value.contact?(i(),n("small",at,m(u.value.contact[0]),1)):_("",!0),A.value&&s.value.phone_local?(i(),n("small",rt,[...e[24]||(e[24]=[t("i",{class:"bi bi-check-circle me-1"},null,-1),C("âœ“ Valid UK phone number ",-1)])])):_("",!0),(i(!0),n(T,null,H(O.value,(o,a)=>(i(),n("small",{key:a,class:"text-info d-block mt-1"},[e[25]||(e[25]=t("i",{class:"bi bi-info-circle me-1"},null,-1)),C(m(o),1)]))),128))]),t("div",nt,[e[27]||(e[27]=t("label",{class:"form-label"},"Preferred Items",-1)),S(t("input",{class:"form-control","onUpdate:modelValue":e[8]||(e[8]=o=>s.value.preferred_items=o)},null,512),[[k,s.value.preferred_items]])]),t("div",it,[e[28]||(e[28]=t("label",{class:"form-label"},"Address",-1)),S(t("textarea",{class:V(["form-control",{"is-invalid":u.value.address}]),rows:"4","onUpdate:modelValue":e[9]||(e[9]=o=>s.value.address=o)},null,2),[[k,s.value.address]]),u.value.address?(i(),n("small",dt,m(u.value.address[0]),1)):_("",!0)]),t("div",ut,[$.value==="Edit"?(i(),n("button",{key:0,class:"btn btn-primary btn-sm py-2 rounded-pill w-100 mt-4",disabled:d.value,onClick:e[10]||(e[10]=o=>ne())},[d.value?(i(),n("span",pt)):_("",!0),e[29]||(e[29]=C(" Save ",-1))],8,ct)):(i(),n("button",{key:1,class:"btn btn-primary rounded-pill btn-sm py-2 w-100 mt-4",disabled:d.value,onClick:e[11]||(e[11]=o=>se())},[d.value?(i(),n("span",vt)):_("",!0),e[30]||(e[30]=C(" Save ",-1))],8,mt))])])])])])])],64))}},St=ce(ft,[["__scopeId","data-v-7fc2fc3d"]]);export{St as default};
