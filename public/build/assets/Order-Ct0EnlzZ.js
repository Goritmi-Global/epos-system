import{_ as pe,r as v,y as Be,a as Ve,b as d,w as ee,f as r,m as y,e,t as o,k as L,v as H,l as T,V as ze,o as ce,n as qe,c as P,d as I,u as f,h as Ue,F as A,g as X,S as me,i as Ge,q as x}from"./app-DMbHFmC5.js";import{_ as Xe}from"./Master--aLkyPB4.js";import{u as He}from"./useFormatters-DkTAsbQy.js";import{F as We}from"./FilterModal-Bd1IeshY.js";import{E as Ke,a as Ye,X as Qe,u as B,w as Ze}from"./xlsx-Dn9bPu55.js";import{E as Je}from"./eye-DTNAA8NV.js";import{C as et}from"./circle-x-nQJ8attk.js";import"./index-DDH_kpx5.js";import"./createLucideIcon-nU0DI13Y.js";import"./index-n9M0qU1L.js";import"./index-CPY7-peg.js";import"./sun-5uuJSwg3.js";const tt={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50"},st={class:"bg-white rounded-xl shadow-xl w-full max-w-md p-6 animate-drop-in relative"},lt={class:"text-center text-lg font-medium text-gray-800 mb-2"},at={class:"bg-gray-50 rounded-lg p-4 mb-4 space-y-2"},ot={class:"flex justify-between text-sm"},nt={class:"font-medium text-gray-800"},dt={class:"flex justify-between text-sm"},rt={class:"font-medium text-gray-800"},it={class:"flex justify-between text-sm"},ut={class:"font-medium text-gray-800"},ct={class:"mb-4"},mt={class:"flex justify-center gap-3"},pt=["disabled"],vt={key:0,class:"spinner-border spinner-border-sm",role:"status"},yt=["disabled"],bt={__name:"OrderCancellationModal",props:{show:{type:Boolean,default:!1},order:{type:Object,default:null},loading:{type:Boolean,default:!1}},emits:["confirm","cancel"],setup(k,{emit:w}){const V=k,F=w,$=v("");Be(()=>V.show,g=>{g||($.value="")});const D=()=>{F("confirm",$.value||"Cancelled by admin from orders page")},S=()=>{F("cancel")},c=g=>new Intl.NumberFormat("en-GB",{style:"currency",currency:"GBP"}).format(g||0);return(g,b)=>(d(),Ve(ze,{name:"fade-slide"},{default:ee(()=>[k.show?(d(),r("div",tt,[e("div",st,[e("button",{class:"absolute top-2 right-2 p-2 rounded-full hover:bg-gray-100 transition transform hover:scale-110",onClick:S,"data-bs-dismiss":"modal","aria-label":"Close",title:"Close"},[...b[1]||(b[1]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)])]),b[6]||(b[6]=e("div",{class:"flex justify-center mb-4"},[e("div",{class:"bg-red-100 p-3 rounded-full"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-8 h-8 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})])])],-1)),e("h3",lt," Cancel Order #"+o(k.order?.id)+"? ",1),b[7]||(b[7]=e("p",{class:"text-center text-sm text-gray-500 mb-4"}," This action will cancel the order and cannot be undone. ",-1)),e("div",at,[e("div",ot,[b[2]||(b[2]=e("span",{class:"text-gray-600"},"Customer:",-1)),e("span",nt,o(k.order?.customer_name||"Walk In"),1)]),e("div",dt,[b[3]||(b[3]=e("span",{class:"text-gray-600"},"Total Amount:",-1)),e("span",rt,o(c(k.order?.total_amount)),1)]),e("div",it,[b[4]||(b[4]=e("span",{class:"text-gray-600"},"Payment Type:",-1)),e("span",ut,o(k.order?.payment?.payment_type||"N/A"),1)])]),e("div",ct,[b[5]||(b[5]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Reason for Cancellation (Optional) ",-1)),L(e("textarea",{"onUpdate:modelValue":b[0]||(b[0]=W=>$.value=W),class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-1 focus:ring-white focus:border-transparent resize-none",rows:"3",placeholder:"Enter reason for cancelling this order..."},null,512),[[H,$.value]])]),e("div",mt,[e("button",{onClick:D,disabled:k.loading,class:"btn btn-danger d-flex align-items-center gap-2 px-4 py-2 rounded-pill text-white"},[k.loading?(d(),r("span",vt)):y("",!0),T(" "+o(k.loading?"Cancelling...":"Cancel Order"),1)],8,pt),e("button",{onClick:S,disabled:k.loading,class:"btn btn-secondary d-flex align-items-center gap-2 px-4 py-2 rounded-pill text-white"}," Keep Order ",8,yt)])])])):y("",!0)]),_:1}))}},ft=pe(bt,[["__scopeId","data-v-828b9886"]]),wt={class:"page-wrapper"},gt={class:"row g-3"},ht={class:"col-md-6 col-xl-4"},xt={class:"card border-0 shadow-sm rounded-4"},_t={class:"card-body d-flex align-items-center justify-content-between"},Ct={class:"mb-0 fw-bold"},kt={class:"col-md-6 col-xl-4"},$t={class:"card border-0 shadow-sm rounded-4"},Tt={class:"card-body d-flex align-items-center justify-content-between"},Dt={class:"mb-0 fw-bold"},St={class:"col-md-6 col-xl-4"},Ot={class:"card border-0 shadow-sm rounded-4"},Mt={class:"card-body d-flex align-items-center justify-content-between"},Ft={class:"mb-0 fw-bold"},Pt={class:"col-md-6 col-xl-3"},jt={class:"card border-0 shadow-sm rounded-4"},Nt={class:"card-body d-flex align-items-center justify-content-between"},It={class:"mb-0 fw-bold"},At={class:"card border-0 shadow-lg rounded-4 mt-0"},Lt={class:"card-body"},Et={class:"d-flex flex-wrap gap-2 justify-content-between align-items-center mb-3"},Rt={class:"d-flex flex-wrap gap-2 align-items-center"},Bt={class:"search-wrap"},Vt={key:1,class:"form-control search-input",placeholder:"Search",disabled:"",type:"text"},zt={class:"col-md-6"},qt=["onUpdate:modelValue"],Ut=["value"],Gt={class:"col-md-6 mt-3"},Xt=["onUpdate:modelValue"],Ht=["value"],Wt={class:"dropdown"},Kt={class:"dropdown-menu dropdown-menu-end shadow rounded-4 py-2"},Yt={class:"table-responsive"},Qt={class:"table table-hover align-middle mb-0"},Zt={key:0},Jt=["onClick"],es={style:{"font-size":"14px"}},ts={class:"text-muted small"},ss={class:"text-left"},ls={class:"d-flex gap-2 justify-content-center align-items-center"},as=["onClick"],os=["onClick","disabled"],ns=["onClick","disabled"],ds={key:0},rs={class:"modal fade",id:"paymentDetailsModal",tabindex:"-1","aria-hidden":"true"},is={class:"modal-dialog modal-md modal-dialog-centered"},us={class:"modal-content border-0 shadow-lg rounded-4 overflow-hidden"},cs={class:"modal-body p-4"},ms={class:"payment-info"},ps={class:"row g-3"},vs={class:"col-6"},ys={class:"info-card"},bs={class:"value"},fs={class:"col-6"},ws={class:"info-card"},gs={class:"value"},hs={key:0,class:"col-6"},xs={class:"info-card"},_s={class:"value"},Cs={key:1,class:"col-6"},ks={class:"info-card"},$s={class:"value"},Ts={class:"col-6"},Ds={class:"info-card"},Ss={class:"value"},Os={key:2,class:"col-6"},Ms={class:"info-card"},Fs={class:"value text-capitalize"},Ps={key:3,class:"col-6"},js={class:"info-card"},Ns={class:"value"},Is={key:4,class:"col-6"},As={class:"info-card"},Ls={class:"value"},Es={key:5,class:"col-6"},Rs={class:"info-card"},Bs={class:"value"},Vs={class:"modal fade",id:"orderDetailsModal",tabindex:"-1","aria-hidden":"true"},zs={class:"modal-dialog modal-lg modal-dialog-centered"},qs={class:"modal-content rounded-4 shadow border-0"},Us={class:"modal-header bg-white border-0 position-relative px-4 pt-4"},Gs={class:"d-flex align-items-center gap-3"},Xs={class:"d-flex flex-column"},Hs={class:"modal-title fw-bold mb-0"},Ws={class:"text-muted"},Ks={class:"modal-body bg-light px-4 pb-4"},Ys={key:0,class:"rounded-3 bg-white shadow-sm p-4"},Qs={class:"mb-4"},Zs={class:"row text-muted small"},Js={class:"col-md-4 mb-2"},el={class:"col-md-4 mb-2"},tl={class:"table-responsive"},sl={class:"table align-middle table-striped table-hover border rounded-3 overflow-hidden shadow-sm"},ll={class:"px-3"},al={class:"fw-semibold"},ol={class:"fw-bold text-success"},nl={key:0,class:"no-border"},dl={class:"text-success fw-semibold",colspan:"3"},rl={key:1,class:"no-border"},il={class:"text-success fw-semibold",colspan:"3"},ul={key:2,class:"no-border"},cl={class:"text-success fw-semibold",colspan:"3"},ml={key:3,class:"no-border"},pl={class:"text-success fw-semibold",colspan:"3"},vl={key:4,class:"no-border"},yl={class:"text-success fw-semibold",colspan:"3"},bl={key:5,class:"no-border"},fl={class:"text-success fw-semibold",colspan:"3"},wl={class:"border-top-thick"},gl={class:"fw-bold text-success"},hl={key:6},xl={class:"modal-footer bg-white border-0 shadow-sm px-4 py-3"},_l={class:"modal fade",id:"refundModal",tabindex:"-1","aria-hidden":"true"},Cl={class:"modal-dialog modal-dialog-centered"},kl={class:"modal-content rounded-4 shadow border-0"},$l={class:"modal-body"},Tl={class:"mb-3"},Dl={class:"bg-light p-3 rounded-3"},Sl={class:"d-flex justify-content-between mb-2"},Ol={class:"fw-semibold"},Ml={class:"d-flex justify-content-between mb-2"},Fl={class:"fw-semibold"},Pl={class:"d-flex justify-content-between mb-2"},jl={class:"fw-semibold"},Nl={class:"d-flex justify-content-between mb-2"},Il={class:"fw-semibold text-capitalize"},Al={key:0,class:"d-flex justify-content-between mb-2"},Ll={class:"fw-semibold text-success"},El={key:1,class:"d-flex justify-content-between"},Rl={class:"fw-semibold"},Bl={class:"mb-3"},Vl={class:"input-group"},zl=["max"],ql={class:"text-muted"},Ul={class:"mb-3"},Gl={class:"text-muted"},Xl={class:"modal-footer border-0"},Hl=["disabled"],Wl=["disabled"],Kl={key:0},Yl={key:1},Ql={__name:"Order",setup(k){const{formatCurrencySymbol:w,dateFmt:V}=He(),F=v(null),$=v(null),D=v(0),S=v(""),c=v(null),g=v([]),b=v(!1),W=async()=>{b.value=!0;try{const l=await axios.get("/api/orders/all");g.value=l.data.data}catch(l){console.error("Error fetching inventory:",l)}finally{b.value=!1}};ce(async()=>{j.value="",te.value=Date.now(),await qe(),setTimeout(()=>{se.value=!0;const t=document.getElementById(K);t&&(t.value="",j.value="")},100),W();const l=document.getElementById("orderFilterModal");l&&l.addEventListener("hidden.bs.modal",()=>{m.value={sortBy:O.value.sortBy||"",orderType:O.value.orderType||"",paymentType:O.value.paymentType||"",status:O.value.status||"",priceMin:O.value.priceMin||null,priceMax:O.value.priceMax||null,dateFrom:O.value.dateFrom||"",dateTo:O.value.dateTo||""}})});const j=v(""),te=v(Date.now()),K=`search-${Math.random().toString(36).substr(2,9)}`,se=v(!1),m=v({sortBy:"",orderType:"",paymentType:"",status:"",priceMin:null,priceMax:null,dateFrom:"",dateTo:""}),O=v({sortBy:"",orderType:"",paymentType:"",status:"",priceMin:null,priceMax:null,dateFrom:"",dateTo:""});v(["All","Dine In","Delivery","Takeaway"]),v(["All","Cash","Card","Split"]);const Y=P(()=>{const l=j.value.trim().toLowerCase();let t=[...g.value];return l&&(t=t.filter(s=>[String(s.id),s.type?.table_number??"",s.type?.order_type??"",s.customer_name??"",s.payment?.payment_type??"",s.status??"",String(s.total_amount??""),E(s.created_at),le(s.created_at)].join(" ").toLowerCase().includes(l))),m.value.orderType&&(t=t.filter(s=>(s.type?.order_type??"").toLowerCase()===m.value.orderType.toLowerCase())),m.value.paymentType&&(t=t.filter(s=>(s.payment?.payment_type??"").toLowerCase()===m.value.paymentType.toLowerCase())),m.value.status&&(t=t.filter(s=>s.status?.toLowerCase()===m.value.status.toLowerCase())),(m.value.priceMin!==null||m.value.priceMax!==null)&&(t=t.filter(s=>{const a=s.total_amount||0,i=m.value.priceMin||0,_=m.value.priceMax||1/0;return a>=i&&a<=_})),m.value.dateFrom&&(t=t.filter(s=>{const a=new Date(s.created_at),i=new Date(m.value.dateFrom);return a>=i})),m.value.dateTo&&(t=t.filter(s=>{const a=new Date(s.created_at),i=new Date(m.value.dateTo);return i.setHours(23,59,59,999),a<=i})),t}),ve=P(()=>{const l=[...Y.value];switch(m.value.sortBy){case"date_desc":return l.sort((s,a)=>new Date(a.created_at)-new Date(s.created_at));case"date_asc":return l.sort((s,a)=>new Date(s.created_at)-new Date(a.created_at));case"price_desc":return l.sort((s,a)=>(a.total_amount||0)-(s.total_amount||0));case"price_asc":return l.sort((s,a)=>(s.total_amount||0)-(a.total_amount||0));case"customer_asc":return l.sort((s,a)=>(s.customer_name||"").localeCompare(a.customer_name||""));case"customer_desc":return l.sort((s,a)=>(a.customer_name||"").localeCompare(s.customer_name||""));default:return l.sort((s,a)=>new Date(a.created_at)-new Date(s.created_at))}}),z=P(()=>({sortOptions:[{value:"date_desc",label:"Date: Newest First"},{value:"date_asc",label:"Date: Oldest First"},{value:"price_desc",label:"Price: High to Low"},{value:"price_asc",label:"Price: Low to High"},{value:"customer_asc",label:"Customer: A to Z"},{value:"customer_desc",label:"Customer: Z to A"}],orderTypeOptions:[{value:"Dine In",label:"Dine In"},{value:"Delivery",label:"Delivery"},{value:"Takeaway",label:"Takeaway"},{value:"Collection",label:"Collection"}],paymentTypeOptions:[{value:"Cash",label:"Cash"},{value:"Card",label:"Card"},{value:"Split",label:"Split"}],statusOptions:[{value:"paid",label:"Paid"},{value:"pending",label:"Pending"},{value:"cancelled",label:"Cancelled"}]})),ye=l=>{m.value={...m.value,...l},O.value={...m.value},console.log("Filters applied:",m.value)},be=()=>{m.value={sortBy:"",orderType:"",paymentType:"",status:"",priceMin:null,priceMax:null,dateFrom:"",dateTo:""},O.value={sortBy:"",orderType:"",paymentType:"",status:"",priceMin:null,priceMax:null,dateFrom:"",dateTo:""},console.log("Filters cleared")},fe=P(()=>g.value.length),we=P(()=>g.value.filter(l=>l.status==="paid").length),ge=P(()=>g.value.filter(l=>l.status!=="paid").length),he=P(()=>g.value.reduce((l,t)=>l+(Number(t.total_amount)||0),0));function E(l){const t=new Date(l),s=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),i=String(t.getDate()).padStart(2,"0");return`${s}-${a}-${i}`}function le(l){const t=Date.now()-new Date(l).getTime(),s=Math.floor(t/6e4);if(s<60)return`${s} minute${s===1?"":"s"} ago`;const a=Math.floor(s/60);if(a<24)return`${a} hour${a===1?"":"s"} ago`;const i=Math.floor(a/24);return`${i} day${i===1?"":"s"} ago`}function Q(l){const t=Number(l??0);return`£${Number.isInteger(t)?t.toFixed(0):t.toFixed(1)}`}const xe=v(!1),h=v(null),p=v(null);function _e(l){h.value=l,xe.value=!0,new bootstrap.Modal(document.getElementById("paymentDetailsModal")).show()}const Ce=l=>{p.value=l,new bootstrap.Modal(document.getElementById("orderDetailsModal")).show()};function ke(l){const t=C=>`£${Number(C??0).toFixed(2)}`,s=C=>(C??"").toString(),a=l?.payment??{},i=(a.payment_type??l?.payment_method??"Cash").toLowerCase(),_=a.cash_amount??l?.cash_amount??l?.cash_received??0,u=a.card_amount??l?.card_amount??0,n=a.brand??l?.card_brand??"",N=a.last_digits??l?.last4??l?.last_digits??"";let q="";if(i==="split")q=`Payment: Split (Cash: ${t(_)}, Card: ${t(u)})`;else if(i==="card"||i==="stripe"){const C=n?` (${n})`:"",G=N?` •••• ${N}`:"";q=`Payment: Card${C}${G}`}else q=`Payment: ${s(l?.payment_method)||"Cash"}`;const je=l?.id??"N/A",Ne=l?.type?.order_type??l?.order_type??"N/A",re=l?.type?.table_number??l?.table_number??null,Ie=l?.customer_name||"Walk In",R=l?.created_at?new Date(l.created_at):new Date,Ae=`${R.getFullYear()}-${String(R.getMonth()+1).padStart(2,"0")}-${String(R.getDate()).padStart(2,"0")} ${String(R.getHours()).padStart(2,"0")}:${String(R.getMinutes()).padStart(2,"0")}`,ie=Array.isArray(l?.items)?l.items:[],ue=l?.sub_total??ie.reduce((C,G)=>C+Number(G.price??0)*Number(G.quantity??0),0),Le=l?.total_amount??ue,Ee=ie.map(C=>`
    <div class="row">
      <span class="w-50 ellips">${s(C.title)}</span>
      <span class="w-20 right">x${Number(C.quantity??0)}</span>
      <span class="w-30 right">${t(C.price)}</span>
    </div>
  `).join(""),Re=`
<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Receipt</title>
<style>
  :root { --w: 58mm; }
  html, body { margin:0; padding:0; }
  body { width: var(--w); font-family: monospace; font-size: 12px; line-height: 1.3; color:#000; }
  .center { text-align:center; }
  .right { text-align:right; }
  .row { display:flex; justify-content:space-between; gap:4px; }
  .w-50 { width:50%; } .w-20 { width:20%; } .w-30 { width:30%; }
  .ellips { white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
  hr { border:0; border-top:1px dashed #000; margin:4px 0; }
  h3 { margin:0 0 2px 0; font-size: 14px; }
  small { font-size:11px; }
  .mt-4 { margin-top:4px; }
  .mb-4 { margin-bottom:4px; }
  .bold { font-weight:bold; }
  @page { size: var(--w) auto; margin: 3mm; }
  @media print { body { -webkit-print-color-adjust: exact; print-color-adjust: exact; } }
</style>
</head>
<body>
  <div class="center">
    <h3>Goritmi</h3>
    <small>Order #${je}</small><br/>
    <small>${Ae}</small>
  </div>

  <hr/>
  <div><small>Customer: ${s(Ie)}</small></div>
  <div><small>Order Type: ${s(Ne)}${re?` | Table: ${s(re)}`:""}</small></div>
  <div><small>${q}</small></div>

  <hr/>
  <div class="row bold"><span class="w-50">Item</span><span class="w-20 right">Qty</span><span class="w-30 right">Price</span></div>
  ${Ee}
  <hr/>

  <div class="row"><span>Subtotal:</span><span class="right">${t(ue)}</span></div>
  ${Number(l?.tax??0)?`<div class="row"><span>Tax:</span><span class="right">${t(l.tax)}</span></div>`:""}
  ${Number(l?.service_charges??0)?`<div class="row"><span>Service:</span><span class="right">${t(l.service_charges)}</span></div>`:""}
  ${Number(l?.delivery_charges??0)?`<div class="row"><span>Delivery:</span><span class="right">${t(l.delivery_charges)}</span></div>`:""}

  <div class="row bold mt-4"><span>Total:</span><span class="right">${t(Le)}</span></div>

  ${i==="cash"||!i?`<div class="row"><span>Cash Received:</span><span class="right">${t(l?.cash_received??a?.amount_received??0)}</span></div>
       <div class="row"><span>Change:</span><span class="right">${t(l?.change??0)}</span></div>`:""}

  <hr/>
  <div class="center">
    <small>Abdara Road, Peshawar</small><br/>
    <small>info@goritmi.com</small><br/>
    <small>Thank you for your visit!</small>
  </div>

<script>
  async function ready() {
    try { if (document.fonts && document.fonts.ready) { await document.fonts.ready; } } catch(e){}
    window.focus();
    const mq = window.matchMedia && window.matchMedia('print');
    if (mq && mq.addEventListener) {
      mq.addEventListener('change', function(e){ if(!e.matches) setTimeout(function(){ window.close(); }, 300); });
    } else if (mq && mq.addListener) { // older browsers
      mq.addListener(function(mql){ if(!mql.matches) setTimeout(function(){ window.close(); }, 300); });
    }
    window.onafterprint = function(){ setTimeout(function(){ window.close(); }, 300); };
    setTimeout(function(){ window.print(); }, 200);
  }
  if (document.readyState === 'complete') ready();
  else window.addEventListener('load', ready);
<\/script>
</body>
</html>
`,U=window.open("","","width=420,height=640");if(!U){console.error("Popup blocked or failed to open"),alert("Please allow popups for this site to print receipts");return}U.document.open(),U.document.write(Re),U.document.close()}const ae=v([]),oe=v(!1);ce(async()=>{oe.value=!0;try{const l=await axios.get("/api/printers");ae.value=l.data.data.filter(t=>t.is_connected===!0||t.status==="OK").map(t=>({label:`${t.name}`,value:t.name,driver:t.driver,port:t.port}))}catch(l){console.error("Failed to fetch printers:",l)}finally{oe.value=!1}});const $e=l=>{if(!l||!l.payment)return!1;const t=l.payment.payment_type?.toLowerCase(),s=l.status?.toLowerCase(),a=l.payment.refund_status?.toLowerCase();return(s==="paid"||s==="cancelled")&&(t==="card"||t==="split")&&(!a||a==="none")},Te=async l=>{if(!l)return;l.payment?.payment_type?.toLowerCase();const t=l.total_amount,s=l.payment?.card_amount||t;c.value=l,D.value=Number(s).toFixed(2),S.value="";const a=document.getElementById("refundModal");a&&new bootstrap.Modal(a).show()},De=async()=>{if(!c.value)return;const l=Number(D.value);if(l<=0){x.error("Refund amount must be greater than 0");return}const t=c.value.payment?.payment_type?.toLowerCase(),s=c.value.payment?.card_amount||c.value.total_amount;if(l>s){x.error(`Refund amount cannot exceed ${w(s)}`);return}$.value=c.value.id;try{const a=await axios.post(`/api/pos/orders/${c.value.id}/refund`,{amount:l,reason:S.value||"Refund requested by admin",payment_type:t});if(a.data.success){x.success(`Refund of ${w(l)} processed successfully`);const i=g.value.findIndex(u=>u.id===c.value.id);i!==-1&&(g.value[i]=a.data.order);const _=document.getElementById("refundModal");if(_){const u=bootstrap.Modal.getInstance(_);u&&u.hide()}c.value=null,D.value=0,S.value=""}}catch(a){console.error("Error processing refund:",a),x.error(a.response?.data?.message||"Failed to process refund")}finally{$.value=null}},ne=()=>{const l=document.getElementById("refundModal");if(l){const t=bootstrap.Modal.getInstance(l);t&&t.hide()}c.value=null,D.value=0,S.value=""},Z=v(!1),M=v(null),Se=l=>{l&&(M.value=l,Z.value=!0)},de=()=>{Z.value=!1,M.value=null},Oe=async l=>{if(M.value){F.value=M.value.id;try{const t=await axios.post(`/api/pos/orders/${M.value.id}/cancel`,{reason:l});if(t.data.success){x.success("Order cancelled and stock restored successfully");const s=g.value.findIndex(a=>a.id===M.value.id);s!==-1&&(g.value[s]=t.data.order),de()}}catch(t){console.error("Error cancelling order:",t),x.error(t.response?.data?.message||"Failed to cancel order")}finally{F.value=null}}},J=l=>{if(!g.value||g.value.length===0){x.error("No orders data to download");return}const t=j.value.trim()?Y.value:g.value;if(t.length===0){x.error("No orders found to download");return}try{l==="pdf"?Fe(t):l==="excel"?Pe(t):l==="csv"?Me(t):x.error("Invalid download type")}catch(s){console.error("Download failed:",s),x.error(`Download failed: ${s.message}`)}},Me=l=>{try{const t=["Order ID","Table No.","Order Type","Date","Customer","Payment Type","Sub Total","Promo Discount","Sales Discount","Approved Discount","Tax","Service Charges","Delivery Charges","Total Amount","Status","Promo Name"],s=l.map(n=>[`"${n.id||""}"`,`"${n.type?.table_number||"-"}"`,`"${n.type?.order_type||"-"}"`,`"${E(n.created_at)}"`,`"${n.customer_name||"-"}"`,`"${n.payment?.payment_type||"-"}"`,`"${n.sub_total||0}"`,`"${n.promo?.[0]?.discount_amount||0}"`,`"${n.sales_discount||0}"`,`"${n.approved_discounts||0}"`,`"${n.tax||0}"`,`"${n.service_charges||0}"`,`"${n.delivery_charges||0}"`,`"${n.total_amount||0}"`,`"${n.status||""}"`,`"${n.promo?.[0]?.promo_name||"-"}"`]),a=[t.join(","),...s.map(n=>n.join(","))].join(`
`),i=new Blob([a],{type:"text/csv;charset=utf-8;"}),_=URL.createObjectURL(i),u=document.createElement("a");u.setAttribute("href",_),u.setAttribute("download",`Orders_${new Date().toISOString().split("T")[0]}.csv`),document.body.appendChild(u),u.click(),document.body.removeChild(u),x.success("CSV downloaded successfully")}catch(t){console.error("CSV generation error:",t),x.error(`CSV generation failed: ${t.message}`,{autoClose:5e3})}},Fe=l=>{try{const t=new Ke("l","mm","a4");t.setFontSize(18),t.setFont("helvetica","bold"),t.text("Orders Report",14,20),t.setFontSize(10),t.setFont("helvetica","normal");const s=new Date().toLocaleString();t.text(`Generated on: ${s}`,14,28),t.text(`Total Orders: ${l.length}`,14,34);const a=["Order ID","Table","Type","Date","Customer","Payment","Sub Total","Promo Disc.","Sales Disc.","Total","Status"],i=l.map(u=>[u.id||"",u.type?.table_number||"-",u.type?.order_type||"-",E(u.created_at),u.customer_name||"-",u.payment?.payment_type||"-",`£${Number(u.sub_total||0).toFixed(2)}`,`£${Number(u.promo?.[0]?.discount_amount||0).toFixed(2)}`,`£${Number(u.sales_discount||0).toFixed(2)}`,`£${Number(u.total_amount||0).toFixed(2)}`,u.status||""]);Ye(t,{head:[a],body:i,startY:40,styles:{fontSize:8,cellPadding:2,halign:"left",lineColor:[0,0,0],lineWidth:.1},headStyles:{fillColor:[41,128,185],textColor:255,fontStyle:"bold"},alternateRowStyles:{fillColor:[245,245,245]},margin:{left:14,right:14},didDrawPage:u=>{const n=t.internal.getNumberOfPages(),N=t.internal.pageSize.height;t.setFontSize(8),t.text(`Page ${u.pageNumber} of ${n}`,u.settings.margin.left,N-10)}});const _=`Orders_${new Date().toISOString().split("T")[0]}.pdf`;t.save(_),x.success("PDF downloaded successfully")}catch(t){console.error("PDF generation error:",t),x.error(`PDF generation failed: ${t.message}`,{autoClose:5e3})}},Pe=l=>{try{if(typeof Qe>"u")throw new Error("XLSX library is not loaded");const t=l.map(n=>({"Order ID":n.id||"","Table No.":n.type?.table_number||"-","Order Type":n.type?.order_type||"-",Date:E(n.created_at),Customer:n.customer_name||"-","Payment Type":n.payment?.payment_type||"-","Sub Total":Number(n.sub_total||0).toFixed(2),"Promo Discount":Number(n.promo?.[0]?.discount_amount||0).toFixed(2),"Sales Discount":Number(n.sales_discount||0).toFixed(2),"Approved Discount":Number(n.approved_discounts||0).toFixed(2),Tax:Number(n.tax||0).toFixed(2),"Service Charges":Number(n.service_charges||0).toFixed(2),"Delivery Charges":Number(n.delivery_charges||0).toFixed(2),"Total Amount":Number(n.total_amount||0).toFixed(2),Status:n.status||"","Promo Name":n.promo?.[0]?.promo_name||"-"})),s=B.book_new(),a=B.json_to_sheet(t);a["!cols"]=[{wch:10},{wch:10},{wch:12},{wch:12},{wch:20},{wch:12},{wch:12},{wch:15},{wch:15},{wch:17},{wch:10},{wch:15},{wch:16},{wch:13},{wch:10},{wch:20}],B.book_append_sheet(s,a,"Orders");const i=[{Info:"Generated On",Value:new Date().toLocaleString()},{Info:"Total Records",Value:l.length},{Info:"Total Revenue",Value:`£${l.reduce((n,N)=>n+Number(N.total_amount||0),0).toFixed(2)}`},{Info:"Exported By",Value:"Restaurant Management System"}],_=B.json_to_sheet(i);B.book_append_sheet(s,_,"Report Info");const u=`Orders_${new Date().toISOString().split("T")[0]}.xlsx`;Ze(s,u),x.success("Excel file downloaded successfully",{autoClose:2500})}catch(t){console.error("Excel generation error:",t),x.error(`Excel generation failed: ${t.message}`,{autoClose:5e3})}};return(l,t)=>(d(),r(A,null,[I(f(Ue),{title:"Orders"}),I(Xe,null,{default:ee(()=>[e("div",wt,[t[78]||(t[78]=e("h4",{class:"fw-semibold mb-3"},"Overall Orders",-1)),e("div",gt,[e("div",ht,[e("div",xt,[e("div",_t,[e("div",null,[e("h3",Ct,o(fe.value),1),t[9]||(t[9]=e("p",{class:"text-muted mb-0 small"},"Total Orders",-1))]),t[10]||(t[10]=e("div",{class:"rounded-circle p-2 d-flex align-items-center justify-content-center text-primary",style:{width:"40px",height:"40px"}},[e("i",{class:"bi bi-list-task fs-4"})],-1))])])]),e("div",kt,[e("div",$t,[e("div",Tt,[e("div",null,[e("h3",Dt,o(we.value),1),t[11]||(t[11]=e("p",{class:"text-muted mb-0 small"},"Completed Orders",-1))]),t[12]||(t[12]=e("div",{class:"rounded-circle p-3 d-flex align-items-center justify-content-center text-success",style:{width:"40px",height:"40px"}},[e("i",{class:"bi bi-check2-circle fs-4"})],-1))])])]),e("div",St,[e("div",Ot,[e("div",Mt,[e("div",null,[e("h3",Ft,o(ge.value),1),t[13]||(t[13]=e("p",{class:"text-muted mb-0 small"},"Pending Orders",-1))]),t[14]||(t[14]=e("div",{class:"rounded-circle p-3 d-flex align-items-center justify-content-center text-warning",style:{width:"40px",height:"40px"}},[e("i",{class:"bi bi-hourglass-split fs-4"})],-1))])])]),e("div",Pt,[e("div",jt,[e("div",Nt,[e("div",null,[e("h3",It,o(f(w)(he.value)),1),t[15]||(t[15]=e("p",{class:"text-muted mb-0 small"},"Total Revenue",-1))]),t[16]||(t[16]=e("div",{class:"rounded-circle p-3 d-flex align-items-center justify-content-center text-info",style:{width:"40px",height:"40px"}},[e("i",{class:"bi bi-currency-pound fs-4"})],-1))])])])]),e("div",At,[e("div",Lt,[e("div",Et,[t[24]||(t[24]=e("h5",{class:"mb-0 fw-semibold"},"Orders",-1)),e("div",Rt,[e("div",Bt,[t[17]||(t[17]=e("i",{class:"bi bi-search"},null,-1)),t[18]||(t[18]=e("input",{type:"email",name:"email",autocomplete:"email",style:{position:"absolute",left:"-9999px",width:"1px",height:"1px"},tabindex:"-1","aria-hidden":"true"},null,-1)),se.value?L((d(),r("input",{id:K,"onUpdate:modelValue":t[0]||(t[0]=s=>j.value=s),key:te.value,class:"form-control search-input",placeholder:"Search",type:"search",autocomplete:"new-password",name:K,role:"presentation",onFocus:t[1]||(t[1]=(...s)=>l.handleFocus&&l.handleFocus(...s))},null,32)),[[H,j.value]]):(d(),r("input",Vt))]),I(We,{modelValue:m.value,"onUpdate:modelValue":t[2]||(t[2]=s=>m.value=s),title:"Orders","modal-id":"orderFilterModal","modal-size":"modal-lg","sort-options":z.value.sortOptions,"status-options":z.value.statusOptions,"show-stock-status":!1,"show-price-range":!0,"show-date-range":!0,"price-label":"Total Amount Range",onApply:ye,onClear:be},{customFilters:ee(({filters:s})=>[e("div",zt,[t[20]||(t[20]=e("label",{class:"form-label fw-semibold text-dark"},[e("i",{class:"fas fa-concierge-bell me-2 text-muted"}),T("Order Type ")],-1)),L(e("select",{"onUpdate:modelValue":a=>s.orderType=a,class:"form-select"},[t[19]||(t[19]=e("option",{value:""},"All",-1)),(d(!0),r(A,null,X(z.value.orderTypeOptions,a=>(d(),r("option",{key:a.value,value:a.value},o(a.label),9,Ut))),128))],8,qt),[[me,s.orderType]])]),e("div",Gt,[t[22]||(t[22]=e("label",{class:"form-label fw-semibold text-dark"},[e("i",{class:"fas fa-credit-card me-2 text-muted"}),T("Payment Type ")],-1)),L(e("select",{"onUpdate:modelValue":a=>s.paymentType=a,class:"form-select"},[t[21]||(t[21]=e("option",{value:""},"All",-1)),(d(!0),r(A,null,X(z.value.paymentTypeOptions,a=>(d(),r("option",{key:a.value,value:a.value},o(a.label),9,Ht))),128))],8,Xt),[[me,s.paymentType]])])]),_:1},8,["modelValue","sort-options","status-options"]),e("div",Wt,[t[23]||(t[23]=e("button",{class:"btn btn-outline-secondary rounded-pill px-4 dropdown-toggle","data-bs-toggle":"dropdown"}," Export ",-1)),e("ul",Kt,[e("li",null,[e("a",{class:"dropdown-item py-2",href:"javascript:;",onClick:t[3]||(t[3]=s=>J("pdf"))}," Export as PDF ")]),e("li",null,[e("a",{class:"dropdown-item py-2",href:"javascript:;",onClick:t[4]||(t[4]=s=>J("excel"))}," Export as Excel ")]),e("li",null,[e("a",{class:"dropdown-item py-2",href:"javascript:;",onClick:t[5]||(t[5]=s=>J("csv"))}," Export as CSV ")])])])])]),e("div",Yt,[e("table",Qt,[t[28]||(t[28]=e("thead",{class:"border-top small text-muted"},[e("tr",null,[e("th",{style:{width:"70px"}},"S. #"),e("th",null,"Table No."),e("th",null,"Order Type"),e("th",null,"Date"),e("th",null,"Time"),e("th",null,"Customer"),e("th",null,"Payment Type"),e("th",null,"Total"),e("th",null,"Status"),e("th",null,"Source"),e("th",{class:"text-center"},"Actions")])],-1)),e("tbody",null,[b.value?(d(),r("tr",Zt,[...t[25]||(t[25]=[e("td",{colspan:"11",class:"text-center py-5"},[e("div",{class:"d-flex flex-column align-items-center justify-content-center"},[e("div",{class:"spinner-border mb-3",role:"status",style:{color:"#1B1670",width:"3rem",height:"3rem","border-width":"0.3em"}},[e("span",{class:"visually-hidden"},"Loading...")]),e("div",{class:"fw-semibold text-muted"},"Loading orders...")])],-1)])])):(d(),r(A,{key:1},[(d(!0),r(A,null,X(ve.value,(s,a)=>(d(),r("tr",{key:s.id},[e("td",null,o(a+1),1),e("td",null,o(s.type?.table_number??"-"),1),e("td",null,o(s.type?.order_type??"-"),1),e("td",null,o(f(V)(s.created_at)),1),e("td",null,o(le(s.created_at)),1),e("td",null,o(s.customer_name??"-"),1),e("td",null,[e("span",{class:"cursor-pointer",onClick:i=>_e(s.payment)},o(s.payment?.payment_type??"-"),9,Jt)]),e("td",null,o(f(w)(s.total_amount)),1),e("td",es,[e("span",{class:Ge(["badge px-4 py-2 rounded-pill",{"bg-danger":s?.status==="cancelled","bg-warning text-dark":s?.status==="refunded","bg-success":s?.status==="paid"}])},o(s?.status.charAt(0).toUpperCase()+s?.status.slice(1)),3)]),e("td",null,[e("span",ts,o(s.source==="Pos System"?"POS System":s.source==="website"?"Website":"-"),1)]),e("td",ss,[e("div",ls,[e("button",{onClick:i=>Ce(s),title:"View Details",class:"p-2 rounded-full text-primary hover:bg-gray-100"},[I(f(Je),{class:"w-4 h-4"})],8,as),s.status!=="cancelled"&&s.status!=="refunded"?(d(),r("button",{key:0,onClick:i=>Se(s),title:"Cancel Order",disabled:F.value===s.id,class:"p-2 rounded-full text-danger hover:bg-gray-100"},[I(f(et),{class:"w-4 h-4"})],8,os)):y("",!0),$e(s)?(d(),r("button",{key:1,onClick:i=>Te(s),title:"Refund Payment",disabled:$.value===s.id,class:"p-2 rounded-full text-warning hover:bg-gray-100"},[...t[26]||(t[26]=[e("i",{class:"bi bi-arrow-counterclockwise",style:{"font-size":"1rem"}},null,-1)])],8,ns)):y("",!0)])])]))),128)),!b.value&&Y.value.length===0?(d(),r("tr",ds,[...t[27]||(t[27]=[e("td",{colspan:"11",class:"text-center text-muted py-4"},[e("div",{class:"d-flex flex-column align-items-center justify-content-center py-3"},[e("i",{class:"bi bi-inbox",style:{"font-size":"2rem",opacity:"0.5","margin-bottom":"0.5rem"}}),e("div",{class:"fw-semibold"},"No orders found"),e("div",{class:"small text-secondary mt-1"},"Try adjusting your filters or date range")])],-1)])])):y("",!0)],64))])])])])]),e("div",rs,[e("div",is,[e("div",us,[t[38]||(t[38]=e("div",{class:"modal-header border-0 text-black"},[e("h6",{class:"modal-title fw-semibold"},[e("i",{class:"bi bi-credit-card me-2"}),T(" Payment Details ")]),e("button",{class:"absolute top-2 right-2 p-2 rounded-full hover:bg-gray-100 transition transform hover:scale-110","data-bs-dismiss":"modal","aria-label":"Close",title:"Close"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-danger",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})])])],-1)),e("div",cs,[e("div",ms,[e("div",ps,[e("div",vs,[e("div",ys,[t[29]||(t[29]=e("span",{class:"label"},"Payment Type",-1)),e("span",bs,o(h.value?.payment_type??"-"),1)])]),e("div",fs,[e("div",ws,[t[30]||(t[30]=e("span",{class:"label"},"Amount Received",-1)),e("span",gs,o(Q(h.value?.amount_received)),1)])]),h.value?.payment_type==="Split"?(d(),r("div",hs,[e("div",xs,[t[31]||(t[31]=e("span",{class:"label"},"Cash Amount",-1)),e("span",_s,o(Q(h.value?.cash_amount)),1)])])):y("",!0),h.value?.payment_type==="Split"?(d(),r("div",Cs,[e("div",ks,[t[32]||(t[32]=e("span",{class:"label"},"Card Amount",-1)),e("span",$s,o(Q(h.value?.card_amount)),1)])])):y("",!0),e("div",Ts,[e("div",Ds,[t[33]||(t[33]=e("span",{class:"label"},"Payment Date",-1)),e("span",Ss,o(E(h.value?.payment_date)),1)])]),h.value?.brand?(d(),r("div",Os,[e("div",Ms,[t[34]||(t[34]=e("span",{class:"label"},"Card Brand",-1)),e("span",Fs,o(h.value.brand),1)])])):y("",!0),h.value?.last_digits?(d(),r("div",Ps,[e("div",js,[t[35]||(t[35]=e("span",{class:"label"},"Last 4 Digits",-1)),e("span",Ns,"**** **** **** "+o(h.value.last_digits),1)])])):y("",!0),h.value?.exp_month?(d(),r("div",Is,[e("div",As,[t[36]||(t[36]=e("span",{class:"label"},"Expiry",-1)),e("span",Ls,o(h.value.exp_month)+"/"+o(h.value.exp_year),1)])])):y("",!0),h.value?.currency_code?(d(),r("div",Es,[e("div",Rs,[t[37]||(t[37]=e("span",{class:"label"},"Currency",-1)),e("span",Bs,o(h.value.currency_code),1)])])):y("",!0)])])])])])]),e("div",Vs,[e("div",zs,[e("div",qs,[e("div",Us,[e("div",Gs,[t[39]||(t[39]=e("span",{class:"badge bg-gradient rounded-circle p-3 shadow-sm",style:{background:`linear-gradient(
                                            135deg,
                                            #4e73df,
                                            #224abe
                                        )`}},[e("i",{class:"bi bi-receipt fs-5 text-black"})],-1)),e("div",Xs,[e("h5",Hs," Order #"+o(p.value?.id),1),e("small",Ws," Customer: "+o(p.value?.customer_name??"—"),1)])]),t[40]||(t[40]=e("button",{class:"absolute top-2 right-2 p-2 rounded-full hover:bg-gray-100 transition transform hover:scale-110","data-bs-dismiss":"modal","aria-label":"Close",title:"Close"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})])],-1))]),e("div",Ks,[p.value?(d(),r("div",Ys,[e("div",Qs,[t[43]||(t[43]=e("h6",{class:"fw-bold mb-3 text-primary"}," Order Details ",-1)),e("div",Zs,[e("div",Js,[t[41]||(t[41]=e("span",{class:"fw-semibold text-dark"},"Order Type:",-1)),T(" "+o(p.value?.type?.order_type??"—"),1)]),e("div",el,[t[42]||(t[42]=e("span",{class:"fw-semibold text-dark"},"Date:",-1)),T(" "+o(f(V)(p.value?.created_at)),1)])])]),t[75]||(t[75]=e("h6",{class:"fw-bold mb-3 text-primary"}," Order Items ",-1)),e("div",tl,[e("table",sl,[t[74]||(t[74]=e("thead",{class:"bg-light text-muted small"},[e("tr",null,[e("th",{class:"px-3"},"#"),e("th",null,"Item"),e("th",null,"Qty"),e("th",null,"Actual Price"),e("th",null,"="),e("th",null,"Promo Name"),e("th",null,"Total Price")])],-1)),e("tbody",null,[(d(!0),r(A,null,X(p.value.items??[],(s,a)=>(d(),r("tr",{key:s.id},[e("td",ll,o(a+1),1),e("td",null,o(s.title),1),e("td",null,o(s.quantity),1),e("td",al,o(f(w)(s.price)),1),t[44]||(t[44]=e("td",null,null,-1)),e("td",null,o(p.value.promo[0]?.promo_name||"-"),1),e("td",ol,o(f(w)(s.price)),1)]))),128)),p.value.promo?(d(),r("tr",nl,[t[45]||(t[45]=e("td",null,null,-1)),t[46]||(t[46]=e("td",null,null,-1)),t[47]||(t[47]=e("td",null,null,-1)),t[48]||(t[48]=e("td",{colspan:"3",class:"text-end text-muted text-adjusting"},"Promo Discount",-1)),e("td",dl," -"+o(f(w)(p.value.promo[0]?.discount_amount??0)),1)])):y("",!0),p.value.tax?(d(),r("tr",rl,[t[49]||(t[49]=e("td",null,null,-1)),t[50]||(t[50]=e("td",null,null,-1)),t[51]||(t[51]=e("td",null,null,-1)),t[52]||(t[52]=e("td",{colspan:"3",class:"text-end text-muted text-adjusting"},"Tax",-1)),e("td",il," +"+o(f(w)(p.value.tax??0)),1)])):y("",!0),p.value.service_charges?(d(),r("tr",ul,[t[53]||(t[53]=e("td",null,null,-1)),t[54]||(t[54]=e("td",null,null,-1)),t[55]||(t[55]=e("td",null,null,-1)),t[56]||(t[56]=e("td",{colspan:"3",class:"text-end text-muted text-adjusting"},"Service Charges",-1)),e("td",cl," +"+o(f(w)(p.value.service_charges??0)),1)])):y("",!0),p.value.delivery_charges?(d(),r("tr",ml,[t[57]||(t[57]=e("td",null,null,-1)),t[58]||(t[58]=e("td",null,null,-1)),t[59]||(t[59]=e("td",null,null,-1)),t[60]||(t[60]=e("td",{colspan:"3",class:"text-end text-muted text-adjusting"},"Delivery Charges",-1)),e("td",pl," +"+o(f(w)(p.value.delivery_charges??0)),1)])):y("",!0),p.value.sales_discount?(d(),r("tr",vl,[t[61]||(t[61]=e("td",null,null,-1)),t[62]||(t[62]=e("td",null,null,-1)),t[63]||(t[63]=e("td",null,null,-1)),t[64]||(t[64]=e("td",{colspan:"3",class:"text-end text-muted text-adjusting"},"Sales Discount",-1)),e("td",yl," +"+o(f(w)(p.value.sales_discount??0)),1)])):y("",!0),p.value.approved_discounts?(d(),r("tr",bl,[t[65]||(t[65]=e("td",null,null,-1)),t[66]||(t[66]=e("td",null,null,-1)),t[67]||(t[67]=e("td",null,null,-1)),t[68]||(t[68]=e("td",{colspan:"3",class:"text-end text-muted text-adjusting"},"Approved Discounts",-1)),e("td",fl," +"+o(f(w)(p.value.approved_discounts??0)),1)])):y("",!0),e("tr",wl,[t[69]||(t[69]=e("td",null,null,-1)),t[70]||(t[70]=e("td",null,null,-1)),t[71]||(t[71]=e("td",null,null,-1)),t[72]||(t[72]=e("td",{colspan:"3",class:"text-end text-muted text-adjusting"},"Grand Total ",-1)),e("td",gl,o(f(w)(p.value.total_amount)),1)]),(p.value.items??[]).length===0?(d(),r("tr",hl,[...t[73]||(t[73]=[e("td",{colspan:"7",class:"text-center text-muted py-4"}," No items found ",-1)])])):y("",!0)])])])])):y("",!0)]),e("div",xl,[t[77]||(t[77]=e("button",{class:"btn btn-secondary px-2 py-2","data-bs-dismiss":"modal"}," Close ",-1)),ae.value.length>0?(d(),r("button",{key:0,class:"btn btn-primary shadow-sm rounded-pill px-4 py-2",onClick:t[6]||(t[6]=s=>ke(p.value))},[...t[76]||(t[76]=[e("i",{class:"bi bi-printer me-1"},null,-1),T(" Print Receipt ",-1)])])):y("",!0)])])])])]),e("div",_l,[e("div",Cl,[e("div",kl,[e("div",{class:"modal-header border-0"},[t[80]||(t[80]=e("h5",{class:"modal-title fw-bold"},[e("i",{class:"bi bi-arrow-counterclockwise text-warning me-2"}),T(" Process Refund ")],-1)),e("button",{onClick:ne,class:"absolute top-2 right-2 p-2 rounded-full hover:bg-gray-100 transition transform hover:scale-110","data-bs-dismiss":"modal","aria-label":"Close",title:"Close"},[...t[79]||(t[79]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("div",$l,[t[91]||(t[91]=e("div",{class:"alert alert-warning d-flex align-items-start gap-2"},[e("i",{class:"bi bi-exclamation-triangle-fill mt-1"}),e("div",null,[e("strong",null,"Important:"),T(" This will process a refund to the customer's card. This action cannot be undone. ")])],-1)),e("div",Tl,[t[87]||(t[87]=e("label",{class:"form-label fw-semibold"},"Order Details",-1)),e("div",Dl,[e("div",Sl,[t[81]||(t[81]=e("span",{class:"text-muted"},"Order #:",-1)),e("span",Ol,o(c.value?.id),1)]),e("div",Ml,[t[82]||(t[82]=e("span",{class:"text-muted"},"Customer:",-1)),e("span",Fl,o(c.value?.customer_name||"Walk In"),1)]),e("div",Pl,[t[83]||(t[83]=e("span",{class:"text-muted"},"Total Amount:",-1)),e("span",jl,o(f(w)(c.value?.total_amount)),1)]),e("div",Nl,[t[84]||(t[84]=e("span",{class:"text-muted"},"Payment Type:",-1)),e("span",Il,o(c.value?.payment?.payment_type),1)]),c.value?.payment?.payment_type?.toLowerCase()==="split"?(d(),r("div",Al,[t[85]||(t[85]=e("span",{class:"text-muted"},"Card Amount:",-1)),e("span",Ll,o(f(w)(c.value?.payment?.card_amount)),1)])):y("",!0),c.value?.payment?.brand?(d(),r("div",El,[t[86]||(t[86]=e("span",{class:"text-muted"},"Card:",-1)),e("span",Rl,o(c.value.payment.brand)+" •••• "+o(c.value.payment.last_digits),1)])):y("",!0)])]),e("div",Bl,[t[89]||(t[89]=e("label",{class:"form-label fw-semibold"},"Refund Amount",-1)),e("div",Vl,[t[88]||(t[88]=e("span",{class:"input-group-text"},"£",-1)),L(e("input",{"onUpdate:modelValue":t[7]||(t[7]=s=>D.value=s),type:"number",class:"form-control",max:c.value?.payment?.card_amount||c.value?.total_amount,step:"0.01",min:"0.01",required:""},null,8,zl),[[H,D.value,void 0,{number:!0}]])]),e("small",ql," Maximum: "+o(f(w)(c.value?.payment?.card_amount||c.value?.total_amount)),1)]),e("div",Ul,[t[90]||(t[90]=e("label",{class:"form-label fw-semibold"},"Refund Reason (Optional)",-1)),L(e("textarea",{"onUpdate:modelValue":t[8]||(t[8]=s=>S.value=s),class:"form-control",rows:"3",placeholder:"Enter reason for refund...",maxlength:"500"},null,512),[[H,S.value]]),e("small",Gl,o(S.value.length)+"/500 characters",1)])]),e("div",Xl,[e("button",{type:"button",class:"btn btn-secondary px-2 py-2",onClick:ne,disabled:$.value!==null}," Cancel ",8,Hl),e("button",{type:"button",class:"btn btn-primary px-2 py-2",onClick:De,disabled:$.value!==null||!D.value||D.value<=0},[$.value?(d(),r("span",Kl,[...t[92]||(t[92]=[e("span",{class:"spinner-border spinner-border-sm me-2"},null,-1),T(" Processing... ",-1)])])):(d(),r("span",Yl,[...t[93]||(t[93]=[e("i",{class:"bi bi-arrow-counterclockwise me-1"},null,-1),T(" Process Refund ",-1)])]))],8,Wl)])])])]),I(ft,{show:Z.value,order:M.value,loading:F.value===M.value?.id,onConfirm:Oe,onCancel:de},null,8,["show","order","loading"])]),_:1})],64))}},ca=pe(Ql,[["__scopeId","data-v-fc7436b1"]]);export{ca as default};
